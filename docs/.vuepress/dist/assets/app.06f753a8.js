const Ui={},jo="modulepreload",Gi={},Vo="/",ir=function(t,a){return!a||a.length===0?t():Promise.all(a.map(x=>{if(x=`${Vo}${x}`,x in Gi)return;Gi[x]=!0;const F=x.endsWith(".css"),W=F?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${W}`))return;const N=document.createElement("link");if(N.rel=F?"stylesheet":jo,F||(N.as="script",N.crossOrigin=""),N.href=x,document.head.appendChild(N),F)return new Promise((O,v)=>{N.addEventListener("load",O),N.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${x}`)))})})).then(()=>t())},Yo={"v-8daa1a0e":()=>ir(()=>import("./index.html.092ff4f9.js"),[]).then(({data:e})=>e),"v-3706649a":()=>ir(()=>import("./404.html.7d858b3d.js"),[]).then(({data:e})=>e)};function ai(e,t){const a=Object.create(null),x=e.split(",");for(let F=0;F<x.length;F++)a[x[F]]=!0;return t?F=>!!a[F.toLowerCase()]:F=>!!a[F]}function cn(e){if(ce(e)){const t={};for(let a=0;a<e.length;a++){const x=e[a],F=Te(x)?Qo(x):cn(x);if(F)for(const W in F)t[W]=F[W]}return t}else{if(Te(e))return e;if(xe(e))return e}}const zo=/;(?![^(]*\))/g,$o=/:([^]+)/,Xo=/\/\*.*?\*\//gs;function Qo(e){const t={};return e.replace(Xo,"").split(zo).forEach(a=>{if(a){const x=a.split($o);x.length>1&&(t[x[0].trim()]=x[1].trim())}}),t}function br(e){let t="";if(Te(e))t=e;else if(ce(e))for(let a=0;a<e.length;a++){const x=br(e[a]);x&&(t+=x+" ")}else if(xe(e))for(const a in e)e[a]&&(t+=a+" ");return t.trim()}const Jo="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Zo=ai(Jo);function Js(e){return!!e||e===""}const qo=e=>Te(e)?e:e==null?"":ce(e)||xe(e)&&(e.toString===ta||!he(e.toString))?JSON.stringify(e,Zs,2):String(e),Zs=(e,t)=>t&&t.__v_isRef?Zs(e,t.value):er(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((a,[x,F])=>(a[`${x} =>`]=F,a),{})}:qs(t)?{[`Set(${t.size})`]:[...t.values()]}:xe(t)&&!ce(t)&&!ra(t)?String(t):t,_e={},qt=[],ot=()=>{},el=()=>!1,tl=/^on[^a-z]/,Or=e=>tl.test(e),oi=e=>e.startsWith("onUpdate:"),Ue=Object.assign,li=(e,t)=>{const a=e.indexOf(t);a>-1&&e.splice(a,1)},rl=Object.prototype.hasOwnProperty,me=(e,t)=>rl.call(e,t),ce=Array.isArray,er=e=>dn(e)==="[object Map]",qs=e=>dn(e)==="[object Set]",he=e=>typeof e=="function",Te=e=>typeof e=="string",ui=e=>typeof e=="symbol",xe=e=>e!==null&&typeof e=="object",ea=e=>xe(e)&&he(e.then)&&he(e.catch),ta=Object.prototype.toString,dn=e=>ta.call(e),nl=e=>dn(e).slice(8,-1),ra=e=>dn(e)==="[object Object]",fi=e=>Te(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,yr=ai(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),hn=e=>{const t=Object.create(null);return a=>t[a]||(t[a]=e(a))},il=/-(\w)/g,ht=hn(e=>e.replace(il,(t,a)=>a?a.toUpperCase():"")),sl=/\B([A-Z])/g,$t=hn(e=>e.replace(sl,"-$1").toLowerCase()),vn=hn(e=>e.charAt(0).toUpperCase()+e.slice(1)),Dn=hn(e=>e?`on${vn(e)}`:""),Ar=(e,t)=>!Object.is(e,t),Pn=(e,t)=>{for(let a=0;a<e.length;a++)e[a](t)},Zr=(e,t,a)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:a})},al=e=>{const t=parseFloat(e);return isNaN(t)?e:t},ol=e=>{const t=Te(e)?Number(e):NaN;return isNaN(t)?e:t};let ji;const ll=()=>ji||(ji=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let Ye;class ul{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Ye,!t&&Ye&&(this.index=(Ye.scopes||(Ye.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const a=Ye;try{return Ye=this,t()}finally{Ye=a}}}on(){Ye=this}off(){Ye=this.parent}stop(t){if(this._active){let a,x;for(a=0,x=this.effects.length;a<x;a++)this.effects[a].stop();for(a=0,x=this.cleanups.length;a<x;a++)this.cleanups[a]();if(this.scopes)for(a=0,x=this.scopes.length;a<x;a++)this.scopes[a].stop(!0);if(!this.detached&&this.parent&&!t){const F=this.parent.scopes.pop();F&&F!==this&&(this.parent.scopes[this.index]=F,F.index=this.index)}this.parent=void 0,this._active=!1}}}function fl(e,t=Ye){t&&t.active&&t.effects.push(e)}function na(){return Ye}function cl(e){Ye&&Ye.cleanups.push(e)}const ci=e=>{const t=new Set(e);return t.w=0,t.n=0,t},ia=e=>(e.w&Ct)>0,sa=e=>(e.n&Ct)>0,dl=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=Ct},hl=e=>{const{deps:t}=e;if(t.length){let a=0;for(let x=0;x<t.length;x++){const F=t[x];ia(F)&&!sa(F)?F.delete(e):t[a++]=F,F.w&=~Ct,F.n&=~Ct}t.length=a}},qr=new WeakMap;let Er=0,Ct=1;const jn=30;let st;const Vt=Symbol(""),Vn=Symbol("");class di{constructor(t,a=null,x){this.fn=t,this.scheduler=a,this.active=!0,this.deps=[],this.parent=void 0,fl(this,x)}run(){if(!this.active)return this.fn();let t=st,a=Rt;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=st,st=this,Rt=!0,Ct=1<<++Er,Er<=jn?dl(this):Vi(this),this.fn()}finally{Er<=jn&&hl(this),Ct=1<<--Er,st=this.parent,Rt=a,this.parent=void 0,this.deferStop&&this.stop()}}stop(){st===this?this.deferStop=!0:this.active&&(Vi(this),this.onStop&&this.onStop(),this.active=!1)}}function Vi(e){const{deps:t}=e;if(t.length){for(let a=0;a<t.length;a++)t[a].delete(e);t.length=0}}let Rt=!0;const aa=[];function cr(){aa.push(Rt),Rt=!1}function dr(){const e=aa.pop();Rt=e===void 0?!0:e}function je(e,t,a){if(Rt&&st){let x=qr.get(e);x||qr.set(e,x=new Map);let F=x.get(a);F||x.set(a,F=ci()),oa(F)}}function oa(e,t){let a=!1;Er<=jn?sa(e)||(e.n|=Ct,a=!ia(e)):a=!e.has(st),a&&(e.add(st),st.deps.push(e))}function yt(e,t,a,x,F,W){const N=qr.get(e);if(!N)return;let O=[];if(t==="clear")O=[...N.values()];else if(a==="length"&&ce(e)){const v=Number(x);N.forEach((M,S)=>{(S==="length"||S>=v)&&O.push(M)})}else switch(a!==void 0&&O.push(N.get(a)),t){case"add":ce(e)?fi(a)&&O.push(N.get("length")):(O.push(N.get(Vt)),er(e)&&O.push(N.get(Vn)));break;case"delete":ce(e)||(O.push(N.get(Vt)),er(e)&&O.push(N.get(Vn)));break;case"set":er(e)&&O.push(N.get(Vt));break}if(O.length===1)O[0]&&Yn(O[0]);else{const v=[];for(const M of O)M&&v.push(...M);Yn(ci(v))}}function Yn(e,t){const a=ce(e)?e:[...e];for(const x of a)x.computed&&Yi(x);for(const x of a)x.computed||Yi(x)}function Yi(e,t){(e!==st||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}function vl(e,t){var a;return(a=qr.get(e))===null||a===void 0?void 0:a.get(t)}const gl=ai("__proto__,__v_isRef,__isVue"),la=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(ui)),ml=hi(),pl=hi(!1,!0),El=hi(!0),zi=yl();function yl(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...a){const x=pe(this);for(let W=0,N=this.length;W<N;W++)je(x,"get",W+"");const F=x[t](...a);return F===-1||F===!1?x[t](...a.map(pe)):F}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...a){cr();const x=pe(this)[t].apply(this,a);return dr(),x}}),e}function Tl(e){const t=pe(this);return je(t,"has",e),t.hasOwnProperty(e)}function hi(e=!1,t=!1){return function(x,F,W){if(F==="__v_isReactive")return!e;if(F==="__v_isReadonly")return e;if(F==="__v_isShallow")return t;if(F==="__v_raw"&&W===(e?t?kl:ha:t?da:ca).get(x))return x;const N=ce(x);if(!e){if(N&&me(zi,F))return Reflect.get(zi,F,W);if(F==="hasOwnProperty")return Tl}const O=Reflect.get(x,F,W);return(ui(F)?la.has(F):gl(F))||(e||je(x,"get",F),t)?O:Me(O)?N&&fi(F)?O:O.value:xe(O)?e?mi(O):hr(O):O}}const _l=ua(),Sl=ua(!0);function ua(e=!1){return function(a,x,F,W){let N=a[x];if(sr(N)&&Me(N)&&!Me(F))return!1;if(!e&&(!en(F)&&!sr(F)&&(N=pe(N),F=pe(F)),!ce(a)&&Me(N)&&!Me(F)))return N.value=F,!0;const O=ce(a)&&fi(x)?Number(x)<a.length:me(a,x),v=Reflect.set(a,x,F,W);return a===pe(W)&&(O?Ar(F,N)&&yt(a,"set",x,F):yt(a,"add",x,F)),v}}function xl(e,t){const a=me(e,t);e[t];const x=Reflect.deleteProperty(e,t);return x&&a&&yt(e,"delete",t,void 0),x}function Ll(e,t){const a=Reflect.has(e,t);return(!ui(t)||!la.has(t))&&je(e,"has",t),a}function Al(e){return je(e,"iterate",ce(e)?"length":Vt),Reflect.ownKeys(e)}const fa={get:ml,set:_l,deleteProperty:xl,has:Ll,ownKeys:Al},Dl={get:El,set(e,t){return!0},deleteProperty(e,t){return!0}},Pl=Ue({},fa,{get:pl,set:Sl}),vi=e=>e,gn=e=>Reflect.getPrototypeOf(e);function Kr(e,t,a=!1,x=!1){e=e.__v_raw;const F=pe(e),W=pe(t);a||(t!==W&&je(F,"get",t),je(F,"get",W));const{has:N}=gn(F),O=x?vi:a?Ei:Dr;if(N.call(F,t))return O(e.get(t));if(N.call(F,W))return O(e.get(W));e!==F&&e.get(t)}function Wr(e,t=!1){const a=this.__v_raw,x=pe(a),F=pe(e);return t||(e!==F&&je(x,"has",e),je(x,"has",F)),e===F?a.has(e):a.has(e)||a.has(F)}function Hr(e,t=!1){return e=e.__v_raw,!t&&je(pe(e),"iterate",Vt),Reflect.get(e,"size",e)}function $i(e){e=pe(e);const t=pe(this);return gn(t).has.call(t,e)||(t.add(e),yt(t,"add",e,e)),this}function Xi(e,t){t=pe(t);const a=pe(this),{has:x,get:F}=gn(a);let W=x.call(a,e);W||(e=pe(e),W=x.call(a,e));const N=F.call(a,e);return a.set(e,t),W?Ar(t,N)&&yt(a,"set",e,t):yt(a,"add",e,t),this}function Qi(e){const t=pe(this),{has:a,get:x}=gn(t);let F=a.call(t,e);F||(e=pe(e),F=a.call(t,e)),x&&x.call(t,e);const W=t.delete(e);return F&&yt(t,"delete",e,void 0),W}function Ji(){const e=pe(this),t=e.size!==0,a=e.clear();return t&&yt(e,"clear",void 0,void 0),a}function Gr(e,t){return function(x,F){const W=this,N=W.__v_raw,O=pe(N),v=t?vi:e?Ei:Dr;return!e&&je(O,"iterate",Vt),N.forEach((M,S)=>x.call(F,v(M),v(S),W))}}function jr(e,t,a){return function(...x){const F=this.__v_raw,W=pe(F),N=er(W),O=e==="entries"||e===Symbol.iterator&&N,v=e==="keys"&&N,M=F[e](...x),S=a?vi:t?Ei:Dr;return!t&&je(W,"iterate",v?Vn:Vt),{next(){const{value:k,done:R}=M.next();return R?{value:k,done:R}:{value:O?[S(k[0]),S(k[1])]:S(k),done:R}},[Symbol.iterator](){return this}}}}function _t(e){return function(...t){return e==="delete"?!1:this}}function Rl(){const e={get(W){return Kr(this,W)},get size(){return Hr(this)},has:Wr,add:$i,set:Xi,delete:Qi,clear:Ji,forEach:Gr(!1,!1)},t={get(W){return Kr(this,W,!1,!0)},get size(){return Hr(this)},has:Wr,add:$i,set:Xi,delete:Qi,clear:Ji,forEach:Gr(!1,!0)},a={get(W){return Kr(this,W,!0)},get size(){return Hr(this,!0)},has(W){return Wr.call(this,W,!0)},add:_t("add"),set:_t("set"),delete:_t("delete"),clear:_t("clear"),forEach:Gr(!0,!1)},x={get(W){return Kr(this,W,!0,!0)},get size(){return Hr(this,!0)},has(W){return Wr.call(this,W,!0)},add:_t("add"),set:_t("set"),delete:_t("delete"),clear:_t("clear"),forEach:Gr(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(W=>{e[W]=jr(W,!1,!1),a[W]=jr(W,!0,!1),t[W]=jr(W,!1,!0),x[W]=jr(W,!0,!0)}),[e,a,t,x]}const[Il,Cl,bl,Ol]=Rl();function gi(e,t){const a=t?e?Ol:bl:e?Cl:Il;return(x,F,W)=>F==="__v_isReactive"?!e:F==="__v_isReadonly"?e:F==="__v_raw"?x:Reflect.get(me(a,F)&&F in x?a:x,F,W)}const Ml={get:gi(!1,!1)},wl={get:gi(!1,!0)},Fl={get:gi(!0,!1)},ca=new WeakMap,da=new WeakMap,ha=new WeakMap,kl=new WeakMap;function Ul(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Bl(e){return e.__v_skip||!Object.isExtensible(e)?0:Ul(nl(e))}function hr(e){return sr(e)?e:pi(e,!1,fa,Ml,ca)}function Nl(e){return pi(e,!1,Pl,wl,da)}function mi(e){return pi(e,!0,Dl,Fl,ha)}function pi(e,t,a,x,F){if(!xe(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const W=F.get(e);if(W)return W;const N=Bl(e);if(N===0)return e;const O=new Proxy(e,N===2?x:a);return F.set(e,O),O}function tr(e){return sr(e)?tr(e.__v_raw):!!(e&&e.__v_isReactive)}function sr(e){return!!(e&&e.__v_isReadonly)}function en(e){return!!(e&&e.__v_isShallow)}function va(e){return tr(e)||sr(e)}function pe(e){const t=e&&e.__v_raw;return t?pe(t):e}function ga(e){return Zr(e,"__v_skip",!0),e}const Dr=e=>xe(e)?hr(e):e,Ei=e=>xe(e)?mi(e):e;function ma(e){Rt&&st&&(e=pe(e),oa(e.dep||(e.dep=ci())))}function pa(e,t){e=pe(e);const a=e.dep;a&&Yn(a)}function Me(e){return!!(e&&e.__v_isRef===!0)}function ke(e){return ya(e,!1)}function Ea(e){return ya(e,!0)}function ya(e,t){return Me(e)?e:new Kl(e,t)}class Kl{constructor(t,a){this.__v_isShallow=a,this.dep=void 0,this.__v_isRef=!0,this._rawValue=a?t:pe(t),this._value=a?t:Dr(t)}get value(){return ma(this),this._value}set value(t){const a=this.__v_isShallow||en(t)||sr(t);t=a?t:pe(t),Ar(t,this._rawValue)&&(this._rawValue=t,this._value=a?t:Dr(t),pa(this))}}function lt(e){return Me(e)?e.value:e}const Wl={get:(e,t,a)=>lt(Reflect.get(e,t,a)),set:(e,t,a,x)=>{const F=e[t];return Me(F)&&!Me(a)?(F.value=a,!0):Reflect.set(e,t,a,x)}};function Ta(e){return tr(e)?e:new Proxy(e,Wl)}function Mh(e){const t=ce(e)?new Array(e.length):{};for(const a in e)t[a]=Gl(e,a);return t}class Hl{constructor(t,a,x){this._object=t,this._key=a,this._defaultValue=x,this.__v_isRef=!0}get value(){const t=this._object[this._key];return t===void 0?this._defaultValue:t}set value(t){this._object[this._key]=t}get dep(){return vl(pe(this._object),this._key)}}function Gl(e,t,a){const x=e[t];return Me(x)?x:new Hl(e,t,a)}var _a;class jl{constructor(t,a,x,F){this._setter=a,this.dep=void 0,this.__v_isRef=!0,this[_a]=!1,this._dirty=!0,this.effect=new di(t,()=>{this._dirty||(this._dirty=!0,pa(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!F,this.__v_isReadonly=x}get value(){const t=pe(this);return ma(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}_a="__v_isReadonly";function Vl(e,t,a=!1){let x,F;const W=he(e);return W?(x=e,F=ot):(x=e.get,F=e.set),new jl(x,F,W||!F,a)}function It(e,t,a,x){let F;try{F=x?e(...x):e()}catch(W){Mr(W,t,a)}return F}function qe(e,t,a,x){if(he(e)){const W=It(e,t,a,x);return W&&ea(W)&&W.catch(N=>{Mr(N,t,a)}),W}const F=[];for(let W=0;W<e.length;W++)F.push(qe(e[W],t,a,x));return F}function Mr(e,t,a,x=!0){const F=t?t.vnode:null;if(t){let W=t.parent;const N=t.proxy,O=a;for(;W;){const M=W.ec;if(M){for(let S=0;S<M.length;S++)if(M[S](e,N,O)===!1)return}W=W.parent}const v=t.appContext.config.errorHandler;if(v){It(v,null,10,[e,N,O]);return}}Yl(e,a,F,x)}function Yl(e,t,a,x=!0){console.error(e)}let Pr=!1,zn=!1;const Ne=[];let dt=0;const rr=[];let mt=null,Wt=0;const Sa=Promise.resolve();let yi=null;function Ti(e){const t=yi||Sa;return e?t.then(this?e.bind(this):e):t}function zl(e){let t=dt+1,a=Ne.length;for(;t<a;){const x=t+a>>>1;Rr(Ne[x])<e?t=x+1:a=x}return t}function mn(e){(!Ne.length||!Ne.includes(e,Pr&&e.allowRecurse?dt+1:dt))&&(e.id==null?Ne.push(e):Ne.splice(zl(e.id),0,e),xa())}function xa(){!Pr&&!zn&&(zn=!0,yi=Sa.then(La))}function $l(e){const t=Ne.indexOf(e);t>dt&&Ne.splice(t,1)}function Xl(e){ce(e)?rr.push(...e):(!mt||!mt.includes(e,e.allowRecurse?Wt+1:Wt))&&rr.push(e),xa()}function Zi(e,t=Pr?dt+1:0){for(;t<Ne.length;t++){const a=Ne[t];a&&a.pre&&(Ne.splice(t,1),t--,a())}}function tn(e){if(rr.length){const t=[...new Set(rr)];if(rr.length=0,mt){mt.push(...t);return}for(mt=t,mt.sort((a,x)=>Rr(a)-Rr(x)),Wt=0;Wt<mt.length;Wt++)mt[Wt]();mt=null,Wt=0}}const Rr=e=>e.id==null?1/0:e.id,Ql=(e,t)=>{const a=Rr(e)-Rr(t);if(a===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return a};function La(e){zn=!1,Pr=!0,Ne.sort(Ql);const t=ot;try{for(dt=0;dt<Ne.length;dt++){const a=Ne[dt];a&&a.active!==!1&&It(a,null,14)}}finally{dt=0,Ne.length=0,tn(),Pr=!1,yi=null,(Ne.length||rr.length)&&La()}}function Jl(e,t,...a){if(e.isUnmounted)return;const x=e.vnode.props||_e;let F=a;const W=t.startsWith("update:"),N=W&&t.slice(7);if(N&&N in x){const S=`${N==="modelValue"?"model":N}Modifiers`,{number:k,trim:R}=x[S]||_e;R&&(F=a.map(K=>Te(K)?K.trim():K)),k&&(F=a.map(al))}let O,v=x[O=Dn(t)]||x[O=Dn(ht(t))];!v&&W&&(v=x[O=Dn($t(t))]),v&&qe(v,e,6,F);const M=x[O+"Once"];if(M){if(!e.emitted)e.emitted={};else if(e.emitted[O])return;e.emitted[O]=!0,qe(M,e,6,F)}}function Aa(e,t,a=!1){const x=t.emitsCache,F=x.get(e);if(F!==void 0)return F;const W=e.emits;let N={},O=!1;if(!he(e)){const v=M=>{const S=Aa(M,t,!0);S&&(O=!0,Ue(N,S))};!a&&t.mixins.length&&t.mixins.forEach(v),e.extends&&v(e.extends),e.mixins&&e.mixins.forEach(v)}return!W&&!O?(xe(e)&&x.set(e,null),null):(ce(W)?W.forEach(v=>N[v]=null):Ue(N,W),xe(e)&&x.set(e,N),N)}function pn(e,t){return!e||!Or(t)?!1:(t=t.slice(2).replace(/Once$/,""),me(e,t[0].toLowerCase()+t.slice(1))||me(e,$t(t))||me(e,t))}let Fe=null,Da=null;function rn(e){const t=Fe;return Fe=e,Da=e&&e.type.__scopeId||null,t}function Zl(e,t=Fe,a){if(!t||e._n)return e;const x=(...F)=>{x._d&&ls(-1);const W=rn(t);let N;try{N=e(...F)}finally{rn(W),x._d&&ls(1)}return N};return x._n=!0,x._c=!0,x._d=!0,x}function Rn(e){const{type:t,vnode:a,proxy:x,withProxy:F,props:W,propsOptions:[N],slots:O,attrs:v,emit:M,render:S,renderCache:k,data:R,setupState:K,ctx:b,inheritAttrs:I}=e;let C,L;const A=rn(e);try{if(a.shapeFlag&4){const D=F||x;C=it(S.call(D,D,k,W,K,R,b)),L=v}else{const D=t;C=it(D.length>1?D(W,{attrs:v,slots:O,emit:M}):D(W,null)),L=t.props?v:ql(v)}}catch(D){Sr.length=0,Mr(D,e,1),C=Ie(ze)}let h=C;if(L&&I!==!1){const D=Object.keys(L),{shapeFlag:T}=h;D.length&&T&7&&(N&&D.some(oi)&&(L=eu(L,N)),h=bt(h,L))}return a.dirs&&(h=bt(h),h.dirs=h.dirs?h.dirs.concat(a.dirs):a.dirs),a.transition&&(h.transition=a.transition),C=h,rn(A),C}const ql=e=>{let t;for(const a in e)(a==="class"||a==="style"||Or(a))&&((t||(t={}))[a]=e[a]);return t},eu=(e,t)=>{const a={};for(const x in e)(!oi(x)||!(x.slice(9)in t))&&(a[x]=e[x]);return a};function tu(e,t,a){const{props:x,children:F,component:W}=e,{props:N,children:O,patchFlag:v}=t,M=W.emitsOptions;if(t.dirs||t.transition)return!0;if(a&&v>=0){if(v&1024)return!0;if(v&16)return x?qi(x,N,M):!!N;if(v&8){const S=t.dynamicProps;for(let k=0;k<S.length;k++){const R=S[k];if(N[R]!==x[R]&&!pn(M,R))return!0}}}else return(F||O)&&(!O||!O.$stable)?!0:x===N?!1:x?N?qi(x,N,M):!0:!!N;return!1}function qi(e,t,a){const x=Object.keys(t);if(x.length!==Object.keys(e).length)return!0;for(let F=0;F<x.length;F++){const W=x[F];if(t[W]!==e[W]&&!pn(a,W))return!0}return!1}function ru({vnode:e,parent:t},a){for(;t&&t.subTree===e;)(e=t.vnode).el=a,t=t.parent}const nu=e=>e.__isSuspense;function Pa(e,t){t&&t.pendingBranch?ce(e)?t.effects.push(...e):t.effects.push(e):Xl(e)}function Yt(e,t){if(Re){let a=Re.provides;const x=Re.parent&&Re.parent.provides;x===a&&(a=Re.provides=Object.create(x)),a[e]=t}}function Oe(e,t,a=!1){const x=Re||Fe;if(x){const F=x.parent==null?x.vnode.appContext&&x.vnode.appContext.provides:x.parent.provides;if(F&&e in F)return F[e];if(arguments.length>1)return a&&he(t)?t.call(x.proxy):t}}const Vr={};function Et(e,t,a){return Ra(e,t,a)}function Ra(e,t,{immediate:a,deep:x,flush:F,onTrack:W,onTrigger:N}=_e){const O=na()===(Re==null?void 0:Re.scope)?Re:null;let v,M=!1,S=!1;if(Me(e)?(v=()=>e.value,M=en(e)):tr(e)?(v=()=>e,x=!0):ce(e)?(S=!0,M=e.some(h=>tr(h)||en(h)),v=()=>e.map(h=>{if(Me(h))return h.value;if(tr(h))return jt(h);if(he(h))return It(h,O,2)})):he(e)?t?v=()=>It(e,O,2):v=()=>{if(!(O&&O.isUnmounted))return k&&k(),qe(e,O,3,[R])}:v=ot,t&&x){const h=v;v=()=>jt(h())}let k,R=h=>{k=L.onStop=()=>{It(h,O,4)}},K;if(lr)if(R=ot,t?a&&qe(t,O,3,[v(),S?[]:void 0,R]):v(),F==="sync"){const h=Ju();K=h.__watcherHandles||(h.__watcherHandles=[])}else return ot;let b=S?new Array(e.length).fill(Vr):Vr;const I=()=>{if(!!L.active)if(t){const h=L.run();(x||M||(S?h.some((D,T)=>Ar(D,b[T])):Ar(h,b)))&&(k&&k(),qe(t,O,3,[h,b===Vr?void 0:S&&b[0]===Vr?[]:b,R]),b=h)}else L.run()};I.allowRecurse=!!t;let C;F==="sync"?C=I:F==="post"?C=()=>He(I,O&&O.suspense):(I.pre=!0,O&&(I.id=O.uid),C=()=>mn(I));const L=new di(v,C);t?a?I():b=L.run():F==="post"?He(L.run.bind(L),O&&O.suspense):L.run();const A=()=>{L.stop(),O&&O.scope&&li(O.scope.effects,L)};return K&&K.push(A),A}function iu(e,t,a){const x=this.proxy,F=Te(e)?e.includes(".")?Ia(x,e):()=>x[e]:e.bind(x,x);let W;he(t)?W=t:(W=t.handler,a=t);const N=Re;or(this);const O=Ra(F,W.bind(x),a);return N?or(N):zt(),O}function Ia(e,t){const a=t.split(".");return()=>{let x=e;for(let F=0;F<a.length&&x;F++)x=x[a[F]];return x}}function jt(e,t){if(!xe(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),Me(e))jt(e.value,t);else if(ce(e))for(let a=0;a<e.length;a++)jt(e[a],t);else if(qs(e)||er(e))e.forEach(a=>{jt(a,t)});else if(ra(e))for(const a in e)jt(e[a],t);return e}function su(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Ot(()=>{e.isMounted=!0}),_i(()=>{e.isUnmounting=!0}),e}const Je=[Function,Array],au={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Je,onEnter:Je,onAfterEnter:Je,onEnterCancelled:Je,onBeforeLeave:Je,onLeave:Je,onAfterLeave:Je,onLeaveCancelled:Je,onBeforeAppear:Je,onAppear:Je,onAfterAppear:Je,onAppearCancelled:Je},setup(e,{slots:t}){const a=Qa(),x=su();let F;return()=>{const W=t.default&&Oa(t.default(),!0);if(!W||!W.length)return;let N=W[0];if(W.length>1){for(const I of W)if(I.type!==ze){N=I;break}}const O=pe(e),{mode:v}=O;if(x.isLeaving)return In(N);const M=es(N);if(!M)return In(N);const S=$n(M,O,x,a);Xn(M,S);const k=a.subTree,R=k&&es(k);let K=!1;const{getTransitionKey:b}=M.type;if(b){const I=b();F===void 0?F=I:I!==F&&(F=I,K=!0)}if(R&&R.type!==ze&&(!Ht(M,R)||K)){const I=$n(R,O,x,a);if(Xn(R,I),v==="out-in")return x.isLeaving=!0,I.afterLeave=()=>{x.isLeaving=!1,a.update.active!==!1&&a.update()},In(N);v==="in-out"&&M.type!==ze&&(I.delayLeave=(C,L,A)=>{const h=ba(x,R);h[String(R.key)]=R,C._leaveCb=()=>{L(),C._leaveCb=void 0,delete S.delayedLeave},S.delayedLeave=A})}return N}}},Ca=au;function ba(e,t){const{leavingVNodes:a}=e;let x=a.get(t.type);return x||(x=Object.create(null),a.set(t.type,x)),x}function $n(e,t,a,x){const{appear:F,mode:W,persisted:N=!1,onBeforeEnter:O,onEnter:v,onAfterEnter:M,onEnterCancelled:S,onBeforeLeave:k,onLeave:R,onAfterLeave:K,onLeaveCancelled:b,onBeforeAppear:I,onAppear:C,onAfterAppear:L,onAppearCancelled:A}=t,h=String(e.key),D=ba(a,e),T=(i,l)=>{i&&qe(i,x,9,l)},d=(i,l)=>{const p=l[1];T(i,l),ce(i)?i.every(m=>m.length<=1)&&p():i.length<=1&&p()},f={mode:W,persisted:N,beforeEnter(i){let l=O;if(!a.isMounted)if(F)l=I||O;else return;i._leaveCb&&i._leaveCb(!0);const p=D[h];p&&Ht(e,p)&&p.el._leaveCb&&p.el._leaveCb(),T(l,[i])},enter(i){let l=v,p=M,m=S;if(!a.isMounted)if(F)l=C||v,p=L||M,m=A||S;else return;let s=!1;const c=i._enterCb=_=>{s||(s=!0,_?T(m,[i]):T(p,[i]),f.delayedLeave&&f.delayedLeave(),i._enterCb=void 0)};l?d(l,[i,c]):c()},leave(i,l){const p=String(e.key);if(i._enterCb&&i._enterCb(!0),a.isUnmounting)return l();T(k,[i]);let m=!1;const s=i._leaveCb=c=>{m||(m=!0,l(),c?T(b,[i]):T(K,[i]),i._leaveCb=void 0,D[p]===e&&delete D[p])};D[p]=e,R?d(R,[i,s]):s()},clone(i){return $n(i,t,a,x)}};return f}function In(e){if(wr(e))return e=bt(e),e.children=null,e}function es(e){return wr(e)?e.children?e.children[0]:void 0:e}function Xn(e,t){e.shapeFlag&6&&e.component?Xn(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function Oa(e,t=!1,a){let x=[],F=0;for(let W=0;W<e.length;W++){let N=e[W];const O=a==null?N.key:String(a)+String(N.key!=null?N.key:W);N.type===Ge?(N.patchFlag&128&&F++,x=x.concat(Oa(N.children,t,O))):(t||N.type!==ze)&&x.push(O!=null?bt(N,{key:O}):N)}if(F>1)for(let W=0;W<x.length;W++)x[W].patchFlag=-2;return x}function et(e){return he(e)?{setup:e,name:e.name}:e}const nr=e=>!!e.type.__asyncLoader;function nn(e){he(e)&&(e={loader:e});const{loader:t,loadingComponent:a,errorComponent:x,delay:F=200,timeout:W,suspensible:N=!0,onError:O}=e;let v=null,M,S=0;const k=()=>(S++,v=null,R()),R=()=>{let K;return v||(K=v=t().catch(b=>{if(b=b instanceof Error?b:new Error(String(b)),O)return new Promise((I,C)=>{O(b,()=>I(k()),()=>C(b),S+1)});throw b}).then(b=>K!==v&&v?v:(b&&(b.__esModule||b[Symbol.toStringTag]==="Module")&&(b=b.default),M=b,b)))};return et({name:"AsyncComponentWrapper",__asyncLoader:R,get __asyncResolved(){return M},setup(){const K=Re;if(M)return()=>Cn(M,K);const b=A=>{v=null,Mr(A,K,13,!x)};if(N&&K.suspense||lr)return R().then(A=>()=>Cn(A,K)).catch(A=>(b(A),()=>x?Ie(x,{error:A}):null));const I=ke(!1),C=ke(),L=ke(!!F);return F&&setTimeout(()=>{L.value=!1},F),W!=null&&setTimeout(()=>{if(!I.value&&!C.value){const A=new Error(`Async component timed out after ${W}ms.`);b(A),C.value=A}},W),R().then(()=>{I.value=!0,K.parent&&wr(K.parent.vnode)&&mn(K.parent.update)}).catch(A=>{b(A),C.value=A}),()=>{if(I.value&&M)return Cn(M,K);if(C.value&&x)return Ie(x,{error:C.value});if(a&&!L.value)return Ie(a)}}})}function Cn(e,t){const{ref:a,props:x,children:F,ce:W}=t.vnode,N=Ie(e,x,F);return N.ref=a,N.ce=W,delete t.vnode.ce,N}const wr=e=>e.type.__isKeepAlive;function ou(e,t){Ma(e,"a",t)}function lu(e,t){Ma(e,"da",t)}function Ma(e,t,a=Re){const x=e.__wdc||(e.__wdc=()=>{let F=a;for(;F;){if(F.isDeactivated)return;F=F.parent}return e()});if(En(t,x,a),a){let F=a.parent;for(;F&&F.parent;)wr(F.parent.vnode)&&uu(x,t,a,F),F=F.parent}}function uu(e,t,a,x){const F=En(t,e,x,!0);Si(()=>{li(x[t],F)},a)}function En(e,t,a=Re,x=!1){if(a){const F=a[e]||(a[e]=[]),W=t.__weh||(t.__weh=(...N)=>{if(a.isUnmounted)return;cr(),or(a);const O=qe(t,a,e,N);return zt(),dr(),O});return x?F.unshift(W):F.push(W),W}}const Tt=e=>(t,a=Re)=>(!lr||e==="sp")&&En(e,(...x)=>t(...x),a),wa=Tt("bm"),Ot=Tt("m"),fu=Tt("bu"),cu=Tt("u"),_i=Tt("bum"),Si=Tt("um"),du=Tt("sp"),hu=Tt("rtg"),vu=Tt("rtc");function gu(e,t=Re){En("ec",e,t)}function wh(e,t){const a=Fe;if(a===null)return e;const x=Tn(a)||a.proxy,F=e.dirs||(e.dirs=[]);for(let W=0;W<t.length;W++){let[N,O,v,M=_e]=t[W];N&&(he(N)&&(N={mounted:N,updated:N}),N.deep&&jt(O),F.push({dir:N,instance:x,value:O,oldValue:void 0,arg:v,modifiers:M}))}return e}function ct(e,t,a,x){const F=e.dirs,W=t&&t.dirs;for(let N=0;N<F.length;N++){const O=F[N];W&&(O.oldValue=W[N].value);let v=O.dir[x];v&&(cr(),qe(v,a,8,[e.el,O,e,t]),dr())}}const Fa="components";function mu(e,t){return Eu(Fa,e,!0,t)||e}const pu=Symbol();function Eu(e,t,a=!0,x=!1){const F=Fe||Re;if(F){const W=F.type;if(e===Fa){const O=$u(W,!1);if(O&&(O===t||O===ht(t)||O===vn(ht(t))))return W}const N=ts(F[e]||W[e],t)||ts(F.appContext[e],t);return!N&&x?W:N}}function ts(e,t){return e&&(e[t]||e[ht(t)]||e[vn(ht(t))])}function Fh(e,t,a,x){let F;const W=a&&a[x];if(ce(e)||Te(e)){F=new Array(e.length);for(let N=0,O=e.length;N<O;N++)F[N]=t(e[N],N,void 0,W&&W[N])}else if(typeof e=="number"){F=new Array(e);for(let N=0;N<e;N++)F[N]=t(N+1,N,void 0,W&&W[N])}else if(xe(e))if(e[Symbol.iterator])F=Array.from(e,(N,O)=>t(N,O,void 0,W&&W[O]));else{const N=Object.keys(e);F=new Array(N.length);for(let O=0,v=N.length;O<v;O++){const M=N[O];F[O]=t(e[M],M,O,W&&W[O])}}else F=[];return a&&(a[x]=F),F}function ka(e,t,a={},x,F){if(Fe.isCE||Fe.parent&&nr(Fe.parent)&&Fe.parent.isCE)return t!=="default"&&(a.name=t),Ie("slot",a,x&&x());let W=e[t];W&&W._c&&(W._d=!1),Fr();const N=W&&Ua(W(a)),O=za(Ge,{key:a.key||N&&N.key||`_${t}`},N||(x?x():[]),N&&e._===1?64:-2);return!F&&O.scopeId&&(O.slotScopeIds=[O.scopeId+"-s"]),W&&W._c&&(W._d=!0),O}function Ua(e){return e.some(t=>on(t)?!(t.type===ze||t.type===Ge&&!Ua(t.children)):!0)?e:null}const Qn=e=>e?Ja(e)?Tn(e)||e.proxy:Qn(e.parent):null,Tr=Ue(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Qn(e.parent),$root:e=>Qn(e.root),$emit:e=>e.emit,$options:e=>xi(e),$forceUpdate:e=>e.f||(e.f=()=>mn(e.update)),$nextTick:e=>e.n||(e.n=Ti.bind(e.proxy)),$watch:e=>iu.bind(e)}),bn=(e,t)=>e!==_e&&!e.__isScriptSetup&&me(e,t),yu={get({_:e},t){const{ctx:a,setupState:x,data:F,props:W,accessCache:N,type:O,appContext:v}=e;let M;if(t[0]!=="$"){const K=N[t];if(K!==void 0)switch(K){case 1:return x[t];case 2:return F[t];case 4:return a[t];case 3:return W[t]}else{if(bn(x,t))return N[t]=1,x[t];if(F!==_e&&me(F,t))return N[t]=2,F[t];if((M=e.propsOptions[0])&&me(M,t))return N[t]=3,W[t];if(a!==_e&&me(a,t))return N[t]=4,a[t];Jn&&(N[t]=0)}}const S=Tr[t];let k,R;if(S)return t==="$attrs"&&je(e,"get",t),S(e);if((k=O.__cssModules)&&(k=k[t]))return k;if(a!==_e&&me(a,t))return N[t]=4,a[t];if(R=v.config.globalProperties,me(R,t))return R[t]},set({_:e},t,a){const{data:x,setupState:F,ctx:W}=e;return bn(F,t)?(F[t]=a,!0):x!==_e&&me(x,t)?(x[t]=a,!0):me(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(W[t]=a,!0)},has({_:{data:e,setupState:t,accessCache:a,ctx:x,appContext:F,propsOptions:W}},N){let O;return!!a[N]||e!==_e&&me(e,N)||bn(t,N)||(O=W[0])&&me(O,N)||me(x,N)||me(Tr,N)||me(F.config.globalProperties,N)},defineProperty(e,t,a){return a.get!=null?e._.accessCache[t]=0:me(a,"value")&&this.set(e,t,a.value,null),Reflect.defineProperty(e,t,a)}};let Jn=!0;function Tu(e){const t=xi(e),a=e.proxy,x=e.ctx;Jn=!1,t.beforeCreate&&rs(t.beforeCreate,e,"bc");const{data:F,computed:W,methods:N,watch:O,provide:v,inject:M,created:S,beforeMount:k,mounted:R,beforeUpdate:K,updated:b,activated:I,deactivated:C,beforeDestroy:L,beforeUnmount:A,destroyed:h,unmounted:D,render:T,renderTracked:d,renderTriggered:f,errorCaptured:i,serverPrefetch:l,expose:p,inheritAttrs:m,components:s,directives:c,filters:_}=t;if(M&&_u(M,x,null,e.appContext.config.unwrapInjectedRef),N)for(const n in N){const g=N[n];he(g)&&(x[n]=g.bind(a))}if(F){const n=F.call(a,a);xe(n)&&(e.data=hr(n))}if(Jn=!0,W)for(const n in W){const g=W[n],r=he(g)?g.bind(a,a):he(g.get)?g.get.bind(a,a):ot,E=!he(g)&&he(g.set)?g.set.bind(a):ot,P=Se({get:r,set:E});Object.defineProperty(x,n,{enumerable:!0,configurable:!0,get:()=>P.value,set:y=>P.value=y})}if(O)for(const n in O)Ba(O[n],x,a,n);if(v){const n=he(v)?v.call(a):v;Reflect.ownKeys(n).forEach(g=>{Yt(g,n[g])})}S&&rs(S,e,"c");function o(n,g){ce(g)?g.forEach(r=>n(r.bind(a))):g&&n(g.bind(a))}if(o(wa,k),o(Ot,R),o(fu,K),o(cu,b),o(ou,I),o(lu,C),o(gu,i),o(vu,d),o(hu,f),o(_i,A),o(Si,D),o(du,l),ce(p))if(p.length){const n=e.exposed||(e.exposed={});p.forEach(g=>{Object.defineProperty(n,g,{get:()=>a[g],set:r=>a[g]=r})})}else e.exposed||(e.exposed={});T&&e.render===ot&&(e.render=T),m!=null&&(e.inheritAttrs=m),s&&(e.components=s),c&&(e.directives=c)}function _u(e,t,a=ot,x=!1){ce(e)&&(e=Zn(e));for(const F in e){const W=e[F];let N;xe(W)?"default"in W?N=Oe(W.from||F,W.default,!0):N=Oe(W.from||F):N=Oe(W),Me(N)&&x?Object.defineProperty(t,F,{enumerable:!0,configurable:!0,get:()=>N.value,set:O=>N.value=O}):t[F]=N}}function rs(e,t,a){qe(ce(e)?e.map(x=>x.bind(t.proxy)):e.bind(t.proxy),t,a)}function Ba(e,t,a,x){const F=x.includes(".")?Ia(a,x):()=>a[x];if(Te(e)){const W=t[e];he(W)&&Et(F,W)}else if(he(e))Et(F,e.bind(a));else if(xe(e))if(ce(e))e.forEach(W=>Ba(W,t,a,x));else{const W=he(e.handler)?e.handler.bind(a):t[e.handler];he(W)&&Et(F,W,e)}}function xi(e){const t=e.type,{mixins:a,extends:x}=t,{mixins:F,optionsCache:W,config:{optionMergeStrategies:N}}=e.appContext,O=W.get(t);let v;return O?v=O:!F.length&&!a&&!x?v=t:(v={},F.length&&F.forEach(M=>sn(v,M,N,!0)),sn(v,t,N)),xe(t)&&W.set(t,v),v}function sn(e,t,a,x=!1){const{mixins:F,extends:W}=t;W&&sn(e,W,a,!0),F&&F.forEach(N=>sn(e,N,a,!0));for(const N in t)if(!(x&&N==="expose")){const O=Su[N]||a&&a[N];e[N]=O?O(e[N],t[N]):t[N]}return e}const Su={data:ns,props:Bt,emits:Bt,methods:Bt,computed:Bt,beforeCreate:Ke,created:Ke,beforeMount:Ke,mounted:Ke,beforeUpdate:Ke,updated:Ke,beforeDestroy:Ke,beforeUnmount:Ke,destroyed:Ke,unmounted:Ke,activated:Ke,deactivated:Ke,errorCaptured:Ke,serverPrefetch:Ke,components:Bt,directives:Bt,watch:Lu,provide:ns,inject:xu};function ns(e,t){return t?e?function(){return Ue(he(e)?e.call(this,this):e,he(t)?t.call(this,this):t)}:t:e}function xu(e,t){return Bt(Zn(e),Zn(t))}function Zn(e){if(ce(e)){const t={};for(let a=0;a<e.length;a++)t[e[a]]=e[a];return t}return e}function Ke(e,t){return e?[...new Set([].concat(e,t))]:t}function Bt(e,t){return e?Ue(Ue(Object.create(null),e),t):t}function Lu(e,t){if(!e)return t;if(!t)return e;const a=Ue(Object.create(null),e);for(const x in t)a[x]=Ke(e[x],t[x]);return a}function Au(e,t,a,x=!1){const F={},W={};Zr(W,yn,1),e.propsDefaults=Object.create(null),Na(e,t,F,W);for(const N in e.propsOptions[0])N in F||(F[N]=void 0);a?e.props=x?F:Nl(F):e.type.props?e.props=F:e.props=W,e.attrs=W}function Du(e,t,a,x){const{props:F,attrs:W,vnode:{patchFlag:N}}=e,O=pe(F),[v]=e.propsOptions;let M=!1;if((x||N>0)&&!(N&16)){if(N&8){const S=e.vnode.dynamicProps;for(let k=0;k<S.length;k++){let R=S[k];if(pn(e.emitsOptions,R))continue;const K=t[R];if(v)if(me(W,R))K!==W[R]&&(W[R]=K,M=!0);else{const b=ht(R);F[b]=qn(v,O,b,K,e,!1)}else K!==W[R]&&(W[R]=K,M=!0)}}}else{Na(e,t,F,W)&&(M=!0);let S;for(const k in O)(!t||!me(t,k)&&((S=$t(k))===k||!me(t,S)))&&(v?a&&(a[k]!==void 0||a[S]!==void 0)&&(F[k]=qn(v,O,k,void 0,e,!0)):delete F[k]);if(W!==O)for(const k in W)(!t||!me(t,k)&&!0)&&(delete W[k],M=!0)}M&&yt(e,"set","$attrs")}function Na(e,t,a,x){const[F,W]=e.propsOptions;let N=!1,O;if(t)for(let v in t){if(yr(v))continue;const M=t[v];let S;F&&me(F,S=ht(v))?!W||!W.includes(S)?a[S]=M:(O||(O={}))[S]=M:pn(e.emitsOptions,v)||(!(v in x)||M!==x[v])&&(x[v]=M,N=!0)}if(W){const v=pe(a),M=O||_e;for(let S=0;S<W.length;S++){const k=W[S];a[k]=qn(F,v,k,M[k],e,!me(M,k))}}return N}function qn(e,t,a,x,F,W){const N=e[a];if(N!=null){const O=me(N,"default");if(O&&x===void 0){const v=N.default;if(N.type!==Function&&he(v)){const{propsDefaults:M}=F;a in M?x=M[a]:(or(F),x=M[a]=v.call(null,t),zt())}else x=v}N[0]&&(W&&!O?x=!1:N[1]&&(x===""||x===$t(a))&&(x=!0))}return x}function Ka(e,t,a=!1){const x=t.propsCache,F=x.get(e);if(F)return F;const W=e.props,N={},O=[];let v=!1;if(!he(e)){const S=k=>{v=!0;const[R,K]=Ka(k,t,!0);Ue(N,R),K&&O.push(...K)};!a&&t.mixins.length&&t.mixins.forEach(S),e.extends&&S(e.extends),e.mixins&&e.mixins.forEach(S)}if(!W&&!v)return xe(e)&&x.set(e,qt),qt;if(ce(W))for(let S=0;S<W.length;S++){const k=ht(W[S]);is(k)&&(N[k]=_e)}else if(W)for(const S in W){const k=ht(S);if(is(k)){const R=W[S],K=N[k]=ce(R)||he(R)?{type:R}:Object.assign({},R);if(K){const b=os(Boolean,K.type),I=os(String,K.type);K[0]=b>-1,K[1]=I<0||b<I,(b>-1||me(K,"default"))&&O.push(k)}}}const M=[N,O];return xe(e)&&x.set(e,M),M}function is(e){return e[0]!=="$"}function ss(e){const t=e&&e.toString().match(/^\s*(function|class) (\w+)/);return t?t[2]:e===null?"null":""}function as(e,t){return ss(e)===ss(t)}function os(e,t){return ce(t)?t.findIndex(a=>as(a,e)):he(t)&&as(t,e)?0:-1}const Wa=e=>e[0]==="_"||e==="$stable",Li=e=>ce(e)?e.map(it):[it(e)],Pu=(e,t,a)=>{if(t._n)return t;const x=Zl((...F)=>Li(t(...F)),a);return x._c=!1,x},Ha=(e,t,a)=>{const x=e._ctx;for(const F in e){if(Wa(F))continue;const W=e[F];if(he(W))t[F]=Pu(F,W,x);else if(W!=null){const N=Li(W);t[F]=()=>N}}},Ga=(e,t)=>{const a=Li(t);e.slots.default=()=>a},Ru=(e,t)=>{if(e.vnode.shapeFlag&32){const a=t._;a?(e.slots=pe(t),Zr(t,"_",a)):Ha(t,e.slots={})}else e.slots={},t&&Ga(e,t);Zr(e.slots,yn,1)},Iu=(e,t,a)=>{const{vnode:x,slots:F}=e;let W=!0,N=_e;if(x.shapeFlag&32){const O=t._;O?a&&O===1?W=!1:(Ue(F,t),!a&&O===1&&delete F._):(W=!t.$stable,Ha(t,F)),N=t}else t&&(Ga(e,t),N={default:1});if(W)for(const O in F)!Wa(O)&&!(O in N)&&delete F[O]};function ja(){return{app:null,config:{isNativeTag:el,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Cu=0;function bu(e,t){return function(x,F=null){he(x)||(x=Object.assign({},x)),F!=null&&!xe(F)&&(F=null);const W=ja(),N=new Set;let O=!1;const v=W.app={_uid:Cu++,_component:x,_props:F,_container:null,_context:W,_instance:null,version:Zu,get config(){return W.config},set config(M){},use(M,...S){return N.has(M)||(M&&he(M.install)?(N.add(M),M.install(v,...S)):he(M)&&(N.add(M),M(v,...S))),v},mixin(M){return W.mixins.includes(M)||W.mixins.push(M),v},component(M,S){return S?(W.components[M]=S,v):W.components[M]},directive(M,S){return S?(W.directives[M]=S,v):W.directives[M]},mount(M,S,k){if(!O){const R=Ie(x,F);return R.appContext=W,S&&t?t(R,M):e(R,M,k),O=!0,v._container=M,M.__vue_app__=v,Tn(R.component)||R.component.proxy}},unmount(){O&&(e(null,v._container),delete v._container.__vue_app__)},provide(M,S){return W.provides[M]=S,v}};return v}}function an(e,t,a,x,F=!1){if(ce(e)){e.forEach((R,K)=>an(R,t&&(ce(t)?t[K]:t),a,x,F));return}if(nr(x)&&!F)return;const W=x.shapeFlag&4?Tn(x.component)||x.component.proxy:x.el,N=F?null:W,{i:O,r:v}=e,M=t&&t.r,S=O.refs===_e?O.refs={}:O.refs,k=O.setupState;if(M!=null&&M!==v&&(Te(M)?(S[M]=null,me(k,M)&&(k[M]=null)):Me(M)&&(M.value=null)),he(v))It(v,O,12,[N,S]);else{const R=Te(v),K=Me(v);if(R||K){const b=()=>{if(e.f){const I=R?me(k,v)?k[v]:S[v]:v.value;F?ce(I)&&li(I,W):ce(I)?I.includes(W)||I.push(W):R?(S[v]=[W],me(k,v)&&(k[v]=S[v])):(v.value=[W],e.k&&(S[e.k]=v.value))}else R?(S[v]=N,me(k,v)&&(k[v]=N)):K&&(v.value=N,e.k&&(S[e.k]=N))};N?(b.id=-1,He(b,a)):b()}}}let St=!1;const Yr=e=>/svg/.test(e.namespaceURI)&&e.tagName!=="foreignObject",zr=e=>e.nodeType===8;function Ou(e){const{mt:t,p:a,o:{patchProp:x,createText:F,nextSibling:W,parentNode:N,remove:O,insert:v,createComment:M}}=e,S=(L,A)=>{if(!A.hasChildNodes()){a(null,L,A),tn(),A._vnode=L;return}St=!1,k(A.firstChild,L,null,null,null),tn(),A._vnode=L,St&&console.error("Hydration completed but contains mismatches.")},k=(L,A,h,D,T,d=!1)=>{const f=zr(L)&&L.data==="[",i=()=>I(L,A,h,D,T,f),{type:l,ref:p,shapeFlag:m,patchFlag:s}=A;let c=L.nodeType;A.el=L,s===-2&&(d=!1,A.dynamicChildren=null);let _=null;switch(l){case ar:c!==3?A.children===""?(v(A.el=F(""),N(L),L),_=L):_=i():(L.data!==A.children&&(St=!0,L.data=A.children),_=W(L));break;case ze:c!==8||f?_=i():_=W(L);break;case _r:if(f&&(L=W(L),c=L.nodeType),c===1||c===3){_=L;const u=!A.children.length;for(let o=0;o<A.staticCount;o++)u&&(A.children+=_.nodeType===1?_.outerHTML:_.data),o===A.staticCount-1&&(A.anchor=_),_=W(_);return f?W(_):_}else i();break;case Ge:f?_=b(L,A,h,D,T,d):_=i();break;default:if(m&1)c!==1||A.type.toLowerCase()!==L.tagName.toLowerCase()?_=i():_=R(L,A,h,D,T,d);else if(m&6){A.slotScopeIds=T;const u=N(L);if(t(A,u,null,h,D,Yr(u),d),_=f?C(L):W(L),_&&zr(_)&&_.data==="teleport end"&&(_=W(_)),nr(A)){let o;f?(o=Ie(Ge),o.anchor=_?_.previousSibling:u.lastChild):o=L.nodeType===3?Di(""):Ie("div"),o.el=L,A.component.subTree=o}}else m&64?c!==8?_=i():_=A.type.hydrate(L,A,h,D,T,d,e,K):m&128&&(_=A.type.hydrate(L,A,h,D,Yr(N(L)),T,d,e,k))}return p!=null&&an(p,null,D,A),_},R=(L,A,h,D,T,d)=>{d=d||!!A.dynamicChildren;const{type:f,props:i,patchFlag:l,shapeFlag:p,dirs:m}=A,s=f==="input"&&m||f==="option";if(s||l!==-1){if(m&&ct(A,null,h,"created"),i)if(s||!d||l&48)for(const _ in i)(s&&_.endsWith("value")||Or(_)&&!yr(_))&&x(L,_,null,i[_],!1,void 0,h);else i.onClick&&x(L,"onClick",null,i.onClick,!1,void 0,h);let c;if((c=i&&i.onVnodeBeforeMount)&&Ze(c,h,A),m&&ct(A,null,h,"beforeMount"),((c=i&&i.onVnodeMounted)||m)&&Pa(()=>{c&&Ze(c,h,A),m&&ct(A,null,h,"mounted")},D),p&16&&!(i&&(i.innerHTML||i.textContent))){let _=K(L.firstChild,A,L,h,D,T,d);for(;_;){St=!0;const u=_;_=_.nextSibling,O(u)}}else p&8&&L.textContent!==A.children&&(St=!0,L.textContent=A.children)}return L.nextSibling},K=(L,A,h,D,T,d,f)=>{f=f||!!A.dynamicChildren;const i=A.children,l=i.length;for(let p=0;p<l;p++){const m=f?i[p]:i[p]=it(i[p]);if(L)L=k(L,m,D,T,d,f);else{if(m.type===ar&&!m.children)continue;St=!0,a(null,m,h,null,D,T,Yr(h),d)}}return L},b=(L,A,h,D,T,d)=>{const{slotScopeIds:f}=A;f&&(T=T?T.concat(f):f);const i=N(L),l=K(W(L),A,i,h,D,T,d);return l&&zr(l)&&l.data==="]"?W(A.anchor=l):(St=!0,v(A.anchor=M("]"),i,l),l)},I=(L,A,h,D,T,d)=>{if(St=!0,A.el=null,d){const l=C(L);for(;;){const p=W(L);if(p&&p!==l)O(p);else break}}const f=W(L),i=N(L);return O(L),a(null,A,i,f,h,D,Yr(i),T),f},C=L=>{let A=0;for(;L;)if(L=W(L),L&&zr(L)&&(L.data==="["&&A++,L.data==="]")){if(A===0)return W(L);A--}return L};return[S,k]}const He=Pa;function Mu(e){return wu(e,Ou)}function wu(e,t){const a=ll();a.__VUE__=!0;const{insert:x,remove:F,patchProp:W,createElement:N,createText:O,createComment:v,setText:M,setElementText:S,parentNode:k,nextSibling:R,setScopeId:K=ot,insertStaticContent:b}=e,I=(j,Y,Q,J=null,Z=null,ee=null,ne=!1,te=null,q=!!Y.dynamicChildren)=>{if(j===Y)return;j&&!Ht(j,Y)&&(J=G(j),y(j,Z,ee,!0),j=null),Y.patchFlag===-2&&(q=!1,Y.dynamicChildren=null);const{type:re,ref:se,shapeFlag:ie}=Y;switch(re){case ar:C(j,Y,Q,J);break;case ze:L(j,Y,Q,J);break;case _r:j==null&&A(Y,Q,J,ne);break;case Ge:s(j,Y,Q,J,Z,ee,ne,te,q);break;default:ie&1?T(j,Y,Q,J,Z,ee,ne,te,q):ie&6?c(j,Y,Q,J,Z,ee,ne,te,q):(ie&64||ie&128)&&re.process(j,Y,Q,J,Z,ee,ne,te,q,z)}se!=null&&Z&&an(se,j&&j.ref,ee,Y||j,!Y)},C=(j,Y,Q,J)=>{if(j==null)x(Y.el=O(Y.children),Q,J);else{const Z=Y.el=j.el;Y.children!==j.children&&M(Z,Y.children)}},L=(j,Y,Q,J)=>{j==null?x(Y.el=v(Y.children||""),Q,J):Y.el=j.el},A=(j,Y,Q,J)=>{[j.el,j.anchor]=b(j.children,Y,Q,J,j.el,j.anchor)},h=({el:j,anchor:Y},Q,J)=>{let Z;for(;j&&j!==Y;)Z=R(j),x(j,Q,J),j=Z;x(Y,Q,J)},D=({el:j,anchor:Y})=>{let Q;for(;j&&j!==Y;)Q=R(j),F(j),j=Q;F(Y)},T=(j,Y,Q,J,Z,ee,ne,te,q)=>{ne=ne||Y.type==="svg",j==null?d(Y,Q,J,Z,ee,ne,te,q):l(j,Y,Z,ee,ne,te,q)},d=(j,Y,Q,J,Z,ee,ne,te)=>{let q,re;const{type:se,props:ie,shapeFlag:ae,transition:oe,dirs:le}=j;if(q=j.el=N(j.type,ee,ie&&ie.is,ie),ae&8?S(q,j.children):ae&16&&i(j.children,q,null,J,Z,ee&&se!=="foreignObject",ne,te),le&&ct(j,null,J,"created"),f(q,j,j.scopeId,ne,J),ie){for(const fe in ie)fe!=="value"&&!yr(fe)&&W(q,fe,null,ie[fe],ee,j.children,J,Z,H);"value"in ie&&W(q,"value",null,ie.value),(re=ie.onVnodeBeforeMount)&&Ze(re,J,j)}le&&ct(j,null,J,"beforeMount");const ue=(!Z||Z&&!Z.pendingBranch)&&oe&&!oe.persisted;ue&&oe.beforeEnter(q),x(q,Y,Q),((re=ie&&ie.onVnodeMounted)||ue||le)&&He(()=>{re&&Ze(re,J,j),ue&&oe.enter(q),le&&ct(j,null,J,"mounted")},Z)},f=(j,Y,Q,J,Z)=>{if(Q&&K(j,Q),J)for(let ee=0;ee<J.length;ee++)K(j,J[ee]);if(Z){let ee=Z.subTree;if(Y===ee){const ne=Z.vnode;f(j,ne,ne.scopeId,ne.slotScopeIds,Z.parent)}}},i=(j,Y,Q,J,Z,ee,ne,te,q=0)=>{for(let re=q;re<j.length;re++){const se=j[re]=te?At(j[re]):it(j[re]);I(null,se,Y,Q,J,Z,ee,ne,te)}},l=(j,Y,Q,J,Z,ee,ne)=>{const te=Y.el=j.el;let{patchFlag:q,dynamicChildren:re,dirs:se}=Y;q|=j.patchFlag&16;const ie=j.props||_e,ae=Y.props||_e;let oe;Q&&Ft(Q,!1),(oe=ae.onVnodeBeforeUpdate)&&Ze(oe,Q,Y,j),se&&ct(Y,j,Q,"beforeUpdate"),Q&&Ft(Q,!0);const le=Z&&Y.type!=="foreignObject";if(re?p(j.dynamicChildren,re,te,Q,J,le,ee):ne||g(j,Y,te,null,Q,J,le,ee,!1),q>0){if(q&16)m(te,Y,ie,ae,Q,J,Z);else if(q&2&&ie.class!==ae.class&&W(te,"class",null,ae.class,Z),q&4&&W(te,"style",ie.style,ae.style,Z),q&8){const ue=Y.dynamicProps;for(let fe=0;fe<ue.length;fe++){const de=ue[fe],ve=ie[de],Le=ae[de];(Le!==ve||de==="value")&&W(te,de,ve,Le,Z,j.children,Q,J,H)}}q&1&&j.children!==Y.children&&S(te,Y.children)}else!ne&&re==null&&m(te,Y,ie,ae,Q,J,Z);((oe=ae.onVnodeUpdated)||se)&&He(()=>{oe&&Ze(oe,Q,Y,j),se&&ct(Y,j,Q,"updated")},J)},p=(j,Y,Q,J,Z,ee,ne)=>{for(let te=0;te<Y.length;te++){const q=j[te],re=Y[te],se=q.el&&(q.type===Ge||!Ht(q,re)||q.shapeFlag&70)?k(q.el):Q;I(q,re,se,null,J,Z,ee,ne,!0)}},m=(j,Y,Q,J,Z,ee,ne)=>{if(Q!==J){if(Q!==_e)for(const te in Q)!yr(te)&&!(te in J)&&W(j,te,Q[te],null,ne,Y.children,Z,ee,H);for(const te in J){if(yr(te))continue;const q=J[te],re=Q[te];q!==re&&te!=="value"&&W(j,te,re,q,ne,Y.children,Z,ee,H)}"value"in J&&W(j,"value",Q.value,J.value)}},s=(j,Y,Q,J,Z,ee,ne,te,q)=>{const re=Y.el=j?j.el:O(""),se=Y.anchor=j?j.anchor:O("");let{patchFlag:ie,dynamicChildren:ae,slotScopeIds:oe}=Y;oe&&(te=te?te.concat(oe):oe),j==null?(x(re,Q,J),x(se,Q,J),i(Y.children,Q,se,Z,ee,ne,te,q)):ie>0&&ie&64&&ae&&j.dynamicChildren?(p(j.dynamicChildren,ae,Q,Z,ee,ne,te),(Y.key!=null||Z&&Y===Z.subTree)&&Va(j,Y,!0)):g(j,Y,Q,se,Z,ee,ne,te,q)},c=(j,Y,Q,J,Z,ee,ne,te,q)=>{Y.slotScopeIds=te,j==null?Y.shapeFlag&512?Z.ctx.activate(Y,Q,J,ne,q):_(Y,Q,J,Z,ee,ne,q):u(j,Y,q)},_=(j,Y,Q,J,Z,ee,ne)=>{const te=j.component=Gu(j,J,Z);if(wr(j)&&(te.ctx.renderer=z),ju(te),te.asyncDep){if(Z&&Z.registerDep(te,o),!j.el){const q=te.subTree=Ie(ze);L(null,q,Y,Q)}return}o(te,j,Y,Q,Z,ee,ne)},u=(j,Y,Q)=>{const J=Y.component=j.component;if(tu(j,Y,Q))if(J.asyncDep&&!J.asyncResolved){n(J,Y,Q);return}else J.next=Y,$l(J.update),J.update();else Y.el=j.el,J.vnode=Y},o=(j,Y,Q,J,Z,ee,ne)=>{const te=()=>{if(j.isMounted){let{next:se,bu:ie,u:ae,parent:oe,vnode:le}=j,ue=se,fe;Ft(j,!1),se?(se.el=le.el,n(j,se,ne)):se=le,ie&&Pn(ie),(fe=se.props&&se.props.onVnodeBeforeUpdate)&&Ze(fe,oe,se,le),Ft(j,!0);const de=Rn(j),ve=j.subTree;j.subTree=de,I(ve,de,k(ve.el),G(ve),j,Z,ee),se.el=de.el,ue===null&&ru(j,de.el),ae&&He(ae,Z),(fe=se.props&&se.props.onVnodeUpdated)&&He(()=>Ze(fe,oe,se,le),Z)}else{let se;const{el:ie,props:ae}=Y,{bm:oe,m:le,parent:ue}=j,fe=nr(Y);if(Ft(j,!1),oe&&Pn(oe),!fe&&(se=ae&&ae.onVnodeBeforeMount)&&Ze(se,ue,Y),Ft(j,!0),ie&&X){const de=()=>{j.subTree=Rn(j),X(ie,j.subTree,j,Z,null)};fe?Y.type.__asyncLoader().then(()=>!j.isUnmounted&&de()):de()}else{const de=j.subTree=Rn(j);I(null,de,Q,J,j,Z,ee),Y.el=de.el}if(le&&He(le,Z),!fe&&(se=ae&&ae.onVnodeMounted)){const de=Y;He(()=>Ze(se,ue,de),Z)}(Y.shapeFlag&256||ue&&nr(ue.vnode)&&ue.vnode.shapeFlag&256)&&j.a&&He(j.a,Z),j.isMounted=!0,Y=Q=J=null}},q=j.effect=new di(te,()=>mn(re),j.scope),re=j.update=()=>q.run();re.id=j.uid,Ft(j,!0),re()},n=(j,Y,Q)=>{Y.component=j;const J=j.vnode.props;j.vnode=Y,j.next=null,Du(j,Y.props,J,Q),Iu(j,Y.children,Q),cr(),Zi(),dr()},g=(j,Y,Q,J,Z,ee,ne,te,q=!1)=>{const re=j&&j.children,se=j?j.shapeFlag:0,ie=Y.children,{patchFlag:ae,shapeFlag:oe}=Y;if(ae>0){if(ae&128){E(re,ie,Q,J,Z,ee,ne,te,q);return}else if(ae&256){r(re,ie,Q,J,Z,ee,ne,te,q);return}}oe&8?(se&16&&H(re,Z,ee),ie!==re&&S(Q,ie)):se&16?oe&16?E(re,ie,Q,J,Z,ee,ne,te,q):H(re,Z,ee,!0):(se&8&&S(Q,""),oe&16&&i(ie,Q,J,Z,ee,ne,te,q))},r=(j,Y,Q,J,Z,ee,ne,te,q)=>{j=j||qt,Y=Y||qt;const re=j.length,se=Y.length,ie=Math.min(re,se);let ae;for(ae=0;ae<ie;ae++){const oe=Y[ae]=q?At(Y[ae]):it(Y[ae]);I(j[ae],oe,Q,null,Z,ee,ne,te,q)}re>se?H(j,Z,ee,!0,!1,ie):i(Y,Q,J,Z,ee,ne,te,q,ie)},E=(j,Y,Q,J,Z,ee,ne,te,q)=>{let re=0;const se=Y.length;let ie=j.length-1,ae=se-1;for(;re<=ie&&re<=ae;){const oe=j[re],le=Y[re]=q?At(Y[re]):it(Y[re]);if(Ht(oe,le))I(oe,le,Q,null,Z,ee,ne,te,q);else break;re++}for(;re<=ie&&re<=ae;){const oe=j[ie],le=Y[ae]=q?At(Y[ae]):it(Y[ae]);if(Ht(oe,le))I(oe,le,Q,null,Z,ee,ne,te,q);else break;ie--,ae--}if(re>ie){if(re<=ae){const oe=ae+1,le=oe<se?Y[oe].el:J;for(;re<=ae;)I(null,Y[re]=q?At(Y[re]):it(Y[re]),Q,le,Z,ee,ne,te,q),re++}}else if(re>ae)for(;re<=ie;)y(j[re],Z,ee,!0),re++;else{const oe=re,le=re,ue=new Map;for(re=le;re<=ae;re++){const Ee=Y[re]=q?At(Y[re]):it(Y[re]);Ee.key!=null&&ue.set(Ee.key,re)}let fe,de=0;const ve=ae-le+1;let Le=!1,Ae=0;const De=new Array(ve);for(re=0;re<ve;re++)De[re]=0;for(re=oe;re<=ie;re++){const Ee=j[re];if(de>=ve){y(Ee,Z,ee,!0);continue}let Ce;if(Ee.key!=null)Ce=ue.get(Ee.key);else for(fe=le;fe<=ae;fe++)if(De[fe-le]===0&&Ht(Ee,Y[fe])){Ce=fe;break}Ce===void 0?y(Ee,Z,ee,!0):(De[Ce-le]=re+1,Ce>=Ae?Ae=Ce:Le=!0,I(Ee,Y[Ce],Q,null,Z,ee,ne,te,q),de++)}const Ve=Le?Fu(De):qt;for(fe=Ve.length-1,re=ve-1;re>=0;re--){const Ee=le+re,Ce=Y[Ee],We=Ee+1<se?Y[Ee+1].el:J;De[re]===0?I(null,Ce,Q,We,Z,ee,ne,te,q):Le&&(fe<0||re!==Ve[fe]?P(Ce,Q,We,2):fe--)}}},P=(j,Y,Q,J,Z=null)=>{const{el:ee,type:ne,transition:te,children:q,shapeFlag:re}=j;if(re&6){P(j.component.subTree,Y,Q,J);return}if(re&128){j.suspense.move(Y,Q,J);return}if(re&64){ne.move(j,Y,Q,z);return}if(ne===Ge){x(ee,Y,Q);for(let ie=0;ie<q.length;ie++)P(q[ie],Y,Q,J);x(j.anchor,Y,Q);return}if(ne===_r){h(j,Y,Q);return}if(J!==2&&re&1&&te)if(J===0)te.beforeEnter(ee),x(ee,Y,Q),He(()=>te.enter(ee),Z);else{const{leave:ie,delayLeave:ae,afterLeave:oe}=te,le=()=>x(ee,Y,Q),ue=()=>{ie(ee,()=>{le(),oe&&oe()})};ae?ae(ee,le,ue):ue()}else x(ee,Y,Q)},y=(j,Y,Q,J=!1,Z=!1)=>{const{type:ee,props:ne,ref:te,children:q,dynamicChildren:re,shapeFlag:se,patchFlag:ie,dirs:ae}=j;if(te!=null&&an(te,null,Q,j,!0),se&256){Y.ctx.deactivate(j);return}const oe=se&1&&ae,le=!nr(j);let ue;if(le&&(ue=ne&&ne.onVnodeBeforeUnmount)&&Ze(ue,Y,j),se&6)w(j.component,Q,J);else{if(se&128){j.suspense.unmount(Q,J);return}oe&&ct(j,null,Y,"beforeUnmount"),se&64?j.type.remove(j,Y,Q,Z,z,J):re&&(ee!==Ge||ie>0&&ie&64)?H(re,Y,Q,!1,!0):(ee===Ge&&ie&384||!Z&&se&16)&&H(q,Y,Q),J&&U(j)}(le&&(ue=ne&&ne.onVnodeUnmounted)||oe)&&He(()=>{ue&&Ze(ue,Y,j),oe&&ct(j,null,Y,"unmounted")},Q)},U=j=>{const{type:Y,el:Q,anchor:J,transition:Z}=j;if(Y===Ge){B(Q,J);return}if(Y===_r){D(j);return}const ee=()=>{F(Q),Z&&!Z.persisted&&Z.afterLeave&&Z.afterLeave()};if(j.shapeFlag&1&&Z&&!Z.persisted){const{leave:ne,delayLeave:te}=Z,q=()=>ne(Q,ee);te?te(j.el,ee,q):q()}else ee()},B=(j,Y)=>{let Q;for(;j!==Y;)Q=R(j),F(j),j=Q;F(Y)},w=(j,Y,Q)=>{const{bum:J,scope:Z,update:ee,subTree:ne,um:te}=j;J&&Pn(J),Z.stop(),ee&&(ee.active=!1,y(ne,j,Y,Q)),te&&He(te,Y),He(()=>{j.isUnmounted=!0},Y),Y&&Y.pendingBranch&&!Y.isUnmounted&&j.asyncDep&&!j.asyncResolved&&j.suspenseId===Y.pendingId&&(Y.deps--,Y.deps===0&&Y.resolve())},H=(j,Y,Q,J=!1,Z=!1,ee=0)=>{for(let ne=ee;ne<j.length;ne++)y(j[ne],Y,Q,J,Z)},G=j=>j.shapeFlag&6?G(j.component.subTree):j.shapeFlag&128?j.suspense.next():R(j.anchor||j.el),V=(j,Y,Q)=>{j==null?Y._vnode&&y(Y._vnode,null,null,!0):I(Y._vnode||null,j,Y,null,null,null,Q),Zi(),tn(),Y._vnode=j},z={p:I,um:y,m:P,r:U,mt:_,mc:i,pc:g,pbc:p,n:G,o:e};let $,X;return t&&([$,X]=t(z)),{render:V,hydrate:$,createApp:bu(V,$)}}function Ft({effect:e,update:t},a){e.allowRecurse=t.allowRecurse=a}function Va(e,t,a=!1){const x=e.children,F=t.children;if(ce(x)&&ce(F))for(let W=0;W<x.length;W++){const N=x[W];let O=F[W];O.shapeFlag&1&&!O.dynamicChildren&&((O.patchFlag<=0||O.patchFlag===32)&&(O=F[W]=At(F[W]),O.el=N.el),a||Va(N,O)),O.type===ar&&(O.el=N.el)}}function Fu(e){const t=e.slice(),a=[0];let x,F,W,N,O;const v=e.length;for(x=0;x<v;x++){const M=e[x];if(M!==0){if(F=a[a.length-1],e[F]<M){t[x]=F,a.push(x);continue}for(W=0,N=a.length-1;W<N;)O=W+N>>1,e[a[O]]<M?W=O+1:N=O;M<e[a[W]]&&(W>0&&(t[x]=a[W-1]),a[W]=x)}}for(W=a.length,N=a[W-1];W-- >0;)a[W]=N,N=t[N];return a}const ku=e=>e.__isTeleport,Ge=Symbol(void 0),ar=Symbol(void 0),ze=Symbol(void 0),_r=Symbol(void 0),Sr=[];let at=null;function Fr(e=!1){Sr.push(at=e?null:[])}function Uu(){Sr.pop(),at=Sr[Sr.length-1]||null}let Ir=1;function ls(e){Ir+=e}function Ya(e){return e.dynamicChildren=Ir>0?at||qt:null,Uu(),Ir>0&&at&&at.push(e),e}function Ai(e,t,a,x,F,W){return Ya(Xa(e,t,a,x,F,W,!0))}function za(e,t,a,x,F){return Ya(Ie(e,t,a,x,F,!0))}function on(e){return e?e.__v_isVNode===!0:!1}function Ht(e,t){return e.type===t.type&&e.key===t.key}const yn="__vInternal",$a=({key:e})=>e!=null?e:null,Qr=({ref:e,ref_key:t,ref_for:a})=>e!=null?Te(e)||Me(e)||he(e)?{i:Fe,r:e,k:t,f:!!a}:e:null;function Xa(e,t=null,a=null,x=0,F=null,W=e===Ge?0:1,N=!1,O=!1){const v={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&$a(t),ref:t&&Qr(t),scopeId:Da,slotScopeIds:null,children:a,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:W,patchFlag:x,dynamicProps:F,dynamicChildren:null,appContext:null,ctx:Fe};return O?(Pi(v,a),W&128&&e.normalize(v)):a&&(v.shapeFlag|=Te(a)?8:16),Ir>0&&!N&&at&&(v.patchFlag>0||W&6)&&v.patchFlag!==32&&at.push(v),v}const Ie=Bu;function Bu(e,t=null,a=null,x=0,F=null,W=!1){if((!e||e===pu)&&(e=ze),on(e)){const O=bt(e,t,!0);return a&&Pi(O,a),Ir>0&&!W&&at&&(O.shapeFlag&6?at[at.indexOf(e)]=O:at.push(O)),O.patchFlag|=-2,O}if(Xu(e)&&(e=e.__vccOpts),t){t=Nu(t);let{class:O,style:v}=t;O&&!Te(O)&&(t.class=br(O)),xe(v)&&(va(v)&&!ce(v)&&(v=Ue({},v)),t.style=cn(v))}const N=Te(e)?1:nu(e)?128:ku(e)?64:xe(e)?4:he(e)?2:0;return Xa(e,t,a,x,F,N,W,!0)}function Nu(e){return e?va(e)||yn in e?Ue({},e):e:null}function bt(e,t,a=!1){const{props:x,ref:F,patchFlag:W,children:N}=e,O=t?Ku(x||{},t):x;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:O,key:O&&$a(O),ref:t&&t.ref?a&&F?ce(F)?F.concat(Qr(t)):[F,Qr(t)]:Qr(t):F,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:N,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Ge?W===-1?16:W|16:W,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&bt(e.ssContent),ssFallback:e.ssFallback&&bt(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function Di(e=" ",t=0){return Ie(ar,null,e,t)}function kh(e,t){const a=Ie(_r,null,e);return a.staticCount=t,a}function Uh(e="",t=!1){return t?(Fr(),za(ze,null,e)):Ie(ze,null,e)}function it(e){return e==null||typeof e=="boolean"?Ie(ze):ce(e)?Ie(Ge,null,e.slice()):typeof e=="object"?At(e):Ie(ar,null,String(e))}function At(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:bt(e)}function Pi(e,t){let a=0;const{shapeFlag:x}=e;if(t==null)t=null;else if(ce(t))a=16;else if(typeof t=="object")if(x&65){const F=t.default;F&&(F._c&&(F._d=!1),Pi(e,F()),F._c&&(F._d=!0));return}else{a=32;const F=t._;!F&&!(yn in t)?t._ctx=Fe:F===3&&Fe&&(Fe.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else he(t)?(t={default:t,_ctx:Fe},a=32):(t=String(t),x&64?(a=16,t=[Di(t)]):a=8);e.children=t,e.shapeFlag|=a}function Ku(...e){const t={};for(let a=0;a<e.length;a++){const x=e[a];for(const F in x)if(F==="class")t.class!==x.class&&(t.class=br([t.class,x.class]));else if(F==="style")t.style=cn([t.style,x.style]);else if(Or(F)){const W=t[F],N=x[F];N&&W!==N&&!(ce(W)&&W.includes(N))&&(t[F]=W?[].concat(W,N):N)}else F!==""&&(t[F]=x[F])}return t}function Ze(e,t,a,x=null){qe(e,t,7,[a,x])}const Wu=ja();let Hu=0;function Gu(e,t,a){const x=e.type,F=(t?t.appContext:e.appContext)||Wu,W={uid:Hu++,vnode:e,type:x,parent:t,appContext:F,root:null,next:null,subTree:null,effect:null,update:null,scope:new ul(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(F.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ka(x,F),emitsOptions:Aa(x,F),emit:null,emitted:null,propsDefaults:_e,inheritAttrs:x.inheritAttrs,ctx:_e,data:_e,props:_e,attrs:_e,slots:_e,refs:_e,setupState:_e,setupContext:null,suspense:a,suspenseId:a?a.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return W.ctx={_:W},W.root=t?t.root:W,W.emit=Jl.bind(null,W),e.ce&&e.ce(W),W}let Re=null;const Qa=()=>Re||Fe,or=e=>{Re=e,e.scope.on()},zt=()=>{Re&&Re.scope.off(),Re=null};function Ja(e){return e.vnode.shapeFlag&4}let lr=!1;function ju(e,t=!1){lr=t;const{props:a,children:x}=e.vnode,F=Ja(e);Au(e,a,F,t),Ru(e,x);const W=F?Vu(e,t):void 0;return lr=!1,W}function Vu(e,t){const a=e.type;e.accessCache=Object.create(null),e.proxy=ga(new Proxy(e.ctx,yu));const{setup:x}=a;if(x){const F=e.setupContext=x.length>1?zu(e):null;or(e),cr();const W=It(x,e,0,[e.props,F]);if(dr(),zt(),ea(W)){if(W.then(zt,zt),t)return W.then(N=>{us(e,N,t)}).catch(N=>{Mr(N,e,0)});e.asyncDep=W}else us(e,W,t)}else Za(e,t)}function us(e,t,a){he(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:xe(t)&&(e.setupState=Ta(t)),Za(e,a)}let fs;function Za(e,t,a){const x=e.type;if(!e.render){if(!t&&fs&&!x.render){const F=x.template||xi(e).template;if(F){const{isCustomElement:W,compilerOptions:N}=e.appContext.config,{delimiters:O,compilerOptions:v}=x,M=Ue(Ue({isCustomElement:W,delimiters:O},N),v);x.render=fs(F,M)}}e.render=x.render||ot}or(e),cr(),Tu(e),dr(),zt()}function Yu(e){return new Proxy(e.attrs,{get(t,a){return je(e,"get","$attrs"),t[a]}})}function zu(e){const t=x=>{e.exposed=x||{}};let a;return{get attrs(){return a||(a=Yu(e))},slots:e.slots,emit:e.emit,expose:t}}function Tn(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Ta(ga(e.exposed)),{get(t,a){if(a in t)return t[a];if(a in Tr)return Tr[a](e)},has(t,a){return a in t||a in Tr}}))}function $u(e,t=!0){return he(e)?e.displayName||e.name:e.name||t&&e.__name}function Xu(e){return he(e)&&"__vccOpts"in e}const Se=(e,t)=>Vl(e,t,lr);function Pe(e,t,a){const x=arguments.length;return x===2?xe(t)&&!ce(t)?on(t)?Ie(e,null,[t]):Ie(e,t):Ie(e,null,t):(x>3?a=Array.prototype.slice.call(arguments,2):x===3&&on(a)&&(a=[a]),Ie(e,t,a))}const Qu=Symbol(""),Ju=()=>Oe(Qu),Zu="3.2.47",qu="http://www.w3.org/2000/svg",Gt=typeof document!="undefined"?document:null,cs=Gt&&Gt.createElement("template"),ef={insert:(e,t,a)=>{t.insertBefore(e,a||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,a,x)=>{const F=t?Gt.createElementNS(qu,e):Gt.createElement(e,a?{is:a}:void 0);return e==="select"&&x&&x.multiple!=null&&F.setAttribute("multiple",x.multiple),F},createText:e=>Gt.createTextNode(e),createComment:e=>Gt.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Gt.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,a,x,F,W){const N=a?a.previousSibling:t.lastChild;if(F&&(F===W||F.nextSibling))for(;t.insertBefore(F.cloneNode(!0),a),!(F===W||!(F=F.nextSibling)););else{cs.innerHTML=x?`<svg>${e}</svg>`:e;const O=cs.content;if(x){const v=O.firstChild;for(;v.firstChild;)O.appendChild(v.firstChild);O.removeChild(v)}t.insertBefore(O,a)}return[N?N.nextSibling:t.firstChild,a?a.previousSibling:t.lastChild]}};function tf(e,t,a){const x=e._vtc;x&&(t=(t?[t,...x]:[...x]).join(" ")),t==null?e.removeAttribute("class"):a?e.setAttribute("class",t):e.className=t}function rf(e,t,a){const x=e.style,F=Te(a);if(a&&!F){if(t&&!Te(t))for(const W in t)a[W]==null&&ei(x,W,"");for(const W in a)ei(x,W,a[W])}else{const W=x.display;F?t!==a&&(x.cssText=a):t&&e.removeAttribute("style"),"_vod"in e&&(x.display=W)}}const ds=/\s*!important$/;function ei(e,t,a){if(ce(a))a.forEach(x=>ei(e,t,x));else if(a==null&&(a=""),t.startsWith("--"))e.setProperty(t,a);else{const x=nf(e,t);ds.test(a)?e.setProperty($t(x),a.replace(ds,""),"important"):e[x]=a}}const hs=["Webkit","Moz","ms"],On={};function nf(e,t){const a=On[t];if(a)return a;let x=ht(t);if(x!=="filter"&&x in e)return On[t]=x;x=vn(x);for(let F=0;F<hs.length;F++){const W=hs[F]+x;if(W in e)return On[t]=W}return t}const vs="http://www.w3.org/1999/xlink";function sf(e,t,a,x,F){if(x&&t.startsWith("xlink:"))a==null?e.removeAttributeNS(vs,t.slice(6,t.length)):e.setAttributeNS(vs,t,a);else{const W=Zo(t);a==null||W&&!Js(a)?e.removeAttribute(t):e.setAttribute(t,W?"":a)}}function af(e,t,a,x,F,W,N){if(t==="innerHTML"||t==="textContent"){x&&N(x,F,W),e[t]=a==null?"":a;return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=a;const v=a==null?"":a;(e.value!==v||e.tagName==="OPTION")&&(e.value=v),a==null&&e.removeAttribute(t);return}let O=!1;if(a===""||a==null){const v=typeof e[t];v==="boolean"?a=Js(a):a==null&&v==="string"?(a="",O=!0):v==="number"&&(a=0,O=!0)}try{e[t]=a}catch{}O&&e.removeAttribute(t)}function of(e,t,a,x){e.addEventListener(t,a,x)}function lf(e,t,a,x){e.removeEventListener(t,a,x)}function uf(e,t,a,x,F=null){const W=e._vei||(e._vei={}),N=W[t];if(x&&N)N.value=x;else{const[O,v]=ff(t);if(x){const M=W[t]=hf(x,F);of(e,O,M,v)}else N&&(lf(e,O,N,v),W[t]=void 0)}}const gs=/(?:Once|Passive|Capture)$/;function ff(e){let t;if(gs.test(e)){t={};let x;for(;x=e.match(gs);)e=e.slice(0,e.length-x[0].length),t[x[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):$t(e.slice(2)),t]}let Mn=0;const cf=Promise.resolve(),df=()=>Mn||(cf.then(()=>Mn=0),Mn=Date.now());function hf(e,t){const a=x=>{if(!x._vts)x._vts=Date.now();else if(x._vts<=a.attached)return;qe(vf(x,a.value),t,5,[x])};return a.value=e,a.attached=df(),a}function vf(e,t){if(ce(t)){const a=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{a.call(e),e._stopped=!0},t.map(x=>F=>!F._stopped&&x&&x(F))}else return t}const ms=/^on[a-z]/,gf=(e,t,a,x,F=!1,W,N,O,v)=>{t==="class"?tf(e,x,F):t==="style"?rf(e,a,x):Or(t)?oi(t)||uf(e,t,a,x,N):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):mf(e,t,x,F))?af(e,t,x,W,N,O,v):(t==="true-value"?e._trueValue=x:t==="false-value"&&(e._falseValue=x),sf(e,t,x,F))};function mf(e,t,a,x){return x?!!(t==="innerHTML"||t==="textContent"||t in e&&ms.test(t)&&he(a)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||ms.test(t)&&Te(a)?!1:t in e}const xt="transition",vr="animation",Ri=(e,{slots:t})=>Pe(Ca,pf(e),t);Ri.displayName="Transition";const qa={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};Ri.props=Ue({},Ca.props,qa);const kt=(e,t=[])=>{ce(e)?e.forEach(a=>a(...t)):e&&e(...t)},ps=e=>e?ce(e)?e.some(t=>t.length>1):e.length>1:!1;function pf(e){const t={};for(const s in e)s in qa||(t[s]=e[s]);if(e.css===!1)return t;const{name:a="v",type:x,duration:F,enterFromClass:W=`${a}-enter-from`,enterActiveClass:N=`${a}-enter-active`,enterToClass:O=`${a}-enter-to`,appearFromClass:v=W,appearActiveClass:M=N,appearToClass:S=O,leaveFromClass:k=`${a}-leave-from`,leaveActiveClass:R=`${a}-leave-active`,leaveToClass:K=`${a}-leave-to`}=e,b=Ef(F),I=b&&b[0],C=b&&b[1],{onBeforeEnter:L,onEnter:A,onEnterCancelled:h,onLeave:D,onLeaveCancelled:T,onBeforeAppear:d=L,onAppear:f=A,onAppearCancelled:i=h}=t,l=(s,c,_)=>{Ut(s,c?S:O),Ut(s,c?M:N),_&&_()},p=(s,c)=>{s._isLeaving=!1,Ut(s,k),Ut(s,K),Ut(s,R),c&&c()},m=s=>(c,_)=>{const u=s?f:A,o=()=>l(c,s,_);kt(u,[c,o]),Es(()=>{Ut(c,s?v:W),Lt(c,s?S:O),ps(u)||ys(c,x,I,o)})};return Ue(t,{onBeforeEnter(s){kt(L,[s]),Lt(s,W),Lt(s,N)},onBeforeAppear(s){kt(d,[s]),Lt(s,v),Lt(s,M)},onEnter:m(!1),onAppear:m(!0),onLeave(s,c){s._isLeaving=!0;const _=()=>p(s,c);Lt(s,k),_f(),Lt(s,R),Es(()=>{!s._isLeaving||(Ut(s,k),Lt(s,K),ps(D)||ys(s,x,C,_))}),kt(D,[s,_])},onEnterCancelled(s){l(s,!1),kt(h,[s])},onAppearCancelled(s){l(s,!0),kt(i,[s])},onLeaveCancelled(s){p(s),kt(T,[s])}})}function Ef(e){if(e==null)return null;if(xe(e))return[wn(e.enter),wn(e.leave)];{const t=wn(e);return[t,t]}}function wn(e){return ol(e)}function Lt(e,t){t.split(/\s+/).forEach(a=>a&&e.classList.add(a)),(e._vtc||(e._vtc=new Set)).add(t)}function Ut(e,t){t.split(/\s+/).forEach(x=>x&&e.classList.remove(x));const{_vtc:a}=e;a&&(a.delete(t),a.size||(e._vtc=void 0))}function Es(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let yf=0;function ys(e,t,a,x){const F=e._endId=++yf,W=()=>{F===e._endId&&x()};if(a)return setTimeout(W,a);const{type:N,timeout:O,propCount:v}=Tf(e,t);if(!N)return x();const M=N+"end";let S=0;const k=()=>{e.removeEventListener(M,R),W()},R=K=>{K.target===e&&++S>=v&&k()};setTimeout(()=>{S<v&&k()},O+1),e.addEventListener(M,R)}function Tf(e,t){const a=window.getComputedStyle(e),x=b=>(a[b]||"").split(", "),F=x(`${xt}Delay`),W=x(`${xt}Duration`),N=Ts(F,W),O=x(`${vr}Delay`),v=x(`${vr}Duration`),M=Ts(O,v);let S=null,k=0,R=0;t===xt?N>0&&(S=xt,k=N,R=W.length):t===vr?M>0&&(S=vr,k=M,R=v.length):(k=Math.max(N,M),S=k>0?N>M?xt:vr:null,R=S?S===xt?W.length:v.length:0);const K=S===xt&&/\b(transform|all)(,|$)/.test(x(`${xt}Property`).toString());return{type:S,timeout:k,propCount:R,hasTransform:K}}function Ts(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((a,x)=>_s(a)+_s(e[x])))}function _s(e){return Number(e.slice(0,-1).replace(",","."))*1e3}function _f(){return document.body.offsetHeight}const Sf={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Bh=(e,t)=>a=>{if(!("key"in a))return;const x=$t(a.key);if(t.some(F=>F===x||Sf[F]===x))return e(a)},Nh={beforeMount(e,{value:t},{transition:a}){e._vod=e.style.display==="none"?"":e.style.display,a&&t?a.beforeEnter(e):gr(e,t)},mounted(e,{value:t},{transition:a}){a&&t&&a.enter(e)},updated(e,{value:t,oldValue:a},{transition:x}){!t!=!a&&(x?t?(x.beforeEnter(e),gr(e,!0),x.enter(e)):x.leave(e,()=>{gr(e,!1)}):gr(e,t))},beforeUnmount(e,{value:t}){gr(e,t)}};function gr(e,t){e.style.display=t?e._vod:"none"}const xf=Ue({patchProp:gf},ef);let Fn,Ss=!1;function Lf(){return Fn=Ss?Fn:Mu(xf),Ss=!0,Fn}const Af=(...e)=>{const t=Lf().createApp(...e),{mount:a}=t;return t.mount=x=>{const F=Df(x);if(F)return a(F,!0,F instanceof SVGElement)},t};function Df(e){return Te(e)?document.querySelector(e):e}const Pf=JSON.parse('{"base":"/","lang":"en-US","title":"Personal Root Live","description":"Personal Root live","head":[["meta",{"name":"theme-color","content":"#3eaf7c"}],["meta",{"name":"apple-mobile-web-app-capable","content":"yes"}],["meta",{"name":"apple-mobile-web-app-status-bar-style","content":"black"}],["link",{"rel":"apple-touch-icon","sizes":"180x180","href":"/favicons/apple-touch-icon.png"}],["link",{"rel":"icon","type":"image/png","sizes":"32x32","href":"/favicons/favicon-32x32.png"}],["link",{"rel":"icon","type":"image/png","sizes":"16x16","href":"/favicons/favicon-16x16.png"}],["link",{"rel":"manifest","href":"/favicons/site.webmanifest"}],["link",{"rel":"shortcut icon","href":"/favicons/favicon.ico"}],["meta",{"name":"msapplication-TileColor","content":"#3a0839"}],["meta",{"name":"robots","content":"noindex,nofollow"}]],"locales":{"/":{"lang":"en-US","title":"Personal Root Live","description":"Personal Root live"}}}');var Rf=([e,t,a])=>e==="meta"&&t.name?`${e}.${t.name}`:["title","base"].includes(e)?e:e==="template"&&t.id?`${e}.${t.id}`:JSON.stringify([e,t,a]),If=e=>{const t=new Set,a=[];return e.forEach(x=>{const F=Rf(x);t.has(F)||(t.add(F),a.push(x))}),a},Cf=e=>/^(https?:)?\/\//.test(e),Kh=e=>/^mailto:/.test(e),Wh=e=>/^tel:/.test(e),eo=e=>Object.prototype.toString.call(e)==="[object Object]",bf=e=>e.replace(/\/$/,""),Of=e=>e.replace(/^\//,""),to=(e,t)=>{const a=Object.keys(e).sort((x,F)=>{const W=F.split("/").length-x.split("/").length;return W!==0?W:F.length-x.length});for(const x of a)if(t.startsWith(x))return x;return"/"};const ro={"v-8daa1a0e":nn(()=>ir(()=>import("./index.html.9c4f85b5.js"),[])),"v-3706649a":nn(()=>ir(()=>import("./404.html.ef80d927.js"),[]))},Mf={404:nn(()=>ir(()=>import("./404.426b5815.js"),[])),Layout:nn(()=>ir(()=>import("./Layout.b12867fb.js"),[]))};var no=ke(Yo),io=mi({key:"",path:"",title:"",lang:"",frontmatter:{},excerpt:"",headers:[]}),pt=ke(io),kr=()=>pt;Ui.webpackHot&&(__VUE_HMR_RUNTIME__.updatePageData=e=>{no.value[e.key]=()=>Promise.resolve(e),e.key===pt.value.key&&(pt.value=e)});var so=Symbol(""),wf=()=>{const e=Oe(so);if(!e)throw new Error("usePageFrontmatter() is called without provider.");return e},ao=Symbol(""),Ff=()=>{const e=Oe(ao);if(!e)throw new Error("usePageHead() is called without provider.");return e},kf=Symbol(""),oo=Symbol(""),Uf=()=>{const e=Oe(oo);if(!e)throw new Error("usePageLang() is called without provider.");return e},Ii=Symbol(""),Bf=()=>{const e=Oe(Ii);if(!e)throw new Error("useRouteLocale() is called without provider.");return e},Pt=ke(Pf),Nf=()=>Pt;Ui.webpackHot&&(__VUE_HMR_RUNTIME__.updateSiteData=e=>{Pt.value=e});var lo=Symbol(""),Hh=()=>{const e=Oe(lo);if(!e)throw new Error("useSiteLocaleData() is called without provider.");return e},Kf=Symbol(""),Nt=hr({resolvePageData:async e=>{const t=no.value[e],a=await(t==null?void 0:t());return a!=null?a:io},resolvePageFrontmatter:e=>e.frontmatter,resolvePageHead:(e,t,a)=>{const x=Te(t.description)?t.description:a.description,F=[...ce(t.head)?t.head:[],...a.head,["title",{},e],["meta",{name:"description",content:x}]];return If(F)},resolvePageHeadTitle:(e,t)=>`${e.title?`${e.title} | `:""}${t.title}`,resolvePageLang:e=>e.lang||"en",resolveRouteLocale:(e,t)=>to(e,t),resolveSiteLocaleData:(e,t)=>({...e,...e.locales[t]})}),Wf=et({name:"ClientOnly",setup(e,t){const a=ke(!1);return Ot(()=>{a.value=!0}),()=>{var x,F;return a.value?(F=(x=t.slots).default)==null?void 0:F.call(x):null}}}),Hf=et({name:"Content",props:{pageKey:{type:String,required:!1,default:""}},setup(e){const t=kr(),a=Se(()=>ro[e.pageKey||t.value.key]);return()=>a.value?Pe(a.value):Pe("div","404 Not Found")}}),xs=et({name:"Vuepress",setup(){const e=kr(),t=Se(()=>{let a;if(e.value.path){const x=e.value.frontmatter.layout;Te(x)?a=x:a="Layout"}else a="404";return Mf[a]||mu(a,!1)});return()=>Pe(t.value)}}),Gf=e=>Cf(e)?e:`${Nf().value.base}${Of(e)}`,Mt=e=>e;function uo(e,t,a){var x,F,W;t===void 0&&(t=50),a===void 0&&(a={});var N=(x=a.isImmediate)!=null&&x,O=(F=a.callback)!=null&&F,v=a.maxWait,M=Date.now(),S=[];function k(){if(v!==void 0){var K=Date.now()-M;if(K+t>=v)return v-K}return t}var R=function(){var K=[].slice.call(arguments),b=this;return new Promise(function(I,C){var L=N&&W===void 0;if(W!==void 0&&clearTimeout(W),W=setTimeout(function(){if(W=void 0,M=Date.now(),!N){var h=e.apply(b,K);O&&O(h),S.forEach(function(D){return(0,D.resolve)(h)}),S=[]}},k()),L){var A=e.apply(b,K);return O&&O(A),I(A)}S.push({resolve:I,reject:C})})};return R.cancel=function(K){W!==void 0&&clearTimeout(W),S.forEach(function(b){return(0,b.reject)(K)}),S=[]},R}/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */const Zt=typeof window!="undefined";function jf(e){return e.__esModule||e[Symbol.toStringTag]==="Module"}const ye=Object.assign;function kn(e,t){const a={};for(const x in t){const F=t[x];a[x]=ut(F)?F.map(e):e(F)}return a}const xr=()=>{},ut=Array.isArray,Vf=/\/$/,Yf=e=>e.replace(Vf,"");function Un(e,t,a="/"){let x,F={},W="",N="";const O=t.indexOf("#");let v=t.indexOf("?");return O<v&&O>=0&&(v=-1),v>-1&&(x=t.slice(0,v),W=t.slice(v+1,O>-1?O:t.length),F=e(W)),O>-1&&(x=x||t.slice(0,O),N=t.slice(O,t.length)),x=Qf(x!=null?x:t,a),{fullPath:x+(W&&"?")+W+N,path:x,query:F,hash:N}}function zf(e,t){const a=t.query?e(t.query):"";return t.path+(a&&"?")+a+(t.hash||"")}function Ls(e,t){return!t||!e.toLowerCase().startsWith(t.toLowerCase())?e:e.slice(t.length)||"/"}function $f(e,t,a){const x=t.matched.length-1,F=a.matched.length-1;return x>-1&&x===F&&ur(t.matched[x],a.matched[F])&&fo(t.params,a.params)&&e(t.query)===e(a.query)&&t.hash===a.hash}function ur(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function fo(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const a in e)if(!Xf(e[a],t[a]))return!1;return!0}function Xf(e,t){return ut(e)?As(e,t):ut(t)?As(t,e):e===t}function As(e,t){return ut(t)?e.length===t.length&&e.every((a,x)=>a===t[x]):e.length===1&&e[0]===t}function Qf(e,t){if(e.startsWith("/"))return e;if(!e)return t;const a=t.split("/"),x=e.split("/");let F=a.length-1,W,N;for(W=0;W<x.length;W++)if(N=x[W],N!==".")if(N==="..")F>1&&F--;else break;return a.slice(0,F).join("/")+"/"+x.slice(W-(W===x.length?1:0)).join("/")}var Cr;(function(e){e.pop="pop",e.push="push"})(Cr||(Cr={}));var Lr;(function(e){e.back="back",e.forward="forward",e.unknown=""})(Lr||(Lr={}));function Jf(e){if(!e)if(Zt){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),Yf(e)}const Zf=/^[^#]+#/;function qf(e,t){return e.replace(Zf,"#")+t}function ec(e,t){const a=document.documentElement.getBoundingClientRect(),x=e.getBoundingClientRect();return{behavior:t.behavior,left:x.left-a.left-(t.left||0),top:x.top-a.top-(t.top||0)}}const _n=()=>({left:window.pageXOffset,top:window.pageYOffset});function tc(e){let t;if("el"in e){const a=e.el,x=typeof a=="string"&&a.startsWith("#"),F=typeof a=="string"?x?document.getElementById(a.slice(1)):document.querySelector(a):a;if(!F)return;t=ec(F,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.pageXOffset,t.top!=null?t.top:window.pageYOffset)}function Ds(e,t){return(history.state?history.state.position-t:-1)+e}const ti=new Map;function rc(e,t){ti.set(e,t)}function nc(e){const t=ti.get(e);return ti.delete(e),t}let ic=()=>location.protocol+"//"+location.host;function co(e,t){const{pathname:a,search:x,hash:F}=t,W=e.indexOf("#");if(W>-1){let O=F.includes(e.slice(W))?e.slice(W).length:1,v=F.slice(O);return v[0]!=="/"&&(v="/"+v),Ls(v,"")}return Ls(a,e)+x+F}function sc(e,t,a,x){let F=[],W=[],N=null;const O=({state:R})=>{const K=co(e,location),b=a.value,I=t.value;let C=0;if(R){if(a.value=K,t.value=R,N&&N===b){N=null;return}C=I?R.position-I.position:0}else x(K);F.forEach(L=>{L(a.value,b,{delta:C,type:Cr.pop,direction:C?C>0?Lr.forward:Lr.back:Lr.unknown})})};function v(){N=a.value}function M(R){F.push(R);const K=()=>{const b=F.indexOf(R);b>-1&&F.splice(b,1)};return W.push(K),K}function S(){const{history:R}=window;!R.state||R.replaceState(ye({},R.state,{scroll:_n()}),"")}function k(){for(const R of W)R();W=[],window.removeEventListener("popstate",O),window.removeEventListener("beforeunload",S)}return window.addEventListener("popstate",O),window.addEventListener("beforeunload",S),{pauseListeners:v,listen:M,destroy:k}}function Ps(e,t,a,x=!1,F=!1){return{back:e,current:t,forward:a,replaced:x,position:window.history.length,scroll:F?_n():null}}function ac(e){const{history:t,location:a}=window,x={value:co(e,a)},F={value:t.state};F.value||W(x.value,{back:null,current:x.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function W(v,M,S){const k=e.indexOf("#"),R=k>-1?(a.host&&document.querySelector("base")?e:e.slice(k))+v:ic()+e+v;try{t[S?"replaceState":"pushState"](M,"",R),F.value=M}catch(K){console.error(K),a[S?"replace":"assign"](R)}}function N(v,M){const S=ye({},t.state,Ps(F.value.back,v,F.value.forward,!0),M,{position:F.value.position});W(v,S,!0),x.value=v}function O(v,M){const S=ye({},F.value,t.state,{forward:v,scroll:_n()});W(S.current,S,!0);const k=ye({},Ps(x.value,v,null),{position:S.position+1},M);W(v,k,!1),x.value=v}return{location:x,state:F,push:O,replace:N}}function oc(e){e=Jf(e);const t=ac(e),a=sc(e,t.state,t.location,t.replace);function x(W,N=!0){N||a.pauseListeners(),history.go(W)}const F=ye({location:"",base:e,go:x,createHref:qf.bind(null,e)},t,a);return Object.defineProperty(F,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(F,"state",{enumerable:!0,get:()=>t.state.value}),F}function lc(e){return typeof e=="string"||e&&typeof e=="object"}function ho(e){return typeof e=="string"||typeof e=="symbol"}const gt={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},vo=Symbol("");var Rs;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(Rs||(Rs={}));function fr(e,t){return ye(new Error,{type:e,[vo]:!0},t)}function vt(e,t){return e instanceof Error&&vo in e&&(t==null||!!(e.type&t))}const Is="[^/]+?",uc={sensitive:!1,strict:!1,start:!0,end:!0},fc=/[.+*?^${}()[\]/\\]/g;function cc(e,t){const a=ye({},uc,t),x=[];let F=a.start?"^":"";const W=[];for(const M of e){const S=M.length?[]:[90];a.strict&&!M.length&&(F+="/");for(let k=0;k<M.length;k++){const R=M[k];let K=40+(a.sensitive?.25:0);if(R.type===0)k||(F+="/"),F+=R.value.replace(fc,"\\$&"),K+=40;else if(R.type===1){const{value:b,repeatable:I,optional:C,regexp:L}=R;W.push({name:b,repeatable:I,optional:C});const A=L||Is;if(A!==Is){K+=10;try{new RegExp(`(${A})`)}catch(D){throw new Error(`Invalid custom RegExp for param "${b}" (${A}): `+D.message)}}let h=I?`((?:${A})(?:/(?:${A}))*)`:`(${A})`;k||(h=C&&M.length<2?`(?:/${h})`:"/"+h),C&&(h+="?"),F+=h,K+=20,C&&(K+=-8),I&&(K+=-20),A===".*"&&(K+=-50)}S.push(K)}x.push(S)}if(a.strict&&a.end){const M=x.length-1;x[M][x[M].length-1]+=.7000000000000001}a.strict||(F+="/?"),a.end?F+="$":a.strict&&(F+="(?:/|$)");const N=new RegExp(F,a.sensitive?"":"i");function O(M){const S=M.match(N),k={};if(!S)return null;for(let R=1;R<S.length;R++){const K=S[R]||"",b=W[R-1];k[b.name]=K&&b.repeatable?K.split("/"):K}return k}function v(M){let S="",k=!1;for(const R of e){(!k||!S.endsWith("/"))&&(S+="/"),k=!1;for(const K of R)if(K.type===0)S+=K.value;else if(K.type===1){const{value:b,repeatable:I,optional:C}=K,L=b in M?M[b]:"";if(ut(L)&&!I)throw new Error(`Provided param "${b}" is an array but it is not repeatable (* or + modifiers)`);const A=ut(L)?L.join("/"):L;if(!A)if(C)R.length<2&&(S.endsWith("/")?S=S.slice(0,-1):k=!0);else throw new Error(`Missing required param "${b}"`);S+=A}}return S||"/"}return{re:N,score:x,keys:W,parse:O,stringify:v}}function dc(e,t){let a=0;for(;a<e.length&&a<t.length;){const x=t[a]-e[a];if(x)return x;a++}return e.length<t.length?e.length===1&&e[0]===40+40?-1:1:e.length>t.length?t.length===1&&t[0]===40+40?1:-1:0}function hc(e,t){let a=0;const x=e.score,F=t.score;for(;a<x.length&&a<F.length;){const W=dc(x[a],F[a]);if(W)return W;a++}if(Math.abs(F.length-x.length)===1){if(Cs(x))return 1;if(Cs(F))return-1}return F.length-x.length}function Cs(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const vc={type:0,value:""},gc=/[a-zA-Z0-9_]/;function mc(e){if(!e)return[[]];if(e==="/")return[[vc]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(K){throw new Error(`ERR (${a})/"${M}": ${K}`)}let a=0,x=a;const F=[];let W;function N(){W&&F.push(W),W=[]}let O=0,v,M="",S="";function k(){!M||(a===0?W.push({type:0,value:M}):a===1||a===2||a===3?(W.length>1&&(v==="*"||v==="+")&&t(`A repeatable param (${M}) must be alone in its segment. eg: '/:ids+.`),W.push({type:1,value:M,regexp:S,repeatable:v==="*"||v==="+",optional:v==="*"||v==="?"})):t("Invalid state to consume buffer"),M="")}function R(){M+=v}for(;O<e.length;){if(v=e[O++],v==="\\"&&a!==2){x=a,a=4;continue}switch(a){case 0:v==="/"?(M&&k(),N()):v===":"?(k(),a=1):R();break;case 4:R(),a=x;break;case 1:v==="("?a=2:gc.test(v)?R():(k(),a=0,v!=="*"&&v!=="?"&&v!=="+"&&O--);break;case 2:v===")"?S[S.length-1]=="\\"?S=S.slice(0,-1)+v:a=3:S+=v;break;case 3:k(),a=0,v!=="*"&&v!=="?"&&v!=="+"&&O--,S="";break;default:t("Unknown state");break}}return a===2&&t(`Unfinished custom RegExp for param "${M}"`),k(),N(),F}function pc(e,t,a){const x=cc(mc(e.path),a),F=ye(x,{record:e,parent:t,children:[],alias:[]});return t&&!F.record.aliasOf==!t.record.aliasOf&&t.children.push(F),F}function Ec(e,t){const a=[],x=new Map;t=Ms({strict:!1,end:!0,sensitive:!1},t);function F(S){return x.get(S)}function W(S,k,R){const K=!R,b=yc(S);b.aliasOf=R&&R.record;const I=Ms(t,S),C=[b];if("alias"in S){const h=typeof S.alias=="string"?[S.alias]:S.alias;for(const D of h)C.push(ye({},b,{components:R?R.record.components:b.components,path:D,aliasOf:R?R.record:b}))}let L,A;for(const h of C){const{path:D}=h;if(k&&D[0]!=="/"){const T=k.record.path,d=T[T.length-1]==="/"?"":"/";h.path=k.record.path+(D&&d+D)}if(L=pc(h,k,I),R?R.alias.push(L):(A=A||L,A!==L&&A.alias.push(L),K&&S.name&&!Os(L)&&N(S.name)),b.children){const T=b.children;for(let d=0;d<T.length;d++)W(T[d],L,R&&R.children[d])}R=R||L,(L.record.components&&Object.keys(L.record.components).length||L.record.name||L.record.redirect)&&v(L)}return A?()=>{N(A)}:xr}function N(S){if(ho(S)){const k=x.get(S);k&&(x.delete(S),a.splice(a.indexOf(k),1),k.children.forEach(N),k.alias.forEach(N))}else{const k=a.indexOf(S);k>-1&&(a.splice(k,1),S.record.name&&x.delete(S.record.name),S.children.forEach(N),S.alias.forEach(N))}}function O(){return a}function v(S){let k=0;for(;k<a.length&&hc(S,a[k])>=0&&(S.record.path!==a[k].record.path||!go(S,a[k]));)k++;a.splice(k,0,S),S.record.name&&!Os(S)&&x.set(S.record.name,S)}function M(S,k){let R,K={},b,I;if("name"in S&&S.name){if(R=x.get(S.name),!R)throw fr(1,{location:S});I=R.record.name,K=ye(bs(k.params,R.keys.filter(A=>!A.optional).map(A=>A.name)),S.params&&bs(S.params,R.keys.map(A=>A.name))),b=R.stringify(K)}else if("path"in S)b=S.path,R=a.find(A=>A.re.test(b)),R&&(K=R.parse(b),I=R.record.name);else{if(R=k.name?x.get(k.name):a.find(A=>A.re.test(k.path)),!R)throw fr(1,{location:S,currentLocation:k});I=R.record.name,K=ye({},k.params,S.params),b=R.stringify(K)}const C=[];let L=R;for(;L;)C.unshift(L.record),L=L.parent;return{name:I,path:b,params:K,matched:C,meta:_c(C)}}return e.forEach(S=>W(S)),{addRoute:W,resolve:M,removeRoute:N,getRoutes:O,getRecordMatcher:F}}function bs(e,t){const a={};for(const x of t)x in e&&(a[x]=e[x]);return a}function yc(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:Tc(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function Tc(e){const t={},a=e.props||!1;if("component"in e)t.default=a;else for(const x in e.components)t[x]=typeof a=="boolean"?a:a[x];return t}function Os(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function _c(e){return e.reduce((t,a)=>ye(t,a.meta),{})}function Ms(e,t){const a={};for(const x in e)a[x]=x in t?t[x]:e[x];return a}function go(e,t){return t.children.some(a=>a===e||go(e,a))}const mo=/#/g,Sc=/&/g,xc=/\//g,Lc=/=/g,Ac=/\?/g,po=/\+/g,Dc=/%5B/g,Pc=/%5D/g,Eo=/%5E/g,Rc=/%60/g,yo=/%7B/g,Ic=/%7C/g,To=/%7D/g,Cc=/%20/g;function Ci(e){return encodeURI(""+e).replace(Ic,"|").replace(Dc,"[").replace(Pc,"]")}function bc(e){return Ci(e).replace(yo,"{").replace(To,"}").replace(Eo,"^")}function ri(e){return Ci(e).replace(po,"%2B").replace(Cc,"+").replace(mo,"%23").replace(Sc,"%26").replace(Rc,"`").replace(yo,"{").replace(To,"}").replace(Eo,"^")}function Oc(e){return ri(e).replace(Lc,"%3D")}function Mc(e){return Ci(e).replace(mo,"%23").replace(Ac,"%3F")}function wc(e){return e==null?"":Mc(e).replace(xc,"%2F")}function ln(e){try{return decodeURIComponent(""+e)}catch{}return""+e}function Fc(e){const t={};if(e===""||e==="?")return t;const x=(e[0]==="?"?e.slice(1):e).split("&");for(let F=0;F<x.length;++F){const W=x[F].replace(po," "),N=W.indexOf("="),O=ln(N<0?W:W.slice(0,N)),v=N<0?null:ln(W.slice(N+1));if(O in t){let M=t[O];ut(M)||(M=t[O]=[M]),M.push(v)}else t[O]=v}return t}function ws(e){let t="";for(let a in e){const x=e[a];if(a=Oc(a),x==null){x!==void 0&&(t+=(t.length?"&":"")+a);continue}(ut(x)?x.map(W=>W&&ri(W)):[x&&ri(x)]).forEach(W=>{W!==void 0&&(t+=(t.length?"&":"")+a,W!=null&&(t+="="+W))})}return t}function kc(e){const t={};for(const a in e){const x=e[a];x!==void 0&&(t[a]=ut(x)?x.map(F=>F==null?null:""+F):x==null?x:""+x)}return t}const Uc=Symbol(""),Fs=Symbol(""),Sn=Symbol(""),bi=Symbol(""),ni=Symbol("");function mr(){let e=[];function t(x){return e.push(x),()=>{const F=e.indexOf(x);F>-1&&e.splice(F,1)}}function a(){e=[]}return{add:t,list:()=>e,reset:a}}function Dt(e,t,a,x,F){const W=x&&(x.enterCallbacks[F]=x.enterCallbacks[F]||[]);return()=>new Promise((N,O)=>{const v=k=>{k===!1?O(fr(4,{from:a,to:t})):k instanceof Error?O(k):lc(k)?O(fr(2,{from:t,to:k})):(W&&x.enterCallbacks[F]===W&&typeof k=="function"&&W.push(k),N())},M=e.call(x&&x.instances[F],t,a,v);let S=Promise.resolve(M);e.length<3&&(S=S.then(v)),S.catch(k=>O(k))})}function Bn(e,t,a,x){const F=[];for(const W of e)for(const N in W.components){let O=W.components[N];if(!(t!=="beforeRouteEnter"&&!W.instances[N]))if(Bc(O)){const M=(O.__vccOpts||O)[t];M&&F.push(Dt(M,a,x,W,N))}else{let v=O();F.push(()=>v.then(M=>{if(!M)return Promise.reject(new Error(`Couldn't resolve component "${N}" at "${W.path}"`));const S=jf(M)?M.default:M;W.components[N]=S;const R=(S.__vccOpts||S)[t];return R&&Dt(R,a,x,W,N)()}))}}return F}function Bc(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function ks(e){const t=Oe(Sn),a=Oe(bi),x=Se(()=>t.resolve(lt(e.to))),F=Se(()=>{const{matched:v}=x.value,{length:M}=v,S=v[M-1],k=a.matched;if(!S||!k.length)return-1;const R=k.findIndex(ur.bind(null,S));if(R>-1)return R;const K=Us(v[M-2]);return M>1&&Us(S)===K&&k[k.length-1].path!==K?k.findIndex(ur.bind(null,v[M-2])):R}),W=Se(()=>F.value>-1&&Hc(a.params,x.value.params)),N=Se(()=>F.value>-1&&F.value===a.matched.length-1&&fo(a.params,x.value.params));function O(v={}){return Wc(v)?t[lt(e.replace)?"replace":"push"](lt(e.to)).catch(xr):Promise.resolve()}return{route:x,href:Se(()=>x.value.href),isActive:W,isExactActive:N,navigate:O}}const Nc=et({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:ks,setup(e,{slots:t}){const a=hr(ks(e)),{options:x}=Oe(Sn),F=Se(()=>({[Bs(e.activeClass,x.linkActiveClass,"router-link-active")]:a.isActive,[Bs(e.exactActiveClass,x.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const W=t.default&&t.default(a);return e.custom?W:Pe("a",{"aria-current":a.isExactActive?e.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:F.value},W)}}}),Kc=Nc;function Wc(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function Hc(e,t){for(const a in t){const x=t[a],F=e[a];if(typeof x=="string"){if(x!==F)return!1}else if(!ut(F)||F.length!==x.length||x.some((W,N)=>W!==F[N]))return!1}return!0}function Us(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const Bs=(e,t,a)=>e!=null?e:t!=null?t:a,Gc=et({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:a}){const x=Oe(ni),F=Se(()=>e.route||x.value),W=Oe(Fs,0),N=Se(()=>{let M=lt(W);const{matched:S}=F.value;let k;for(;(k=S[M])&&!k.components;)M++;return M}),O=Se(()=>F.value.matched[N.value]);Yt(Fs,Se(()=>N.value+1)),Yt(Uc,O),Yt(ni,F);const v=ke();return Et(()=>[v.value,O.value,e.name],([M,S,k],[R,K,b])=>{S&&(S.instances[k]=M,K&&K!==S&&M&&M===R&&(S.leaveGuards.size||(S.leaveGuards=K.leaveGuards),S.updateGuards.size||(S.updateGuards=K.updateGuards))),M&&S&&(!K||!ur(S,K)||!R)&&(S.enterCallbacks[k]||[]).forEach(I=>I(M))},{flush:"post"}),()=>{const M=F.value,S=e.name,k=O.value,R=k&&k.components[S];if(!R)return Ns(a.default,{Component:R,route:M});const K=k.props[S],b=K?K===!0?M.params:typeof K=="function"?K(M):K:null,C=Pe(R,ye({},b,t,{onVnodeUnmounted:L=>{L.component.isUnmounted&&(k.instances[S]=null)},ref:v}));return Ns(a.default,{Component:C,route:M})||C}}});function Ns(e,t){if(!e)return null;const a=e(t);return a.length===1?a[0]:a}const _o=Gc;function jc(e){const t=Ec(e.routes,e),a=e.parseQuery||Fc,x=e.stringifyQuery||ws,F=e.history,W=mr(),N=mr(),O=mr(),v=Ea(gt);let M=gt;Zt&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const S=kn.bind(null,w=>""+w),k=kn.bind(null,wc),R=kn.bind(null,ln);function K(w,H){let G,V;return ho(w)?(G=t.getRecordMatcher(w),V=H):V=w,t.addRoute(V,G)}function b(w){const H=t.getRecordMatcher(w);H&&t.removeRoute(H)}function I(){return t.getRoutes().map(w=>w.record)}function C(w){return!!t.getRecordMatcher(w)}function L(w,H){if(H=ye({},H||v.value),typeof w=="string"){const j=Un(a,w,H.path),Y=t.resolve({path:j.path},H),Q=F.createHref(j.fullPath);return ye(j,Y,{params:R(Y.params),hash:ln(j.hash),redirectedFrom:void 0,href:Q})}let G;if("path"in w)G=ye({},w,{path:Un(a,w.path,H.path).path});else{const j=ye({},w.params);for(const Y in j)j[Y]==null&&delete j[Y];G=ye({},w,{params:k(w.params)}),H.params=k(H.params)}const V=t.resolve(G,H),z=w.hash||"";V.params=S(R(V.params));const $=zf(x,ye({},w,{hash:bc(z),path:V.path})),X=F.createHref($);return ye({fullPath:$,hash:z,query:x===ws?kc(w.query):w.query||{}},V,{redirectedFrom:void 0,href:X})}function A(w){return typeof w=="string"?Un(a,w,v.value.path):ye({},w)}function h(w,H){if(M!==w)return fr(8,{from:H,to:w})}function D(w){return f(w)}function T(w){return D(ye(A(w),{replace:!0}))}function d(w){const H=w.matched[w.matched.length-1];if(H&&H.redirect){const{redirect:G}=H;let V=typeof G=="function"?G(w):G;return typeof V=="string"&&(V=V.includes("?")||V.includes("#")?V=A(V):{path:V},V.params={}),ye({query:w.query,hash:w.hash,params:"path"in V?{}:w.params},V)}}function f(w,H){const G=M=L(w),V=v.value,z=w.state,$=w.force,X=w.replace===!0,j=d(G);if(j)return f(ye(A(j),{state:typeof j=="object"?ye({},z,j.state):z,force:$,replace:X}),H||G);const Y=G;Y.redirectedFrom=H;let Q;return!$&&$f(x,V,G)&&(Q=fr(16,{to:Y,from:V}),E(V,V,!0,!1)),(Q?Promise.resolve(Q):l(Y,V)).catch(J=>vt(J)?vt(J,2)?J:r(J):n(J,Y,V)).then(J=>{if(J){if(vt(J,2))return f(ye({replace:X},A(J.to),{state:typeof J.to=="object"?ye({},z,J.to.state):z,force:$}),H||Y)}else J=m(Y,V,!0,X,z);return p(Y,V,J),J})}function i(w,H){const G=h(w,H);return G?Promise.reject(G):Promise.resolve()}function l(w,H){let G;const[V,z,$]=Vc(w,H);G=Bn(V.reverse(),"beforeRouteLeave",w,H);for(const j of V)j.leaveGuards.forEach(Y=>{G.push(Dt(Y,w,H))});const X=i.bind(null,w,H);return G.push(X),Qt(G).then(()=>{G=[];for(const j of W.list())G.push(Dt(j,w,H));return G.push(X),Qt(G)}).then(()=>{G=Bn(z,"beforeRouteUpdate",w,H);for(const j of z)j.updateGuards.forEach(Y=>{G.push(Dt(Y,w,H))});return G.push(X),Qt(G)}).then(()=>{G=[];for(const j of w.matched)if(j.beforeEnter&&!H.matched.includes(j))if(ut(j.beforeEnter))for(const Y of j.beforeEnter)G.push(Dt(Y,w,H));else G.push(Dt(j.beforeEnter,w,H));return G.push(X),Qt(G)}).then(()=>(w.matched.forEach(j=>j.enterCallbacks={}),G=Bn($,"beforeRouteEnter",w,H),G.push(X),Qt(G))).then(()=>{G=[];for(const j of N.list())G.push(Dt(j,w,H));return G.push(X),Qt(G)}).catch(j=>vt(j,8)?j:Promise.reject(j))}function p(w,H,G){for(const V of O.list())V(w,H,G)}function m(w,H,G,V,z){const $=h(w,H);if($)return $;const X=H===gt,j=Zt?history.state:{};G&&(V||X?F.replace(w.fullPath,ye({scroll:X&&j&&j.scroll},z)):F.push(w.fullPath,z)),v.value=w,E(w,H,G,X),r()}let s;function c(){s||(s=F.listen((w,H,G)=>{if(!B.listening)return;const V=L(w),z=d(V);if(z){f(ye(z,{replace:!0}),V).catch(xr);return}M=V;const $=v.value;Zt&&rc(Ds($.fullPath,G.delta),_n()),l(V,$).catch(X=>vt(X,12)?X:vt(X,2)?(f(X.to,V).then(j=>{vt(j,20)&&!G.delta&&G.type===Cr.pop&&F.go(-1,!1)}).catch(xr),Promise.reject()):(G.delta&&F.go(-G.delta,!1),n(X,V,$))).then(X=>{X=X||m(V,$,!1),X&&(G.delta&&!vt(X,8)?F.go(-G.delta,!1):G.type===Cr.pop&&vt(X,20)&&F.go(-1,!1)),p(V,$,X)}).catch(xr)}))}let _=mr(),u=mr(),o;function n(w,H,G){r(w);const V=u.list();return V.length?V.forEach(z=>z(w,H,G)):console.error(w),Promise.reject(w)}function g(){return o&&v.value!==gt?Promise.resolve():new Promise((w,H)=>{_.add([w,H])})}function r(w){return o||(o=!w,c(),_.list().forEach(([H,G])=>w?G(w):H()),_.reset()),w}function E(w,H,G,V){const{scrollBehavior:z}=e;if(!Zt||!z)return Promise.resolve();const $=!G&&nc(Ds(w.fullPath,0))||(V||!G)&&history.state&&history.state.scroll||null;return Ti().then(()=>z(w,H,$)).then(X=>X&&tc(X)).catch(X=>n(X,w,H))}const P=w=>F.go(w);let y;const U=new Set,B={currentRoute:v,listening:!0,addRoute:K,removeRoute:b,hasRoute:C,getRoutes:I,resolve:L,options:e,push:D,replace:T,go:P,back:()=>P(-1),forward:()=>P(1),beforeEach:W.add,beforeResolve:N.add,afterEach:O.add,onError:u.add,isReady:g,install(w){const H=this;w.component("RouterLink",Kc),w.component("RouterView",_o),w.config.globalProperties.$router=H,Object.defineProperty(w.config.globalProperties,"$route",{enumerable:!0,get:()=>lt(v)}),Zt&&!y&&v.value===gt&&(y=!0,D(F.location).catch(z=>{}));const G={};for(const z in gt)G[z]=Se(()=>v.value[z]);w.provide(Sn,H),w.provide(bi,hr(G)),w.provide(ni,v);const V=w.unmount;U.add(w),w.unmount=function(){U.delete(w),U.size<1&&(M=gt,s&&s(),s=null,v.value=gt,y=!1,o=!1),V()}}};return B}function Qt(e){return e.reduce((t,a)=>t.then(()=>a()),Promise.resolve())}function Vc(e,t){const a=[],x=[],F=[],W=Math.max(t.matched.length,e.matched.length);for(let N=0;N<W;N++){const O=t.matched[N];O&&(e.matched.find(M=>ur(M,O))?x.push(O):a.push(O));const v=e.matched[N];v&&(t.matched.find(M=>ur(M,v))||F.push(v))}return[a,x,F]}function Oi(){return Oe(Sn)}function Mi(){return Oe(bi)}const Yc=({headerLinkSelector:e,headerAnchorSelector:t,delay:a,offset:x=5})=>{const F=Oi(),W=kr(),O=uo(()=>{var C,L,A,h;const v=Math.max(window.scrollY,document.documentElement.scrollTop,document.body.scrollTop);if(Math.abs(v-0)<x){Ks(F,{hash:"",force:!0});return}const S=window.innerHeight+v,k=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),R=Math.abs(k-S)<x,K=Array.from(document.querySelectorAll(e)),I=Array.from(document.querySelectorAll(t)).filter(D=>K.some(T=>T.hash===D.hash));for(let D=0;D<I.length;D++){const T=I[D],d=I[D+1],f=v>=((L=(C=T.parentElement)==null?void 0:C.offsetTop)!=null?L:0)-x,i=!d||v<((h=(A=d.parentElement)==null?void 0:A.offsetTop)!=null?h:0)-x;if(!(f&&i))continue;const p=decodeURIComponent(F.currentRoute.value.hash),m=decodeURIComponent(T.hash);if(p===m)return;if(R){for(let s=D+1;s<I.length;s++)if(p===decodeURIComponent(I[s].hash))return}Ks(F,{hash:m,force:!0});return}},a);Ot(()=>{O(),window.addEventListener("scroll",O)}),_i(()=>{window.removeEventListener("scroll",O)}),Et(()=>W.value.path,O)},Ks=async(e,...t)=>{const{scrollBehavior:a}=e.options;e.options.scrollBehavior=void 0,await e.replace(...t).finally(()=>e.options.scrollBehavior=a)},zc="a.sidebar-item",$c=".header-anchor",Xc=300,Qc=5;var Jc=Mt({setup(){Yc({headerLinkSelector:zc,headerAnchorSelector:$c,delay:Xc,offset:Qc})}});const Ws=()=>window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,Zc=()=>window.scrollTo({top:0,behavior:"smooth"});const qc=et({name:"BackToTop",setup(){const e=ke(0),t=Se(()=>e.value>300),a=uo(()=>{e.value=Ws()},100);Ot(()=>{e.value=Ws(),window.addEventListener("scroll",()=>a())});const x=Pe("div",{class:"back-to-top",onClick:Zc});return()=>Pe(Ri,{name:"back-to-top"},()=>t.value?x:null)}});var ed=Mt({rootComponents:[qc]});const td=Pe("svg",{class:"external-link-icon",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15"},[Pe("path",{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}),Pe("polygon",{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"})]),rd=et({name:"ExternalLinkIcon",props:{locales:{type:Object,required:!1,default:()=>({})}},setup(e){const t=Bf(),a=Se(()=>{var x;return(x=e.locales[t.value])!=null?x:{openInNewWindow:"open in new window"}});return()=>Pe("span",[td,Pe("span",{class:"external-link-icon-sr-only"},a.value.openInNewWindow)])}}),nd={"/":{openInNewWindow:"open in new window"}};var id=Mt({enhance({app:e}){e.component("ExternalLinkIcon",Pe(rd,{locales:nd}))}});/*! medium-zoom 1.0.8 | MIT License | https://github.com/francoischalifour/medium-zoom */var Kt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var x in a)Object.prototype.hasOwnProperty.call(a,x)&&(e[x]=a[x])}return e},$r=function(t){return t.tagName==="IMG"},sd=function(t){return NodeList.prototype.isPrototypeOf(t)},Jr=function(t){return t&&t.nodeType===1},Hs=function(t){var a=t.currentSrc||t.src;return a.substr(-4).toLowerCase()===".svg"},Gs=function(t){try{return Array.isArray(t)?t.filter($r):sd(t)?[].slice.call(t).filter($r):Jr(t)?[t].filter($r):typeof t=="string"?[].slice.call(document.querySelectorAll(t)).filter($r):[]}catch{throw new TypeError(`The provided selector is invalid.
Expects a CSS selector, a Node element, a NodeList or an array.
See: https://github.com/francoischalifour/medium-zoom`)}},ad=function(t){var a=document.createElement("div");return a.classList.add("medium-zoom-overlay"),a.style.background=t,a},od=function(t){var a=t.getBoundingClientRect(),x=a.top,F=a.left,W=a.width,N=a.height,O=t.cloneNode(),v=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,M=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return O.removeAttribute("id"),O.style.position="absolute",O.style.top=x+v+"px",O.style.left=F+M+"px",O.style.width=W+"px",O.style.height=N+"px",O.style.transform="",O},Jt=function(t,a){var x=Kt({bubbles:!1,cancelable:!1,detail:void 0},a);if(typeof window.CustomEvent=="function")return new CustomEvent(t,x);var F=document.createEvent("CustomEvent");return F.initCustomEvent(t,x.bubbles,x.cancelable,x.detail),F},ld=function e(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=window.Promise||function(s){function c(){}s(c,c)},F=function(s){var c=s.target;if(c===l){b();return}h.indexOf(c)!==-1&&I({target:c})},W=function(){if(!(T||!i.original)){var s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(d-s)>f.scrollOffset&&setTimeout(b,150)}},N=function(s){var c=s.key||s.keyCode;(c==="Escape"||c==="Esc"||c===27)&&b()},O=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s;if(s.background&&(l.style.background=s.background),s.container&&s.container instanceof Object&&(c.container=Kt({},f.container,s.container)),s.template){var _=Jr(s.template)?s.template:document.querySelector(s.template);c.template=_}return f=Kt({},f,c),h.forEach(function(u){u.dispatchEvent(Jt("medium-zoom:update",{detail:{zoom:p}}))}),p},v=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e(Kt({},f,s))},M=function(){for(var s=arguments.length,c=Array(s),_=0;_<s;_++)c[_]=arguments[_];var u=c.reduce(function(o,n){return[].concat(o,Gs(n))},[]);return u.filter(function(o){return h.indexOf(o)===-1}).forEach(function(o){h.push(o),o.classList.add("medium-zoom-image")}),D.forEach(function(o){var n=o.type,g=o.listener,r=o.options;u.forEach(function(E){E.addEventListener(n,g,r)})}),p},S=function(){for(var s=arguments.length,c=Array(s),_=0;_<s;_++)c[_]=arguments[_];i.zoomed&&b();var u=c.length>0?c.reduce(function(o,n){return[].concat(o,Gs(n))},[]):h;return u.forEach(function(o){o.classList.remove("medium-zoom-image"),o.dispatchEvent(Jt("medium-zoom:detach",{detail:{zoom:p}}))}),h=h.filter(function(o){return u.indexOf(o)===-1}),p},k=function(s,c){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return h.forEach(function(u){u.addEventListener("medium-zoom:"+s,c,_)}),D.push({type:"medium-zoom:"+s,listener:c,options:_}),p},R=function(s,c){var _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return h.forEach(function(u){u.removeEventListener("medium-zoom:"+s,c,_)}),D=D.filter(function(u){return!(u.type==="medium-zoom:"+s&&u.listener.toString()===c.toString())}),p},K=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.target,_=function(){var o={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},n=void 0,g=void 0;if(f.container)if(f.container instanceof Object)o=Kt({},o,f.container),n=o.width-o.left-o.right-f.margin*2,g=o.height-o.top-o.bottom-f.margin*2;else{var r=Jr(f.container)?f.container:document.querySelector(f.container),E=r.getBoundingClientRect(),P=E.width,y=E.height,U=E.left,B=E.top;o=Kt({},o,{width:P,height:y,left:U,top:B})}n=n||o.width-f.margin*2,g=g||o.height-f.margin*2;var w=i.zoomedHd||i.original,H=Hs(w)?n:w.naturalWidth||n,G=Hs(w)?g:w.naturalHeight||g,V=w.getBoundingClientRect(),z=V.top,$=V.left,X=V.width,j=V.height,Y=Math.min(Math.max(X,H),n)/X,Q=Math.min(Math.max(j,G),g)/j,J=Math.min(Y,Q),Z=(-$+(n-X)/2+f.margin+o.left)/J,ee=(-z+(g-j)/2+f.margin+o.top)/J,ne="scale("+J+") translate3d("+Z+"px, "+ee+"px, 0)";i.zoomed.style.transform=ne,i.zoomedHd&&(i.zoomedHd.style.transform=ne)};return new x(function(u){if(c&&h.indexOf(c)===-1){u(p);return}var o=function P(){T=!1,i.zoomed.removeEventListener("transitionend",P),i.original.dispatchEvent(Jt("medium-zoom:opened",{detail:{zoom:p}})),u(p)};if(i.zoomed){u(p);return}if(c)i.original=c;else if(h.length>0){var n=h;i.original=n[0]}else{u(p);return}if(i.original.dispatchEvent(Jt("medium-zoom:open",{detail:{zoom:p}})),d=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,T=!0,i.zoomed=od(i.original),document.body.appendChild(l),f.template){var g=Jr(f.template)?f.template:document.querySelector(f.template);i.template=document.createElement("div"),i.template.appendChild(g.content.cloneNode(!0)),document.body.appendChild(i.template)}if(i.original.parentElement&&i.original.parentElement.tagName==="PICTURE"&&i.original.currentSrc&&(i.zoomed.src=i.original.currentSrc),document.body.appendChild(i.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),i.original.classList.add("medium-zoom-image--hidden"),i.zoomed.classList.add("medium-zoom-image--opened"),i.zoomed.addEventListener("click",b),i.zoomed.addEventListener("transitionend",o),i.original.getAttribute("data-zoom-src")){i.zoomedHd=i.zoomed.cloneNode(),i.zoomedHd.removeAttribute("srcset"),i.zoomedHd.removeAttribute("sizes"),i.zoomedHd.removeAttribute("loading"),i.zoomedHd.src=i.zoomed.getAttribute("data-zoom-src"),i.zoomedHd.onerror=function(){clearInterval(r),console.warn("Unable to reach the zoom image target "+i.zoomedHd.src),i.zoomedHd=null,_()};var r=setInterval(function(){i.zoomedHd.complete&&(clearInterval(r),i.zoomedHd.classList.add("medium-zoom-image--opened"),i.zoomedHd.addEventListener("click",b),document.body.appendChild(i.zoomedHd),_())},10)}else if(i.original.hasAttribute("srcset")){i.zoomedHd=i.zoomed.cloneNode(),i.zoomedHd.removeAttribute("sizes"),i.zoomedHd.removeAttribute("loading");var E=i.zoomedHd.addEventListener("load",function(){i.zoomedHd.removeEventListener("load",E),i.zoomedHd.classList.add("medium-zoom-image--opened"),i.zoomedHd.addEventListener("click",b),document.body.appendChild(i.zoomedHd),_()})}else _()})},b=function(){return new x(function(s){if(T||!i.original){s(p);return}var c=function _(){i.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(i.zoomed),i.zoomedHd&&document.body.removeChild(i.zoomedHd),document.body.removeChild(l),i.zoomed.classList.remove("medium-zoom-image--opened"),i.template&&document.body.removeChild(i.template),T=!1,i.zoomed.removeEventListener("transitionend",_),i.original.dispatchEvent(Jt("medium-zoom:closed",{detail:{zoom:p}})),i.original=null,i.zoomed=null,i.zoomedHd=null,i.template=null,s(p)};T=!0,document.body.classList.remove("medium-zoom--opened"),i.zoomed.style.transform="",i.zoomedHd&&(i.zoomedHd.style.transform=""),i.template&&(i.template.style.transition="opacity 150ms",i.template.style.opacity=0),i.original.dispatchEvent(Jt("medium-zoom:close",{detail:{zoom:p}})),i.zoomed.addEventListener("transitionend",c)})},I=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=s.target;return i.original?b():K({target:c})},C=function(){return f},L=function(){return h},A=function(){return i.original},h=[],D=[],T=!1,d=0,f=a,i={original:null,zoomed:null,zoomedHd:null,template:null};Object.prototype.toString.call(t)==="[object Object]"?f=t:(t||typeof t=="string")&&M(t),f=Kt({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},f);var l=ad(f.background);document.addEventListener("click",F),document.addEventListener("keyup",N),document.addEventListener("scroll",W),window.addEventListener("resize",b);var p={open:K,close:b,toggle:I,update:O,clone:v,attach:M,detach:S,on:k,off:R,getOptions:C,getImages:L,getZoomedImage:A};return p};function ud(e,t){t===void 0&&(t={});var a=t.insertAt;if(!(!e||typeof document=="undefined")){var x=document.head||document.getElementsByTagName("head")[0],F=document.createElement("style");F.type="text/css",a==="top"&&x.firstChild?x.insertBefore(F,x.firstChild):x.appendChild(F),F.styleSheet?F.styleSheet.cssText=e:F.appendChild(document.createTextNode(e))}}var fd=".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}";ud(fd);var cd=ld;const dd=Symbol("mediumZoom");const hd=".theme-default-content > img, .theme-default-content :not(a) > img",vd={},gd=300;var md=Mt({enhance({app:e,router:t}){const a=cd(vd);a.refresh=(x=hd)=>{a.detach(),a.attach(x)},e.provide(dd,a),t.afterEach(()=>{setTimeout(()=>a.refresh(),gd)})}});/**
 * NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT
 */const ge={settings:{minimum:.08,easing:"ease",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,barSelector:'[role="bar"]',parent:"body",template:'<div class="bar" role="bar"></div>'},status:null,set:e=>{const t=ge.isStarted();e=Nn(e,ge.settings.minimum,1),ge.status=e===1?null:e;const a=ge.render(!t),x=a.querySelector(ge.settings.barSelector),F=ge.settings.speed,W=ge.settings.easing;return a.offsetWidth,pd(N=>{Xr(x,{transform:"translate3d("+js(e)+"%,0,0)",transition:"all "+F+"ms "+W}),e===1?(Xr(a,{transition:"none",opacity:"1"}),a.offsetWidth,setTimeout(function(){Xr(a,{transition:"all "+F+"ms linear",opacity:"0"}),setTimeout(function(){ge.remove(),N()},F)},F)):setTimeout(()=>N(),F)}),ge},isStarted:()=>typeof ge.status=="number",start:()=>{ge.status||ge.set(0);const e=()=>{setTimeout(()=>{!ge.status||(ge.trickle(),e())},ge.settings.trickleSpeed)};return ge.settings.trickle&&e(),ge},done:e=>!e&&!ge.status?ge:ge.inc(.3+.5*Math.random()).set(1),inc:e=>{let t=ge.status;return t?(typeof e!="number"&&(e=(1-t)*Nn(Math.random()*t,.1,.95)),t=Nn(t+e,0,.994),ge.set(t)):ge.start()},trickle:()=>ge.inc(Math.random()*ge.settings.trickleRate),render:e=>{if(ge.isRendered())return document.getElementById("nprogress");Vs(document.documentElement,"nprogress-busy");const t=document.createElement("div");t.id="nprogress",t.innerHTML=ge.settings.template;const a=t.querySelector(ge.settings.barSelector),x=e?"-100":js(ge.status||0),F=document.querySelector(ge.settings.parent);return Xr(a,{transition:"all 0 linear",transform:"translate3d("+x+"%,0,0)"}),F!==document.body&&Vs(F,"nprogress-custom-parent"),F==null||F.appendChild(t),t},remove:()=>{Ys(document.documentElement,"nprogress-busy"),Ys(document.querySelector(ge.settings.parent),"nprogress-custom-parent");const e=document.getElementById("nprogress");e&&Ed(e)},isRendered:()=>!!document.getElementById("nprogress")},Nn=(e,t,a)=>e<t?t:e>a?a:e,js=e=>(-1+e)*100,pd=function(){const e=[];function t(){const a=e.shift();a&&a(t)}return function(a){e.push(a),e.length===1&&t()}}(),Xr=function(){const e=["Webkit","O","Moz","ms"],t={};function a(N){return N.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(O,v){return v.toUpperCase()})}function x(N){const O=document.body.style;if(N in O)return N;let v=e.length;const M=N.charAt(0).toUpperCase()+N.slice(1);let S;for(;v--;)if(S=e[v]+M,S in O)return S;return N}function F(N){return N=a(N),t[N]||(t[N]=x(N))}function W(N,O,v){O=F(O),N.style[O]=v}return function(N,O){for(const v in O){const M=O[v];M!==void 0&&Object.prototype.hasOwnProperty.call(O,v)&&W(N,v,M)}}}(),So=(e,t)=>(typeof e=="string"?e:wi(e)).indexOf(" "+t+" ")>=0,Vs=(e,t)=>{const a=wi(e),x=a+t;So(a,t)||(e.className=x.substring(1))},Ys=(e,t)=>{const a=wi(e);if(!So(e,t))return;const x=a.replace(" "+t+" "," ");e.className=x.substring(1,x.length-1)},wi=e=>(" "+(e.className||"")+" ").replace(/\s+/gi," "),Ed=e=>{e&&e.parentNode&&e.parentNode.removeChild(e)};const yd=()=>{Ot(()=>{const e=Oi(),t=new Set;t.add(e.currentRoute.value.path),e.beforeEach(a=>{t.has(a.path)||ge.start()}),e.afterEach(a=>{t.add(a.path),ge.done()})})};var Td=Mt({setup(){yd()}});const _d=JSON.parse(`{"locales":{"/":{"selectLanguageName":"English"}},"colorMode":"auto","colorModeSwitch":true,"navbar":[],"logo":null,"repo":null,"selectLanguageText":"Languages","selectLanguageAriaLabel":"Select language","sidebar":"auto","sidebarDepth":2,"editLink":true,"editLinkText":"Edit this page","lastUpdated":true,"lastUpdatedText":"Last Updated","contributors":true,"contributorsText":"Contributors","notFound":["There's nothing here.","How did we get here?","That's a Four-Oh-Four.","Looks like we've got some broken links."],"backToHome":"Take me home","openInNewWindow":"open in new window","toggleColorMode":"toggle color mode","toggleSidebar":"toggle sidebar"}`),xo=ke(_d),Sd=()=>xo;Ui.webpackHot&&(__VUE_HMR_RUNTIME__.updateThemeData=e=>{xo.value=e});const Lo=Symbol(""),xd=()=>{const e=Oe(Lo);if(!e)throw new Error("useThemeLocaleData() is called without provider.");return e},Ld=(e,t)=>{var a;return{...e,...(a=e.locales)==null?void 0:a[t]}};var Ad=Mt({enhance({app:e}){const t=Sd(),a=e._context.provides[Ii],x=Se(()=>Ld(t.value,a.value));e.provide(Lo,x),Object.defineProperties(e.config.globalProperties,{$theme:{get(){return t.value}},$themeLocale:{get(){return x.value}}})}}),Fi=(e,t)=>{const a=e.__vccOpts||e;for(const[x,F]of t)a[x]=F;return a};const Dd=et({__name:"Badge",props:{type:{type:String,required:!1,default:"tip"},text:{type:String,required:!1,default:""},vertical:{type:String,required:!1,default:void 0}},setup(e){return(t,a)=>(Fr(),Ai("span",{class:br(["badge",e.type]),style:cn({verticalAlign:e.vertical})},[ka(t.$slots,"default",{},()=>[Di(qo(e.text),1)])],6))}});var Pd=Fi(Dd,[["__file","Badge.vue"]]);const Rd=et({name:"CodeGroup",setup(e,{slots:t}){const a=ke(-1),x=ke([]),F=(O=a.value)=>{O<x.value.length-1?a.value=O+1:a.value=0,x.value[a.value].focus()},W=(O=a.value)=>{O>0?a.value=O-1:a.value=x.value.length-1,x.value[a.value].focus()},N=(O,v)=>{O.key===" "||O.key==="Enter"?(O.preventDefault(),a.value=v):O.key==="ArrowRight"?(O.preventDefault(),F(v)):O.key==="ArrowLeft"&&(O.preventDefault(),W(v))};return()=>{var v;const O=(((v=t.default)==null?void 0:v.call(t))||[]).filter(M=>M.type.name==="CodeGroupItem").map(M=>(M.props===null&&(M.props={}),M));return O.length===0?null:(a.value<0||a.value>O.length-1?(a.value=O.findIndex(M=>M.props.active===""||M.props.active===!0),a.value===-1&&(a.value=0)):O.forEach((M,S)=>{M.props.active=S===a.value}),Pe("div",{class:"code-group"},[Pe("div",{class:"code-group__nav"},Pe("ul",{class:"code-group__ul"},O.map((M,S)=>{const k=S===a.value;return Pe("li",{class:"code-group__li"},Pe("button",{ref:R=>{R&&(x.value[S]=R)},class:{"code-group__nav-tab":!0,"code-group__nav-tab-active":k},ariaPressed:k,ariaExpanded:k,onClick:()=>a.value=S,onKeydown:R=>N(R,S)},M.props.title))}))),O]))}}}),Id=["aria-selected"],Cd=et({name:"CodeGroupItem"}),bd=et({...Cd,props:{title:{type:String,required:!0},active:{type:Boolean,required:!1,default:!1}},setup(e){return(t,a)=>(Fr(),Ai("div",{class:br(["code-group-item",{"code-group-item__active":e.active}]),"aria-selected":e.active},[ka(t.$slots,"default")],10,Id))}});var Od=Fi(bd,[["__file","CodeGroupItem.vue"]]),zs;const Ur=typeof window!="undefined",Md=e=>typeof e=="string",Kn=()=>{};Ur&&((zs=window==null?void 0:window.navigator)==null?void 0:zs.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function wd(e,t){function a(...x){e(()=>t.apply(this,x),{fn:t,thisArg:this,args:x})}return a}const Ao=e=>e();function Fd(e=Ao){const t=ke(!0);function a(){t.value=!1}function x(){t.value=!0}return{isActive:t,pause:a,resume:x,eventFilter:(...W)=>{t.value&&e(...W)}}}function Do(e){return na()?(cl(e),!0):!1}function kd(e,t=!0){Qa()?wa(e):t?e():Ti(e)}function Gh(e=!1,t={}){const{truthyValue:a=!0,falsyValue:x=!1}=t,F=Me(e),W=ke(e);function N(O){return arguments.length?(W.value=O,W.value):(W.value=W.value===lt(a)?lt(x):lt(a),W.value)}return F?N:[W,N]}var $s=Object.getOwnPropertySymbols,Ud=Object.prototype.hasOwnProperty,Bd=Object.prototype.propertyIsEnumerable,Nd=(e,t)=>{var a={};for(var x in e)Ud.call(e,x)&&t.indexOf(x)<0&&(a[x]=e[x]);if(e!=null&&$s)for(var x of $s(e))t.indexOf(x)<0&&Bd.call(e,x)&&(a[x]=e[x]);return a};function Kd(e,t,a={}){const x=a,{eventFilter:F=Ao}=x,W=Nd(x,["eventFilter"]);return Et(e,wd(F,t),W)}var Wd=Object.defineProperty,Hd=Object.defineProperties,Gd=Object.getOwnPropertyDescriptors,un=Object.getOwnPropertySymbols,Po=Object.prototype.hasOwnProperty,Ro=Object.prototype.propertyIsEnumerable,Xs=(e,t,a)=>t in e?Wd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,jd=(e,t)=>{for(var a in t||(t={}))Po.call(t,a)&&Xs(e,a,t[a]);if(un)for(var a of un(t))Ro.call(t,a)&&Xs(e,a,t[a]);return e},Vd=(e,t)=>Hd(e,Gd(t)),Yd=(e,t)=>{var a={};for(var x in e)Po.call(e,x)&&t.indexOf(x)<0&&(a[x]=e[x]);if(e!=null&&un)for(var x of un(e))t.indexOf(x)<0&&Ro.call(e,x)&&(a[x]=e[x]);return a};function zd(e,t,a={}){const x=a,{eventFilter:F}=x,W=Yd(x,["eventFilter"]),{eventFilter:N,pause:O,resume:v,isActive:M}=Fd(F);return{stop:Kd(e,t,Vd(jd({},W),{eventFilter:N})),pause:O,resume:v,isActive:M}}function $d(e){var t;const a=lt(e);return(t=a==null?void 0:a.$el)!=null?t:a}const fn=Ur?window:void 0;Ur&&window.document;Ur&&window.navigator;Ur&&window.location;function Xd(...e){let t,a,x,F;if(Md(e[0])?([a,x,F]=e,t=fn):[t,a,x,F]=e,!t)return Kn;let W=Kn;const N=Et(()=>$d(t),v=>{W(),v&&(v.addEventListener(a,x,F),W=()=>{v.removeEventListener(a,x,F),W=Kn})},{immediate:!0,flush:"post"}),O=()=>{N(),W()};return Do(O),O}function Qd(e,t={}){const{window:a=fn}=t,x=Boolean(a&&"matchMedia"in a&&typeof a.matchMedia=="function");let F;const W=ke(!1),N=()=>{!x||(F||(F=a.matchMedia(e)),W.value=F.matches)};return kd(()=>{N(),F&&("addEventListener"in F?F.addEventListener("change",N):F.addListener(N),Do(()=>{"removeEventListener"in F?F.removeEventListener("change",N):F.removeListener(N)}))}),W}const ii=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},si="__vueuse_ssr_handlers__";ii[si]=ii[si]||{};const Jd=ii[si];function Zd(e,t){return Jd[e]||t}function qd(e){return e==null?"any":e instanceof Set?"set":e instanceof Map?"map":e instanceof Date?"date":typeof e=="boolean"?"boolean":typeof e=="string"?"string":typeof e=="object"||Array.isArray(e)?"object":Number.isNaN(e)?"any":"number"}const eh={boolean:{read:e=>e==="true",write:e=>String(e)},object:{read:e=>JSON.parse(e),write:e=>JSON.stringify(e)},number:{read:e=>Number.parseFloat(e),write:e=>String(e)},any:{read:e=>e,write:e=>String(e)},string:{read:e=>e,write:e=>String(e)},map:{read:e=>new Map(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e.entries()))},set:{read:e=>new Set(JSON.parse(e)),write:e=>JSON.stringify(Array.from(e))},date:{read:e=>new Date(e),write:e=>e.toISOString()}};function th(e,t,a,x={}){var F;const{flush:W="pre",deep:N=!0,listenToStorageChanges:O=!0,writeDefaults:v=!0,shallow:M,window:S=fn,eventFilter:k,onError:R=d=>{console.error(d)}}=x,K=(M?Ea:ke)(t);if(!a)try{a=Zd("getDefaultStorage",()=>{var d;return(d=fn)==null?void 0:d.localStorage})()}catch(d){R(d)}if(!a)return K;const b=lt(t),I=qd(b),C=(F=x.serializer)!=null?F:eh[I],{pause:L,resume:A}=zd(K,()=>h(K.value),{flush:W,deep:N,eventFilter:k});return S&&O&&Xd(S,"storage",T),T(),K;function h(d){try{d==null?a.removeItem(e):a.setItem(e,C.write(d))}catch(f){R(f)}}function D(d){if(!(d&&d.key!==e)){L();try{const f=d?d.newValue:a.getItem(e);return f==null?(v&&b!==null&&a.setItem(e,C.write(b)),b):typeof f!="string"?f:C.read(f)}catch(f){R(f)}finally{A()}}}function T(d){d&&d.key!==e||(K.value=D(d))}}function rh(e){return Qd("(prefers-color-scheme: dark)",e)}var Qs;(function(e){e.UP="UP",e.RIGHT="RIGHT",e.DOWN="DOWN",e.LEFT="LEFT",e.NONE="NONE"})(Qs||(Qs={}));const Io=Symbol(""),jh=()=>{const e=Oe(Io);if(!e)throw new Error("useDarkMode() is called without provider.");return e},nh=()=>{const e=Mo(),t=rh(),a=th("vuepress-color-scheme",e.value.colorMode),x=Se({get(){return e.value.colorModeSwitch?a.value==="auto"?t.value:a.value==="dark":e.value.colorMode==="dark"},set(F){F===t.value?a.value="auto":a.value=F?"dark":"light"}});Yt(Io,x),ih(x)},ih=e=>{const t=(a=e.value)=>{const x=window==null?void 0:window.document.querySelector("html");x==null||x.classList.toggle("dark",a)};Ot(()=>{Et(e,t,{immediate:!0})}),Si(()=>t())},Co=(...e)=>{const a=Oi().resolve(...e),x=a.matched[a.matched.length-1];if(!(x!=null&&x.redirect))return a;const{redirect:F}=x,W=he(F)?F(a):F,N=Te(W)?{path:W}:W;return Co({hash:a.hash,query:a.query,params:a.params,...N})},sh=e=>{const t=Co(encodeURI(e));return{text:t.meta.title||e,link:t.name==="404"?e:t.fullPath}};let Wn=null,pr=null;const ah={wait:()=>Wn,pending:()=>{Wn=new Promise(e=>pr=e)},resolve:()=>{pr==null||pr(),Wn=null,pr=null}},oh=()=>ah,bo=Symbol("sidebarItems"),Vh=()=>{const e=Oe(bo);if(!e)throw new Error("useSidebarItems() is called without provider.");return e},lh=()=>{const e=Mo(),t=wf(),a=Se(()=>uh(t.value,e.value));Yt(bo,a)},uh=(e,t)=>{var F,W,N,O;const a=(W=(F=e.sidebar)!=null?F:t.sidebar)!=null?W:"auto",x=(O=(N=e.sidebarDepth)!=null?N:t.sidebarDepth)!=null?O:2;return e.home||a===!1?[]:a==="auto"?ch(x):ce(a)?Oo(a,x):eo(a)?dh(a,x):[]},fh=(e,t)=>({text:e.title,link:`#${e.slug}`,children:ki(e.children,t)}),ki=(e,t)=>t>0?e.map(a=>fh(a,t-1)):[],ch=e=>{const t=kr();return[{text:t.value.title,children:ki(t.value.headers,e)}]},Oo=(e,t)=>{const a=Mi(),x=kr(),F=W=>{var O;let N;if(Te(W)?N=sh(W):N=W,N.children)return{...N,children:N.children.map(v=>F(v))};if(N.link===a.path){const v=((O=x.value.headers[0])==null?void 0:O.level)===1?x.value.headers[0].children:x.value.headers;return{...N,children:ki(v,t)}}return N};return e.map(W=>F(W))},dh=(e,t)=>{var W;const a=Mi(),x=to(e,a.path),F=(W=e[x])!=null?W:[];return Oo(F,t)},Mo=()=>xd();var hh=Mt({enhance({app:e,router:t}){e.component("Badge",Pd),e.component("CodeGroup",Rd),e.component("CodeGroupItem",Od),e.component("AutoLinkExternalIcon",()=>{const x=e.component("ExternalLinkIcon");return x?Pe(x):null}),e.component("NavbarSearch",()=>{const x=e.component("Docsearch")||e.component("SearchBox");return x?Pe(x):null});const a=t.options.scrollBehavior;t.options.scrollBehavior=async(...x)=>(await oh().wait(),a(...x))},setup(){nh(),lh()}}),vh=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function gh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var wo={exports:{}};(function(e,t){typeof window!="undefined"&&function(x,F){e.exports=F()}(vh,()=>(()=>{var a={"./src/config.ts":(N,O,v)=>{v.r(O),v.d(O,{enableStreamingMode:()=>g,hlsDefaultConfig:()=>u,mergeConfig:()=>n});var M=v("./src/controller/abr-controller.ts"),S=v("./src/controller/audio-stream-controller.ts"),k=v("./src/controller/audio-track-controller.ts"),R=v("./src/controller/subtitle-stream-controller.ts"),K=v("./src/controller/subtitle-track-controller.ts"),b=v("./src/controller/buffer-controller.ts"),I=v("./src/controller/timeline-controller.ts"),C=v("./src/controller/cap-level-controller.ts"),L=v("./src/controller/fps-controller.ts"),A=v("./src/controller/eme-controller.ts"),h=v("./src/controller/cmcd-controller.ts"),D=v("./src/utils/xhr-loader.ts"),T=v("./src/utils/fetch-loader.ts"),d=v("./src/utils/cues.ts"),f=v("./src/utils/mediakeys-helper.ts"),i=v("./src/utils/logger.ts");function l(){return l=Object.assign?Object.assign.bind():function(r){for(var E=1;E<arguments.length;E++){var P=arguments[E];for(var y in P)Object.prototype.hasOwnProperty.call(P,y)&&(r[y]=P[y])}return r},l.apply(this,arguments)}function p(r,E){var P=Object.keys(r);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(r);E&&(y=y.filter(function(U){return Object.getOwnPropertyDescriptor(r,U).enumerable})),P.push.apply(P,y)}return P}function m(r){for(var E=1;E<arguments.length;E++){var P=arguments[E]!=null?arguments[E]:{};E%2?p(Object(P),!0).forEach(function(y){s(r,y,P[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(P)):p(Object(P)).forEach(function(y){Object.defineProperty(r,y,Object.getOwnPropertyDescriptor(P,y))})}return r}function s(r,E,P){return E=c(E),E in r?Object.defineProperty(r,E,{value:P,enumerable:!0,configurable:!0,writable:!0}):r[E]=P,r}function c(r){var E=_(r,"string");return typeof E=="symbol"?E:String(E)}function _(r,E){if(typeof r!="object"||r===null)return r;var P=r[Symbol.toPrimitive];if(P!==void 0){var y=P.call(r,E||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(r)}var u=m(m({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:D.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:b.default,capLevelController:C.default,fpsController:L.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:f.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},o()),{},{subtitleStreamController:R.SubtitleStreamController,subtitleTrackController:K.default,timelineController:I.TimelineController,audioStreamController:S.default,audioTrackController:k.default,emeController:A.default,cmcdController:h.default});function o(){return{cueHandler:d.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function n(r,E){if((E.liveSyncDurationCount||E.liveMaxLatencyDurationCount)&&(E.liveSyncDuration||E.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(E.liveMaxLatencyDurationCount!==void 0&&(E.liveSyncDurationCount===void 0||E.liveMaxLatencyDurationCount<=E.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(E.liveMaxLatencyDuration!==void 0&&(E.liveSyncDuration===void 0||E.liveMaxLatencyDuration<=E.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return l({},r,E)}function g(r){var E=r.loader;if(E!==T.default&&E!==D.default)i.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1;else{var P=(0,T.fetchSupported)();P&&(r.loader=T.default,r.progressive=!0,r.enableSoftwareAES=!0,i.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>D});var M=v("./src/polyfills/number.ts"),S=v("./src/utils/ewma-bandwidth-estimator.ts"),k=v("./src/events.ts"),R=v("./src/errors.ts"),K=v("./src/types/loader.ts"),b=v("./src/utils/logger.ts");function I(T,d){for(var f=0;f<d.length;f++){var i=d[f];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(T,L(i.key),i)}}function C(T,d,f){return d&&I(T.prototype,d),f&&I(T,f),Object.defineProperty(T,"prototype",{writable:!1}),T}function L(T){var d=A(T,"string");return typeof d=="symbol"?d:String(d)}function A(T,d){if(typeof T!="object"||T===null)return T;var f=T[Symbol.toPrimitive];if(f!==void 0){var i=f.call(T,d||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(d==="string"?String:Number)(T)}var h=function(){function T(f){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=f;var i=f.config;this.bwEstimator=new S.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var d=T.prototype;return d.registerListeners=function(){var i=this.hls;i.on(k.Events.FRAG_LOADING,this.onFragLoading,this),i.on(k.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(k.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var i=this.hls;i.off(k.Events.FRAG_LOADING,this.onFragLoading,this),i.off(k.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(k.Events.ERROR,this.onError,this)},d.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},d.onFragLoading=function(i,l){var p=l.frag;if(p.type===K.PlaylistLevelType.MAIN&&!this.timer){var m;this.fragCurrent=p,this.partCurrent=(m=l.part)!=null?m:null,this.timer=self.setInterval(this.onCheck,100)}},d.onLevelLoaded=function(i,l){var p=this.hls.config;l.details.live?this.bwEstimator.update(p.abrEwmaSlowLive,p.abrEwmaFastLive):this.bwEstimator.update(p.abrEwmaSlowVoD,p.abrEwmaFastVoD)},d._abandonRulesCheck=function(){var i=this.fragCurrent,l=this.partCurrent,p=this.hls,m=p.autoLevelEnabled,s=p.media;if(!(!i||!s)){var c=l?l.stats:i.stats,_=l?l.duration:i.duration;if(c.aborted||c.loaded&&c.loaded===c.total||i.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!m||s.paused||!s.playbackRate||!s.readyState)){var u=p.mainForwardBufferInfo;if(u!==null){var o=performance.now()-c.loading.start,n=Math.abs(s.playbackRate);if(!(o<=500*_/n)){var g=c.loaded&&c.loading.first,r=this.bwEstimator.getEstimate(),E=p.levels,P=p.minAutoLevel,y=E[i.level],U=c.total||Math.max(c.loaded,Math.round(_*y.maxBitrate/8)),B=g?c.loaded*1e3/o:0,w=B?(U-c.loaded)/B:U*8/r,H=u.len/n;if(!(w<=H)){var G=Number.POSITIVE_INFINITY,V;for(V=i.level-1;V>P;V--){var z=E[V].maxBitrate;if(G=B?_*z/(8*.8*B):_*z/r,G<H)break}G>=w||(b.logger.warn("Fragment "+i.sn+(l?" part "+l.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+V+`
      Current BW estimate: `+((0,M.isFiniteNumber)(r)?(r/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+w.toFixed(3)+` s
      Estimated load time for the next fragment: `+G.toFixed(3)+` s
      Time to underbuffer: `+H.toFixed(3)+" s"),p.nextLoadLevel=V,g&&this.bwEstimator.sample(o,c.loaded),this.clearTimer(),(i.loader||i.keyLoader)&&(this.fragCurrent=this.partCurrent=null,i.abortRequests()),p.trigger(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:l,stats:c}))}}}}}},d.onFragLoaded=function(i,l){var p=l.frag,m=l.part;if(p.type===K.PlaylistLevelType.MAIN&&(0,M.isFiniteNumber)(p.sn)){var s=m?m.stats:p.stats,c=m?m.duration:p.duration;if(this.clearTimer(),this.lastLoadedFragLevel=p.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var _=this.hls.levels[p.level],u=(_.loaded?_.loaded.bytes:0)+s.loaded,o=(_.loaded?_.loaded.duration:0)+c;_.loaded={bytes:u,duration:o},_.realBitrate=Math.round(8*u/o)}if(p.bitrateTest){var n={stats:s,frag:p,part:m,id:p.type};this.onFragBuffered(k.Events.FRAG_BUFFERED,n)}}},d.onFragBuffered=function(i,l){var p=l.frag,m=l.part,s=m?m.stats:p.stats;if(!s.aborted&&!(p.type!==K.PlaylistLevelType.MAIN||p.sn==="initSegment")){var c=s.parsing.end-s.loading.start;this.bwEstimator.sample(c,s.loaded),s.bwEstimate=this.bwEstimator.getEstimate(),p.bitrateTest?this.bitrateTestDelay=c/1e3:this.bitrateTestDelay=0}},d.onError=function(i,l){var p;if(((p=l.frag)===null||p===void 0?void 0:p.type)===K.PlaylistLevelType.MAIN){if(l.type===R.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(l.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:case R.ErrorDetails.KEY_LOAD_ERROR:case R.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},d.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},d.getNextABRAutoLevel=function(){var i=this.fragCurrent,l=this.partCurrent,p=this.hls,m=p.maxAutoLevel,s=p.config,c=p.minAutoLevel,_=p.media,u=l?l.duration:i?i.duration:0,o=_&&_.playbackRate!==0?Math.abs(_.playbackRate):1,n=this.bwEstimator?this.bwEstimator.getEstimate():s.abrEwmaDefaultEstimate,g=p.mainForwardBufferInfo,r=(g?g.len:0)/o,E=this.findBestLevel(n,c,m,r,s.abrBandWidthFactor,s.abrBandWidthUpFactor);if(E>=0)return E;b.logger.trace((r?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var P=u?Math.min(u,s.maxStarvationDelay):s.maxStarvationDelay,y=s.abrBandWidthFactor,U=s.abrBandWidthUpFactor;if(!r){var B=this.bitrateTestDelay;if(B){var w=u?Math.min(u,s.maxLoadingDelay):s.maxLoadingDelay;P=w-B,b.logger.trace("bitrate test took "+Math.round(1e3*B)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*P)+" ms"),y=U=1}}return E=this.findBestLevel(n,c,m,r+P,y,U),Math.max(E,0)},d.findBestLevel=function(i,l,p,m,s,c){for(var _,u=this.fragCurrent,o=this.partCurrent,n=this.lastLoadedFragLevel,g=this.hls.levels,r=g[n],E=!!(r!=null&&(_=r.details)!==null&&_!==void 0&&_.live),P=r==null?void 0:r.codecSet,y=o?o.duration:u?u.duration:0,U=p;U>=l;U--){var B=g[U];if(!(!B||P&&B.codecSet!==P)){var w=B.details,H=(o?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||y,G=void 0;U<=n?G=s*i:G=c*i;var V=g[U].maxBitrate,z=V*H/G;if(b.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+U+"/"+Math.round(G)+"/"+V+"/"+H+"/"+m+"/"+z),G>V&&(z===0||!(0,M.isFiniteNumber)(z)||E&&!this.bitrateTestDelay||z<m))return U}}return-1},C(T,[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,l=this.bwEstimator;if(i!==-1&&!l.canEstimate())return i;var p=this.getNextABRAutoLevel();return i!==-1&&this.hls.levels[p].loadError?i:(i!==-1&&(p=Math.min(i,p)),p)},set:function(i){this._nextAutoLevel=i}}]),T}();const D=h},"./src/controller/audio-stream-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>s});var M=v("./src/polyfills/number.ts"),S=v("./src/controller/base-stream-controller.ts"),k=v("./src/events.ts"),R=v("./src/utils/buffer-helper.ts"),K=v("./src/controller/fragment-tracker.ts"),b=v("./src/types/level.ts"),I=v("./src/types/loader.ts"),C=v("./src/loader/fragment.ts"),L=v("./src/demux/chunk-cache.ts"),A=v("./src/demux/transmuxer-interface.ts"),h=v("./src/types/transmuxer.ts"),D=v("./src/controller/fragment-finders.ts"),T=v("./src/utils/discontinuities.ts"),d=v("./src/errors.ts");function f(){return f=Object.assign?Object.assign.bind():function(c){for(var _=1;_<arguments.length;_++){var u=arguments[_];for(var o in u)Object.prototype.hasOwnProperty.call(u,o)&&(c[o]=u[o])}return c},f.apply(this,arguments)}function i(c,_){c.prototype=Object.create(_.prototype),c.prototype.constructor=c,l(c,_)}function l(c,_){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,n){return o.__proto__=n,o},l(c,_)}var p=100,m=function(c){i(_,c);function _(o,n,g){var r;return r=c.call(this,o,n,g,"[audio-stream-controller]")||this,r.videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}var u=_.prototype;return u.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},u._registerListeners=function(){var n=this.hls;n.on(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(k.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.on(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(k.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(k.Events.ERROR,this.onError,this),n.on(k.Events.BUFFER_RESET,this.onBufferReset,this),n.on(k.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(k.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var n=this.hls;n.off(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(k.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),n.off(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(k.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(k.Events.ERROR,this.onError,this),n.off(k.Events.BUFFER_RESET,this.onBufferReset,this),n.off(k.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(k.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),n.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.onInitPtsFound=function(n,g){var r=g.frag,E=g.id,P=g.initPTS;if(E==="main"){var y=r.cc;this.initPTS[r.cc]=P,this.log("InitPTS for cc: "+y+" found from main: "+P),this.videoTrackCC=y,this.state===S.State.WAITING_INIT_PTS&&this.tick()}},u.startLoad=function(n){if(!this.levels){this.startPosition=n,this.state=S.State.STOPPED;return}var g=this.lastCurrentTime;this.stopLoad(),this.setInterval(p),this.fragLoadError=0,g>0&&n===-1?(this.log("Override startPosition with lastCurrentTime @"+g.toFixed(3)),n=g,this.state=S.State.IDLE):(this.loadedmetadata=!1,this.state=S.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()},u.doTick=function(){switch(this.state){case S.State.IDLE:this.doTickIdle();break;case S.State.WAITING_TRACK:{var n,g=this.levels,r=this.trackId,E=g==null||(n=g[r])===null||n===void 0?void 0:n.details;if(E){if(this.waitForCdnTuneIn(E))break;this.state=S.State.WAITING_INIT_PTS}break}case S.State.FRAG_LOADING_WAITING_RETRY:{var P,y=performance.now(),U=this.retryDate;(!U||y>=U||(P=this.media)!==null&&P!==void 0&&P.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=S.State.IDLE);break}case S.State.WAITING_INIT_PTS:{var B=this.waitingData;if(B){var w=B.frag,H=B.part,G=B.cache,V=B.complete;if(this.initPTS[w.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=S.State.FRAG_LOADING;var z=G.flush(),$={frag:w,part:H,payload:z,networkDetails:null};this._handleFragmentLoadProgress($),V&&c.prototype._handleFragmentLoadComplete.call(this,$)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+w.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var X=this.getLoadPosition(),j=R.BufferHelper.bufferInfo(this.mediaBuffer,X,this.config.maxBufferHole),Y=(0,D.fragmentWithinToleranceTest)(j.end,this.config.maxFragLookUpTolerance,w);Y<0&&(this.log("Waiting fragment cc ("+w.cc+") @ "+w.start+" cancelled because another fragment at "+j.end+" is needed"),this.clearWaitingFragment())}}else this.state=S.State.IDLE}}this.onTickEnd()},u.clearWaitingFragment=function(){var n=this.waitingData;n&&(this.fragmentTracker.removeFragment(n.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=S.State.IDLE)},u.resetLoadingState=function(){this.clearWaitingFragment(),c.prototype.resetLoadingState.call(this)},u.onTickEnd=function(){var n=this.media;!n||!n.readyState||(this.lastCurrentTime=n.currentTime)},u.doTickIdle=function(){var n=this.hls,g=this.levels,r=this.media,E=this.trackId,P=n.config;if(!(!g||!g[E])&&!(!r&&(this.startFragRequested||!P.startFragPrefetch))){var y=g[E],U=y.details;if(!U||U.live&&this.levelLastLoaded!==E||this.waitForCdnTuneIn(U)){this.state=S.State.WAITING_TRACK;return}var B=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&B&&(this.bufferFlushed=!1,this.afterBufferFlushed(B,C.ElementaryStreamTypes.AUDIO,I.PlaylistLevelType.AUDIO));var w=this.getFwdBufferInfo(B,I.PlaylistLevelType.AUDIO);if(w!==null){var H=this.audioSwitch;if(!H&&this._streamEnded(w,U)){n.trigger(k.Events.BUFFER_EOS,{type:"audio"}),this.state=S.State.ENDED;return}var G=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,I.PlaylistLevelType.MAIN),V=w.len,z=this.getMaxBufferLength(G==null?void 0:G.len);if(!(V>=z&&!H)){var $=U.fragments,X=$[0].start,j=w.end;if(H&&r){var Y=this.getLoadPosition();j=Y,U.PTSKnown&&Y<X&&(w.end>X||w.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=X+.05)}if(!(G&&j>G.end+U.targetduration)&&!((!G||!G.len)&&w.len)){var Q=this.getNextFragment(j,U);if(!Q){this.bufferFlushed=!0;return}this.loadFragment(Q,U,j)}}}}},u.getMaxBufferLength=function(n){var g=c.prototype.getMaxBufferLength.call(this);return n?Math.max(g,n):g},u.onMediaDetaching=function(){this.videoBuffer=null,c.prototype.onMediaDetaching.call(this)},u.onAudioTracksUpdated=function(n,g){var r=g.audioTracks;this.resetTransmuxer(),this.levels=r.map(function(E){return new b.Level(E)})},u.onAudioTrackSwitching=function(n,g){var r=!!g.url;this.trackId=g.id;var E=this.fragCurrent;E&&E.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(p):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=S.State.IDLE):this.state=S.State.STOPPED,this.tick()},u.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},u.onLevelLoaded=function(n,g){this.mainDetails=g.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(k.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},u.onAudioTrackLoaded=function(n,g){var r;if(this.mainDetails==null){this.cachedTrackLoadedData=g;return}var E=this.levels,P=g.details,y=g.id;if(!E){this.warn("Audio tracks were reset while loading level "+y);return}this.log("Track "+y+" loaded ["+P.startSN+","+P.endSN+"],duration:"+P.totalduration);var U=E[y],B=0;if(P.live||(r=U.details)!==null&&r!==void 0&&r.live){var w=this.mainDetails;if(P.fragments[0]||(P.deltaUpdateFailed=!0),P.deltaUpdateFailed||!w)return;!U.details&&P.hasProgramDateTime&&w.hasProgramDateTime?((0,T.alignMediaPlaylistByPDT)(P,w),B=P.fragments[0].start):B=this.alignPlaylists(P,U.details)}U.details=P,this.levelLastLoaded=y,!this.startFragRequested&&(this.mainDetails||!P.live)&&this.setStartPosition(U.details,B),this.state===S.State.WAITING_TRACK&&!this.waitForCdnTuneIn(P)&&(this.state=S.State.IDLE),this.tick()},u._handleFragmentLoadProgress=function(n){var g,r=n.frag,E=n.part,P=n.payload,y=this.config,U=this.trackId,B=this.levels;if(!B){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered");return}var w=B[U];console.assert(w,"Audio track is defined on fragment load progress");var H=w.details;console.assert(H,"Audio track details are defined on fragment load progress");var G=y.defaultAudioCodec||w.audioCodec||"mp4a.40.2",V=this.transmuxer;V||(V=this.transmuxer=new A.default(this.hls,I.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var z=this.initPTS[r.cc],$=(g=r.initSegment)===null||g===void 0?void 0:g.data;if(z!==void 0){var X=!1,j=E?E.index:-1,Y=j!==-1,Q=new h.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,P.byteLength,j,Y);V.push(P,$,G,"",r,E,H.totalduration,X,Q,z)}else{this.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+H.startSN+" ,"+H.endSN+"],track "+U);var J=this.waitingData=this.waitingData||{frag:r,part:E,cache:new L.default,complete:!1},Z=J.cache;Z.push(new Uint8Array(P)),this.waitingVideoCC=this.videoTrackCC,this.state=S.State.WAITING_INIT_PTS}},u._handleFragmentLoadComplete=function(n){if(this.waitingData){this.waitingData.complete=!0;return}c.prototype._handleFragmentLoadComplete.call(this,n)},u.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},u.onBufferCreated=function(n,g){var r=g.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),g.tracks.video&&(this.videoBuffer=g.tracks.video.buffer||null)},u.onFragBuffered=function(n,g){var r=g.frag,E=g.part;if(r.type!==I.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&r.type===I.PlaylistLevelType.MAIN){var P;(P=this.videoBuffer||this.media)!==null&&P!==void 0&&P.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(r)){this.warn("Fragment "+r.sn+(E?" p: "+E.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}r.sn!=="initSegment"&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,E)},u.onError=function(n,g){if(g.type===d.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(I.PlaylistLevelType.AUDIO,g);return}switch(g.details){case d.ErrorDetails.FRAG_LOAD_ERROR:case d.ErrorDetails.FRAG_LOAD_TIMEOUT:case d.ErrorDetails.FRAG_PARSING_ERROR:case d.ErrorDetails.KEY_LOAD_ERROR:case d.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(I.PlaylistLevelType.AUDIO,g);break;case d.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case d.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==S.State.ERROR&&this.state!==S.State.STOPPED&&(this.state=g.fatal?S.State.ERROR:S.State.IDLE,this.warn(g.details+" while loading frag, switching to "+this.state+" state"));break;case d.ErrorDetails.BUFFER_FULL_ERROR:if(g.parent==="audio"&&(this.state===S.State.PARSING||this.state===S.State.PARSED)){var r=!0,E=this.getFwdBufferInfo(this.mediaBuffer,I.PlaylistLevelType.AUDIO);E&&E.len>.5&&(r=!this.reduceMaxBufferLength(E.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,c.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},u.onBufferFlushed=function(n,g){var r=g.type;r===C.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===S.State.ENDED&&(this.state=S.State.IDLE))},u._handleTransmuxComplete=function(n){var g,r="audio",E=this.hls,P=n.remuxResult,y=n.chunkMeta,U=this.getCurrentContext(y);if(!U){this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(y.level);return}var B=U.frag,w=U.part,H=U.level.details,G=P.audio,V=P.text,z=P.id3,$=P.initSegment;if(!(this.fragContextChanged(B)||!H)){if(this.state=S.State.PARSING,this.audioSwitch&&G&&this.completeAudioSwitch(),$!=null&&$.tracks&&(this._bufferInitSegment($.tracks,B,y),E.trigger(k.Events.FRAG_PARSING_INIT_SEGMENT,{frag:B,id:r,tracks:$.tracks})),G){var X=G.startPTS,j=G.endPTS,Y=G.startDTS,Q=G.endDTS;w&&(w.elementaryStreams[C.ElementaryStreamTypes.AUDIO]={startPTS:X,endPTS:j,startDTS:Y,endDTS:Q}),B.setElementaryStreamInfo(C.ElementaryStreamTypes.AUDIO,X,j,Y,Q),this.bufferFragmentData(G,B,w,y)}if(z!=null&&(g=z.samples)!==null&&g!==void 0&&g.length){var J=f({id:r,frag:B,details:H},z);E.trigger(k.Events.FRAG_PARSING_METADATA,J)}if(V){var Z=f({id:r,frag:B,details:H},V);E.trigger(k.Events.FRAG_PARSING_USERDATA,Z)}}},u._bufferInitSegment=function(n,g,r){if(this.state===S.State.PARSING){n.video&&delete n.video;var E=n.audio;if(!!E){E.levelCodec=E.codec,E.id="audio",this.log("Init audio buffer, container:"+E.container+", codecs[parsed]=["+E.codec+"]"),this.hls.trigger(k.Events.BUFFER_CODECS,n);var P=E.initSegment;if(P!=null&&P.byteLength){var y={type:"audio",frag:g,part:null,chunkMeta:r,parent:g.type,data:P};this.hls.trigger(k.Events.BUFFER_APPENDING,y)}this.tick()}}},u.loadFragment=function(n,g,r){var E=this.fragmentTracker.getState(n);this.fragCurrent=n,(this.audioSwitch||E===K.FragmentState.NOT_LOADED||E===K.FragmentState.PARTIAL)&&(n.sn==="initSegment"?this._loadInitSegment(n,g):g.live&&!(0,M.isFiniteNumber)(this.initPTS[n.cc])?(this.log("Waiting for video PTS in continuity counter "+n.cc+" of live stream before loading audio fragment "+n.sn+" of level "+this.trackId),this.state=S.State.WAITING_INIT_PTS):(this.startFragRequested=!0,c.prototype.loadFragment.call(this,n,g,r)))},u.completeAudioSwitch=function(){var n=this.hls,g=this.media,r=this.trackId;g&&(this.log("Switching audio track : flushing all audio"),c.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,n.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:r})},_}(S.default);const s=m},"./src/controller/audio-track-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>D});var M=v("./src/events.ts"),S=v("./src/errors.ts"),k=v("./src/controller/base-playlist-controller.ts"),R=v("./src/types/loader.ts");function K(T,d){for(var f=0;f<d.length;f++){var i=d[f];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(T,I(i.key),i)}}function b(T,d,f){return d&&K(T.prototype,d),f&&K(T,f),Object.defineProperty(T,"prototype",{writable:!1}),T}function I(T){var d=C(T,"string");return typeof d=="symbol"?d:String(d)}function C(T,d){if(typeof T!="object"||T===null)return T;var f=T[Symbol.toPrimitive];if(f!==void 0){var i=f.call(T,d||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(d==="string"?String:Number)(T)}function L(T,d){T.prototype=Object.create(d.prototype),T.prototype.constructor=T,A(T,d)}function A(T,d){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,l){return i.__proto__=l,i},A(T,d)}var h=function(T){L(d,T);function d(i){var l;return l=T.call(this,i,"[audio-track-controller]")||this,l.tracks=[],l.groupId=null,l.tracksInGroup=[],l.trackId=-1,l.trackName="",l.selectDefaultTrack=!0,l.registerListeners(),l}var f=d.prototype;return f.registerListeners=function(){var l=this.hls;l.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.on(M.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var l=this.hls;l.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.off(M.Events.ERROR,this.onError,this)},f.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,T.prototype.destroy.call(this)},f.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},f.onManifestParsed=function(l,p){this.tracks=p.audioTracks||[]},f.onAudioTrackLoaded=function(l,p){var m=p.id,s=p.details,c=this.tracksInGroup[m];if(!c){this.warn("Invalid audio track id "+m);return}var _=c.details;c.details=p.details,this.log("audioTrack "+m+" loaded ["+s.startSN+"-"+s.endSN+"]"),m===this.trackId&&(this.retryCount=0,this.playlistLoaded(m,p,_))},f.onLevelLoading=function(l,p){this.switchLevel(p.level)},f.onLevelSwitching=function(l,p){this.switchLevel(p.level)},f.switchLevel=function(l){var p=this.hls.levels[l];if(!!(p!=null&&p.audioGroupIds)){var m=p.audioGroupIds[p.urlId];if(this.groupId!==m){this.groupId=m;var s=this.tracks.filter(function(_){return!m||_.groupId===m});this.selectDefaultTrack&&!s.some(function(_){return _.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=s;var c={audioTracks:s};this.log("Updating audio tracks, "+s.length+' track(s) found in "'+m+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,c),this.selectInitialTrack()}}},f.onError=function(l,p){T.prototype.onError.call(this,l,p),!(p.fatal||!p.context)&&p.context.type===R.PlaylistContextType.AUDIO_TRACK&&p.context.id===this.trackId&&p.context.groupId===this.groupId&&this.retryLoadingOrFail(p)},f.setAudioTrack=function(l){var p=this.tracksInGroup;if(l<0||l>=p.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var m=p[this.trackId];this.log("Now switching to audio-track index "+l);var s=p[l],c=s.id,_=s.groupId,u=_===void 0?"":_,o=s.name,n=s.type,g=s.url;if(this.trackId=l,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:c,groupId:u,name:o,type:n,url:g}),!(s.details&&!s.details.live)){var r=this.switchParams(s.url,m==null?void 0:m.details);this.loadPlaylist(r)}},f.selectInitialTrack=function(){var l=this.tracksInGroup;console.assert(l.length,"Initial audio track should be selected when tracks are known");var p=this.trackName,m=this.findTrackId(p)||this.findTrackId();m!==-1?this.setAudioTrack(m):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},f.findTrackId=function(l){for(var p=this.tracksInGroup,m=0;m<p.length;m++){var s=p[m];if((!this.selectDefaultTrack||s.default)&&(!l||l===s.name))return s.id}return-1},f.loadPlaylist=function(l){T.prototype.loadPlaylist.call(this);var p=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(p)){var m=p.id,s=p.groupId,c=p.url;if(l)try{c=l.addDirectives(c)}catch(_){this.warn("Could not construct new URL with HLS Delivery Directives: "+_)}this.log("loading audio-track playlist for id: "+m),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:c,id:m,groupId:s,deliveryDirectives:l||null})}},b(d,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(l){this.selectDefaultTrack=!1,this.setAudioTrack(l)}}]),d}(k.default);const D=h},"./src/controller/base-playlist-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>K});var M=v("./src/types/level.ts"),S=v("./src/controller/level-helper.ts"),k=v("./src/utils/logger.ts"),R=v("./src/errors.ts"),K=function(){function b(C,L){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=k.logger.log.bind(k.logger,L+":"),this.warn=k.logger.warn.bind(k.logger,L+":"),this.hls=C}var I=b.prototype;return I.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},I.onError=function(L,A){A.fatal&&(A.type===R.ErrorTypes.NETWORK_ERROR||A.type===R.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},I.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},I.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},I.stopLoad=function(){this.canLoad=!1,this.clearTimer()},I.switchParams=function(L,A){var h=A==null?void 0:A.renditionReports;if(h)for(var D=0;D<h.length;D++){var T=h[D],d=void 0;try{d=new self.URL(T.URI,A.url).href}catch(p){k.logger.warn("Could not construct new URL for Rendition Report: "+p),d=T.URI||""}if(d===L.slice(-d.length)){var f=parseInt(T["LAST-MSN"])||(A==null?void 0:A.lastPartSn),i=parseInt(T["LAST-PART"])||(A==null?void 0:A.lastPartIndex);if(this.hls.config.lowLatencyMode){var l=Math.min(A.age-A.partTarget,A.targetduration);i>=0&&l>A.partTarget&&(i+=1)}return new M.HlsUrlParameters(f,i>=0?i:void 0,M.HlsSkip.No)}}},I.loadPlaylist=function(L){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},I.shouldLoadTrack=function(L){return this.canLoad&&L&&!!L.url&&(!L.details||L.details.live)},I.playlistLoaded=function(L,A,h){var D=this,T=A.details,d=A.stats,f=self.performance.now(),i=d.loading.first?Math.max(0,f-d.loading.first):0;if(T.advancedDateTime=Date.now()-i,T.live||h!=null&&h.live){if(T.reloaded(h),h&&this.log("live playlist "+L+" "+(T.advanced?"REFRESHED "+T.lastPartSn+"-"+T.lastPartIndex:"MISSED")),h&&T.fragments.length>0&&(0,S.mergeDetails)(h,T),!this.canLoad||!T.live)return;var l,p=void 0,m=void 0;if(T.canBlockReload&&T.endSN&&T.advanced){var s=this.hls.config.lowLatencyMode,c=T.lastPartSn,_=T.endSN,u=T.lastPartIndex,o=u!==-1,n=c===_,g=s?0:u;o?(p=n?_+1:c,m=n?g:u+1):p=_+1;var r=T.age,E=r+T.ageHeader,P=Math.min(E-T.partTarget,T.targetduration*1.5);if(P>0){if(h&&P>h.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+h.tuneInGoal+" to: "+P+" with playlist age: "+T.age),P=0;else{var y=Math.floor(P/T.targetduration);if(p+=y,m!==void 0){var U=Math.round(P%T.targetduration/T.partTarget);m+=U}this.log("CDN Tune-in age: "+T.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+P+" skip sn "+y+" to part "+m)}T.tuneInGoal=P}if(l=this.getDeliveryDirectives(T,A.deliveryDirectives,p,m),s||!n){this.loadPlaylist(l);return}}else l=this.getDeliveryDirectives(T,A.deliveryDirectives,p,m);var B=this.hls.mainForwardBufferInfo,w=B?B.end-B.len:0,H=(T.edge-w)*1e3,G=(0,S.computeReloadInterval)(T,H);T.updated?f>this.requestScheduled+G&&(this.requestScheduled=d.loading.start):this.requestScheduled=-1,p!==void 0&&T.canBlockReload?this.requestScheduled=d.loading.first+G-(T.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?f:this.requestScheduled)+G;var V=this.requestScheduled-f;V=Math.max(0,V),this.log("reload live playlist "+L+" in "+Math.round(V)+" ms"),this.timer=self.setTimeout(function(){return D.loadPlaylist(l)},V)}else this.clearTimer()},I.getDeliveryDirectives=function(L,A,h,D){var T=(0,M.getSkipValue)(L,h);return A!=null&&A.skip&&L.deltaUpdateFailed&&(h=A.msn,D=A.part,T=M.HlsSkip.No),new M.HlsUrlParameters(h,D,T)},I.retryLoadingOrFail=function(L){var A=this,h=this.hls.config,D=this.retryCount<h.levelLoadingMaxRetry;if(D){var T;if(this.requestScheduled=-1,this.retryCount++,L.details.indexOf("LoadTimeOut")>-1&&(T=L.context)!==null&&T!==void 0&&T.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+L.details+'"'),this.loadPlaylist();else{var d=Math.min(Math.pow(2,this.retryCount)*h.levelLoadingRetryDelay,h.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return A.loadPlaylist()},d),this.warn("retry playlist loading #"+this.retryCount+" in "+d+' ms after "'+L.details+'"')}}else this.warn('cannot recover from error "'+L.details+'"'),this.clearTimer(),L.fatal=!0;return D},b}()},"./src/controller/base-stream-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{State:()=>o,default:()=>n});var M=v("./src/polyfills/number.ts"),S=v("./src/task-loop.ts"),k=v("./src/controller/fragment-tracker.ts"),R=v("./src/utils/buffer-helper.ts"),K=v("./src/utils/logger.ts"),b=v("./src/events.ts"),I=v("./src/errors.ts"),C=v("./src/types/transmuxer.ts"),L=v("./src/utils/mp4-tools.ts"),A=v("./src/utils/discontinuities.ts"),h=v("./src/controller/fragment-finders.ts"),D=v("./src/controller/level-helper.ts"),T=v("./src/loader/fragment-loader.ts"),d=v("./src/crypt/decrypter.ts"),f=v("./src/utils/time-ranges.ts"),i=v("./src/types/loader.ts");function l(g,r){for(var E=0;E<r.length;E++){var P=r[E];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(g,m(P.key),P)}}function p(g,r,E){return r&&l(g.prototype,r),E&&l(g,E),Object.defineProperty(g,"prototype",{writable:!1}),g}function m(g){var r=s(g,"string");return typeof r=="symbol"?r:String(r)}function s(g,r){if(typeof g!="object"||g===null)return g;var E=g[Symbol.toPrimitive];if(E!==void 0){var P=E.call(g,r||"default");if(typeof P!="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(g)}function c(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function _(g,r){g.prototype=Object.create(r.prototype),g.prototype.constructor=g,u(g,r)}function u(g,r){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(P,y){return P.__proto__=y,P},u(g,r)}var o={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},n=function(g){_(r,g);function r(P,y,U,B){var w;return w=g.call(this)||this,w.hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=o.STOPPED,w.media=null,w.mediaBuffer=null,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.keyLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=B,w.log=K.logger.log.bind(K.logger,B+":"),w.warn=K.logger.warn.bind(K.logger,B+":"),w.hls=P,w.fragmentLoader=new T.default(P.config),w.keyLoader=U,w.fragmentTracker=y,w.config=P.config,w.decrypter=new d.default(P.config),P.on(b.Events.LEVEL_SWITCHING,w.onLevelSwitching,c(w)),w}var E=r.prototype;return E.doTick=function(){this.onTickEnd()},E.onTickEnd=function(){},E.startLoad=function(y){},E.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var y=this.fragCurrent;y&&(y.abortRequests(),this.fragmentTracker.removeFragment(y)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=o.STOPPED},E._streamEnded=function(y,U){if(U.live||y.nextStart||!y.end||!this.media)return!1;var B=U.partList;if(B!=null&&B.length){var w=B[B.length-1],H=R.BufferHelper.isBuffered(this.media,w.start+w.duration/2);return H}var G=U.fragments[U.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(G)},E.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var y;return(y=this.levels[this.levelLastLoaded])===null||y===void 0?void 0:y.details}},E.onMediaAttached=function(y,U){var B=this.media=this.mediaBuffer=U.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),B.addEventListener("seeking",this.onvseeking),B.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===o.STOPPED&&this.startLoad(w.startPosition)},E.onMediaDetaching=function(){var y=this.media;y!=null&&y.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),y&&this.onvseeking&&this.onvended&&(y.removeEventListener("seeking",this.onvseeking),y.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},E.onMediaSeeking=function(){var y=this.config,U=this.fragCurrent,B=this.media,w=this.mediaBuffer,H=this.state,G=B?B.currentTime:0,V=R.BufferHelper.bufferInfo(w||B,G,y.maxBufferHole);if(this.log("media seeking to "+((0,M.isFiniteNumber)(G)?G.toFixed(3):G)+", state: "+H),this.state===o.ENDED)this.resetLoadingState();else if(U){var z=y.maxFragLookUpTolerance,$=U.start-z,X=U.start+U.duration+z;if(!V.len||X<V.start||$>V.end){var j=G>X;(G<$||j)&&(j&&U.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),U.abortRequests()),this.resetLoadingState())}}B&&(this.lastCurrentTime=G),!this.loadedmetadata&&!V.len&&(this.nextLoadPosition=this.startPosition=G),this.tickImmediate()},E.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},E.onLevelSwitching=function(y,U){this.fragLoadError=0},E.onHandlerDestroying=function(){this.stopLoad(),g.prototype.onHandlerDestroying.call(this)},E.onHandlerDestroyed=function(){this.state=o.STOPPED,this.hls.off(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,g.prototype.onHandlerDestroyed.call(this)},E.loadFragment=function(y,U,B){this._loadFragForPlayback(y,U,B)},E._loadFragForPlayback=function(y,U,B){var w=this,H=function(V){if(w.fragContextChanged(y)){w.warn("Fragment "+y.sn+(V.part?" p: "+V.part.index:"")+" of level "+y.level+" was dropped during download."),w.fragmentTracker.removeFragment(y);return}y.stats.chunkCount++,w._handleFragmentLoadProgress(V)};this._doFragLoad(y,U,B,H).then(function(G){if(!!G){w.fragLoadError=0;var V=w.state;if(w.fragContextChanged(y)){(V===o.FRAG_LOADING||!w.fragCurrent&&V===o.PARSING)&&(w.fragmentTracker.removeFragment(y),w.state=o.IDLE);return}"payload"in G&&(w.log("Loaded fragment "+y.sn+" of level "+y.level),w.hls.trigger(b.Events.FRAG_LOADED,G)),w._handleFragmentLoadComplete(G)}}).catch(function(G){w.state===o.STOPPED||w.state===o.ERROR||(w.warn(G),w.resetFragmentLoading(y))})},E.flushMainBuffer=function(y,U,B){if(B===void 0&&(B=null),!!(y-U)){var w={startOffset:y,endOffset:U,type:B};this.fragLoadError=0,this.hls.trigger(b.Events.BUFFER_FLUSHING,w)}},E._loadInitSegment=function(y,U){var B=this;this._doFragLoad(y,U).then(function(w){if(!w||B.fragContextChanged(y)||!B.levels)throw new Error("init load aborted");return w}).then(function(w){var H=B.hls,G=w.payload,V=y.decryptdata;if(G&&G.byteLength>0&&V&&V.key&&V.iv&&V.method==="AES-128"){var z=self.performance.now();return B.decrypter.decrypt(new Uint8Array(G),V.key.buffer,V.iv.buffer).then(function($){var X=self.performance.now();return H.trigger(b.Events.FRAG_DECRYPTED,{frag:y,payload:$,stats:{tstart:z,tdecrypt:X}}),w.payload=$,w})}return w}).then(function(w){var H=B.fragCurrent,G=B.hls,V=B.levels;if(!V)throw new Error("init load aborted, missing levels");var z=V[y.level].details;console.assert(z,"Level details are defined when init segment is loaded");var $=y.stats;B.state=o.IDLE,B.fragLoadError=0,y.data=new Uint8Array(w.payload),$.parsing.start=$.buffering.start=self.performance.now(),$.parsing.end=$.buffering.end=self.performance.now(),w.frag===H&&G.trigger(b.Events.FRAG_BUFFERED,{stats:$,frag:H,part:null,id:y.type}),B.tick()}).catch(function(w){B.state===o.STOPPED||B.state===o.ERROR||(B.warn(w),B.resetFragmentLoading(y))})},E.fragContextChanged=function(y){var U=this.fragCurrent;return!y||!U||y.level!==U.level||y.sn!==U.sn||y.urlId!==U.urlId},E.fragBufferedComplete=function(y,U){var B,w,H=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+y.type+" sn: "+y.sn+(U?" part: "+U.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level+" (frag:["+(y.startPTS||NaN).toFixed(3)+"-"+(y.endPTS||NaN).toFixed(3)+"] > buffer:"+(H?f.default.toString(R.BufferHelper.getBuffered(H)):"(detached)")+")"),this.state=o.IDLE,H&&(!this.loadedmetadata&&y.type==i.PlaylistLevelType.MAIN&&H.buffered.length&&((B=this.fragCurrent)===null||B===void 0?void 0:B.sn)===((w=this.fragPrevious)===null||w===void 0?void 0:w.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},E.seekToStartPos=function(){},E._handleFragmentLoadComplete=function(y){var U=this.transmuxer;if(!!U){var B=y.frag,w=y.part,H=y.partsLoaded,G=!H||H.length===0||H.some(function(z){return!z}),V=new C.ChunkMetadata(B.level,B.sn,B.stats.chunkCount+1,0,w?w.index:-1,!G);U.flush(V)}},E._handleFragmentLoadProgress=function(y){},E._doFragLoad=function(y,U,B,w){var H,G=this;if(B===void 0&&(B=null),!this.levels)throw new Error("frag load aborted, missing levels");var V=null;if(y.encrypted&&!((H=y.decryptdata)!==null&&H!==void 0&&H.key)?(this.log("Loading key for "+y.sn+" of ["+U.startSN+"-"+U.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level),this.state=o.KEY_LOADING,this.fragCurrent=y,V=this.keyLoader.load(y).then(function(Y){if(!G.fragContextChanged(Y.frag))return G.hls.trigger(b.Events.KEY_LOADED,Y),G.state===o.KEY_LOADING&&(G.state=o.IDLE),Y}),this.hls.trigger(b.Events.KEY_LOADING,{frag:y}),this.throwIfFragContextChanged("KEY_LOADING")):!y.encrypted&&U.encryptedFragments.length&&this.keyLoader.loadClear(y,U.encryptedFragments),B=Math.max(y.start,B||0),this.config.lowLatencyMode&&U){var z=U.partList;if(z&&w){B>y.end&&U.fragmentHint&&(y=U.fragmentHint);var $=this.getNextPart(z,y,B);if($>-1){var X=z[$];return this.log("Loading part sn: "+y.sn+" p: "+X.index+" cc: "+y.cc+" of playlist ["+U.startSN+"-"+U.endSN+"] parts [0-"+$+"-"+(z.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(B.toFixed(3))),this.nextLoadPosition=X.start+X.duration,this.state=o.FRAG_LOADING,this.hls.trigger(b.Events.FRAG_LOADING,{frag:y,part:z[$],targetBufferTime:B}),this.throwIfFragContextChanged("FRAG_LOADING parts"),V?V.then(function(Y){return!Y||G.fragContextChanged(Y.frag)?null:G.doFragPartsLoad(y,z,$,w)}).catch(function(Y){return G.handleFragLoadError(Y)}):this.doFragPartsLoad(y,z,$,w).catch(function(Y){return G.handleFragLoadError(Y)})}else if(!y.url||this.loadedEndOfParts(z,B))return Promise.resolve(null)}}this.log("Loading fragment "+y.sn+" cc: "+y.cc+" "+(U?"of ["+U.startSN+"-"+U.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(B.toFixed(3))),(0,M.isFiniteNumber)(y.sn)&&!this.bitrateTest&&(this.nextLoadPosition=y.start+y.duration),this.state=o.FRAG_LOADING,this.hls.trigger(b.Events.FRAG_LOADING,{frag:y,targetBufferTime:B}),this.throwIfFragContextChanged("FRAG_LOADING");var j=this.config.progressive;return j&&V?V.then(function(Y){return!Y||G.fragContextChanged(Y==null?void 0:Y.frag)?null:G.fragmentLoader.load(y,w)}).catch(function(Y){return G.handleFragLoadError(Y)}):Promise.all([this.fragmentLoader.load(y,j?w:void 0),V]).then(function(Y){var Q=Y[0];return!j&&Q&&w&&w(Q),Q}).catch(function(Y){return G.handleFragLoadError(Y)})},E.throwIfFragContextChanged=function(y){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+y)},E.doFragPartsLoad=function(y,U,B,w){var H=this;return new Promise(function(G,V){var z=[],$=function X(j){var Y=U[j];H.fragmentLoader.loadPart(y,Y,w).then(function(Q){z[Y.index]=Q;var J=Q.part;H.hls.trigger(b.Events.FRAG_LOADED,Q);var Z=U[j+1];if(Z&&Z.fragment===y)X(j+1);else return G({frag:y,part:J,partsLoaded:z})}).catch(V)};$(B)})},E.handleFragLoadError=function(y){if("data"in y){var U=y.data;y.data&&U.details===I.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(U.frag,U.part):this.hls.trigger(b.Events.ERROR,U)}else this.hls.trigger(b.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,err:y,fatal:!0});return null},E._handleTransmuxerFlush=function(y){var U=this.getCurrentContext(y);if(!U||this.state!==o.PARSING){!this.fragCurrent&&this.state!==o.STOPPED&&this.state!==o.ERROR&&(this.state=o.IDLE);return}var B=U.frag,w=U.part,H=U.level,G=self.performance.now();B.stats.parsing.end=G,w&&(w.stats.parsing.end=G),this.updateLevelTiming(B,w,H,y.partial)},E.getCurrentContext=function(y){var U=this.levels,B=y.level,w=y.sn,H=y.part;if(!U||!U[B])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+B+". The current chunk will not be buffered."),null;var G=U[B],V=H>-1?(0,D.getPartWith)(G,w,H):null,z=V?V.fragment:(0,D.getFragmentWithSN)(G,w,this.fragCurrent);return z?{frag:z,part:V,level:G}:null},E.bufferFragmentData=function(y,U,B,w){if(!(!y||this.state!==o.PARSING)){var H=y.data1,G=y.data2,V=H;if(H&&G&&(V=(0,L.appendUint8Array)(H,G)),!(!V||!V.length)){var z={type:y.type,frag:U,part:B,chunkMeta:w,parent:U.type,data:V};this.hls.trigger(b.Events.BUFFER_APPENDING,z),y.dropped&&y.independent&&!B&&this.flushBufferGap(U)}}},E.flushBufferGap=function(y){var U=this.media;if(!!U){if(!R.BufferHelper.isBuffered(U,U.currentTime)){this.flushMainBuffer(0,y.start);return}var B=U.currentTime,w=R.BufferHelper.bufferInfo(U,B,0),H=y.duration,G=Math.min(this.config.maxFragLookUpTolerance*2,H*.25),V=Math.max(Math.min(y.start-G,w.end-G),B+G);y.start-V>G&&this.flushMainBuffer(V,y.start)}},E.getFwdBufferInfo=function(y,U){var B=this.config,w=this.getLoadPosition();if(!(0,M.isFiniteNumber)(w))return null;var H=R.BufferHelper.bufferInfo(y,w,B.maxBufferHole);if(H.len===0&&H.nextStart!==void 0){var G=this.fragmentTracker.getBufferedFrag(w,U);if(G&&H.nextStart<G.end)return R.BufferHelper.bufferInfo(y,w,Math.max(H.nextStart,B.maxBufferHole))}return H},E.getMaxBufferLength=function(y){var U=this.config,B;return y?B=Math.max(8*U.maxBufferSize/y,U.maxBufferLength):B=U.maxBufferLength,Math.min(B,U.maxMaxBufferLength)},E.reduceMaxBufferLength=function(y){var U=this.config,B=y||U.maxBufferLength;return U.maxMaxBufferLength>=B?(U.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+U.maxMaxBufferLength+"s"),!0):!1},E.getNextFragment=function(y,U){var B=U.fragments,w=B.length;if(!w)return null;var H=this.config,G=B[0].start,V;if(U.live){var z=H.initialLiveManifestSize;if(w<z)return this.warn("Not enough fragments to start playback (have: "+w+", need: "+z+")"),null;!U.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(V=this.getInitialLiveFragment(U,B),this.startPosition=V?this.hls.liveSyncPosition||V.start:y)}else y<=G&&(V=B[0]);if(!V){var $=H.lowLatencyMode?U.partEnd:U.fragmentEnd;V=this.getFragmentAtPosition(y,$,U)}return this.mapToInitFragWhenRequired(V)},E.mapToInitFragWhenRequired=function(y){return y!=null&&y.initSegment&&!(y!=null&&y.initSegment.data)&&!this.bitrateTest?y.initSegment:y},E.getNextPart=function(y,U,B){for(var w=-1,H=!1,G=!0,V=0,z=y.length;V<z;V++){var $=y[V];if(G=G&&!$.independent,w>-1&&B<$.start)break;var X=$.loaded;X?w=-1:(H||$.independent||G)&&$.fragment===U&&(w=V),H=X}return w},E.loadedEndOfParts=function(y,U){var B=y[y.length-1];return B&&U>B.start&&B.loaded},E.getInitialLiveFragment=function(y,U){var B=this.fragPrevious,w=null;if(B){if(y.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+B.programDateTime),w=(0,h.findFragmentByPDT)(U,B.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var H=B.sn+1;if(H>=y.startSN&&H<=y.endSN){var G=U[H-y.startSN];B.cc===G.cc&&(w=G,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=(0,h.findFragWithCC)(U,B.cc),w&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn))}}else{var V=this.hls.liveSyncPosition;V!==null&&(w=this.getFragmentAtPosition(V,this.bitrateTest?y.fragmentEnd:y.edge,y))}return w},E.getFragmentAtPosition=function(y,U,B){var w=this.config,H=this.fragPrevious,G=B.fragments,V=B.endSN,z=B.fragmentHint,$=w.maxFragLookUpTolerance,X=!!(w.lowLatencyMode&&B.partList&&z);X&&z&&!this.bitrateTest&&(G=G.concat(z),V=z.sn);var j;if(y<U){var Y=y>U-$?0:$;j=(0,h.findFragmentByPTS)(H,G,y,Y)}else j=G[G.length-1];if(j){var Q=j.sn-B.startSN;if(this.fragmentTracker.getState(j)===k.FragmentState.OK&&(H=j),H&&j.sn===H.sn&&!X){var J=H&&j.level===H.level;if(J){var Z=G[Q+1];j.sn<V&&this.fragmentTracker.getState(Z)!==k.FragmentState.OK?(this.log("SN "+j.sn+" just loaded, load next one: "+Z.sn),j=Z):j=null}}}return j},E.synchronizeToLiveEdge=function(y){var U=this.config,B=this.media;if(!!B){var w=this.hls.liveSyncPosition,H=B.currentTime,G=y.fragments[0].start,V=y.edge,z=H>=G-U.maxFragLookUpTolerance&&H<=V;if(w!==null&&B.duration>w&&(H<w||!z)){var $=U.liveMaxLatencyDuration!==void 0?U.liveMaxLatencyDuration:U.liveMaxLatencyDurationCount*y.targetduration;(!z&&B.readyState<4||H<V-$)&&(this.loadedmetadata||(this.nextLoadPosition=w),B.readyState&&(this.warn("Playback: "+H.toFixed(3)+" is located too far from the end of live sliding playlist: "+V+", reset currentTime to : "+w.toFixed(3)),B.currentTime=w))}}},E.alignPlaylists=function(y,U){var B=this.levels,w=this.levelLastLoaded,H=this.fragPrevious,G=w!==null?B[w]:null,V=y.fragments.length;if(!V)return this.warn("No fragments in live playlist"),0;var z=y.fragments[0].start,$=!U,X=y.alignedSliding&&(0,M.isFiniteNumber)(z);if($||!X&&!z){(0,A.alignStream)(H,G,y);var j=y.fragments[0].start;return this.log("Live playlist sliding: "+j.toFixed(2)+" start-sn: "+(U?U.startSN:"na")+"->"+y.startSN+" prev-sn: "+(H?H.sn:"na")+" fragments: "+V),j}return z},E.waitForCdnTuneIn=function(y){var U=3;return y.live&&y.canBlockReload&&y.partTarget&&y.tuneInGoal>Math.max(y.partHoldBack,y.partTarget*U)},E.setStartPosition=function(y,U){var B=this.startPosition;if(B<U&&(B=-1),B===-1||this.lastCurrentTime===-1){var w=y.startTimeOffset;(0,M.isFiniteNumber)(w)?(B=U+w,w<0&&(B+=y.totalduration),B=Math.min(Math.max(U,B),U+y.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+B),this.startPosition=B):y.live?B=this.hls.liveSyncPosition||U:this.startPosition=B=0,this.lastCurrentTime=B}this.nextLoadPosition=B},E.getLoadPosition=function(){var y=this.media,U=0;return this.loadedmetadata&&y?U=y.currentTime:this.nextLoadPosition&&(U=this.nextLoadPosition),U},E.handleFragLoadAborted=function(y,U){this.transmuxer&&y.sn!=="initSegment"&&y.stats.aborted&&(this.warn("Fragment "+y.sn+(U?" part"+U.index:"")+" of level "+y.level+" was aborted"),this.resetFragmentLoading(y))},E.resetFragmentLoading=function(y){(!this.fragCurrent||!this.fragContextChanged(y)&&this.state!==o.FRAG_LOADING_WAITING_RETRY)&&(this.state=o.IDLE)},E.onFragmentOrKeyLoadError=function(y,U){if(U.fatal){this.stopLoad(),this.state=o.ERROR;return}var B=this.config;if(U.chunkMeta){var w=this.getCurrentContext(U.chunkMeta);w&&(U.frag=w.frag,U.levelRetry=!0,this.fragLoadError=B.fragLoadingMaxRetry)}var H=U.frag;if(!(!H||H.type!==y)){var G=this.fragCurrent;if(console.assert(G&&H.sn===G.sn&&H.level===G.level&&H.urlId===G.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=B.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var V=Math.min(Math.pow(2,this.fragLoadError)*B.fragLoadingRetryDelay,B.fragLoadingMaxRetryTimeout);this.warn("Fragment "+H.sn+" of "+y+" "+H.level+" failed to load, retrying in "+V+"ms"),this.retryDate=self.performance.now()+V,this.fragLoadError++,this.state=o.FRAG_LOADING_WAITING_RETRY}else U.levelRetry?(y===i.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=o.IDLE):(K.logger.error(U.details+" reaches max retry, redispatch as fatal ..."),U.fatal=!0,this.hls.stopLoad(),this.state=o.ERROR)}},E.afterBufferFlushed=function(y,U,B){if(!!y){var w=R.BufferHelper.getBuffered(y);this.fragmentTracker.detectEvictedFragments(U,w,B),this.state===o.ENDED&&this.resetLoadingState()}},E.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=o.IDLE},E.resetStartWhenNotLoaded=function(y){if(!this.loadedmetadata){this.startFragRequested=!1;var U=this.levels?this.levels[y].details:null;U!=null&&U.live?(this.startPosition=-1,this.setStartPosition(U,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},E.updateLevelTiming=function(y,U,B,w){var H=this,G=B.details;console.assert(!!G,"level.details must be defined");var V=Object.keys(y.elementaryStreams).reduce(function(z,$){var X=y.elementaryStreams[$];if(X){var j=X.endPTS-X.startPTS;if(j<=0)return H.warn("Could not parse fragment "+y.sn+" "+$+" duration reliably ("+j+")"),z||!1;var Y=w?0:(0,D.updateFragPTSDTS)(G,y,X.startPTS,X.endPTS,X.startDTS,X.endDTS);return H.hls.trigger(b.Events.LEVEL_PTS_UPDATED,{details:G,level:B,drift:Y,type:$,frag:y,start:X.startPTS,end:X.endPTS}),!0}return z},!1);V||(this.warn("Found no media in fragment "+y.sn+" of level "+B.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=o.PARSED,this.hls.trigger(b.Events.FRAG_PARSED,{frag:y,part:U})},E.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},p(r,[{key:"state",get:function(){return this._state},set:function(y){var U=this._state;U!==y&&(this._state=y,this.log(U+"->"+y))}}]),r}(S.default)},"./src/controller/buffer-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>h});var M=v("./src/polyfills/number.ts"),S=v("./src/events.ts"),k=v("./src/utils/logger.ts"),R=v("./src/errors.ts"),K=v("./src/utils/buffer-helper.ts"),b=v("./src/utils/mediasource-helper.ts"),I=v("./src/loader/fragment.ts"),C=v("./src/controller/buffer-operation-queue.ts"),L=(0,b.getMediaSource)(),A=/([ha]vc.)(?:\.[^.,]+)+/,h=function(){function D(d){var f=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=f.media,l=f.mediaSource;k.logger.log("[buffer-controller]: Media source opened"),i&&(i.removeEventListener("emptied",f._onMediaEmptied),f.updateMediaElementDuration(),f.hls.trigger(S.Events.MEDIA_ATTACHED,{media:i})),l&&l.removeEventListener("sourceopen",f._onMediaSourceOpen),f.checkPendingTracks()},this._onMediaSourceClose=function(){k.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){k.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var i=f.media,l=f._objectUrl;i&&i.src!==l&&k.logger.error("Media element src was set while attaching MediaSource ("+l+" > "+i.src+")")},this.hls=d,this._initSourceBuffer(),this.registerListeners()}var T=D.prototype;return T.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},T.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},T.registerListeners=function(){var f=this.hls;f.on(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(S.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.on(S.Events.BUFFER_RESET,this.onBufferReset,this),f.on(S.Events.BUFFER_APPENDING,this.onBufferAppending,this),f.on(S.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.on(S.Events.BUFFER_EOS,this.onBufferEos,this),f.on(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.on(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),f.on(S.Events.FRAG_PARSED,this.onFragParsed,this),f.on(S.Events.FRAG_CHANGED,this.onFragChanged,this)},T.unregisterListeners=function(){var f=this.hls;f.off(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),f.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(S.Events.MANIFEST_PARSED,this.onManifestParsed,this),f.off(S.Events.BUFFER_RESET,this.onBufferReset,this),f.off(S.Events.BUFFER_APPENDING,this.onBufferAppending,this),f.off(S.Events.BUFFER_CODECS,this.onBufferCodecs,this),f.off(S.Events.BUFFER_EOS,this.onBufferEos,this),f.off(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),f.off(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),f.off(S.Events.FRAG_PARSED,this.onFragParsed,this),f.off(S.Events.FRAG_CHANGED,this.onFragChanged,this)},T._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new C.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},T.onManifestParsed=function(f,i){var l=2;(i.audio&&!i.video||!i.altAudio)&&(l=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=l,this.details=null,k.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},T.onMediaAttaching=function(f,i){var l=this.media=i.media;if(l&&L){var p=this.mediaSource=new L;p.addEventListener("sourceopen",this._onMediaSourceOpen),p.addEventListener("sourceended",this._onMediaSourceEnded),p.addEventListener("sourceclose",this._onMediaSourceClose),l.src=self.URL.createObjectURL(p),this._objectUrl=l.src,l.addEventListener("emptied",this._onMediaEmptied)}},T.onMediaDetaching=function(){var f=this.media,i=this.mediaSource,l=this._objectUrl;if(i){if(k.logger.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(p){k.logger.warn("[buffer-controller]: onMediaDetaching: "+p.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),f&&(f.removeEventListener("emptied",this._onMediaEmptied),l&&self.URL.revokeObjectURL(l),f.src===l?(f.removeAttribute("src"),f.load()):k.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(S.Events.MEDIA_DETACHED,void 0)},T.onBufferReset=function(){var f=this;this.getSourceBufferTypes().forEach(function(i){var l=f.sourceBuffer[i];try{l&&(f.removeBufferListeners(i),f.mediaSource&&f.mediaSource.removeSourceBuffer(l),f.sourceBuffer[i]=void 0)}catch(p){k.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",p)}}),this._initSourceBuffer()},T.onBufferCodecs=function(f,i){var l=this,p=this.getSourceBufferTypes().length;Object.keys(i).forEach(function(m){if(p){var s=l.tracks[m];if(s&&typeof s.buffer.changeType=="function"){var c=i[m],_=c.id,u=c.codec,o=c.levelCodec,n=c.container,g=c.metadata,r=(s.levelCodec||s.codec).replace(A,"$1"),E=(o||u).replace(A,"$1");if(r!==E){var P=n+";codecs="+(o||u);l.appendChangeType(m,P),k.logger.log("[buffer-controller]: switching codec "+r+" to "+E),l.tracks[m]={buffer:s.buffer,codec:u,container:n,levelCodec:o,metadata:g,id:_}}}}else l.pendingTracks[m]=i[m]}),!p&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},T.appendChangeType=function(f,i){var l=this,p=this.operationQueue,m={execute:function(){var c=l.sourceBuffer[f];c&&(k.logger.log("[buffer-controller]: changing "+f+" sourceBuffer type to "+i),c.changeType(i)),p.shiftAndExecuteNext(f)},onStart:function(){},onComplete:function(){},onError:function(c){k.logger.warn("[buffer-controller]: Failed to change "+f+" SourceBuffer type",c)}};p.append(m,f)},T.onBufferAppending=function(f,i){var l=this,p=this.hls,m=this.operationQueue,s=this.tracks,c=i.data,_=i.type,u=i.frag,o=i.part,n=i.chunkMeta,g=n.buffering[_],r=self.performance.now();g.start=r;var E=u.stats.buffering,P=o?o.stats.buffering:null;E.start===0&&(E.start=r),P&&P.start===0&&(P.start=r);var y=s.audio,U=!1;_==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(U=!this.lastMpegAudioChunk||n.id===1||this.lastMpegAudioChunk.sn!==n.sn,this.lastMpegAudioChunk=n);var B=u.start,w={execute:function(){if(g.executeStart=self.performance.now(),U){var G=l.sourceBuffer[_];if(G){var V=B-G.timestampOffset;Math.abs(V)>=.1&&(k.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+B+" (delta: "+V+") sn: "+u.sn+")"),G.timestampOffset=B)}}l.appendExecutor(c,_)},onStart:function(){},onComplete:function(){var G=self.performance.now();g.executeEnd=g.end=G,E.first===0&&(E.first=G),P&&P.first===0&&(P.first=G);var V=l.sourceBuffer,z={};for(var $ in V)z[$]=K.BufferHelper.getBuffered(V[$]);l.appendError=0,l.hls.trigger(S.Events.BUFFER_APPENDED,{type:_,frag:u,part:o,chunkMeta:n,parent:u.type,timeRanges:z})},onError:function(G){k.logger.error("[buffer-controller]: Error encountered while trying to append to the "+_+" SourceBuffer",G);var V={type:R.ErrorTypes.MEDIA_ERROR,parent:u.type,details:R.ErrorDetails.BUFFER_APPEND_ERROR,err:G,fatal:!1};G.code===DOMException.QUOTA_EXCEEDED_ERR?V.details=R.ErrorDetails.BUFFER_FULL_ERROR:(l.appendError++,V.details=R.ErrorDetails.BUFFER_APPEND_ERROR,l.appendError>p.config.appendErrorMaxRetry&&(k.logger.error("[buffer-controller]: Failed "+p.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),V.fatal=!0,p.stopLoad())),p.trigger(S.Events.ERROR,V)}};m.append(w,_)},T.onBufferFlushing=function(f,i){var l=this,p=this.operationQueue,m=function(c){return{execute:l.removeExecutor.bind(l,c,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){l.hls.trigger(S.Events.BUFFER_FLUSHED,{type:c})},onError:function(u){k.logger.warn("[buffer-controller]: Failed to remove from "+c+" SourceBuffer",u)}}};i.type?p.append(m(i.type),i.type):this.getSourceBufferTypes().forEach(function(s){p.append(m(s),s)})},T.onFragParsed=function(f,i){var l=this,p=i.frag,m=i.part,s=[],c=m?m.elementaryStreams:p.elementaryStreams;c[I.ElementaryStreamTypes.AUDIOVIDEO]?s.push("audiovideo"):(c[I.ElementaryStreamTypes.AUDIO]&&s.push("audio"),c[I.ElementaryStreamTypes.VIDEO]&&s.push("video"));var _=function(){var o=self.performance.now();p.stats.buffering.end=o,m&&(m.stats.buffering.end=o);var n=m?m.stats:p.stats;l.hls.trigger(S.Events.FRAG_BUFFERED,{frag:p,part:m,stats:n,id:p.type})};s.length===0&&k.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+p.type+" level: "+p.level+" sn: "+p.sn),this.blockBuffers(_,s)},T.onFragChanged=function(f,i){this.flushBackBuffer()},T.onBufferEos=function(f,i){var l=this,p=this.getSourceBufferTypes().reduce(function(m,s){var c=l.sourceBuffer[s];return c&&(!i.type||i.type===s)&&(c.ending=!0,c.ended||(c.ended=!0,k.logger.log("[buffer-controller]: "+s+" sourceBuffer now EOS"))),m&&!!(!c||c.ended)},!0);p&&(k.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){l.getSourceBufferTypes().forEach(function(s){var c=l.sourceBuffer[s];c&&(c.ending=!1)});var m=l.mediaSource;if(!m||m.readyState!=="open"){m&&k.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+m.readyState);return}k.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),m.endOfStream()}))},T.onLevelUpdated=function(f,i){var l=i.details;!l.fragments.length||(this.details=l,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},T.flushBackBuffer=function(){var f=this.hls,i=this.details,l=this.media,p=this.sourceBuffer;if(!(!l||i===null)){var m=this.getSourceBufferTypes();if(!!m.length){var s=i.live&&f.config.liveBackBufferLength!==null?f.config.liveBackBufferLength:f.config.backBufferLength;if(!(!(0,M.isFiniteNumber)(s)||s<0)){var c=l.currentTime,_=i.levelTargetDuration,u=Math.max(s,_),o=Math.floor(c/_)*_-u;m.forEach(function(n){var g=p[n];if(g){var r=K.BufferHelper.getBuffered(g);if(r.length>0&&o>r.start(0)){if(f.trigger(S.Events.BACK_BUFFER_REACHED,{bufferEnd:o}),i.live)f.trigger(S.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:o});else if(g.ended&&r.end(r.length-1)-c<_*2){k.logger.info("[buffer-controller]: Cannot flush "+n+" back buffer while SourceBuffer is in ended state");return}f.trigger(S.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:o,type:n})}}})}}}},T.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var f=this.details,i=this.hls,l=this.media,p=this.mediaSource,m=f.fragments[0].start+f.totalduration,s=l.duration,c=(0,M.isFiniteNumber)(p.duration)?p.duration:0;f.live&&i.config.liveDurationInfinity?(k.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),p.duration=1/0,this.updateSeekableRange(f)):(m>c&&m>s||!(0,M.isFiniteNumber)(s))&&(k.logger.log("[buffer-controller]: Updating Media Source duration to "+m.toFixed(3)),p.duration=m)}},T.updateSeekableRange=function(f){var i=this.mediaSource,l=f.fragments,p=l.length;if(p&&f.live&&i!==null&&i!==void 0&&i.setLiveSeekableRange){var m=Math.max(0,l[0].start),s=Math.max(m,m+f.totalduration);i.setLiveSeekableRange(m,s)}},T.checkPendingTracks=function(){var f=this.bufferCodecEventsExpected,i=this.operationQueue,l=this.pendingTracks,p=Object.keys(l).length;if(p&&!f||p===2){this.createSourceBuffers(l),this.pendingTracks={};var m=this.getSourceBufferTypes();if(m.length===0){this.hls.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}m.forEach(function(s){i.executeNext(s)})}},T.createSourceBuffers=function(f){var i=this.sourceBuffer,l=this.mediaSource;if(!l)throw Error("createSourceBuffers called when mediaSource was null");var p=0;for(var m in f)if(!i[m]){var s=f[m];if(!s)throw Error("source buffer exists for track "+m+", however track does not");var c=s.levelCodec||s.codec,_=s.container+";codecs="+c;k.logger.log("[buffer-controller]: creating sourceBuffer("+_+")");try{var u=i[m]=l.addSourceBuffer(_),o=m;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[m]={buffer:u,codec:c,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id},p++}catch(n){k.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+n.message),this.hls.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:n,mimeType:_})}}p&&this.hls.trigger(S.Events.BUFFER_CREATED,{tracks:this.tracks})},T._onSBUpdateStart=function(f){var i=this.operationQueue,l=i.current(f);l.onStart()},T._onSBUpdateEnd=function(f){var i=this.operationQueue,l=i.current(f);l.onComplete(),i.shiftAndExecuteNext(f)},T._onSBUpdateError=function(f,i){k.logger.error("[buffer-controller]: "+f+" SourceBuffer error",i),this.hls.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var l=this.operationQueue.current(f);l&&l.onError(i)},T.removeExecutor=function(f,i,l){var p=this.media,m=this.mediaSource,s=this.operationQueue,c=this.sourceBuffer,_=c[f];if(!p||!m||!_){k.logger.warn("[buffer-controller]: Attempting to remove from the "+f+" SourceBuffer, but it does not exist"),s.shiftAndExecuteNext(f);return}var u=(0,M.isFiniteNumber)(p.duration)?p.duration:1/0,o=(0,M.isFiniteNumber)(m.duration)?m.duration:1/0,n=Math.max(0,i),g=Math.min(l,u,o);g>n&&!_.ending?(_.ended=!1,k.logger.log("[buffer-controller]: Removing ["+n+","+g+"] from the "+f+" SourceBuffer"),console.assert(!_.updating,f+" sourceBuffer must not be updating"),_.remove(n,g)):s.shiftAndExecuteNext(f)},T.appendExecutor=function(f,i){var l=this.operationQueue,p=this.sourceBuffer,m=p[i];if(!m){k.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),l.shiftAndExecuteNext(i);return}m.ended=!1,console.assert(!m.updating,i+" sourceBuffer must not be updating"),m.appendBuffer(f)},T.blockBuffers=function(f,i){var l=this;if(i===void 0&&(i=this.getSourceBufferTypes()),!i.length){k.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(f);return}var p=this.operationQueue,m=i.map(function(s){return p.appendBlocker(s)});Promise.all(m).then(function(){f(),i.forEach(function(s){var c=l.sourceBuffer[s];(!c||!c.updating)&&p.shiftAndExecuteNext(s)})})},T.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},T.addBufferListener=function(f,i,l){var p=this.sourceBuffer[f];if(!!p){var m=l.bind(this,f);this.listeners[f].push({event:i,listener:m}),p.addEventListener(i,m)}},T.removeBufferListeners=function(f){var i=this.sourceBuffer[f];!i||this.listeners[f].forEach(function(l){i.removeEventListener(l.event,l.listener)})},D}()},"./src/controller/buffer-operation-queue.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>S});var M=v("./src/utils/logger.ts"),S=function(){function k(K){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=K}var R=k.prototype;return R.append=function(b,I){var C=this.queues[I];C.push(b),C.length===1&&this.buffers[I]&&this.executeNext(I)},R.insertAbort=function(b,I){var C=this.queues[I];C.unshift(b),this.executeNext(I)},R.appendBlocker=function(b){var I,C=new Promise(function(A){I=A}),L={execute:I,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(L,b),C},R.executeNext=function(b){var I=this.buffers,C=this.queues,L=I[b],A=C[b];if(A.length){var h=A[0];try{h.execute()}catch(D){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),h.onError(D),(!L||!L.updating)&&(A.shift(),this.executeNext(b))}}},R.shiftAndExecuteNext=function(b){this.queues[b].shift(),this.executeNext(b)},R.current=function(b){return this.queues[b][0]},k}()},"./src/controller/cap-level-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>I});var M=v("./src/events.ts");function S(C,L){for(var A=0;A<L.length;A++){var h=L[A];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(C,R(h.key),h)}}function k(C,L,A){return L&&S(C.prototype,L),A&&S(C,A),Object.defineProperty(C,"prototype",{writable:!1}),C}function R(C){var L=K(C,"string");return typeof L=="symbol"?L:String(L)}function K(C,L){if(typeof C!="object"||C===null)return C;var A=C[Symbol.toPrimitive];if(A!==void 0){var h=A.call(C,L||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(L==="string"?String:Number)(C)}var b=function(){function C(A){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=A,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var L=C.prototype;return L.setStreamController=function(h){this.streamController=h},L.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},L.registerListeners=function(){var h=this.hls;h.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),h.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),h.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},L.unregisterListener=function(){var h=this.hls;h.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),h.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),h.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),h.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),h.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},L.onFpsDropLevelCapping=function(h,D){C.isLevelAllowed(D.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(D.droppedLevel)},L.onMediaAttaching=function(h,D){this.media=D.media instanceof HTMLVideoElement?D.media:null,this.clientRect=null},L.onManifestParsed=function(h,D){var T=this.hls;this.restrictedLevels=[],this.firstLevel=D.firstLevel,T.config.capLevelToPlayerSize&&D.video&&this.startCapping()},L.onBufferCodecs=function(h,D){var T=this.hls;T.config.capLevelToPlayerSize&&D.video&&this.startCapping()},L.onMediaDetaching=function(){this.stopCapping()},L.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var h=this.hls.levels;if(h.length){var D=this.hls;D.autoLevelCapping=this.getMaxLevel(h.length-1),D.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=D.autoLevelCapping}}},L.getMaxLevel=function(h){var D=this,T=this.hls.levels;if(!T.length)return-1;var d=T.filter(function(f,i){return C.isLevelAllowed(i,D.restrictedLevels)&&i<=h});return this.clientRect=null,C.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},L.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},L.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},L.getDimensions=function(){if(this.clientRect)return this.clientRect;var h=this.media,D={width:0,height:0};if(h){var T=h.getBoundingClientRect();D.width=T.width,D.height=T.height,!D.width&&!D.height&&(D.width=T.right-T.left||h.width||0,D.height=T.bottom-T.top||h.height||0)}return this.clientRect=D,D},C.isLevelAllowed=function(h,D){return D===void 0&&(D=[]),D.indexOf(h)===-1},C.getMaxLevelByMediaSize=function(h,D,T){if(!h||!h.length)return-1;for(var d=function(m,s){return s?m.width!==s.width||m.height!==s.height:!0},f=h.length-1,i=0;i<h.length;i+=1){var l=h[i];if((l.width>=D||l.height>=T)&&d(l,h[i+1])){f=i;break}}return f},k(C,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var h=1;if(!this.hls.config.ignoreDevicePixelRatio)try{h=self.devicePixelRatio}catch{}return h}}]),C}();const I=b},"./src/controller/cmcd-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>T});var M=v("./src/events.ts"),S=v("./src/types/cmcd.ts"),k=v("./src/utils/buffer-helper.ts"),R=v("./src/utils/logger.ts");function K(d,f){for(var i=0;i<f.length;i++){var l=f[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,I(l.key),l)}}function b(d,f,i){return f&&K(d.prototype,f),i&&K(d,i),Object.defineProperty(d,"prototype",{writable:!1}),d}function I(d){var f=C(d,"string");return typeof f=="symbol"?f:String(f)}function C(d,f){if(typeof d!="object"||d===null)return d;var i=d[Symbol.toPrimitive];if(i!==void 0){var l=i.call(d,f||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(d)}function L(d,f){var i=typeof Symbol!="undefined"&&d[Symbol.iterator]||d["@@iterator"];if(i)return(i=i.call(d)).next.bind(i);if(Array.isArray(d)||(i=A(d))||f&&d&&typeof d.length=="number"){i&&(d=i);var l=0;return function(){return l>=d.length?{done:!0}:{done:!1,value:d[l++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A(d,f){if(!!d){if(typeof d=="string")return h(d,f);var i=Object.prototype.toString.call(d).slice(8,-1);if(i==="Object"&&d.constructor&&(i=d.constructor.name),i==="Map"||i==="Set")return Array.from(d);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(d,f)}}function h(d,f){(f==null||f>d.length)&&(f=d.length);for(var i=0,l=new Array(f);i<f;i++)l[i]=d[i];return l}function D(){return D=Object.assign?Object.assign.bind():function(d){for(var f=1;f<arguments.length;f++){var i=arguments[f];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(d[l]=i[l])}return d},D.apply(this,arguments)}var T=function(){function d(i){var l=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){l.initialized&&(l.starved=!0),l.buffering=!0},this.onPlaying=function(){l.initialized||(l.initialized=!0),l.buffering=!1},this.applyPlaylistData=function(s){try{l.apply(s,{ot:S.CMCDObjectType.MANIFEST,su:!l.initialized})}catch(c){R.logger.warn("Could not generate manifest CMCD data.",c)}},this.applyFragmentData=function(s){try{var c=s.frag,_=l.hls.levels[c.level],u=l.getObjectType(c),o={d:c.duration*1e3,ot:u};(u===S.CMCDObjectType.VIDEO||u===S.CMCDObjectType.AUDIO||u==S.CMCDObjectType.MUXED)&&(o.br=_.bitrate/1e3,o.tb=l.getTopBandwidth(u)/1e3,o.bl=l.getBufferLength(u)),l.apply(s,o)}catch(n){R.logger.warn("Could not generate segment CMCD data.",n)}},this.hls=i;var p=this.config=i.config,m=p.cmcd;m!=null&&(p.pLoader=this.createPlaylistLoader(),p.fLoader=this.createFragmentLoader(),this.sid=m.sessionId||d.uuid(),this.cid=m.contentId,this.useHeaders=m.useHeaders===!0,this.registerListeners())}var f=d.prototype;return f.registerListeners=function(){var l=this.hls;l.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),l.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},f.unregisterListeners=function(){var l=this.hls;l.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),l.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},f.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},f.onMediaAttached=function(l,p){this.media=p.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},f.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},f.onBufferCreated=function(l,p){var m,s;this.audioBuffer=(m=p.tracks.audio)===null||m===void 0?void 0:m.buffer,this.videoBuffer=(s=p.tracks.video)===null||s===void 0?void 0:s.buffer},f.createData=function(){var l;return{v:S.CMCDVersion,sf:S.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(l=this.media)===null||l===void 0?void 0:l.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},f.apply=function(l,p){p===void 0&&(p={}),D(p,this.createData());var m=p.ot===S.CMCDObjectType.INIT||p.ot===S.CMCDObjectType.VIDEO||p.ot===S.CMCDObjectType.MUXED;if(this.starved&&m&&(p.bs=!0,p.su=!0,this.starved=!1),p.su==null&&(p.su=this.buffering),this.useHeaders){var s=d.toHeaders(p);if(!Object.keys(s).length)return;l.headers||(l.headers={}),D(l.headers,s)}else{var c=d.toQuery(p);if(!c)return;l.url=d.appendQueryToUri(l.url,c)}},f.getObjectType=function(l){var p=l.type;if(p==="subtitle")return S.CMCDObjectType.TIMED_TEXT;if(l.sn==="initSegment")return S.CMCDObjectType.INIT;if(p==="audio")return S.CMCDObjectType.AUDIO;if(p==="main")return this.hls.audioTracks.length?S.CMCDObjectType.VIDEO:S.CMCDObjectType.MUXED},f.getTopBandwidth=function(l){var p=0,m,s=this.hls;if(l===S.CMCDObjectType.AUDIO)m=s.audioTracks;else{var c=s.maxAutoLevel,_=c>-1?c+1:s.levels.length;m=s.levels.slice(0,_)}for(var u=L(m),o;!(o=u()).done;){var n=o.value;n.bitrate>p&&(p=n.bitrate)}return p>0?p:NaN},f.getBufferLength=function(l){var p=this.hls.media,m=l===S.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!m||!p)return NaN;var s=k.BufferHelper.bufferInfo(m,p.currentTime,this.config.maxBufferHole);return s.len*1e3},f.createPlaylistLoader=function(){var l=this.config.pLoader,p=this.applyPlaylistData,m=l||this.config.loader;return function(){function s(_){this.loader=void 0,this.loader=new m(_)}var c=s.prototype;return c.destroy=function(){this.loader.destroy()},c.abort=function(){this.loader.abort()},c.load=function(u,o,n){p(u),this.loader.load(u,o,n)},b(s,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),s}()},f.createFragmentLoader=function(){var l=this.config.fLoader,p=this.applyFragmentData,m=l||this.config.loader;return function(){function s(_){this.loader=void 0,this.loader=new m(_)}var c=s.prototype;return c.destroy=function(){this.loader.destroy()},c.abort=function(){this.loader.abort()},c.load=function(u,o,n){p(u),this.loader.load(u,o,n)},b(s,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),s}()},d.uuid=function(){var l=URL.createObjectURL(new Blob),p=l.toString();return URL.revokeObjectURL(l),p.slice(p.lastIndexOf("/")+1)},d.serialize=function(l){for(var p=[],m=function(w){return!Number.isNaN(w)&&w!=null&&w!==""&&w!==!1},s=function(w){return Math.round(w)},c=function(w){return s(w/100)*100},_=function(w){return encodeURIComponent(w)},u={br:s,d:s,bl:c,dl:c,mtp:c,nor:_,rtp:c,tb:s},o=Object.keys(l||{}).sort(),n=L(o),g;!(g=n()).done;){var r=g.value,E=l[r];if(!!m(E)&&!(r==="v"&&E===1)&&!(r=="pr"&&E===1)){var P=u[r];P&&(E=P(E));var y=typeof E,U=void 0;r==="ot"||r==="sf"||r==="st"?U=r+"="+E:y==="boolean"?U=r:y==="number"?U=r+"="+E:U=r+"="+JSON.stringify(E),p.push(U)}}return p.join(",")},d.toHeaders=function(l){for(var p=Object.keys(l),m={},s=["Object","Request","Session","Status"],c=[{},{},{},{}],_={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},u=0,o=p;u<o.length;u++){var n=o[u],g=_[n]!=null?_[n]:1;c[g][n]=l[n]}for(var r=0;r<c.length;r++){var E=d.serialize(c[r]);E&&(m["CMCD-"+s[r]]=E)}return m},d.toQuery=function(l){return"CMCD="+encodeURIComponent(d.serialize(l))},d.appendQueryToUri=function(l,p){if(!p)return l;var m=l.includes("?")?"&":"?";return""+l+m+p},d}()},"./src/controller/eme-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>u});var M=v("./src/events.ts"),S=v("./src/errors.ts"),k=v("./src/utils/logger.ts"),R=v("./src/utils/mediakeys-helper.ts"),K=v("./src/utils/keysystem-util.ts"),b=v("./src/utils/numeric-encoding-utils.ts"),I=v("./src/loader/level-key.ts"),C=v("./src/utils/hex.ts"),L=v("./src/utils/mp4-tools.ts"),A=v("./node_modules/eventemitter3/index.js"),h=v.n(A);function D(o,n){o.prototype=Object.create(n.prototype),o.prototype.constructor=o,l(o,n)}function T(o){var n=typeof Map=="function"?new Map:void 0;return T=function(r){if(r===null||!i(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(r))return n.get(r);n.set(r,E)}function E(){return d(r,arguments,p(this).constructor)}return E.prototype=Object.create(r.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),l(E,r)},T(o)}function d(o,n,g){return f()?d=Reflect.construct.bind():d=function(E,P,y){var U=[null];U.push.apply(U,P);var B=Function.bind.apply(E,U),w=new B;return y&&l(w,y.prototype),w},d.apply(null,arguments)}function f(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function i(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function l(o,n){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,E){return r.__proto__=E,r},l(o,n)}function p(o){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},p(o)}var m=3,s="[eme]",c=function(){function o(g){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=o.CDMCleanupPromise?[o.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=k.logger.debug.bind(k.logger,s),this.log=k.logger.log.bind(k.logger,s),this.warn=k.logger.warn.bind(k.logger,s),this.error=k.logger.error.bind(k.logger,s),this.hls=g,this.config=g.config,this.registerListeners()}var n=o.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},n.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},n.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},n.getLicenseServerUrl=function(r){var E=this.config,P=E.drmSystems,y=E.widevineLicenseUrl,U=P[r];if(U)return U.licenseUrl;if(r===R.KeySystems.WIDEVINE&&y)return y;throw new Error('no license server URL configured for key-system "'+r+'"')},n.getServerCertificateUrl=function(r){var E=this.config.drmSystems,P=E[r];if(P)return P.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+r+'"]')},n.attemptKeySystemAccess=function(r){var E=this,P=this.hls.levels,y=function(H,G,V){return!!H&&V.indexOf(H)===G},U=P.map(function(w){return w.audioCodec}).filter(y),B=P.map(function(w){return w.videoCodec}).filter(y);return U.length+B.length===0&&B.push("avc1.42e01e"),new Promise(function(w,H){var G=function V(z){var $=z.shift();E.getMediaKeysPromise($,U,B).then(function(X){return w({keySystem:$,mediaKeys:X})}).catch(function(X){z.length?V(z):X instanceof _?H(X):H(new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:X,fatal:!0},X.message))})};G(r)})},n.requestMediaKeySystemAccess=function(r,E){var P=this.config.requestMediaKeySystemAccessFunc;if(typeof P!="function"){var y="Configured requestMediaKeySystemAccess is not a function "+P;return R.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(y="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(y))}return P(r,E)},n.getMediaKeysPromise=function(r,E,P){var y=this,U=(0,R.getSupportedMediaKeySystemConfigurations)(r,E,P,this.config.drmSystemOptions),B=this.keySystemAccessPromises[r],w=B==null?void 0:B.keySystemAccess;if(!w){this.log('Requesting encrypted media "'+r+'" key-system access with config: '+JSON.stringify(U)),w=this.requestMediaKeySystemAccess(r,U);var H=this.keySystemAccessPromises[r]={keySystemAccess:w};return w.catch(function(G){y.log('Failed to obtain access to key-system "'+r+'": '+G)}),w.then(function(G){y.log('Access for key-system "'+G.keySystem+'" obtained');var V=y.fetchServerCertificate(r);return y.log('Create media-keys for "'+r+'"'),H.mediaKeys=G.createMediaKeys().then(function(z){return y.log('Media-keys created for "'+r+'"'),V.then(function($){return $?y.setMediaKeysServerCertificate(z,r,$):z})}),H.mediaKeys.catch(function(z){y.error('Failed to create media-keys for "'+r+'"}: '+z)}),H.mediaKeys})}return w.then(function(){return B.mediaKeys})},n.createMediaKeySessionContext=function(r){var E=r.decryptdata,P=r.keySystem,y=r.mediaKeys;console.assert(!!y,"mediaKeys is defined"),this.log('Creating key-system session "'+P+'" keyId: '+C.default.hexDump(E.keyId||[]));var U=y.createSession(),B={decryptdata:E,keySystem:P,mediaKeys:y,mediaKeysSession:U,keyStatus:"status-pending"};return this.mediaKeySessions.push(B),B},n.renewKeySession=function(r){var E=r.decryptdata;if(E.pssh){var P=this.createMediaKeySessionContext(r),y=this.getKeyIdString(E),U="cenc";this.keyIdToKeySessionPromise[y]=this.generateRequestWithPreferredKeySession(P,U,E.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(r)},n.getKeyIdString=function(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return C.default.hexDump(r.keyId)},n.updateKeySession=function(r,E){var P,y=r.mediaKeysSession;return this.log('Updating key-session "'+y.sessionId+'" for keyID '+C.default.hexDump(((P=r.decryptdata)===null||P===void 0?void 0:P.keyId)||[])+`
      } (data length: `+(E&&E.byteLength)+")"),y.update(E)},n.selectKeySystemFormat=function(r){var E=Object.keys(r.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+r.sn+" "+r.type+": "+r.level+") key formats "+E.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(E)),this.keyFormatPromise},n.getKeyFormatPromise=function(r){var E=this;return new Promise(function(P,y){var U=(0,R.getKeySystemsForConfig)(E.config),B=r.map(R.keySystemFormatToKeySystemDomain).filter(function(w){return!!w&&U.indexOf(w)!==-1});return E.getKeySystemSelectionPromise(B).then(function(w){var H=w.keySystem,G=(0,R.keySystemDomainToKeySystemFormat)(H);G?P(G):y(new Error('Unable to find format for key-system "'+H+'"'))}).catch(y)})},n.loadKey=function(r){var E=this,P=r.keyInfo.decryptdata,y=this.getKeyIdString(P),U="(keyId: "+y+' format: "'+P.keyFormat+'" method: '+P.method+" uri: "+P.uri+")";this.log("Starting session for key "+U);var B=this.keyIdToKeySessionPromise[y];return B||(B=this.keyIdToKeySessionPromise[y]=this.getKeySystemForKeyPromise(P).then(function(w){var H=w.keySystem,G=w.mediaKeys;return E.throwIfDestroyed(),E.log("Handle encrypted media sn: "+r.frag.sn+" "+r.frag.type+": "+r.frag.level+" using key "+U),E.attemptSetMediaKeys(H,G).then(function(){E.throwIfDestroyed();var V=E.createMediaKeySessionContext({keySystem:H,mediaKeys:G,decryptdata:P}),z="cenc";return E.generateRequestWithPreferredKeySession(V,z,P.pssh,"playlist-key")})}),B.catch(function(w){return E.handleError(w)})),B},n.throwIfDestroyed=function(r){if(!this.hls)throw new Error("invalid state")},n.handleError=function(r){!this.hls||(this.error(r.message),r instanceof _?this.hls.trigger(M.Events.ERROR,r.data):this.hls.trigger(M.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:r,fatal:!0}))},n.getKeySystemForKeyPromise=function(r){var E=this.getKeyIdString(r),P=this.keyIdToKeySessionPromise[E];if(!P){var y=(0,R.keySystemFormatToKeySystemDomain)(r.keyFormat),U=y?[y]:(0,R.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(U)}return P},n.getKeySystemSelectionPromise=function(r){if(r.length||(r=(0,R.getKeySystemsForConfig)(this.config)),r.length===0)throw new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(r)},n._onMediaEncrypted=function(r){var E=this,P=r.initDataType,y=r.initData;if(this.debug('"'+r.type+'" event: init data type: "'+P+'"'),y!==null){var U,B;if(P==="sinf"&&this.config.drmSystems[R.KeySystems.FAIRPLAY]){var w=(0,L.bin2str)(new Uint8Array(y));try{var H=(0,b.base64Decode)(JSON.parse(w).sinf),G=(0,L.parseSinf)(new Uint8Array(H));if(!G)return;U=G.subarray(8,24),B=R.KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var V=(0,L.parsePssh)(y);if(V===null)return;V.version===0&&V.systemId===R.KeySystemIds.WIDEVINE&&V.data&&(U=V.data.subarray(8,24)),B=(0,R.keySystemIdToKeySystemDomain)(V.systemId)}if(!(!B||!U)){for(var z=C.default.hexDump(U),$=this.keyIdToKeySessionPromise,X=this.mediaKeySessions,j=$[z],Y=function(ee){var ne=X[ee],te=ne.decryptdata;if(te.pssh||!te.keyId)return"continue";var q=C.default.hexDump(te.keyId);if(z===q||te.uri.replace(/-/g,"").indexOf(z)!==-1)return j=$[q],delete $[q],te.pssh=new Uint8Array(y),te.keyId=U,j=$[z]=j.then(function(){return E.generateRequestWithPreferredKeySession(ne,P,y,"encrypted-event-key-match")}),"break"},Q=0;Q<X.length;Q++){var J=Y(Q);if(J!=="continue"&&J==="break")break}j||(j=$[z]=this.getKeySystemSelectionPromise([B]).then(function(Z){var ee,ne=Z.keySystem,te=Z.mediaKeys;E.throwIfDestroyed();var q=new I.LevelKey("ISO-23001-7",z,(ee=(0,R.keySystemDomainToKeySystemFormat)(ne))!=null?ee:"");return q.pssh=new Uint8Array(y),q.keyId=U,E.attemptSetMediaKeys(ne,te).then(function(){E.throwIfDestroyed();var re=E.createMediaKeySessionContext({decryptdata:q,keySystem:ne,mediaKeys:te});return E.generateRequestWithPreferredKeySession(re,P,y,"encrypted-event-no-match")})})),j.catch(function(Z){return E.handleError(Z)})}}},n._onWaitingForKey=function(r){this.log('"'+r.type+'" event')},n.attemptSetMediaKeys=function(r,E){var P=this,y=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+r+'"');var U=Promise.all(y).then(function(){if(!P.media)throw new Error("Attempted to set mediaKeys without media element attached");return P.media.setMediaKeys(E)});return this.setMediaKeysQueue.push(U),U.then(function(){P.log('Media-keys set for "'+r+'"'),y.push(U),P.setMediaKeysQueue=P.setMediaKeysQueue.filter(function(B){return y.indexOf(B)===-1})})},n.generateRequestWithPreferredKeySession=function(r,E,P,y){var U,B,w=this,H=(U=this.config.drmSystems)===null||U===void 0||(B=U[r.keySystem])===null||B===void 0?void 0:B.generateRequest;if(H)try{var G=H.call(this.hls,E,P,r);if(!G)throw new Error("Invalid response from configured generateRequest filter");E=G.initDataType,P=r.decryptdata.pssh=G.initData?new Uint8Array(G.initData):null}catch(j){var V;if(this.warn(j.message),(V=this.hls)!==null&&V!==void 0&&V.config.debug)throw j}if(P===null)return this.log('Skipping key-session request for "'+y+'" (no initData)'),Promise.resolve(r);var z=this.getKeyIdString(r.decryptdata);this.log('Generating key-session request for "'+y+'": '+z+" (init data type: "+E+" length: "+(P?P.byteLength:null)+")");var $=new(h());r.mediaKeysSession.onmessage=function(j){var Y=r.mediaKeysSession;if(!Y){$.emit("error",new Error("invalid state"));return}var Q=j.messageType,J=j.message;w.log('"'+Q+'" message event for session "'+Y.sessionId+'" message size: '+J.byteLength),Q==="license-request"||Q==="license-renewal"?w.renewLicense(r,J).catch(function(Z){w.handleError(Z),$.emit("error",Z)}):Q==="license-release"?r.keySystem===R.KeySystems.FAIRPLAY&&(w.updateKeySession(r,(0,K.strToUtf8array)("acknowledged")),w.removeSession(r)):w.warn('unhandled media key message type "'+Q+'"')},r.mediaKeysSession.onkeystatuseschange=function(j){var Y=r.mediaKeysSession;if(!Y){$.emit("error",new Error("invalid state"));return}w.onKeyStatusChange(r);var Q=r.keyStatus;$.emit("keyStatus",Q),Q==="expired"&&(w.warn(r.keySystem+" expired for key "+z),w.renewKeySession(r))};var X=new Promise(function(j,Y){$.on("error",Y),$.on("keyStatus",function(Q){Q.startsWith("usable")?j():Q==="output-restricted"?Y(new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):Q==="internal-error"?Y(new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+Q+'"')):Q==="expired"?Y(new Error("key expired while generating request")):w.warn('unhandled key status change "'+Q+'"')})});return r.mediaKeysSession.generateRequest(E,P).then(function(){var j;w.log('Request generated for key-session "'+((j=r.mediaKeysSession)===null||j===void 0?void 0:j.sessionId)+'" keyId: '+z)}).catch(function(j){throw new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:j,fatal:!1},"Error generating key-session request: "+j)}).then(function(){return X}).catch(function(j){throw $.removeAllListeners(),w.removeSession(r),j}).then(function(){return $.removeAllListeners(),r})},n.onKeyStatusChange=function(r){var E=this;r.mediaKeysSession.keyStatuses.forEach(function(P,y){E.log('key status change "'+P+'" for keyStatuses keyId: '+C.default.hexDump("buffer"in y?new Uint8Array(y.buffer,y.byteOffset,y.byteLength):new Uint8Array(y))+" session keyId: "+C.default.hexDump(new Uint8Array(r.decryptdata.keyId||[]))+" uri: "+r.decryptdata.uri),r.keyStatus=P})},n.fetchServerCertificate=function(r){var E=this;return new Promise(function(P,y){var U=E.getServerCertificateUrl(r);if(!U)return P();E.log('Fetching serverCertificate for "'+r+'"');var B=new XMLHttpRequest;B.open("GET",U,!0),B.responseType="arraybuffer",B.onreadystatechange=function(){B.readyState===XMLHttpRequest.DONE&&(B.status===200?P(B.response):y(new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:B},'"'+r+'" certificate request XHR failed ('+U+"). Status: "+B.status+" ("+B.statusText+")")))},B.send()})},n.setMediaKeysServerCertificate=function(r,E,P){var y=this;return new Promise(function(U,B){r.setServerCertificate(P).then(function(w){y.log("setServerCertificate "+(w?"success":"not supported by CDM")+" ("+(P==null?void 0:P.byteLength)+') on "'+E+'"'),U(r)}).catch(function(w){B(new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:w,fatal:!0},w.message))})})},n.renewLicense=function(r,E){var P=this;return this.requestLicense(r,new Uint8Array(E)).then(function(y){return P.updateKeySession(r,new Uint8Array(y)).catch(function(U){throw new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:U,fatal:!0},U.message)})})},n.setupLicenseXHR=function(r,E,P,y){var U=this,B=this.config.licenseXhrSetup;return B?Promise.resolve().then(function(){if(!P.decryptdata)throw new Error("Key removed");return B.call(U.hls,r,E,P,y)}).catch(function(w){if(!P.decryptdata)throw w;return r.open("POST",E,!0),B.call(U.hls,r,E,P,y)}).then(function(w){r.readyState||r.open("POST",E,!0);var H=w||y;return{xhr:r,licenseChallenge:H}}):(r.open("POST",E,!0),Promise.resolve({xhr:r,licenseChallenge:y}))},n.requestLicense=function(r,E){var P=this;return new Promise(function(y,U){var B=P.getLicenseServerUrl(r.keySystem);P.log("Sending license request to URL: "+B);var w=new XMLHttpRequest;w.responseType="arraybuffer",w.onreadystatechange=function(){if(!P.hls||!r.mediaKeysSession)return U(new Error("invalid state"));if(w.readyState===4)if(w.status===200){P._requestLicenseFailureCount=0;var H=w.response;P.log("License received "+(H instanceof ArrayBuffer?H.byteLength:H));var G=P.config.licenseResponseCallback;if(G)try{H=G.call(P.hls,w,B,r)}catch(z){P.error(z)}y(H)}else if(P._requestLicenseFailureCount++,P._requestLicenseFailureCount>m||w.status>=400&&w.status<500)U(new _({type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:w},"License Request XHR failed ("+B+"). Status: "+w.status+" ("+w.statusText+")"));else{var V=m-P._requestLicenseFailureCount+1;P.warn("Retrying license request, "+V+" attempts left"),P.requestLicense(r,E).then(y,U)}},r.licenseXhr&&r.licenseXhr.readyState!==XMLHttpRequest.DONE&&r.licenseXhr.abort(),r.licenseXhr=w,P.setupLicenseXHR(w,B,r,E).then(function(H){var G=H.xhr,V=H.licenseChallenge;G.send(V)})})},n.onMediaAttached=function(r,E){if(!!this.config.emeEnabled){var P=E.media;this.media=P,P.addEventListener("encrypted",this.onMediaEncrypted),P.addEventListener("waitingforkey",this.onWaitingForKey)}},n.onMediaDetached=function(){var r=this,E=this.media,P=this.mediaKeySessions;E&&(E.removeEventListener("encrypted",this.onMediaEncrypted),E.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},I.LevelKey.clearKeyUriToKeyIdMap();var y=P.length;o.CDMCleanupPromise=Promise.all(P.map(function(U){return r.removeSession(U)}).concat(E==null?void 0:E.setMediaKeys(null).catch(function(U){r.log("Could not clear media keys: "+U+". media.src: "+(E==null?void 0:E.src))}))).then(function(){y&&(r.log("finished closing key sessions and clearing media keys"),P.length=0)}).catch(function(U){r.log("Could not close sessions and clear media keys: "+U+". media.src: "+(E==null?void 0:E.src))})},n.onManifestLoaded=function(r,E){var P=E.sessionKeys;if(!(!P||!this.config.emeEnabled)&&!this.keyFormatPromise){var y=P.reduce(function(U,B){return U.indexOf(B.keyFormat)===-1&&U.push(B.keyFormat),U},[]);this.log("Selecting key-system from session-keys "+y.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(y)}},n.removeSession=function(r){var E=this,P=r.mediaKeysSession,y=r.licenseXhr;if(P){this.log("Remove licenses and keys and close session "+P.sessionId),P.onmessage=null,P.onkeystatuseschange=null,y&&y.readyState!==XMLHttpRequest.DONE&&y.abort(),r.mediaKeysSession=r.decryptdata=r.licenseXhr=void 0;var U=this.mediaKeySessions.indexOf(r);return U>-1&&this.mediaKeySessions.splice(U,1),P.remove().catch(function(B){E.log("Could not remove session: "+B)}).then(function(){return P.close()}).catch(function(B){E.log("Could not close session: "+B)})}},o}();c.CDMCleanupPromise=void 0;var _=function(o){D(n,o);function n(g,r){var E;return E=o.call(this,r)||this,E.data=void 0,E.data=g,g.err=g.error,E}return n}(T(Error));const u=c},"./src/controller/fps-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>R});var M=v("./src/events.ts"),S=v("./src/utils/logger.ts"),k=function(){function K(I){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=I,this.registerListeners()}var b=K.prototype;return b.setStreamController=function(C){this.streamController=C},b.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},b.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},b.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},b.onMediaAttaching=function(C,L){var A=this.hls.config;if(A.capLevelOnFPSDrop){var h=L.media instanceof self.HTMLVideoElement?L.media:null;this.media=h,h&&typeof h.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),A.fpsDroppedMonitoringPeriod)}},b.checkFPS=function(C,L,A){var h=performance.now();if(L){if(this.lastTime){var D=h-this.lastTime,T=A-this.lastDroppedFrames,d=L-this.lastDecodedFrames,f=1e3*T/D,i=this.hls;if(i.trigger(M.Events.FPS_DROP,{currentDropped:T,currentDecoded:d,totalDroppedFrames:A}),f>0&&T>i.config.fpsDroppedMonitoringThreshold*d){var l=i.currentLevel;S.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+l),l>0&&(i.autoLevelCapping===-1||i.autoLevelCapping>=l)&&(l=l-1,i.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:l,droppedLevel:i.currentLevel}),i.autoLevelCapping=l,this.streamController.nextLevelSwitch())}}this.lastTime=h,this.lastDroppedFrames=A,this.lastDecodedFrames=L}},b.checkFPSInterval=function(){var C=this.media;if(C)if(this.isVideoPlaybackQualityAvailable){var L=C.getVideoPlaybackQuality();this.checkFPS(C,L.totalVideoFrames,L.droppedVideoFrames)}else this.checkFPS(C,C.webkitDecodedFrameCount,C.webkitDroppedFrameCount)},K}();const R=k},"./src/controller/fragment-finders.ts":(N,O,v)=>{v.r(O),v.d(O,{findFragWithCC:()=>I,findFragmentByPDT:()=>k,findFragmentByPTS:()=>R,fragmentWithinToleranceTest:()=>K,pdtWithinToleranceTest:()=>b});var M=v("./src/polyfills/number.ts"),S=v("./src/utils/binary-search.ts");function k(C,L,A){if(L===null||!Array.isArray(C)||!C.length||!(0,M.isFiniteNumber)(L))return null;var h=C[0].programDateTime;if(L<(h||0))return null;var D=C[C.length-1].endProgramDateTime;if(L>=(D||0))return null;A=A||0;for(var T=0;T<C.length;++T){var d=C[T];if(b(L,A,d))return d}return null}function R(C,L,A,h){A===void 0&&(A=0),h===void 0&&(h=0);var D=null;if(C?D=L[C.sn-L[0].sn+1]||null:A===0&&L[0].start===0&&(D=L[0]),D&&K(A,h,D)===0)return D;var T=S.default.search(L,K.bind(null,A,h));return T&&(T!==C||!D)?T:D}function K(C,L,A){if(C===void 0&&(C=0),L===void 0&&(L=0),A.start<=C&&A.start+A.duration>C)return 0;var h=Math.min(L,A.duration+(A.deltaPTS?A.deltaPTS:0));return A.start+A.duration-h<=C?1:A.start-h>C&&A.start?-1:0}function b(C,L,A){var h=Math.min(L,A.duration+(A.deltaPTS?A.deltaPTS:0))*1e3,D=A.endProgramDateTime||0;return D-h>C}function I(C,L){return S.default.search(C,function(A){return A.cc<L?1:A.cc>L?-1:0})}},"./src/controller/fragment-tracker.ts":(N,O,v)=>{v.r(O),v.d(O,{FragmentState:()=>k,FragmentTracker:()=>R});var M=v("./src/events.ts"),S=v("./src/types/loader.ts"),k;(function(I){I.NOT_LOADED="NOT_LOADED",I.APPENDING="APPENDING",I.PARTIAL="PARTIAL",I.OK="OK"})(k||(k={}));var R=function(){function I(L){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=L,this._registerListeners()}var C=I.prototype;return C._registerListeners=function(){var A=this.hls;A.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),A.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),A.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},C._unregisterListeners=function(){var A=this.hls;A.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),A.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),A.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},C.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},C.getAppendedFrag=function(A,h){if(h===S.PlaylistLevelType.MAIN){var D=this.activeFragment,T=this.activeParts;if(!D)return null;if(T)for(var d=T.length;d--;){var f=T[d],i=f?f.end:D.appendedPTS;if(f.start<=A&&i!==void 0&&A<=i)return d>9&&(this.activeParts=T.slice(d-9)),f}else if(D.start<=A&&D.appendedPTS!==void 0&&A<=D.appendedPTS)return D}return this.getBufferedFrag(A,h)},C.getBufferedFrag=function(A,h){for(var D=this.fragments,T=Object.keys(D),d=T.length;d--;){var f=D[T[d]];if((f==null?void 0:f.body.type)===h&&f.buffered){var i=f.body;if(i.start<=A&&A<=i.end)return i}}return null},C.detectEvictedFragments=function(A,h,D){var T=this;this.timeRanges&&(this.timeRanges[A]=h),Object.keys(this.fragments).forEach(function(d){var f=T.fragments[d];if(!!f){if(!f.buffered&&!f.loaded){f.body.type===D&&T.removeFragment(f.body);return}var i=f.range[A];!i||i.time.some(function(l){var p=!T.isTimeBuffered(l.startPTS,l.endPTS,h);return p&&T.removeFragment(f.body),p})}})},C.detectPartialFragments=function(A){var h=this,D=this.timeRanges,T=A.frag,d=A.part;if(!(!D||T.sn==="initSegment")){var f=b(T),i=this.fragments[f];!i||(Object.keys(D).forEach(function(l){var p=T.elementaryStreams[l];if(!!p){var m=D[l],s=d!==null||p.partial===!0;i.range[l]=h.getBufferedTimes(T,d,s,m)}}),i.loaded=null,Object.keys(i.range).length?(i.buffered=!0,i.body.endList&&(this.endListFragments[i.body.type]=i)):this.removeFragment(i.body))}},C.fragBuffered=function(A){var h=b(A),D=this.fragments[h];D&&(D.loaded=null,D.buffered=!0)},C.getBufferedTimes=function(A,h,D,T){for(var d={time:[],partial:D},f=h?h.start:A.start,i=h?h.end:A.end,l=A.minEndPTS||i,p=A.maxStartPTS||f,m=0;m<T.length;m++){var s=T.start(m)-this.bufferPadding,c=T.end(m)+this.bufferPadding;if(p>=s&&l<=c){d.time.push({startPTS:Math.max(f,T.start(m)),endPTS:Math.min(i,T.end(m))});break}else if(f<c&&i>s)d.partial=!0,d.time.push({startPTS:Math.max(f,T.start(m)),endPTS:Math.min(i,T.end(m))});else if(i<=s)break}return d},C.getPartialFragment=function(A){var h=null,D,T,d,f=0,i=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(p){var m=l[p];!m||K(m)&&(T=m.body.start-i,d=m.body.end+i,A>=T&&A<=d&&(D=Math.min(A-T,d-A),f<=D&&(h=m.body,f=D)))}),h},C.isEndListAppended=function(A){var h=this.endListFragments[A];return h!==void 0&&(h.buffered||K(h))},C.getState=function(A){var h=b(A),D=this.fragments[h];return D?D.buffered?K(D)?k.PARTIAL:k.OK:k.APPENDING:k.NOT_LOADED},C.isTimeBuffered=function(A,h,D){for(var T,d,f=0;f<D.length;f++){if(T=D.start(f)-this.bufferPadding,d=D.end(f)+this.bufferPadding,A>=T&&h<=d)return!0;if(h<=T)return!1}return!1},C.onFragLoaded=function(A,h){var D=h.frag,T=h.part;if(!(D.sn==="initSegment"||D.bitrateTest||T)){var d=b(D);this.fragments[d]={body:D,loaded:h,buffered:!1,range:Object.create(null)}}},C.onBufferAppended=function(A,h){var D=this,T=h.frag,d=h.part,f=h.timeRanges;if(T.type===S.PlaylistLevelType.MAIN)if(this.activeFragment!==T&&(this.activeFragment=T,T.appendedPTS=void 0),d){var i=this.activeParts;i||(this.activeParts=i=[]),i.push(d)}else this.activeParts=null;this.timeRanges=f,Object.keys(f).forEach(function(l){var p=f[l];if(D.detectEvictedFragments(l,p),!d&&T.type===S.PlaylistLevelType.MAIN){var m=T.elementaryStreams[l];if(!m)return;for(var s=0;s<p.length;s++){var c=p.end(s);c<=m.endPTS&&c>m.startPTS?T.appendedPTS=Math.max(c,T.appendedPTS||0):T.appendedPTS=m.endPTS}}})},C.onFragBuffered=function(A,h){this.detectPartialFragments(h)},C.hasFragment=function(A){var h=b(A);return!!this.fragments[h]},C.removeFragmentsInRange=function(A,h,D){var T=this;Object.keys(this.fragments).forEach(function(d){var f=T.fragments[d];if(!!f&&f.buffered){var i=f.body;i.type===D&&i.start<h&&i.end>A&&T.removeFragment(i)}})},C.removeFragment=function(A){var h=b(A);A.stats.loaded=0,A.clearElementaryStreamInfo(),A.appendedPTS=void 0,delete this.fragments[h],A.endList&&delete this.endListFragments[A.type]},C.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},I}();function K(I){var C,L;return I.buffered&&(((C=I.range.video)===null||C===void 0?void 0:C.partial)||((L=I.range.audio)===null||L===void 0?void 0:L.partial))}function b(I){return I.type+"_"+I.level+"_"+I.urlId+"_"+I.sn}},"./src/controller/gap-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{MAX_START_GAP_JUMP:()=>b,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>I,SKIP_BUFFER_RANGE_START:()=>C,STALL_MINIMUM_DURATION_MS:()=>K,default:()=>L});var M=v("./src/utils/buffer-helper.ts"),S=v("./src/errors.ts"),k=v("./src/events.ts"),R=v("./src/utils/logger.ts"),K=250,b=2,I=.1,C=.05,L=function(){function A(D,T,d,f){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=D,this.media=T,this.fragmentTracker=d,this.hls=f}var h=A.prototype;return h.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},h.poll=function(T,d){var f=this.config,i=this.media,l=this.stalled;if(i!==null){var p=i.currentTime,m=i.seeking,s=this.seeking&&!m,c=!this.seeking&&m;if(this.seeking=m,p!==T){if(this.moved=!0,l!==null){if(this.stallReported){var _=self.performance.now()-l;R.logger.warn("playback not stuck anymore @"+p+", after "+Math.round(_)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((c||s)&&(this.stalled=null),!(i.paused&&!m||i.ended||i.playbackRate===0||!M.BufferHelper.getBuffered(i).length)){var u=M.BufferHelper.bufferInfo(i,p,0),o=u.len>0,n=u.nextStart||0;if(!(!o&&!n)){if(m){var g=u.len>b,r=!n||d&&d.start<=p||n-p>b&&!this.fragmentTracker.getPartialFragment(p);if(g||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var E,P=Math.max(n,u.start||0)-p,y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,U=y==null||(E=y.details)===null||E===void 0?void 0:E.live,B=U?y.details.targetduration*2:b;if(P>0&&P<=B){this._trySkipBufferHole(null);return}}var w=self.performance.now();if(l===null){this.stalled=w;return}var H=w-l;if(!(!m&&H>=K&&(this._reportStall(u),!this.media))){var G=M.BufferHelper.bufferInfo(i,p,f.maxBufferHole);this._tryFixBufferStall(G,H)}}}}},h._tryFixBufferStall=function(T,d){var f=this.config,i=this.fragmentTracker,l=this.media;if(l!==null){var p=l.currentTime,m=i.getPartialFragment(p);if(m){var s=this._trySkipBufferHole(m);if(s||!this.media)return}T.len>f.maxBufferHole&&d>f.highBufferWatchdogPeriod*1e3&&(R.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},h._reportStall=function(T){var d=this.hls,f=this.media,i=this.stallReported;!i&&f&&(this.stallReported=!0,R.logger.warn("Playback stalling at @"+f.currentTime+" due to low buffer ("+JSON.stringify(T)+")"),d.trigger(k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:T.len}))},h._trySkipBufferHole=function(T){var d=this.config,f=this.hls,i=this.media;if(i===null)return 0;for(var l=i.currentTime,p=0,m=M.BufferHelper.getBuffered(i),s=0;s<m.length;s++){var c=m.start(s);if(l+d.maxBufferHole>=p&&l<c){var _=Math.max(c+C,i.currentTime+I);return R.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+_),this.moved=!0,this.stalled=null,i.currentTime=_,T&&f.trigger(k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+_,frag:T}),_}p=m.end(s)}return 0},h._tryNudgeBuffer=function(){var T=this.config,d=this.hls,f=this.media,i=this.nudgeRetry;if(f!==null){var l=f.currentTime;if(this.nudgeRetry++,i<T.nudgeMaxRetry){var p=l+(i+1)*T.nudgeOffset;R.logger.warn("Nudging 'currentTime' from "+l+" to "+p),f.currentTime=p,d.trigger(k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else R.logger.error("Playhead still not moving while enough data buffered @"+l+" after "+T.nudgeMaxRetry+" nudges"),d.trigger(k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},A}()},"./src/controller/id3-track-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>T});var M=v("./src/polyfills/number.ts"),S=v("./src/events.ts"),k=v("./src/utils/texttrack-utils.ts"),R=v("./src/demux/id3.ts"),K=v("./src/loader/date-range.ts"),b=v("./src/types/demuxer.ts"),I=.25;function C(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var L=function(){var d=C();try{new d(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function A(d,f){return d.getTime()/1e3-f}function h(d){return Uint8Array.from(d.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var D=function(){function d(i){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=i,this._registerListeners()}var f=d.prototype;return f.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},f._registerListeners=function(){var l=this.hls;l.on(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(S.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),l.on(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.on(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},f._unregisterListeners=function(){var l=this.hls;l.off(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(S.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),l.off(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),l.off(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},f.onMediaAttached=function(l,p){this.media=p.media},f.onMediaDetaching=function(){!this.id3Track||((0,k.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},f.onManifestLoading=function(){this.dateRangeCuesAppended={}},f.createTrack=function(l){var p=this.getID3Track(l.textTracks);return p.mode="hidden",p},f.getID3Track=function(l){if(!!this.media){for(var p=0;p<l.length;p++){var m=l[p];if(m.kind==="metadata"&&m.label==="id3")return(0,k.sendAddTrackEvent)(m,this.media),m}return this.media.addTextTrack("metadata","id3")}},f.onFragParsingMetadata=function(l,p){if(!!this.media){var m=this.hls.config,s=m.enableEmsgMetadataCues,c=m.enableID3MetadataCues;if(!(!s&&!c)){var _=p.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var u=C(),o=0;o<_.length;o++){var n=_[o].type;if(!(n===b.MetadataSchema.emsg&&!s||!c)){var g=R.getID3Frames(_[o].data);if(g){var r=_[o].pts,E=r+_[o].duration;E>L&&(E=L);var P=E-r;P<=0&&(E=r+I);for(var y=0;y<g.length;y++){var U=g[y];if(!R.isTimeStampFrame(U)){this.updateId3CueEnds(r);var B=new u(r,E,"");B.value=U,n&&(B.type=n),this.id3Track.addCue(B)}}}}}}}},f.updateId3CueEnds=function(l){var p,m=(p=this.id3Track)===null||p===void 0?void 0:p.cues;if(m)for(var s=m.length;s--;){var c=m[s];c.startTime<l&&c.endTime===L&&(c.endTime=l)}},f.onBufferFlushing=function(l,p){var m=p.startOffset,s=p.endOffset,c=p.type,_=this.id3Track,u=this.hls;if(!!u){var o=u.config,n=o.enableEmsgMetadataCues,g=o.enableID3MetadataCues;if(_&&(n||g)){var r;c==="audio"?r=function(P){return P.type===b.MetadataSchema.audioId3&&g}:c==="video"?r=function(P){return P.type===b.MetadataSchema.emsg&&n}:r=function(P){return P.type===b.MetadataSchema.audioId3&&g||P.type===b.MetadataSchema.emsg&&n},(0,k.removeCuesInRange)(_,m,s,r)}}},f.onLevelUpdated=function(l,p){var m=this,s=p.details;if(!(!this.media||!s.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var c=this.dateRangeCuesAppended,_=this.id3Track,u=s.dateRanges,o=Object.keys(u);if(_)for(var n=Object.keys(c).filter(function(w){return!o.includes(w)}),g=function(H){var G=n[H];Object.keys(c[G].cues).forEach(function(V){_.removeCue(c[G].cues[V])}),delete c[G]},r=n.length;r--;)g(r);var E=s.fragments[s.fragments.length-1];if(!(o.length===0||!(0,M.isFiniteNumber)(E==null?void 0:E.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var P=E.programDateTime/1e3-E.start,y=C(),U=function(H){var G=o[H],V=u[G],z=c[G],$=(z==null?void 0:z.cues)||{},X=(z==null?void 0:z.durationKnown)||!1,j=A(V.startDate,P),Y=L,Q=V.endDate;if(Q)Y=A(Q,P),X=!0;else if(V.endOnNext&&!X){var J=o.reduce(function(re,se){var ie=u[se];return ie.class===V.class&&ie.id!==se&&ie.startDate>V.startDate&&re.push(ie),re},[]).sort(function(re,se){return re.startDate.getTime()-se.startDate.getTime()})[0];J&&(Y=A(J.startDate,P),X=!0)}for(var Z=Object.keys(V.attr),ee=0;ee<Z.length;ee++){var ne=Z[ee];if(!(ne===K.DateRangeAttribute.ID||ne===K.DateRangeAttribute.CLASS||ne===K.DateRangeAttribute.START_DATE||ne===K.DateRangeAttribute.DURATION||ne===K.DateRangeAttribute.END_DATE||ne===K.DateRangeAttribute.END_ON_NEXT)){var te=$[ne];if(te)X&&!z.durationKnown&&(te.endTime=Y);else{var q=V.attr[ne];te=new y(j,Y,""),(ne===K.DateRangeAttribute.SCTE35_OUT||ne===K.DateRangeAttribute.SCTE35_IN)&&(q=h(q)),te.value={key:ne,data:q},te.type=b.MetadataSchema.dateRange,m.id3Track.addCue(te),$[ne]=te}}}c[G]={cues:$,dateRange:V,durationKnown:X}},B=0;B<o.length;B++)U(B)}}},d}();const T=D},"./src/controller/latency-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>C});var M=v("./src/errors.ts"),S=v("./src/events.ts"),k=v("./src/utils/logger.ts");function R(L,A){for(var h=0;h<A.length;h++){var D=A[h];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(L,b(D.key),D)}}function K(L,A,h){return A&&R(L.prototype,A),h&&R(L,h),Object.defineProperty(L,"prototype",{writable:!1}),L}function b(L){var A=I(L,"string");return typeof A=="symbol"?A:String(A)}function I(L,A){if(typeof L!="object"||L===null)return L;var h=L[Symbol.toPrimitive];if(h!==void 0){var D=h.call(L,A||"default");if(typeof D!="object")return D;throw new TypeError("@@toPrimitive must return a primitive value.")}return(A==="string"?String:Number)(L)}var C=function(){function L(h){var D=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return D.timeupdate()},this.hls=h,this.config=h.config,this.registerListeners()}var A=L.prototype;return A.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},A.registerListeners=function(){this.hls.on(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(S.Events.ERROR,this.onError,this)},A.unregisterListeners=function(){this.hls.off(S.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(S.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(S.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(S.Events.ERROR,this.onError)},A.onMediaAttached=function(D,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},A.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},A.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},A.onLevelUpdated=function(D,T){var d=T.details;this.levelDetails=d,d.advanced&&this.timeupdate(),!d.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},A.onError=function(D,T){T.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,k.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},A.timeupdate=function(){var D=this.media,T=this.levelDetails;if(!(!D||!T)){this.currentTime=D.currentTime;var d=this.computeLatency();if(d!==null){this._latency=d;var f=this.config,i=f.lowLatencyMode,l=f.maxLiveSyncPlaybackRate;if(!(!i||l===1)){var p=this.targetLatency;if(p!==null){var m=d-p,s=Math.min(this.maxLatency,p+T.targetduration),c=m<s;if(T.live&&c&&m>.05&&this.forwardBufferLength>1){var _=Math.min(2,Math.max(1,l)),u=Math.round(2/(1+Math.exp(-.75*m-this.edgeStalled))*20)/20;D.playbackRate=Math.min(_,Math.max(1,u))}else D.playbackRate!==1&&D.playbackRate!==0&&(D.playbackRate=1)}}}}},A.estimateLiveEdge=function(){var D=this.levelDetails;return D===null?null:D.edge+D.age},A.computeLatency=function(){var D=this.estimateLiveEdge();return D===null?null:D-this.currentTime},K(L,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var D=this.config,T=this.levelDetails;return D.liveMaxLatencyDuration!==void 0?D.liveMaxLatencyDuration:T?D.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var D=this.levelDetails;if(D===null)return null;var T=D.holdBack,d=D.partHoldBack,f=D.targetduration,i=this.config,l=i.liveSyncDuration,p=i.liveSyncDurationCount,m=i.lowLatencyMode,s=this.hls.userConfig,c=m&&d||T;(s.liveSyncDuration||s.liveSyncDurationCount||c===0)&&(c=l!==void 0?l:p*f);var _=f,u=1;return c+Math.min(this.stallCount*u,_)}},{key:"liveSyncPosition",get:function(){var D=this.estimateLiveEdge(),T=this.targetLatency,d=this.levelDetails;if(D===null||T===null||d===null)return null;var f=d.edge,i=D-T-this.edgeStalled,l=f-d.totalduration,p=f-(this.config.lowLatencyMode&&d.partTarget||d.targetduration);return Math.min(Math.max(l,i),p)}},{key:"drift",get:function(){var D=this.levelDetails;return D===null?1:D.drift}},{key:"edgeStalled",get:function(){var D=this.levelDetails;if(D===null)return 0;var T=(this.config.lowLatencyMode&&D.partTarget||D.targetduration)*3;return Math.max(D.age-T,0)}},{key:"forwardBufferLength",get:function(){var D=this.media,T=this.levelDetails;if(!D||!T)return 0;var d=D.buffered.length;return(d?D.buffered.end(d-1):T.edge)-this.currentTime}}]),L}()},"./src/controller/level-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>i});var M=v("./src/types/level.ts"),S=v("./src/events.ts"),k=v("./src/errors.ts"),R=v("./src/utils/codecs.ts"),K=v("./src/controller/level-helper.ts"),b=v("./src/controller/base-playlist-controller.ts"),I=v("./src/types/loader.ts");function C(){return C=Object.assign?Object.assign.bind():function(l){for(var p=1;p<arguments.length;p++){var m=arguments[p];for(var s in m)Object.prototype.hasOwnProperty.call(m,s)&&(l[s]=m[s])}return l},C.apply(this,arguments)}function L(l,p){for(var m=0;m<p.length;m++){var s=p[m];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(l,h(s.key),s)}}function A(l,p,m){return p&&L(l.prototype,p),m&&L(l,m),Object.defineProperty(l,"prototype",{writable:!1}),l}function h(l){var p=D(l,"string");return typeof p=="symbol"?p:String(p)}function D(l,p){if(typeof l!="object"||l===null)return l;var m=l[Symbol.toPrimitive];if(m!==void 0){var s=m.call(l,p||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(p==="string"?String:Number)(l)}function T(l,p){l.prototype=Object.create(p.prototype),l.prototype.constructor=l,d(l,p)}function d(l,p){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,c){return s.__proto__=c,s},d(l,p)}var f=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i=function(l){T(p,l);function p(s){var c;return c=l.call(this,s,"[level-controller]")||this,c._levels=[],c._firstLevel=-1,c._startLevel=void 0,c.currentLevelIndex=-1,c.manualLevelIndex=-1,c.onParsedComplete=void 0,c._registerListeners(),c}var m=p.prototype;return m._registerListeners=function(){var c=this.hls;c.on(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.on(S.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),c.on(S.Events.ERROR,this.onError,this)},m._unregisterListeners=function(){var c=this.hls;c.off(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.off(S.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),c.off(S.Events.ERROR,this.onError,this)},m.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,l.prototype.destroy.call(this)},m.startLoad=function(){var c=this._levels;c.forEach(function(_){_.loadError=0}),l.prototype.startLoad.call(this)},m.onManifestLoaded=function(c,_){var u=[],o=[],n=[],g,r={},E,P=!1,y=!1,U=!1;if(_.levels.forEach(function(G){var V=G.attrs;P=P||!!(G.width&&G.height),y=y||!!G.videoCodec,U=U||!!G.audioCodec,f&&G.audioCodec&&G.audioCodec.indexOf("mp4a.40.34")!==-1&&(G.audioCodec=void 0);var z=G.bitrate+"-"+G.attrs.RESOLUTION+"-"+G.attrs.CODECS;E=r[z],E?E.url.push(G.url):(E=new M.Level(G),r[z]=E,u.push(E)),V&&(V.AUDIO&&(0,K.addGroupId)(E,"audio",V.AUDIO),V.SUBTITLES&&(0,K.addGroupId)(E,"text",V.SUBTITLES))}),(P||y)&&U&&(u=u.filter(function(G){var V=G.videoCodec,z=G.width,$=G.height;return!!V||!!(z&&$)})),u=u.filter(function(G){var V=G.audioCodec,z=G.videoCodec;return(!V||(0,R.isCodecSupportedInMp4)(V,"audio"))&&(!z||(0,R.isCodecSupportedInMp4)(z,"video"))}),_.audioTracks&&(o=_.audioTracks.filter(function(G){return!G.audioCodec||(0,R.isCodecSupportedInMp4)(G.audioCodec,"audio")}),(0,K.assignTrackIdsByGroup)(o)),_.subtitles&&(n=_.subtitles,(0,K.assignTrackIdsByGroup)(n)),u.length>0){g=u[0].bitrate,u.sort(function(G,V){return G.attrs["HDCP-LEVEL"]!==V.attrs["HDCP-LEVEL"]?(G.attrs["HDCP-LEVEL"]||"")>(V.attrs["HDCP-LEVEL"]||"")?1:-1:G.bitrate!==V.bitrate?G.bitrate-V.bitrate:G.attrs.SCORE!==V.attrs.SCORE?G.attrs.decimalFloatingPoint("SCORE")-V.attrs.decimalFloatingPoint("SCORE"):P&&G.height!==V.height?G.height-V.height:0}),this._levels=u;for(var B=0;B<u.length;B++)if(u[B].bitrate===g){this._firstLevel=B,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+g);break}var w=U&&!y,H={levels:u,audioTracks:o,subtitleTracks:n,sessionData:_.sessionData,sessionKeys:_.sessionKeys,firstLevel:this._firstLevel,stats:_.stats,audio:U,video:y,altAudio:!w&&o.some(function(G){return!!G.url})};this.hls.trigger(S.Events.MANIFEST_PARSED,H),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(S.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:_.url,reason:"no level with compatible codecs found in manifest"})},m.onError=function(c,_){var u,o;if(l.prototype.onError.call(this,c,_),!_.fatal){var n=_.context,g=this._levels[this.currentLevelIndex];if(n&&(n.type===I.PlaylistContextType.AUDIO_TRACK&&g.audioGroupIds&&n.groupId===g.audioGroupIds[g.urlId]||n.type===I.PlaylistContextType.SUBTITLE_TRACK&&g.textGroupIds&&n.groupId===g.textGroupIds[g.urlId])){this.redundantFailover(this.currentLevelIndex);return}var r=!1,E=!0,P;switch(_.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:if(_.frag){var y=_.frag.type===I.PlaylistLevelType.MAIN?_.frag.level:this.currentLevelIndex,U=this._levels[y];U?(U.fragmentError++,U.fragmentError>this.hls.config.fragLoadingMaxRetry&&(P=y)):P=y}break;case k.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var B=g.attrs["HDCP-LEVEL"];B&&(this.hls.maxHdcpLevel=M.HdcpLevels[M.HdcpLevels.indexOf(B)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case k.ErrorDetails.FRAG_PARSING_ERROR:case k.ErrorDetails.KEY_SYSTEM_NO_SESSION:P=((u=_.frag)===null||u===void 0?void 0:u.type)===I.PlaylistLevelType.MAIN?_.frag.level:this.currentLevelIndex,_.levelRetry=!1;break;case k.ErrorDetails.LEVEL_LOAD_ERROR:case k.ErrorDetails.LEVEL_LOAD_TIMEOUT:n&&(n.deliveryDirectives&&(E=!1),P=n.level),r=!0;break;case k.ErrorDetails.REMUX_ALLOC_ERROR:P=(o=_.level)!=null?o:this.currentLevelIndex,r=!0;break}P!==void 0&&this.recoverLevel(_,P,r,E)}},m.recoverLevel=function(c,_,u,o){var n=c.details,g=this._levels[_];if(g.loadError++,u){var r=this.retryLoadingOrFail(c);if(r)c.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(o){var E=g.url.length;if(E>1&&g.loadError<E)c.levelRetry=!0,this.redundantFailover(_);else if(this.manualLevelIndex===-1){for(var P=-1,y=this._levels,U=y.length;U--;){var B=(U+this.currentLevelIndex)%y.length;if(B!==this.currentLevelIndex&&y[B].loadError===0){P=B;break}}P>-1&&this.currentLevelIndex!==P?(this.warn(n+": switch to "+P),c.levelRetry=!0,this.hls.nextAutoLevel=P):c.levelRetry===!1&&(c.fatal=!0)}}},m.redundantFailover=function(c){var _=this._levels[c],u=_.url.length;if(u>1){var o=(_.urlId+1)%u;this.warn("Switching to redundant URL-id "+o),this._levels.forEach(function(n){n.urlId=o}),this.level=c}},m.onFragLoaded=function(c,_){var u=_.frag;if(u!==void 0&&u.type===I.PlaylistLevelType.MAIN){var o=this._levels[u.level];o!==void 0&&(o.fragmentError=0,o.loadError=0)}},m.onLevelLoaded=function(c,_){var u,o=_.level,n=_.details,g=this._levels[o];if(!g){var r;this.warn("Invalid level index "+o),(r=_.deliveryDirectives)!==null&&r!==void 0&&r.skip&&(n.deltaUpdateFailed=!0);return}o===this.currentLevelIndex?(g.fragmentError===0&&(g.loadError=0,this.retryCount=0),this.playlistLoaded(o,_,g.details)):(u=_.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(n.deltaUpdateFailed=!0)},m.onAudioTrackSwitched=function(c,_){var u=this.hls.levels[this.currentLevelIndex];if(!!u&&u.audioGroupIds){for(var o=-1,n=this.hls.audioTracks[_.id].groupId,g=0;g<u.audioGroupIds.length;g++)if(u.audioGroupIds[g]===n){o=g;break}o!==u.urlId&&(u.urlId=o,this.startLoad())}},m.loadPlaylist=function(c){l.prototype.loadPlaylist.call(this);var _=this.currentLevelIndex,u=this._levels[_];if(this.canLoad&&u&&u.url.length>0){var o=u.urlId,n=u.url[o];if(c)try{n=c.addDirectives(n)}catch(g){this.warn("Could not construct new URL with HLS Delivery Directives: "+g)}this.log("Attempt loading level index "+_+((c==null?void 0:c.msn)!==void 0?" at sn "+c.msn+" part "+c.part:"")+" with URL-id "+o+" "+n),this.clearTimer(),this.hls.trigger(S.Events.LEVEL_LOADING,{url:n,level:_,id:o,deliveryDirectives:c||null})}},m.removeLevel=function(c,_){var u=function(g,r){return r!==_},o=this._levels.filter(function(n,g){return g!==c?!0:n.url.length>1&&_!==void 0?(n.url=n.url.filter(u),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(u)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(u)),n.urlId=0,!0):!1}).map(function(n,g){var r=n.details;return r!=null&&r.fragments&&r.fragments.forEach(function(E){E.level=g}),n});this._levels=o,this.hls.trigger(S.Events.LEVELS_UPDATED,{levels:o})},A(p,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(c){var _,u=this._levels;if(u.length!==0&&!(this.currentLevelIndex===c&&(_=u[c])!==null&&_!==void 0&&_.details)){if(c<0||c>=u.length){var o=c<0;if(this.hls.trigger(S.Events.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.LEVEL_SWITCH_ERROR,level:c,fatal:o,reason:"invalid level idx"}),o)return;c=Math.min(c,u.length-1)}this.clearTimer();var n=this.currentLevelIndex,g=u[n],r=u[c];this.log("switching to level "+c+" from "+n),this.currentLevelIndex=c;var E=C({},r,{level:c,maxBitrate:r.maxBitrate,uri:r.uri,urlId:r.urlId});delete E._urlId,this.hls.trigger(S.Events.LEVEL_SWITCHING,E);var P=r.details;if(!P||P.live){var y=this.switchParams(r.uri,g==null?void 0:g.details);this.loadPlaylist(y)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(c){this.manualLevelIndex=c,this._startLevel===void 0&&(this._startLevel=c),c!==-1&&(this.level=c)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(c){this._firstLevel=c}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var c=this.hls.config.startLevel;return c!==void 0?c:this._firstLevel}else return this._startLevel},set:function(c){this._startLevel=c}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(c){this.level=c,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=c)}}]),p}(b.default)},"./src/controller/level-helper.ts":(N,O,v)=>{v.r(O),v.d(O,{addGroupId:()=>K,addSliding:()=>f,adjustSliding:()=>d,assignTrackIdsByGroup:()=>b,computeReloadInterval:()=>i,getFragmentWithSN:()=>l,getPartWith:()=>p,mapFragmentIntersection:()=>T,mapPartIntersection:()=>D,mergeDetails:()=>A,updateFragPTSDTS:()=>L,updatePTS:()=>I});var M=v("./src/polyfills/number.ts"),S=v("./src/utils/logger.ts"),k=v("./src/loader/date-range.ts");function R(){return R=Object.assign?Object.assign.bind():function(m){for(var s=1;s<arguments.length;s++){var c=arguments[s];for(var _ in c)Object.prototype.hasOwnProperty.call(c,_)&&(m[_]=c[_])}return m},R.apply(this,arguments)}function K(m,s,c){switch(s){case"audio":m.audioGroupIds||(m.audioGroupIds=[]),m.audioGroupIds.push(c);break;case"text":m.textGroupIds||(m.textGroupIds=[]),m.textGroupIds.push(c);break}}function b(m){var s={};m.forEach(function(c){var _=c.groupId||"";c.id=s[_]=s[_]||0,s[_]++})}function I(m,s,c){var _=m[s],u=m[c];C(_,u)}function C(m,s){var c=s.startPTS;if((0,M.isFiniteNumber)(c)){var _=0,u;s.sn>m.sn?(_=c-m.start,u=m):(_=m.start-c,u=s),u.duration!==_&&(u.duration=_)}else if(s.sn>m.sn){var o=m.cc===s.cc;o&&m.minEndPTS?s.start=m.start+(m.minEndPTS-m.start):s.start=m.start+m.duration}else s.start=Math.max(m.start-s.duration,0)}function L(m,s,c,_,u,o){var n=_-c;n<=0&&(S.logger.warn("Fragment should have a positive duration",s),_=c+s.duration,o=u+s.duration);var g=c,r=_,E=s.startPTS,P=s.endPTS;if((0,M.isFiniteNumber)(E)){var y=Math.abs(E-c);(0,M.isFiniteNumber)(s.deltaPTS)?s.deltaPTS=Math.max(y,s.deltaPTS):s.deltaPTS=y,g=Math.max(c,E),c=Math.min(c,E),u=Math.min(u,s.startDTS),r=Math.min(_,P),_=Math.max(_,P),o=Math.max(o,s.endDTS)}s.duration=_-c;var U=c-s.start;s.start=s.startPTS=c,s.maxStartPTS=g,s.startDTS=u,s.endPTS=_,s.minEndPTS=r,s.endDTS=o;var B=s.sn;if(!m||B<m.startSN||B>m.endSN)return 0;var w,H=B-m.startSN,G=m.fragments;for(G[H]=s,w=H;w>0;w--)C(G[w],G[w-1]);for(w=H;w<G.length-1;w++)C(G[w],G[w+1]);return m.fragmentHint&&C(G[G.length-1],m.fragmentHint),m.PTSKnown=m.alignedSliding=!0,U}function A(m,s){for(var c=null,_=m.fragments,u=_.length-1;u>=0;u--){var o=_[u].initSegment;if(o){c=o;break}}m.fragmentHint&&delete m.fragmentHint.endPTS;var n=0,g;if(T(m,s,function(w,H){w.relurl&&(n=w.cc-H.cc),(0,M.isFiniteNumber)(w.startPTS)&&(0,M.isFiniteNumber)(w.endPTS)&&(H.start=H.startPTS=w.startPTS,H.startDTS=w.startDTS,H.appendedPTS=w.appendedPTS,H.maxStartPTS=w.maxStartPTS,H.endPTS=w.endPTS,H.endDTS=w.endDTS,H.minEndPTS=w.minEndPTS,H.duration=w.endPTS-w.startPTS,H.duration&&(g=H),s.PTSKnown=s.alignedSliding=!0),H.elementaryStreams=w.elementaryStreams,H.loader=w.loader,H.stats=w.stats,H.urlId=w.urlId,w.initSegment&&(H.initSegment=w.initSegment,c=w.initSegment)}),c){var r=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments;r.forEach(function(w){var H;(!w.initSegment||w.initSegment.relurl===((H=c)===null||H===void 0?void 0:H.relurl))&&(w.initSegment=c)})}if(s.skippedSegments)if(s.deltaUpdateFailed=s.fragments.some(function(w){return!w}),s.deltaUpdateFailed){S.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var E=s.skippedSegments;E--;)s.fragments.shift();s.startSN=s.fragments[0].sn,s.startCC=s.fragments[0].cc}else s.canSkipDateRanges&&(s.dateRanges=h(m.dateRanges,s.dateRanges,s.recentlyRemovedDateranges));var P=s.fragments;if(n){S.logger.warn("discontinuity sliding from playlist, take drift into account");for(var y=0;y<P.length;y++)P[y].cc+=n}s.skippedSegments&&(s.startCC=s.fragments[0].cc),D(m.partList,s.partList,function(w,H){H.elementaryStreams=w.elementaryStreams,H.stats=w.stats}),g?L(s,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):d(m,s),P.length&&(s.totalduration=s.edge-P[0].start),s.driftStartTime=m.driftStartTime,s.driftStart=m.driftStart;var U=s.advancedDateTime;if(s.advanced&&U){var B=s.edge;s.driftStart||(s.driftStartTime=U,s.driftStart=B),s.driftEndTime=U,s.driftEnd=B}else s.driftEndTime=m.driftEndTime,s.driftEnd=m.driftEnd,s.advancedDateTime=m.advancedDateTime}function h(m,s,c){var _=R({},m);return c&&c.forEach(function(u){delete _[u]}),Object.keys(s).forEach(function(u){var o=new k.DateRange(s[u].attr,_[u]);o.isValid?_[u]=o:S.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(s[u].attr)+'"')}),_}function D(m,s,c){if(m&&s)for(var _=0,u=0,o=m.length;u<=o;u++){var n=m[u],g=s[u+_];n&&g&&n.index===g.index&&n.fragment.sn===g.fragment.sn?c(n,g):_--}}function T(m,s,c){for(var _=s.skippedSegments,u=Math.max(m.startSN,s.startSN)-s.startSN,o=(m.fragmentHint?1:0)+(_?s.endSN:Math.min(m.endSN,s.endSN))-s.startSN,n=s.startSN-m.startSN,g=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,r=m.fragmentHint?m.fragments.concat(m.fragmentHint):m.fragments,E=u;E<=o;E++){var P=r[n+E],y=g[E];_&&!y&&E<_&&(y=s.fragments[E]=P),P&&y&&c(P,y)}}function d(m,s){var c=s.startSN+s.skippedSegments-m.startSN,_=m.fragments;c<0||c>=_.length||f(s,_[c].start)}function f(m,s){if(s){for(var c=m.fragments,_=m.skippedSegments;_<c.length;_++)c[_].start+=s;m.fragmentHint&&(m.fragmentHint.start+=s)}}function i(m,s){s===void 0&&(s=1/0);var c=1e3*m.targetduration;if(m.updated){var _=m.fragments,u=4;if(_.length&&c*u>s){var o=_[_.length-1].duration*1e3;o<c&&(c=o)}}else c/=2;return Math.round(c)}function l(m,s,c){if(!m||!m.details)return null;var _=m.details,u=_.fragments[s-_.startSN];return u||(u=_.fragmentHint,u&&u.sn===s)?u:s<_.startSN&&c&&c.sn===s?c:null}function p(m,s,c){if(!m||!m.details)return null;var _=m.details.partList;if(_)for(var u=_.length;u--;){var o=_[u];if(o.index===c&&o.fragment.sn===s)return o}return null}},"./src/controller/stream-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>s});var M=v("./src/polyfills/number.ts"),S=v("./src/controller/base-stream-controller.ts"),k=v("./src/is-supported.ts"),R=v("./src/events.ts"),K=v("./src/utils/buffer-helper.ts"),b=v("./src/controller/fragment-tracker.ts"),I=v("./src/types/loader.ts"),C=v("./src/loader/fragment.ts"),L=v("./src/demux/transmuxer-interface.ts"),A=v("./src/types/transmuxer.ts"),h=v("./src/controller/gap-controller.ts"),D=v("./src/errors.ts");function T(c,_){for(var u=0;u<_.length;u++){var o=_[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(c,f(o.key),o)}}function d(c,_,u){return _&&T(c.prototype,_),u&&T(c,u),Object.defineProperty(c,"prototype",{writable:!1}),c}function f(c){var _=i(c,"string");return typeof _=="symbol"?_:String(_)}function i(c,_){if(typeof c!="object"||c===null)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var o=u.call(c,_||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(c)}function l(c,_){c.prototype=Object.create(_.prototype),c.prototype.constructor=c,p(c,_)}function p(c,_){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,n){return o.__proto__=n,o},p(c,_)}var m=100,s=function(c){l(_,c);function _(o,n,g){var r;return r=c.call(this,o,n,g,"[stream-controller]")||this,r.audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.couldBacktrack=!1,r.backtrackFragment=null,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}var u=_.prototype;return u._registerListeners=function(){var n=this.hls;n.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),n.on(R.Events.ERROR,this.onError,this),n.on(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(R.Events.BUFFER_CREATED,this.onBufferCreated,this),n.on(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.on(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),n.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var n=this.hls;n.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),n.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),n.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(R.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),n.off(R.Events.ERROR,this.onError,this),n.off(R.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),n.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(R.Events.BUFFER_CREATED,this.onBufferCreated,this),n.off(R.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),n.off(R.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),n.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this)},u.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},u.startLoad=function(n){if(this.levels){var g=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(m),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var E=r.startLevel;E===-1&&(r.config.testBandwidth&&this.levels.length>1?(E=0,this.bitrateTest=!0):E=r.nextAutoLevel),this.level=r.nextLoadLevel=E,this.loadedmetadata=!1}g>0&&n===-1&&(this.log("Override startPosition with lastCurrentTime @"+g.toFixed(3)),n=g),this.state=S.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=n,this.tick()}else this._forceStartLoad=!0,this.state=S.State.STOPPED},u.stopLoad=function(){this._forceStartLoad=!1,c.prototype.stopLoad.call(this)},u.doTick=function(){switch(this.state){case S.State.IDLE:this.doTickIdle();break;case S.State.WAITING_LEVEL:{var n,g=this.levels,r=this.level,E=g==null||(n=g[r])===null||n===void 0?void 0:n.details;if(E&&(!E.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(E))break;this.state=S.State.IDLE;break}break}case S.State.FRAG_LOADING_WAITING_RETRY:{var P,y=self.performance.now(),U=this.retryDate;(!U||y>=U||(P=this.media)!==null&&P!==void 0&&P.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=S.State.IDLE)}break}this.onTickEnd()},u.onTickEnd=function(){c.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},u.doTickIdle=function(){var n=this.hls,g=this.levelLastLoaded,r=this.levels,E=this.media,P=n.config,y=n.nextLoadLevel;if(!(g===null||!E&&(this.startFragRequested||!P.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!r||!r[y])){var U=r[y],B=this.getMainFwdBufferInfo();if(B!==null){var w=this.getLevelDetails();if(w&&this._streamEnded(B,w)){var H={};this.altAudio&&(H.type="video"),this.hls.trigger(R.Events.BUFFER_EOS,H),this.state=S.State.ENDED;return}this.level=n.nextLoadLevel=y;var G=U.details;if(!G||this.state===S.State.WAITING_LEVEL||G.live&&this.levelLastLoaded!==y){this.level=y,this.state=S.State.WAITING_LEVEL;return}var V=B.len,z=this.getMaxBufferLength(U.maxBitrate);if(!(V>=z)){this.backtrackFragment&&this.backtrackFragment.start>B.end&&(this.backtrackFragment=null);var $=this.backtrackFragment?this.backtrackFragment.start:B.end,X=this.getNextFragment($,G);if(this.couldBacktrack&&!this.fragPrevious&&X&&X.sn!=="initSegment"&&this.fragmentTracker.getState(X)!==b.FragmentState.OK){var j,Y=((j=this.backtrackFragment)!=null?j:X).sn,Q=Y-G.startSN,J=G.fragments[Q-1];J&&X.cc===J.cc&&(X=J,this.fragmentTracker.removeFragment(J))}else this.backtrackFragment&&B.len&&(this.backtrackFragment=null);if(X&&this.fragmentTracker.getState(X)===b.FragmentState.OK&&this.nextLoadPosition>$){var Z=this.audioOnly&&!this.altAudio?C.ElementaryStreamTypes.AUDIO:C.ElementaryStreamTypes.VIDEO,ee=(Z===C.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;ee&&this.afterBufferFlushed(ee,Z,I.PlaylistLevelType.MAIN),X=this.getNextFragment(this.nextLoadPosition,G)}!X||(X.initSegment&&!X.initSegment.data&&!this.bitrateTest&&(X=X.initSegment),this.loadFragment(X,G,$))}}}},u.loadFragment=function(n,g,r){var E,P=this.fragmentTracker.getState(n);this.fragCurrent=n,P===b.FragmentState.NOT_LOADED?n.sn==="initSegment"?this._loadInitSegment(n,g):this.bitrateTest?(this.log("Fragment "+n.sn+" of level "+n.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(n,g)):(this.startFragRequested=!0,c.prototype.loadFragment.call(this,n,g,r)):P===b.FragmentState.APPENDING?this.reduceMaxBufferLength(n.duration)&&this.fragmentTracker.removeFragment(n):((E=this.media)===null||E===void 0?void 0:E.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},u.getAppendedFrag=function(n){var g=this.fragmentTracker.getAppendedFrag(n,I.PlaylistLevelType.MAIN);return g&&"fragment"in g?g.fragment:g},u.getBufferedFrag=function(n){return this.fragmentTracker.getBufferedFrag(n,I.PlaylistLevelType.MAIN)},u.followingBufferedFrag=function(n){return n?this.getBufferedFrag(n.end+.5):null},u.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},u.nextLevelSwitch=function(){var n=this.levels,g=this.media;if(g!=null&&g.readyState){var r,E=this.getAppendedFrag(g.currentTime);if(E&&E.start>1&&this.flushMainBuffer(0,E.start-1),!g.paused&&n){var P=this.hls.nextLoadLevel,y=n[P],U=this.fragLastKbps;U&&this.fragCurrent?r=this.fragCurrent.duration*y.maxBitrate/(1e3*U)+1:r=0}else r=0;var B=this.getBufferedFrag(g.currentTime+r);if(B){var w=this.followingBufferedFrag(B);if(w){this.abortCurrentFrag();var H=w.maxStartPTS?w.maxStartPTS:w.start,G=w.duration,V=Math.max(B.end,H+Math.min(Math.max(G-this.config.maxFragLookUpTolerance,G*.5),G*.75));this.flushMainBuffer(V,Number.POSITIVE_INFINITY)}}}},u.abortCurrentFrag=function(){var n=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,n&&n.abortRequests(),this.state){case S.State.KEY_LOADING:case S.State.FRAG_LOADING:case S.State.FRAG_LOADING_WAITING_RETRY:case S.State.PARSING:case S.State.PARSED:this.state=S.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},u.flushMainBuffer=function(n,g){c.prototype.flushMainBuffer.call(this,n,g,this.altAudio?"video":null)},u.onMediaAttached=function(n,g){c.prototype.onMediaAttached.call(this,n,g);var r=g.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new h.default(this.config,r,this.fragmentTracker,this.hls)},u.onMediaDetaching=function(){var n=this.media;n&&this.onvplaying&&this.onvseeked&&(n.removeEventListener("playing",this.onvplaying),n.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),c.prototype.onMediaDetaching.call(this)},u.onMediaPlaying=function(){this.tick()},u.onMediaSeeked=function(){var n=this.media,g=n?n.currentTime:null;(0,M.isFiniteNumber)(g)&&this.log("Media seeked to "+g.toFixed(3)),this.tick()},u.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(R.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},u.onManifestParsed=function(n,g){var r=!1,E=!1,P;g.levels.forEach(function(y){P=y.audioCodec,P&&(P.indexOf("mp4a.40.2")!==-1&&(r=!0),P.indexOf("mp4a.40.5")!==-1&&(E=!0))}),this.audioCodecSwitch=r&&E&&!(0,k.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=g.levels,this.startFragRequested=!1},u.onLevelLoading=function(n,g){var r=this.levels;if(!(!r||this.state!==S.State.IDLE)){var E=r[g.level];(!E.details||E.details.live&&this.levelLastLoaded!==g.level||this.waitForCdnTuneIn(E.details))&&(this.state=S.State.WAITING_LEVEL)}},u.onLevelLoaded=function(n,g){var r,E=this.levels,P=g.level,y=g.details,U=y.totalduration;if(!E){this.warn("Levels were reset while loading level "+P);return}this.log("Level "+P+" loaded ["+y.startSN+","+y.endSN+"], cc ["+y.startCC+", "+y.endCC+"] duration:"+U);var B=this.fragCurrent;B&&(this.state===S.State.FRAG_LOADING||this.state===S.State.FRAG_LOADING_WAITING_RETRY)&&B.level!==g.level&&B.loader&&(this.state=S.State.IDLE,this.backtrackFragment=null,B.abortRequests());var w=E[P],H=0;if(y.live||(r=w.details)!==null&&r!==void 0&&r.live){if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed)return;H=this.alignPlaylists(y,w.details)}if(w.details=y,this.levelLastLoaded=P,this.hls.trigger(R.Events.LEVEL_UPDATED,{details:y,level:P}),this.state===S.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(y))return;this.state=S.State.IDLE}this.startFragRequested?y.live&&this.synchronizeToLiveEdge(y):this.setStartPosition(y,H),this.tick()},u._handleFragmentLoadProgress=function(n){var g,r=n.frag,E=n.part,P=n.payload,y=this.levels;if(!y){this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered");return}var U=y[r.level],B=U.details;if(!B){this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset");return}var w=U.videoCodec,H=B.PTSKnown||!B.live,G=(g=r.initSegment)===null||g===void 0?void 0:g.data,V=this._getAudioCodec(U),z=this.transmuxer=this.transmuxer||new L.default(this.hls,I.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),$=E?E.index:-1,X=$!==-1,j=new A.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,P.byteLength,$,X),Y=this.initPTS[r.cc];z.push(P,G,V,w,r,E,B.totalduration,H,j,Y)},u.onAudioTrackSwitching=function(n,g){var r=this.altAudio,E=!!g.url,P=g.id;if(!E){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var y=this.fragCurrent;y&&(this.log("Switching to main audio track, cancel main fragment load"),y.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var U=this.hls;r&&U.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),U.trigger(R.Events.AUDIO_TRACK_SWITCHED,{id:P})}},u.onAudioTrackSwitched=function(n,g){var r=g.id,E=!!this.hls.audioTracks[r].url;if(E){var P=this.videoBuffer;P&&this.mediaBuffer!==P&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=P)}this.altAudio=E,this.tick()},u.onBufferCreated=function(n,g){var r=g.tracks,E,P,y=!1;for(var U in r){var B=r[U];if(B.id==="main"){if(P=U,E=B,U==="video"){var w=r[U];w&&(this.videoBuffer=w.buffer)}}else y=!0}y&&E?(this.log("Alternate track found, use "+P+".buffered to schedule main fragment loading"),this.mediaBuffer=E.buffer):this.mediaBuffer=this.media},u.onFragBuffered=function(n,g){var r=g.frag,E=g.part;if(!(r&&r.type!==I.PlaylistLevelType.MAIN)){if(this.fragContextChanged(r)){this.warn("Fragment "+r.sn+(E?" p: "+E.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),this.state===S.State.PARSED&&(this.state=S.State.IDLE);return}var P=E?E.stats:r.stats;this.fragLastKbps=Math.round(8*P.total/(P.buffering.end-P.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,E)}},u.onError=function(n,g){if(g.type===D.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(I.PlaylistLevelType.MAIN,g);return}switch(g.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.FRAG_PARSING_ERROR:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(I.PlaylistLevelType.MAIN,g);break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==S.State.ERROR&&(g.fatal?(this.warn(""+g.details),this.state=S.State.ERROR):!g.levelRetry&&this.state===S.State.WAITING_LEVEL&&(this.state=S.State.IDLE));break;case D.ErrorDetails.BUFFER_FULL_ERROR:if(g.parent==="main"&&(this.state===S.State.PARSING||this.state===S.State.PARSED)){var r=!0,E=this.getFwdBufferInfo(this.media,I.PlaylistLevelType.MAIN);E&&E.len>.5&&(r=!this.reduceMaxBufferLength(E.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},u.checkBuffer=function(){var n=this.media,g=this.gapController;if(!(!n||!g||!n.readyState)){if(this.loadedmetadata||!K.BufferHelper.getBuffered(n).length){var r=this.state!==S.State.IDLE?this.fragCurrent:null;g.poll(this.lastCurrentTime,r)}this.lastCurrentTime=n.currentTime}},u.onFragLoadEmergencyAborted=function(){this.state=S.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},u.onBufferFlushed=function(n,g){var r=g.type;if(r!==C.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var E=(r===C.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(E,r,I.PlaylistLevelType.MAIN)}},u.onLevelsUpdated=function(n,g){this.levels=g.levels},u.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},u.seekToStartPos=function(){var n=this.media;if(!!n){var g=n.currentTime,r=this.startPosition;if(r>=0&&g<r){if(n.seeking){this.log("could not seek to "+r+", already seeking at "+g);return}var E=K.BufferHelper.getBuffered(n),P=E.length?E.start(0):0,y=P-r;y>0&&(y<this.config.maxBufferHole||y<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+y+" to match buffer start"),r+=y,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+g),n.currentTime=r}}},u._getAudioCodec=function(n){var g=this.config.defaultAudioCodec||n.audioCodec;return this.audioCodecSwap&&g&&(this.log("Swapping audio codec"),g.indexOf("mp4a.40.5")!==-1?g="mp4a.40.2":g="mp4a.40.5"),g},u._loadBitrateTestFrag=function(n,g){var r=this;n.bitrateTest=!0,this._doFragLoad(n,g).then(function(E){var P=r.hls;if(!(!E||r.fragContextChanged(n))){r.fragLoadError=0,r.state=S.State.IDLE,r.startFragRequested=!1,r.bitrateTest=!1;var y=n.stats;y.parsing.start=y.parsing.end=y.buffering.start=y.buffering.end=self.performance.now(),P.trigger(R.Events.FRAG_LOADED,E),n.bitrateTest=!1}})},u._handleTransmuxComplete=function(n){var g,r="main",E=this.hls,P=n.remuxResult,y=n.chunkMeta,U=this.getCurrentContext(y);if(!U){this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(y.level);return}var B=U.frag,w=U.part,H=U.level,G=P.video,V=P.text,z=P.id3,$=P.initSegment,X=H.details,j=this.altAudio?void 0:P.audio;if(!this.fragContextChanged(B)){if(this.state=S.State.PARSING,$){$.tracks&&(this._bufferInitSegment(H,$.tracks,B,y),E.trigger(R.Events.FRAG_PARSING_INIT_SEGMENT,{frag:B,id:r,tracks:$.tracks}));var Y=$.initPTS,Q=$.timescale;(0,M.isFiniteNumber)(Y)&&(this.initPTS[B.cc]=Y,E.trigger(R.Events.INIT_PTS_FOUND,{frag:B,id:r,initPTS:Y,timescale:Q}))}if(G&&P.independent!==!1){if(X){var J=G.startPTS,Z=G.endPTS,ee=G.startDTS,ne=G.endDTS;if(w)w.elementaryStreams[G.type]={startPTS:J,endPTS:Z,startDTS:ee,endDTS:ne};else if(G.firstKeyFrame&&G.independent&&y.id===1&&(this.couldBacktrack=!0),G.dropped&&G.independent){var te=this.getMainFwdBufferInfo(),q=(te?te.end:this.getLoadPosition())+this.config.maxBufferHole,re=G.firstKeyFramePTS?G.firstKeyFramePTS:J;if(q<re-this.config.maxBufferHole){this.backtrack(B);return}B.setElementaryStreamInfo(G.type,B.start,Z,B.start,ne,!0)}B.setElementaryStreamInfo(G.type,J,Z,ee,ne),this.backtrackFragment&&(this.backtrackFragment=B),this.bufferFragmentData(G,B,w,y)}}else if(P.independent===!1){this.backtrack(B);return}if(j){var se=j.startPTS,ie=j.endPTS,ae=j.startDTS,oe=j.endDTS;w&&(w.elementaryStreams[C.ElementaryStreamTypes.AUDIO]={startPTS:se,endPTS:ie,startDTS:ae,endDTS:oe}),B.setElementaryStreamInfo(C.ElementaryStreamTypes.AUDIO,se,ie,ae,oe),this.bufferFragmentData(j,B,w,y)}if(X&&z!==null&&z!==void 0&&(g=z.samples)!==null&&g!==void 0&&g.length){var le={id:r,frag:B,details:X,samples:z.samples};E.trigger(R.Events.FRAG_PARSING_METADATA,le)}if(X&&V){var ue={id:r,frag:B,details:X,samples:V.samples};E.trigger(R.Events.FRAG_PARSING_USERDATA,ue)}}},u._bufferInitSegment=function(n,g,r,E){var P=this;if(this.state===S.State.PARSING){this.audioOnly=!!g.audio&&!g.video,this.altAudio&&!this.audioOnly&&delete g.audio;var y=g.audio,U=g.video,B=g.audiovideo;if(y){var w=n.audioCodec,H=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(w&&(w.indexOf("mp4a.40.5")!==-1?w="mp4a.40.2":w="mp4a.40.5"),y.metadata.channelCount!==1&&H.indexOf("firefox")===-1&&(w="mp4a.40.5")),H.indexOf("android")!==-1&&y.container!=="audio/mpeg"&&(w="mp4a.40.2",this.log("Android: force audio codec to "+w)),n.audioCodec&&n.audioCodec!==w&&this.log('Swapping manifest audio codec "'+n.audioCodec+'" for "'+w+'"'),y.levelCodec=w,y.id="main",this.log("Init audio buffer, container:"+y.container+", codecs[selected/level/parsed]=["+(w||"")+"/"+(n.audioCodec||"")+"/"+y.codec+"]")}U&&(U.levelCodec=n.videoCodec,U.id="main",this.log("Init video buffer, container:"+U.container+", codecs[level/parsed]=["+(n.videoCodec||"")+"/"+U.codec+"]")),B&&this.log("Init audiovideo buffer, container:"+B.container+", codecs[level/parsed]=["+(n.attrs.CODECS||"")+"/"+B.codec+"]"),this.hls.trigger(R.Events.BUFFER_CODECS,g),Object.keys(g).forEach(function(G){var V=g[G],z=V.initSegment;z!=null&&z.byteLength&&P.hls.trigger(R.Events.BUFFER_APPENDING,{type:G,data:z,frag:r,part:null,chunkMeta:E,parent:r.type})}),this.tick()}},u.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,I.PlaylistLevelType.MAIN)},u.backtrack=function(n){this.couldBacktrack=!0,this.backtrackFragment=n,this.resetTransmuxer(),this.flushBufferGap(n),this.fragmentTracker.removeFragment(n),this.fragPrevious=null,this.nextLoadPosition=n.start,this.state=S.State.IDLE},u.checkFragmentChanged=function(){var n=this.media,g=null;if(n&&n.readyState>1&&n.seeking===!1){var r=n.currentTime;if(K.BufferHelper.isBuffered(n,r)?g=this.getAppendedFrag(r):K.BufferHelper.isBuffered(n,r+.1)&&(g=this.getAppendedFrag(r+.1)),g){this.backtrackFragment=null;var E=this.fragPlaying,P=g.level;(!E||g.sn!==E.sn||E.level!==P||g.urlId!==E.urlId)&&(this.fragPlaying=g,this.hls.trigger(R.Events.FRAG_CHANGED,{frag:g}),(!E||E.level!==P)&&this.hls.trigger(R.Events.LEVEL_SWITCHED,{level:P}))}}},d(_,[{key:"nextLevel",get:function(){var n=this.nextBufferedFrag;return n?n.level:-1}},{key:"currentFrag",get:function(){var n=this.media;return n?this.fragPlaying||this.getAppendedFrag(n.currentTime):null}},{key:"currentProgramDateTime",get:function(){var n=this.media;if(n){var g=n.currentTime,r=this.currentFrag;if(r&&(0,M.isFiniteNumber)(g)&&(0,M.isFiniteNumber)(r.programDateTime)){var E=r.programDateTime+(g-r.start)*1e3;return new Date(E)}}return null}},{key:"currentLevel",get:function(){var n=this.currentFrag;return n?n.level:-1}},{key:"nextBufferedFrag",get:function(){var n=this.currentFrag;return n?this.followingBufferedFrag(n):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),_}(S.default)},"./src/controller/subtitle-stream-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{SubtitleStreamController:()=>l});var M=v("./src/events.ts"),S=v("./src/utils/buffer-helper.ts"),k=v("./src/controller/fragment-finders.ts"),R=v("./src/utils/discontinuities.ts"),K=v("./src/controller/level-helper.ts"),b=v("./src/controller/fragment-tracker.ts"),I=v("./src/controller/base-stream-controller.ts"),C=v("./src/types/loader.ts"),L=v("./src/types/level.ts");function A(m,s){for(var c=0;c<s.length;c++){var _=s[c];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(m,D(_.key),_)}}function h(m,s,c){return s&&A(m.prototype,s),c&&A(m,c),Object.defineProperty(m,"prototype",{writable:!1}),m}function D(m){var s=T(m,"string");return typeof s=="symbol"?s:String(s)}function T(m,s){if(typeof m!="object"||m===null)return m;var c=m[Symbol.toPrimitive];if(c!==void 0){var _=c.call(m,s||"default");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(m)}function d(m,s){m.prototype=Object.create(s.prototype),m.prototype.constructor=m,f(m,s)}function f(m,s){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,u){return _.__proto__=u,_},f(m,s)}var i=500,l=function(m){d(s,m);function s(_,u,o){var n;return n=m.call(this,_,u,o,"[subtitle-stream-controller]")||this,n.levels=[],n.currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n._registerListeners(),n}var c=s.prototype;return c.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},c._registerListeners=function(){var u=this.hls;u.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(M.Events.ERROR,this.onError,this),u.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),u.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),u.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c._unregisterListeners=function(){var u=this.hls;u.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(M.Events.ERROR,this.onError,this),u.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),u.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),u.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),u.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this)},c.startLoad=function(u){this.stopLoad(),this.state=I.State.IDLE,this.setInterval(i),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()},c.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},c.onLevelLoaded=function(u,o){this.mainDetails=o.details},c.onSubtitleFragProcessed=function(u,o){var n=o.frag,g=o.success;if(this.fragPrevious=n,this.state=I.State.IDLE,!!g){var r=this.tracksBuffered[this.currentTrackId];if(!!r){for(var E,P=n.start,y=0;y<r.length;y++)if(P>=r[y].start&&P<=r[y].end){E=r[y];break}var U=n.start+n.duration;E?E.end=U:(E={start:P,end:U},r.push(E)),this.fragmentTracker.fragBuffered(n)}}},c.onBufferFlushing=function(u,o){var n=o.startOffset,g=o.endOffset;if(n===0&&g!==Number.POSITIVE_INFINITY){var r=this.currentTrackId,E=this.levels;if(!E.length||!E[r]||!E[r].details)return;var P=E[r].details,y=P.targetduration,U=g-y;if(U<=0)return;o.endOffsetSubtitles=Math.max(0,U),this.tracksBuffered.forEach(function(B){for(var w=0;w<B.length;){if(B[w].end<=U){B.shift();continue}else if(B[w].start<U)B[w].start=U;else break;w++}}),this.fragmentTracker.removeFragmentsInRange(n,U,C.PlaylistLevelType.SUBTITLE)}},c.onFragBuffered=function(u,o){if(!this.loadedmetadata&&o.frag.type===C.PlaylistLevelType.MAIN){var n;(n=this.media)!==null&&n!==void 0&&n.buffered.length&&(this.loadedmetadata=!0)}},c.onError=function(u,o){var n=o.frag;!n||n.type!==C.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=I.State.IDLE)},c.onSubtitleTracksUpdated=function(u,o){var n=this,g=o.subtitleTracks;this.tracksBuffered=[],this.levels=g.map(function(r){return new L.Level(r)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(r){n.tracksBuffered[r.id]=[]}),this.mediaBuffer=null},c.onSubtitleTrackSwitch=function(u,o){if(this.currentTrackId=o.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.setInterval(i)},c.onSubtitleTrackLoaded=function(u,o){var n,g=o.details,r=o.id,E=this.currentTrackId,P=this.levels;if(!!P.length){var y=P[E];if(!(r>=P.length||r!==E||!y)){this.mediaBuffer=this.mediaBufferTimeRanges;var U=0;if(g.live||(n=y.details)!==null&&n!==void 0&&n.live){var B=this.mainDetails;if(g.deltaUpdateFailed||!B)return;var w=B.fragments[0];y.details?(U=this.alignPlaylists(g,y.details),U===0&&w&&(U=w.start,(0,K.addSliding)(g,U))):g.hasProgramDateTime&&B.hasProgramDateTime?((0,R.alignMediaPlaylistByPDT)(g,B),U=g.fragments[0].start):w&&(U=w.start,(0,K.addSliding)(g,U))}if(y.details=g,this.levelLastLoaded=r,!this.startFragRequested&&(this.mainDetails||!g.live)&&this.setStartPosition(y.details,U),this.tick(),g.live&&!this.fragCurrent&&this.media&&this.state===I.State.IDLE){var H=(0,k.findFragmentByPTS)(null,g.fragments,this.media.currentTime,0);H||(this.warn("Subtitle playlist not aligned with playback"),y.details=void 0)}}}},c._handleFragmentLoadComplete=function(u){var o=this,n=u.frag,g=u.payload,r=n.decryptdata,E=this.hls;if(!this.fragContextChanged(n)&&g&&g.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var P=performance.now();this.decrypter.decrypt(new Uint8Array(g),r.key.buffer,r.iv.buffer).then(function(y){var U=performance.now();E.trigger(M.Events.FRAG_DECRYPTED,{frag:n,payload:y,stats:{tstart:P,tdecrypt:U}})}).catch(function(y){o.warn(y.name+": "+y.message),o.state=I.State.IDLE})}},c.doTick=function(){if(!this.media){this.state=I.State.IDLE;return}if(this.state===I.State.IDLE){var u=this.currentTrackId,o=this.levels;if(!o.length||!o[u]||!o[u].details)return;var n=o[u].details,g=n.targetduration,r=this.config,E=this.getLoadPosition(),P=S.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],E-g,r.maxBufferHole),y=P.end,U=P.len,B=this.getFwdBufferInfo(this.media,C.PlaylistLevelType.MAIN),w=this.getMaxBufferLength(B==null?void 0:B.len)+g;if(U>w)return;console.assert(n,"Subtitle track details are defined on idle subtitle stream controller tick");var H=n.fragments,G=H.length,V=n.edge,z=null,$=this.fragPrevious;if(y<V){var X=r.maxFragLookUpTolerance;z=(0,k.findFragmentByPTS)($,H,Math.max(H[0].start,y),X),!z&&$&&$.start<H[0].start&&(z=H[0])}else z=H[G-1];if(!z)return;z=this.mapToInitFragWhenRequired(z),this.fragmentTracker.getState(z)===b.FragmentState.NOT_LOADED&&this.loadFragment(z,n,y)}},c.getMaxBufferLength=function(u){var o=m.prototype.getMaxBufferLength.call(this);return u?Math.max(o,u):o},c.loadFragment=function(u,o,n){this.fragCurrent=u,u.sn==="initSegment"?this._loadInitSegment(u,o):(this.startFragRequested=!0,m.prototype.loadFragment.call(this,u,o,n))},h(s,[{key:"mediaBufferTimeRanges",get:function(){return new p(this.tracksBuffered[this.currentTrackId]||[])}}]),s}(I.default),p=function(s){this.buffered=void 0;var c=function(u,o,n){if(o=o>>>0,o>n-1)throw new DOMException("Failed to execute '"+u+"' on 'TimeRanges': The index provided ("+o+") is greater than the maximum bound ("+n+")");return s[o][u]};this.buffered={get length(){return s.length},end:function(u){return c("end",u,s.length)},start:function(u){return c("start",u,s.length)}}}},"./src/controller/subtitle-track-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>T});var M=v("./src/events.ts"),S=v("./src/utils/texttrack-utils.ts"),k=v("./src/controller/base-playlist-controller.ts"),R=v("./src/types/loader.ts");function K(d,f){for(var i=0;i<f.length;i++){var l=f[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,I(l.key),l)}}function b(d,f,i){return f&&K(d.prototype,f),i&&K(d,i),Object.defineProperty(d,"prototype",{writable:!1}),d}function I(d){var f=C(d,"string");return typeof f=="symbol"?f:String(f)}function C(d,f){if(typeof d!="object"||d===null)return d;var i=d[Symbol.toPrimitive];if(i!==void 0){var l=i.call(d,f||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(d)}function L(d,f){d.prototype=Object.create(f.prototype),d.prototype.constructor=d,A(d,f)}function A(d,f){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,p){return l.__proto__=p,l},A(d,f)}var h=function(d){L(f,d);function f(l){var p;return p=d.call(this,l,"[subtitle-track-controller]")||this,p.media=null,p.tracks=[],p.groupId=null,p.tracksInGroup=[],p.trackId=-1,p.selectDefaultTrack=!0,p.queuedDefaultTrack=-1,p.trackChangeListener=function(){return p.onTextTracksChanged()},p.asyncPollTrackChange=function(){return p.pollTrackChange(0)},p.useTextTrackPolling=!1,p.subtitlePollingInterval=-1,p._subtitleDisplay=!0,p.registerListeners(),p}var i=f.prototype;return i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,d.prototype.destroy.call(this)},i.registerListeners=function(){var p=this.hls;p.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),p.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),p.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),p.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.on(M.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var p=this.hls;p.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),p.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),p.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),p.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.off(M.Events.ERROR,this.onError,this)},i.onMediaAttached=function(p,m){this.media=m.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},i.pollTrackChange=function(p){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,p)},i.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var p=D(this.media.textTracks);p.forEach(function(m){(0,S.clearCurrentCues)(m)}),this.subtitleTrack=-1,this.media=null}},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},i.onManifestParsed=function(p,m){this.tracks=m.subtitleTracks},i.onSubtitleTrackLoaded=function(p,m){var s=m.id,c=m.details,_=this.trackId,u=this.tracksInGroup[_];if(!u){this.warn("Invalid subtitle track id "+s);return}var o=u.details;u.details=m.details,this.log("subtitle track "+s+" loaded ["+c.startSN+"-"+c.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,m,o))},i.onLevelLoading=function(p,m){this.switchLevel(m.level)},i.onLevelSwitching=function(p,m){this.switchLevel(m.level)},i.switchLevel=function(p){var m=this.hls.levels[p];if(!!(m!=null&&m.textGroupIds)){var s=m.textGroupIds[m.urlId];if(this.groupId!==s){var c=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,_=this.tracks.filter(function(n){return!s||n.groupId===s});this.tracksInGroup=_;var u=this.findTrackId(c==null?void 0:c.name)||this.findTrackId();this.groupId=s;var o={subtitleTracks:_};this.log("Updating subtitle tracks, "+_.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,o),u!==-1&&this.setSubtitleTrack(u,c)}}},i.findTrackId=function(p){for(var m=this.tracksInGroup,s=0;s<m.length;s++){var c=m[s];if((!this.selectDefaultTrack||c.default)&&(!p||p===c.name))return c.id}return-1},i.onError=function(p,m){d.prototype.onError.call(this,p,m),!(m.fatal||!m.context)&&m.context.type===R.PlaylistContextType.SUBTITLE_TRACK&&m.context.id===this.trackId&&m.context.groupId===this.groupId&&this.retryLoadingOrFail(m)},i.loadPlaylist=function(p){d.prototype.loadPlaylist.call(this);var m=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(m)){var s=m.id,c=m.groupId,_=m.url;if(p)try{_=p.addDirectives(_)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("Loading subtitle playlist for id "+s),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:_,id:s,groupId:c,deliveryDirectives:p||null})}},i.toggleTrackModes=function(p){var m=this,s=this.media,c=this.trackId;if(!!s){var _=D(s.textTracks),u=_.filter(function(g){return g.groupId===m.groupId});if(p===-1)[].slice.call(_).forEach(function(g){g.mode="disabled"});else{var o=u[c];o&&(o.mode="disabled")}var n=u[p];n&&(n.mode=this.subtitleDisplay?"showing":"hidden")}},i.setSubtitleTrack=function(p,m){var s,c=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=p;return}if(this.trackId!==p&&this.toggleTrackModes(p),!(this.trackId===p&&(p===-1||(s=c[p])!==null&&s!==void 0&&s.details)||p<-1||p>=c.length)){this.clearTimer();var _=c[p];if(this.log("Switching to subtitle track "+p),this.trackId=p,_){var u=_.id,o=_.groupId,n=o===void 0?"":o,g=_.name,r=_.type,E=_.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:u,groupId:n,name:g,type:r,url:E});var P=this.switchParams(_.url,m==null?void 0:m.details);this.loadPlaylist(P)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:p})}},i.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var p=-1,m=D(this.media.textTracks),s=0;s<m.length;s++)if(m[s].mode==="hidden")p=s;else if(m[s].mode==="showing"){p=s;break}this.subtitleTrack!==p&&(this.subtitleTrack=p)}},b(f,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(p){this._subtitleDisplay=p,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(p){this.selectDefaultTrack=!1;var m=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(p,m)}}]),f}(k.default);function D(d){for(var f=[],i=0;i<d.length;i++){var l=d[i];l.kind==="subtitles"&&l.label&&f.push(d[i])}return f}const T=h},"./src/controller/timeline-controller.ts":(N,O,v)=>{v.r(O),v.d(O,{TimelineController:()=>h});var M=v("./src/polyfills/number.ts"),S=v("./src/events.ts"),k=v("./src/utils/cea-608-parser.ts"),R=v("./src/utils/output-filter.ts"),K=v("./src/utils/webvtt-parser.ts"),b=v("./src/utils/texttrack-utils.ts"),I=v("./src/utils/imsc1-ttml-parser.ts"),C=v("./src/utils/mp4-tools.ts"),L=v("./src/types/loader.ts"),A=v("./src/utils/logger.ts"),h=function(){function f(l){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=d(),this.captionsProperties=void 0,this.hls=l,this.config=l.config,this.Cues=l.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var p=new R.default(this,"textTrack1"),m=new R.default(this,"textTrack2"),s=new R.default(this,"textTrack3"),c=new R.default(this,"textTrack4");this.cea608Parser1=new k.default(1,p,m),this.cea608Parser2=new k.default(3,s,c)}l.on(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(S.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.on(S.Events.FRAG_LOADING,this.onFragLoading,this),l.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(S.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.on(S.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),l.on(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),l.on(S.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.on(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var i=f.prototype;return i.destroy=function(){var p=this.hls;p.off(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),p.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.off(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),p.off(S.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.off(S.Events.FRAG_LOADING,this.onFragLoading,this),p.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),p.off(S.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),p.off(S.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),p.off(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),p.off(S.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),p.off(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},i.addCues=function(p,m,s,c,_){for(var u=!1,o=_.length;o--;){var n=_[o],g=T(n[0],n[1],m,s);if(g>=0&&(n[0]=Math.min(n[0],m),n[1]=Math.max(n[1],s),u=!0,g/(s-m)>.5))return}if(u||_.push([m,s]),this.config.renderTextTracksNatively){var r=this.captionsTracks[p];this.Cues.newCue(r,m,s,c)}else{var E=this.Cues.newCue(null,m,s,c);this.hls.trigger(S.Events.CUES_PARSED,{type:"captions",cues:E,track:p})}},i.onInitPtsFound=function(p,m){var s=this,c=m.frag,_=m.id,u=m.initPTS,o=m.timescale,n=this.unparsedVttFrags;_==="main"&&(this.initPTS[c.cc]=u,this.timescale[c.cc]=o),n.length&&(this.unparsedVttFrags=[],n.forEach(function(g){s.onFragLoaded(S.Events.FRAG_LOADED,g)}))},i.getExistingTrack=function(p){var m=this.media;if(m)for(var s=0;s<m.textTracks.length;s++){var c=m.textTracks[s];if(c[p])return c}return null},i.createCaptionsTrack=function(p){this.config.renderTextTracksNatively?this.createNativeTrack(p):this.createNonNativeTrack(p)},i.createNativeTrack=function(p){if(!this.captionsTracks[p]){var m=this.captionsProperties,s=this.captionsTracks,c=this.media,_=m[p],u=_.label,o=_.languageCode,n=this.getExistingTrack(p);if(n)s[p]=n,(0,b.clearCurrentCues)(s[p]),(0,b.sendAddTrackEvent)(s[p],c);else{var g=this.createTextTrack("captions",u,o);g&&(g[p]=!0,s[p]=g)}}},i.createNonNativeTrack=function(p){if(!this.nonNativeCaptionsTracks[p]){var m=this.captionsProperties[p];if(!!m){var s=m.label,c={_id:p,label:s,kind:"captions",default:m.media?!!m.media.default:!1,closedCaptions:m.media};this.nonNativeCaptionsTracks[p]=c,this.hls.trigger(S.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[c]})}}},i.createTextTrack=function(p,m,s){var c=this.media;if(!!c)return c.addTextTrack(p,m,s)},i.onMediaAttaching=function(p,m){this.media=m.media,this._cleanTracks()},i.onMediaDetaching=function(){var p=this.captionsTracks;Object.keys(p).forEach(function(m){(0,b.clearCurrentCues)(p[m]),delete p[m]}),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=d(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},i._cleanTracks=function(){var p=this.media;if(!!p){var m=p.textTracks;if(m)for(var s=0;s<m.length;s++)(0,b.clearCurrentCues)(m[s])}},i.onSubtitleTracksUpdated=function(p,m){var s=this;this.textTracks=[];var c=m.subtitleTracks||[],_=c.some(function(g){return g.textCodec===I.IMSC1_CODEC});if(this.config.enableWebVTT||_&&this.config.enableIMSC1){var u=this.tracks&&c&&this.tracks.length===c.length;if(this.tracks=c||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach(function(g,r){var E;if(r<o.length){for(var P=null,y=0;y<o.length;y++)if(D(o[y],g)){P=o[y];break}P&&(E=P)}if(E)(0,b.clearCurrentCues)(E);else{var U=s._captionsOrSubtitlesFromCharacteristics(g);E=s.createTextTrack(U,g.name,g.lang),E&&(E.mode="disabled")}E&&(E.groupId=g.groupId,s.textTracks.push(E))})}else if(!u&&this.tracks&&this.tracks.length){var n=this.tracks.map(function(g){return{label:g.name,kind:g.type.toLowerCase(),default:g.default,subtitleTrack:g}});this.hls.trigger(S.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n})}}},i._captionsOrSubtitlesFromCharacteristics=function(p){var m;if((m=p.attrs)!==null&&m!==void 0&&m.CHARACTERISTICS){var s=/transcribes-spoken-dialog/gi.test(p.attrs.CHARACTERISTICS),c=/describes-music-and-sound/gi.test(p.attrs.CHARACTERISTICS);if(s&&c)return"captions"}return"subtitles"},i.onManifestLoaded=function(p,m){var s=this;this.config.enableCEA708Captions&&m.captions&&m.captions.forEach(function(c){var _=/(?:CC|SERVICE)([1-4])/.exec(c.instreamId);if(!!_){var u="textTrack"+_[1],o=s.captionsProperties[u];!o||(o.label=c.name,c.lang&&(o.languageCode=c.lang),o.media=c)}})},i.closedCaptionsForLevel=function(p){var m=this.hls.levels[p.level];return m==null?void 0:m.attrs["CLOSED-CAPTIONS"]},i.onFragLoading=function(p,m){var s=this.cea608Parser1,c=this.cea608Parser2,_=this.lastSn,u=this.lastPartIndex;if(!(!this.enabled||!(s&&c))&&m.frag.type===L.PlaylistLevelType.MAIN){var o,n,g=m.frag.sn,r=(o=m==null||(n=m.part)===null||n===void 0?void 0:n.index)!=null?o:-1;g===_+1||g===_&&r===u+1||(s.reset(),c.reset()),this.lastSn=g,this.lastPartIndex=r}},i.onFragLoaded=function(p,m){var s=m.frag,c=m.payload,_=this.initPTS,u=this.unparsedVttFrags;if(s.type===L.PlaylistLevelType.SUBTITLE)if(c.byteLength){if(!(0,M.isFiniteNumber)(_[s.cc])){u.push(m),_.length&&this.hls.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Missing initial subtitle PTS")});return}var o=s.decryptdata,n="stats"in m;if(o==null||!o.encrypted||n){var g=this.tracks[s.level],r=this.vttCCs;r[s.cc]||(r[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),g&&g.textCodec===I.IMSC1_CODEC?this._parseIMSC1(s,c):this._parseVTTs(s,c,r)}}else this.hls.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})},i._parseIMSC1=function(p,m){var s=this,c=this.hls;(0,I.parseIMSC1)(m,this.initPTS[p.cc],this.timescale[p.cc],function(_){s._appendCues(_,p.level),c.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:p})},function(_){A.logger.log("Failed to parse IMSC1: "+_),c.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:p,error:_})})},i._parseVTTs=function(p,m,s){var c,_=this,u=this.hls,o=(c=p.initSegment)!==null&&c!==void 0&&c.data?(0,C.appendUint8Array)(p.initSegment.data,new Uint8Array(m)):m;(0,K.parseWebVTT)(o,this.initPTS[p.cc],this.timescale[p.cc],s,p.cc,p.start,function(n){_._appendCues(n,p.level),u.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:p})},function(n){_._fallbackToIMSC1(p,m),A.logger.log("Failed to parse VTT cue: "+n),u.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:p,error:n})})},i._fallbackToIMSC1=function(p,m){var s=this,c=this.tracks[p.level];c.textCodec||(0,I.parseIMSC1)(m,this.initPTS[p.cc],this.timescale[p.cc],function(){c.textCodec=I.IMSC1_CODEC,s._parseIMSC1(p,m)},function(){c.textCodec="wvtt"})},i._appendCues=function(p,m){var s=this.hls;if(this.config.renderTextTracksNatively){var c=this.textTracks[m];if(!c||c.mode==="disabled")return;p.forEach(function(o){return(0,b.addCueToTrack)(c,o)})}else{var _=this.tracks[m];if(!_)return;var u=_.default?"default":"subtitles"+m;s.trigger(S.Events.CUES_PARSED,{type:"subtitles",cues:p,track:u})}},i.onFragDecrypted=function(p,m){var s=m.frag;if(s.type===L.PlaylistLevelType.SUBTITLE){if(!(0,M.isFiniteNumber)(this.initPTS[s.cc])){this.unparsedVttFrags.push(m);return}this.onFragLoaded(S.Events.FRAG_LOADED,m)}},i.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},i.onFragParsingUserdata=function(p,m){var s=this.cea608Parser1,c=this.cea608Parser2;if(!(!this.enabled||!(s&&c))){var _=m.frag,u=m.samples;if(!(_.type===L.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(_)==="NONE"))for(var o=0;o<u.length;o++){var n=u[o].bytes;if(n){var g=this.extractCea608Data(n);s.addData(u[o].pts,g[0]),c.addData(u[o].pts,g[1])}}}},i.onBufferFlushing=function(p,m){var s=m.startOffset,c=m.endOffset,_=m.endOffsetSubtitles,u=m.type,o=this.media;if(!(!o||o.currentTime<c)){if(!u||u==="video"){var n=this.captionsTracks;Object.keys(n).forEach(function(r){return(0,b.removeCuesInRange)(n[r],s,c)})}if(this.config.renderTextTracksNatively&&s===0&&_!==void 0){var g=this.textTracks;Object.keys(g).forEach(function(r){return(0,b.removeCuesInRange)(g[r],s,_)})}}},i.extractCea608Data=function(p){for(var m=[[],[]],s=p[0]&31,c=2,_=0;_<s;_++){var u=p[c++],o=127&p[c++],n=127&p[c++];if(!(o===0&&n===0)){var g=(4&u)!==0;if(g){var r=3&u;(r===0||r===1)&&(m[r].push(o),m[r].push(n))}}}return m},f}();function D(f,i){return f&&f.label===i.name&&!(f.textTrack1||f.textTrack2)}function T(f,i,l,p){return Math.min(i,p)-Math.max(f,l)}function d(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>M});var M=function(){function S(R,K){this.subtle=void 0,this.aesIV=void 0,this.subtle=R,this.aesIV=K}var k=S.prototype;return k.decrypt=function(K,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,K)},S}()},"./src/crypt/aes-decryptor.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>k,removePadding:()=>S});var M=v("./src/utils/typed-array.ts");function S(R){var K=R.byteLength,b=K&&new DataView(R.buffer).getUint8(K-1);return b?(0,M.sliceUint8)(R,0,K-b):R}var k=function(){function R(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var K=R.prototype;return K.uint8ArrayToUint32Array_=function(I){for(var C=new DataView(I),L=new Uint32Array(4),A=0;A<4;A++)L[A]=C.getUint32(A*4);return L},K.initTable=function(){var I=this.sBox,C=this.invSBox,L=this.subMix,A=L[0],h=L[1],D=L[2],T=L[3],d=this.invSubMix,f=d[0],i=d[1],l=d[2],p=d[3],m=new Uint32Array(256),s=0,c=0,_=0;for(_=0;_<256;_++)_<128?m[_]=_<<1:m[_]=_<<1^283;for(_=0;_<256;_++){var u=c^c<<1^c<<2^c<<3^c<<4;u=u>>>8^u&255^99,I[s]=u,C[u]=s;var o=m[s],n=m[o],g=m[n],r=m[u]*257^u*16843008;A[s]=r<<24|r>>>8,h[s]=r<<16|r>>>16,D[s]=r<<8|r>>>24,T[s]=r,r=g*16843009^n*65537^o*257^s*16843008,f[u]=r<<24|r>>>8,i[u]=r<<16|r>>>16,l[u]=r<<8|r>>>24,p[u]=r,s?(s=o^m[m[m[g^o]]],c^=m[m[c]]):s=c=1}},K.expandKey=function(I){for(var C=this.uint8ArrayToUint32Array_(I),L=!0,A=0;A<C.length&&L;)L=C[A]===this.key[A],A++;if(!L){this.key=C;var h=this.keySize=C.length;if(h!==4&&h!==6&&h!==8)throw new Error("Invalid aes key size="+h);var D=this.ksRows=(h+6+1)*4,T,d,f=this.keySchedule=new Uint32Array(D),i=this.invKeySchedule=new Uint32Array(D),l=this.sBox,p=this.rcon,m=this.invSubMix,s=m[0],c=m[1],_=m[2],u=m[3],o,n;for(T=0;T<D;T++){if(T<h){o=f[T]=C[T];continue}n=o,T%h===0?(n=n<<8|n>>>24,n=l[n>>>24]<<24|l[n>>>16&255]<<16|l[n>>>8&255]<<8|l[n&255],n^=p[T/h|0]<<24):h>6&&T%h===4&&(n=l[n>>>24]<<24|l[n>>>16&255]<<16|l[n>>>8&255]<<8|l[n&255]),f[T]=o=(f[T-h]^n)>>>0}for(d=0;d<D;d++)T=D-d,d&3?n=f[T]:n=f[T-4],d<4||T<=4?i[d]=n:i[d]=s[l[n>>>24]]^c[l[n>>>16&255]]^_[l[n>>>8&255]]^u[l[n&255]],i[d]=i[d]>>>0}},K.networkToHostOrderSwap=function(I){return I<<24|(I&65280)<<8|(I&16711680)>>8|I>>>24},K.decrypt=function(I,C,L){for(var A=this.keySize+6,h=this.invKeySchedule,D=this.invSBox,T=this.invSubMix,d=T[0],f=T[1],i=T[2],l=T[3],p=this.uint8ArrayToUint32Array_(L),m=p[0],s=p[1],c=p[2],_=p[3],u=new Int32Array(I),o=new Int32Array(u.length),n,g,r,E,P,y,U,B,w,H,G,V,z,$,X=this.networkToHostOrderSwap;C<u.length;){for(w=X(u[C]),H=X(u[C+1]),G=X(u[C+2]),V=X(u[C+3]),P=w^h[0],y=V^h[1],U=G^h[2],B=H^h[3],z=4,$=1;$<A;$++)n=d[P>>>24]^f[y>>16&255]^i[U>>8&255]^l[B&255]^h[z],g=d[y>>>24]^f[U>>16&255]^i[B>>8&255]^l[P&255]^h[z+1],r=d[U>>>24]^f[B>>16&255]^i[P>>8&255]^l[y&255]^h[z+2],E=d[B>>>24]^f[P>>16&255]^i[y>>8&255]^l[U&255]^h[z+3],P=n,y=g,U=r,B=E,z=z+4;n=D[P>>>24]<<24^D[y>>16&255]<<16^D[U>>8&255]<<8^D[B&255]^h[z],g=D[y>>>24]<<24^D[U>>16&255]<<16^D[B>>8&255]<<8^D[P&255]^h[z+1],r=D[U>>>24]<<24^D[B>>16&255]<<16^D[P>>8&255]<<8^D[y&255]^h[z+2],E=D[B>>>24]<<24^D[P>>16&255]<<16^D[y>>8&255]<<8^D[U&255]^h[z+3],o[C]=X(n^m),o[C+1]=X(E^s),o[C+2]=X(r^c),o[C+3]=X(g^_),m=w,s=H,c=G,_=V,C=C+4}return o.buffer},R}()},"./src/crypt/decrypter.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>C});var M=v("./src/crypt/aes-crypto.ts"),S=v("./src/crypt/fast-aes-key.ts"),k=v("./src/crypt/aes-decryptor.ts"),R=v("./src/utils/logger.ts"),K=v("./src/utils/mp4-tools.ts"),b=v("./src/utils/typed-array.ts"),I=16,C=function(){function L(h,D){var T=D===void 0?{}:D,d=T.removePKCS7Padding,f=d===void 0?!0:d;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=h.enableSoftwareAES,this.removePKCS7Padding=f,f)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var A=L.prototype;return A.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},A.isSync=function(){return this.useSoftware},A.flush=function(){var D=this.currentResult,T=this.remainderData;if(!D||T)return this.reset(),null;var d=new Uint8Array(D);return this.reset(),this.removePKCS7Padding?(0,k.removePadding)(d):d},A.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},A.decrypt=function(D,T,d){var f=this;return this.useSoftware?new Promise(function(i,l){f.softwareDecrypt(new Uint8Array(D),T,d);var p=f.flush();p?i(p.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(D),T,d)},A.softwareDecrypt=function(D,T,d){var f=this.currentIV,i=this.currentResult,l=this.remainderData;this.logOnce("JS AES decrypt"),l&&(D=(0,K.appendUint8Array)(l,D),this.remainderData=null);var p=this.getValidChunk(D);if(!p.length)return null;f&&(d=f);var m=this.softwareDecrypter;m||(m=this.softwareDecrypter=new k.default),m.expandKey(T);var s=i;return this.currentResult=m.decrypt(p.buffer,0,d),this.currentIV=(0,b.sliceUint8)(p,-16).buffer,s||null},A.webCryptoDecrypt=function(D,T,d){var f=this,i=this.subtle;return(this.key!==T||!this.fastAesKey)&&(this.key=T,this.fastAesKey=new S.default(i,T)),this.fastAesKey.expandKey().then(function(l){if(!i)return Promise.reject(new Error("web crypto not initialized"));f.logOnce("WebCrypto AES decrypt");var p=new M.default(i,new Uint8Array(d));return p.decrypt(D.buffer,l)}).catch(function(l){return R.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+l.name+": "+l.message),f.onWebCryptoError(D,T,d)})},A.onWebCryptoError=function(D,T,d){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(D,T,d);var f=this.flush();if(f)return f.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},A.getValidChunk=function(D){var T=D,d=D.length-D.length%I;return d!==D.length&&(T=(0,b.sliceUint8)(D,0,d),this.remainderData=(0,b.sliceUint8)(D,d)),T},A.logOnce=function(D){!this.logEnabled||(R.logger.log("[decrypter]: "+D),this.logEnabled=!1)},L}()},"./src/crypt/fast-aes-key.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>M});var M=function(){function S(R,K){this.subtle=void 0,this.key=void 0,this.subtle=R,this.key=K}var k=S.prototype;return k.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},S}()},"./src/demux/aacdemuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>C});var M=v("./src/demux/base-audio-demuxer.ts"),S=v("./src/demux/adts.ts"),k=v("./src/utils/logger.ts"),R=v("./src/demux/id3.ts");function K(L,A){L.prototype=Object.create(A.prototype),L.prototype.constructor=L,b(L,A)}function b(L,A){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,T){return D.__proto__=T,D},b(L,A)}var I=function(L){K(A,L);function A(D,T){var d;return d=L.call(this)||this,d.observer=void 0,d.config=void 0,d.observer=D,d.config=T,d}var h=A.prototype;return h.resetInitSegment=function(T,d,f,i){L.prototype.resetInitSegment.call(this,T,d,f,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:d,duration:i,inputTimeScale:9e4,dropped:0}},A.probe=function(T){if(!T)return!1;for(var d=R.getID3Data(T,0)||[],f=d.length,i=T.length;f<i;f++)if(S.probe(T,f))return k.logger.log("ADTS sync word found !"),!0;return!1},h.canParse=function(T,d){return S.canParse(T,d)},h.appendFrame=function(T,d,f){S.initTrackConfig(T,this.observer,d,f,T.manifestCodec);var i=S.appendFrame(T,d,f,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i},A}(M.default);const C=I},"./src/demux/adts.ts":(N,O,v)=>{v.r(O),v.d(O,{appendFrame:()=>f,canGetFrameLength:()=>C,canParse:()=>A,getAudioConfig:()=>R,getFrameDuration:()=>T,getFullFrameLength:()=>I,getHeaderLength:()=>b,initTrackConfig:()=>D,isHeader:()=>L,isHeaderPattern:()=>K,parseFrameHeader:()=>d,probe:()=>h});var M=v("./src/utils/logger.ts"),S=v("./src/errors.ts"),k=v("./src/events.ts");function R(i,l,p,m){var s,c,_,u,o=navigator.userAgent.toLowerCase(),n=m,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=((l[p+2]&192)>>>6)+1;var r=(l[p+2]&60)>>>2;if(r>g.length-1){i.trigger(k.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+r});return}return _=(l[p+2]&1)<<2,_|=(l[p+3]&192)>>>6,M.logger.log("manifest codec:"+m+", ADTS type:"+s+", samplingIndex:"+r),/firefox/i.test(o)?r>=6?(s=5,u=new Array(4),c=r-3):(s=2,u=new Array(2),c=r):o.indexOf("android")!==-1?(s=2,u=new Array(2),c=r):(s=5,u=new Array(4),m&&(m.indexOf("mp4a.40.29")!==-1||m.indexOf("mp4a.40.5")!==-1)||!m&&r>=6?c=r-3:((m&&m.indexOf("mp4a.40.2")!==-1&&(r>=6&&_===1||/vivaldi/i.test(o))||!m&&_===1)&&(s=2,u=new Array(2)),c=r)),u[0]=s<<3,u[0]|=(r&14)>>1,u[1]|=(r&1)<<7,u[1]|=_<<3,s===5&&(u[1]|=(c&14)>>1,u[2]=(c&1)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:g[r],channelCount:_,codec:"mp4a.40."+s,manifestCodec:n}}function K(i,l){return i[l]===255&&(i[l+1]&246)===240}function b(i,l){return i[l+1]&1?7:9}function I(i,l){return(i[l+3]&3)<<11|i[l+4]<<3|(i[l+5]&224)>>>5}function C(i,l){return l+5<i.length}function L(i,l){return l+1<i.length&&K(i,l)}function A(i,l){return C(i,l)&&K(i,l)&&I(i,l)<=i.length-l}function h(i,l){if(L(i,l)){var p=b(i,l);if(l+p>=i.length)return!1;var m=I(i,l);if(m<=p)return!1;var s=l+m;return s===i.length||L(i,s)}return!1}function D(i,l,p,m,s){if(!i.samplerate){var c=R(l,p,m,s);if(!c)return;i.config=c.config,i.samplerate=c.samplerate,i.channelCount=c.channelCount,i.codec=c.codec,i.manifestCodec=c.manifestCodec,M.logger.log("parsed codec:"+i.codec+", rate:"+c.samplerate+", channels:"+c.channelCount)}}function T(i){return 9216e4/i}function d(i,l){var p=b(i,l);if(l+p<=i.length){var m=I(i,l)-p;if(m>0)return{headerLength:p,frameLength:m}}}function f(i,l,p,m,s){var c=T(i.samplerate),_=m+s*c,u=d(l,p),o;if(u){var n=u.frameLength,g=u.headerLength,r=g+n,E=Math.max(0,p+r-l.length);E?(o=new Uint8Array(r-g),o.set(l.subarray(p+g,l.length),0)):o=l.subarray(p+g,p+r);var P={unit:o,pts:_};return E||i.samples.push(P),{sample:P,length:r,missing:E}}var y=l.length-p;o=new Uint8Array(y),o.set(l.subarray(p,l.length),0);var U={unit:o,pts:_};return{sample:U,length:y,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>L,initPTSFn:()=>C});var M=v("./src/polyfills/number.ts"),S=v("./src/demux/id3.ts"),k=v("./src/types/demuxer.ts"),R=v("./src/demux/dummy-demuxed-track.ts"),K=v("./src/utils/mp4-tools.ts"),b=v("./src/utils/typed-array.ts"),I=function(){function A(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var h=A.prototype;return h.resetInitSegment=function(T,d,f,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},h.resetTimeStamp=function(T){this.initPTS=T,this.resetContiguity()},h.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},h.canParse=function(T,d){return!1},h.appendFrame=function(T,d,f){},h.demux=function(T,d){this.cachedData&&(T=(0,K.appendUint8Array)(this.cachedData,T),this.cachedData=null);var f=S.getID3Data(T,0),i=f?f.length:0,l,p=this._audioTrack,m=this._id3Track,s=f?S.getTimeStamp(f):void 0,c=T.length;for((this.basePTS===null||this.frameIndex===0&&(0,M.isFiniteNumber)(s))&&(this.basePTS=C(s,d,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),f&&f.length>0&&m.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:f,type:k.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});i<c;){if(this.canParse(T,i)){var _=this.appendFrame(p,T,i);_?(this.frameIndex++,this.lastPTS=_.sample.pts,i+=_.length,l=i):i=c}else S.canParse(T,i)?(f=S.getID3Data(T,i),m.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:f,type:k.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),i+=f.length,l=i):i++;if(i===c&&l!==c){var u=(0,b.sliceUint8)(T,l);this.cachedData?this.cachedData=(0,K.appendUint8Array)(this.cachedData,u):this.cachedData=u}}return{audioTrack:p,videoTrack:(0,R.dummyTrack)(),id3Track:m,textTrack:(0,R.dummyTrack)()}},h.demuxSampleAes=function(T,d,f){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},h.flush=function(T){var d=this.cachedData;return d&&(this.cachedData=null,this.demux(d,0)),{audioTrack:this._audioTrack,videoTrack:(0,R.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,R.dummyTrack)()}},h.destroy=function(){},A}(),C=function(h,D,T){return(0,M.isFiniteNumber)(h)?h*90:D*9e4+(T||0)};const L=I},"./src/demux/chunk-cache.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>M});var M=function(){function k(){this.chunks=[],this.dataLength=0}var R=k.prototype;return R.push=function(b){this.chunks.push(b),this.dataLength+=b.length},R.flush=function(){var b=this.chunks,I=this.dataLength,C;if(b.length)b.length===1?C=b[0]:C=S(b,I);else return new Uint8Array(0);return this.reset(),C},R.reset=function(){this.chunks.length=0,this.dataLength=0},k}();function S(k,R){for(var K=new Uint8Array(R),b=0,I=0;I<k.length;I++){var C=k[I];K.set(C,b),b+=C.length}return K}},"./src/demux/dummy-demuxed-track.ts":(N,O,v)=>{v.r(O),v.d(O,{dummyTrack:()=>M});function M(S,k){return S===void 0&&(S=""),k===void 0&&(k=9e4),{type:S,id:-1,pid:-1,inputTimeScale:k,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>k});var M=v("./src/utils/logger.ts"),S=function(){function R(b){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}var K=R.prototype;return K.loadWord=function(){var I=this.data,C=this.bytesAvailable,L=I.byteLength-C,A=new Uint8Array(4),h=Math.min(4,C);if(h===0)throw new Error("no bytes available");A.set(I.subarray(L,L+h)),this.word=new DataView(A.buffer).getUint32(0),this.bitsAvailable=h*8,this.bytesAvailable-=h},K.skipBits=function(I){var C;I=Math.min(I,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,C=I>>3,I-=C<<3,this.bytesAvailable-=C,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},K.readBits=function(I){var C=Math.min(this.bitsAvailable,I),L=this.word>>>32-C;if(I>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=C,this.bitsAvailable>0)this.word<<=C;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return C=I-C,C>0&&this.bitsAvailable?L<<C|this.readBits(C):L},K.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!==0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},K.skipUEG=function(){this.skipBits(1+this.skipLZ())},K.skipEG=function(){this.skipBits(1+this.skipLZ())},K.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},K.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},K.readBoolean=function(){return this.readBits(1)===1},K.readUByte=function(){return this.readBits(8)},K.readUShort=function(){return this.readBits(16)},K.readUInt=function(){return this.readBits(32)},K.skipScalingList=function(I){for(var C=8,L=8,A,h=0;h<I;h++)L!==0&&(A=this.readEG(),L=(C+A+256)%256),C=L===0?C:L},K.readSPS=function(){var I=0,C=0,L=0,A=0,h,D,T,d=this.readUByte.bind(this),f=this.readBits.bind(this),i=this.readUEG.bind(this),l=this.readBoolean.bind(this),p=this.skipBits.bind(this),m=this.skipEG.bind(this),s=this.skipUEG.bind(this),c=this.skipScalingList.bind(this);d();var _=d();if(f(5),p(3),d(),s(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){var u=i();if(u===3&&p(1),s(),s(),p(1),l())for(D=u!==3?8:12,T=0;T<D;T++)l()&&(T<6?c(16):c(64))}s();var o=i();if(o===0)i();else if(o===1)for(p(1),m(),m(),h=i(),T=0;T<h;T++)m();s(),p(1);var n=i(),g=i(),r=f(1);r===0&&p(1),p(1),l()&&(I=i(),C=i(),L=i(),A=i());var E=[1,1];if(l()&&l()){var P=d();switch(P){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:{E=[d()<<8|d(),d()<<8|d()];break}}}return{width:Math.ceil((n+1)*16-I*2-C*2),height:(2-r)*(g+1)*16-(r?2:4)*(L+A),pixelRatio:E}},K.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},R}();const k=S},"./src/demux/id3.ts":(N,O,v)=>{v.r(O),v.d(O,{canParse:()=>K,decodeFrame:()=>A,getID3Data:()=>k,getID3Frames:()=>L,getTimeStamp:()=>b,isFooter:()=>S,isHeader:()=>M,isTimeStampFrame:()=>I,testables:()=>i,utf8ArrayToStr:()=>f});var M=function(s,c){return c+10<=s.length&&s[c]===73&&s[c+1]===68&&s[c+2]===51&&s[c+3]<255&&s[c+4]<255&&s[c+6]<128&&s[c+7]<128&&s[c+8]<128&&s[c+9]<128},S=function(s,c){return c+10<=s.length&&s[c]===51&&s[c+1]===68&&s[c+2]===73&&s[c+3]<255&&s[c+4]<255&&s[c+6]<128&&s[c+7]<128&&s[c+8]<128&&s[c+9]<128},k=function(s,c){for(var _=c,u=0;M(s,c);){u+=10;var o=R(s,c+6);u+=o,S(s,c+10)&&(u+=10),c+=u}if(u>0)return s.subarray(_,_+u)},R=function(s,c){var _=0;return _=(s[c]&127)<<21,_|=(s[c+1]&127)<<14,_|=(s[c+2]&127)<<7,_|=s[c+3]&127,_},K=function(s,c){return M(s,c)&&R(s,c+6)+10<=s.length-c},b=function(s){for(var c=L(s),_=0;_<c.length;_++){var u=c[_];if(I(u))return d(u)}},I=function(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"},C=function(s){var c=String.fromCharCode(s[0],s[1],s[2],s[3]),_=R(s,4),u=10;return{type:c,size:_,data:s.subarray(u,u+_)}},L=function(s){for(var c=0,_=[];M(s,c);){var u=R(s,c+6);c+=10;for(var o=c+u;c+8<o;){var n=C(s.subarray(c)),g=A(n);g&&_.push(g),c+=n.size+10}S(s,c)&&(c+=10)}return _},A=function(s){return s.type==="PRIV"?h(s):s.type[0]==="W"?T(s):D(s)},h=function(s){if(!(s.size<2)){var c=f(s.data,!0),_=new Uint8Array(s.data.subarray(c.length+1));return{key:s.type,info:c,data:_.buffer}}},D=function(s){if(!(s.size<2)){if(s.type==="TXXX"){var c=1,_=f(s.data.subarray(c),!0);c+=_.length+1;var u=f(s.data.subarray(c));return{key:s.type,info:_,data:u}}var o=f(s.data.subarray(1));return{key:s.type,data:o}}},T=function(s){if(s.type==="WXXX"){if(s.size<2)return;var c=1,_=f(s.data.subarray(c),!0);c+=_.length+1;var u=f(s.data.subarray(c));return{key:s.type,info:_,data:u}}var o=f(s.data);return{key:s.type,data:o}},d=function(s){if(s.data.byteLength===8){var c=new Uint8Array(s.data),_=c[3]&1,u=(c[4]<<23)+(c[5]<<15)+(c[6]<<7)+c[7];return u/=45,_&&(u+=4772185884e-2),Math.round(u)}},f=function(s,c){c===void 0&&(c=!1);var _=p();if(_){var u=_.decode(s);if(c){var o=u.indexOf("\0");return o!==-1?u.substring(0,o):u}return u.replace(/\0/g,"")}for(var n=s.length,g,r,E,P="",y=0;y<n;){if(g=s[y++],g===0&&c)return P;if(g===0||g===3)continue;switch(g>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:P+=String.fromCharCode(g);break;case 12:case 13:r=s[y++],P+=String.fromCharCode((g&31)<<6|r&63);break;case 14:r=s[y++],E=s[y++],P+=String.fromCharCode((g&15)<<12|(r&63)<<6|(E&63)<<0);break}}return P},i={decodeTextFrame:D},l;function p(){return!l&&typeof self.TextDecoder!="undefined"&&(l=new self.TextDecoder("utf-8")),l}},"./src/demux/mp3demuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>C});var M=v("./src/demux/base-audio-demuxer.ts"),S=v("./src/demux/id3.ts"),k=v("./src/utils/logger.ts"),R=v("./src/demux/mpegaudio.ts");function K(L,A){L.prototype=Object.create(A.prototype),L.prototype.constructor=L,b(L,A)}function b(L,A){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(D,T){return D.__proto__=T,D},b(L,A)}var I=function(L){K(A,L);function A(){return L.apply(this,arguments)||this}var h=A.prototype;return h.resetInitSegment=function(T,d,f,i){L.prototype.resetInitSegment.call(this,T,d,f,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:d,duration:i,inputTimeScale:9e4,dropped:0}},A.probe=function(T){if(!T)return!1;for(var d=S.getID3Data(T,0)||[],f=d.length,i=T.length;f<i;f++)if(R.probe(T,f))return k.logger.log("MPEG Audio sync word found !"),!0;return!1},h.canParse=function(T,d){return R.canParse(T,d)},h.appendFrame=function(T,d,f){if(this.basePTS!==null)return R.appendFrame(T,d,f,this.basePTS,this.frameIndex)},A}(M.default);const C=I},"./src/demux/mp4demuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>I});var M=v("./src/polyfills/number.ts"),S=v("./src/types/demuxer.ts"),k=v("./src/utils/mp4-tools.ts"),R=v("./src/demux/dummy-demuxed-track.ts"),K=/\/emsg[-/]ID3/i,b=function(){function C(A,h){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=h}var L=C.prototype;return L.resetTimeStamp=function(){},L.resetInitSegment=function(h,D,T,d){var f=this.videoTrack=(0,R.dummyTrack)("video",1),i=this.audioTrack=(0,R.dummyTrack)("audio",1),l=this.txtTrack=(0,R.dummyTrack)("text",1);if(this.id3Track=(0,R.dummyTrack)("id3",1),this.timeOffset=0,!(!h||!h.byteLength)){var p=(0,k.parseInitSegment)(h);if(p.video){var m=p.video,s=m.id,c=m.timescale,_=m.codec;f.id=s,f.timescale=l.timescale=c,f.codec=_}if(p.audio){var u=p.audio,o=u.id,n=u.timescale,g=u.codec;i.id=o,i.timescale=n,i.codec=g}l.id=k.RemuxerTrackIdConfig.text,f.sampleDuration=0,f.duration=i.duration=d}},L.resetContiguity=function(){},C.probe=function(h){return h=h.length>16384?h.subarray(0,16384):h,(0,k.findBox)(h,["moof"]).length>0},L.demux=function(h,D){this.timeOffset=D;var T=h,d=this.videoTrack,f=this.txtTrack;if(this.config.progressive){this.remainderData&&(T=(0,k.appendUint8Array)(this.remainderData,h));var i=(0,k.segmentValidRange)(T);this.remainderData=i.remainder,d.samples=i.valid||new Uint8Array}else d.samples=T;var l=this.extractID3Track(d,D);return f.samples=(0,k.parseSamples)(D,d),{videoTrack:d,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},L.flush=function(){var h=this.timeOffset,D=this.videoTrack,T=this.txtTrack;D.samples=this.remainderData||new Uint8Array,this.remainderData=null;var d=this.extractID3Track(D,this.timeOffset);return T.samples=(0,k.parseSamples)(h,D),{videoTrack:D,audioTrack:(0,R.dummyTrack)(),id3Track:d,textTrack:(0,R.dummyTrack)()}},L.extractID3Track=function(h,D){var T=this.id3Track;if(h.samples.length){var d=(0,k.findBox)(h.samples,["emsg"]);d&&d.forEach(function(f){var i=(0,k.parseEmsg)(f);if(K.test(i.schemeIdUri)){var l=(0,M.isFiniteNumber)(i.presentationTime)?i.presentationTime/i.timeScale:D+i.presentationTimeDelta/i.timeScale,p=i.eventDuration===4294967295?Number.POSITIVE_INFINITY:i.eventDuration/i.timeScale;p<=.001&&(p=Number.POSITIVE_INFINITY);var m=i.payload;T.samples.push({data:m,len:m.byteLength,dts:l,pts:l,type:S.MetadataSchema.emsg,duration:p})}})}return T},L.demuxSampleAes=function(h,D,T){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},L.destroy=function(){},C}();const I=b},"./src/demux/mpegaudio.ts":(N,O,v)=>{v.r(O),v.d(O,{appendFrame:()=>b,canParse:()=>A,isHeader:()=>L,isHeaderPattern:()=>C,parseHeader:()=>I,probe:()=>h});var M=null,S=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],k=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],R=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],K=[0,1,1,4];function b(D,T,d,f,i){if(!(d+24>T.length)){var l=I(T,d);if(l&&d+l.frameLength<=T.length){var p=l.samplesPerFrame*9e4/l.sampleRate,m=f+i*p,s={unit:T.subarray(d,d+l.frameLength),pts:m,dts:m};return D.config=[],D.channelCount=l.channelCount,D.samplerate=l.sampleRate,D.samples.push(s),{sample:s,length:l.frameLength,missing:0}}}}function I(D,T){var d=D[T+1]>>3&3,f=D[T+1]>>1&3,i=D[T+2]>>4&15,l=D[T+2]>>2&3;if(d!==1&&i!==0&&i!==15&&l!==3){var p=D[T+2]>>1&1,m=D[T+3]>>6,s=d===3?3-f:f===3?3:4,c=S[s*14+i-1]*1e3,_=d===3?0:d===2?1:2,u=k[_*3+l],o=m===3?1:2,n=R[d][f],g=K[f],r=n*8*g,E=Math.floor(n*c/u+p)*g;if(M===null){var P=navigator.userAgent||"",y=P.match(/Chrome\/(\d+)/i);M=y?parseInt(y[1]):0}var U=!!M&&M<=87;return U&&f===2&&c>=224e3&&m===0&&(D[T+3]=D[T+3]|128),{sampleRate:u,channelCount:o,frameLength:E,samplesPerFrame:r}}}function C(D,T){return D[T]===255&&(D[T+1]&224)===224&&(D[T+1]&6)!==0}function L(D,T){return T+1<D.length&&C(D,T)}function A(D,T){var d=4;return C(D,T)&&d<=D.length-T}function h(D,T){if(T+1<D.length&&C(D,T)){var d=4,f=I(D,T),i=d;f!=null&&f.frameLength&&(i=f.frameLength);var l=T+i;return l===D.length||L(D,l)}return!1}},"./src/demux/sample-aes.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>R});var M=v("./src/crypt/decrypter.ts"),S=v("./src/utils/mp4-tools.ts"),k=function(){function K(I,C,L){this.keyData=void 0,this.decrypter=void 0,this.keyData=L,this.decrypter=new M.default(C,{removePKCS7Padding:!1})}var b=K.prototype;return b.decryptBuffer=function(C){return this.decrypter.decrypt(C,this.keyData.key.buffer,this.keyData.iv.buffer)},b.decryptAacSample=function(C,L,A){var h=this,D=C[L].unit;if(!(D.length<=16)){var T=D.subarray(16,D.length-D.length%16),d=T.buffer.slice(T.byteOffset,T.byteOffset+T.length);this.decryptBuffer(d).then(function(f){var i=new Uint8Array(f);D.set(i,16),h.decrypter.isSync()||h.decryptAacSamples(C,L+1,A)})}},b.decryptAacSamples=function(C,L,A){for(;;L++){if(L>=C.length){A();return}if(!(C[L].unit.length<32)&&(this.decryptAacSample(C,L,A),!this.decrypter.isSync()))return}},b.getAvcEncryptedData=function(C){for(var L=Math.floor((C.length-48)/160)*16+16,A=new Int8Array(L),h=0,D=32;D<C.length-16;D+=160,h+=16)A.set(C.subarray(D,D+16),h);return A},b.getAvcDecryptedUnit=function(C,L){for(var A=new Uint8Array(L),h=0,D=32;D<C.length-16;D+=160,h+=16)C.set(A.subarray(h,h+16),D);return C},b.decryptAvcSample=function(C,L,A,h,D){var T=this,d=(0,S.discardEPB)(D.data),f=this.getAvcEncryptedData(d);this.decryptBuffer(f.buffer).then(function(i){D.data=T.getAvcDecryptedUnit(d,i),T.decrypter.isSync()||T.decryptAvcSamples(C,L,A+1,h)})},b.decryptAvcSamples=function(C,L,A,h){if(C instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;L++,A=0){if(L>=C.length){h();return}for(var D=C[L].units;!(A>=D.length);A++){var T=D[A];if(!(T.data.length<=48||T.type!==1&&T.type!==5)&&(this.decryptAvcSample(C,L,A,h,T),!this.decrypter.isSync()))return}}},K}();const R=k},"./src/demux/transmuxer-interface.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>L});var M=v("./src/demux/webworkify-webpack.js"),S=v("./src/events.ts"),k=v("./src/demux/transmuxer.ts"),R=v("./src/utils/logger.ts"),K=v("./src/errors.ts"),b=v("./src/utils/mediasource-helper.ts"),I=v("./node_modules/eventemitter3/index.js"),C=(0,b.getMediaSource)()||{isTypeSupported:function(){return!1}},L=function(){function A(D,T,d,f){var i=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var l=D.config;this.hls=D,this.id=T,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=d,this.onFlush=f;var p=function(u,o){o=o||{},o.frag=i.frag,o.id=i.id,i.hls.trigger(u,o)};this.observer=new I.EventEmitter,this.observer.on(S.Events.FRAG_DECRYPTED,p),this.observer.on(S.Events.ERROR,p);var m={mp4:C.isTypeSupported("video/mp4"),mpeg:C.isTypeSupported("audio/mpeg"),mp3:C.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(this.useWorker&&typeof Worker!="undefined"){R.logger.log("demuxing in webworker");var c;try{c=this.worker=(0,M.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),c.addEventListener("message",this.onwmsg),c.onerror=function(_){i.useWorker=!1,R.logger.warn("Exception in webworker, fallback to inline"),i.hls.trigger(S.Events.ERROR,{type:K.ErrorTypes.OTHER_ERROR,details:K.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(_.message+"  ("+_.filename+":"+_.lineno+")")})},c.postMessage({cmd:"init",typeSupported:m,vendor:s,id:T,config:JSON.stringify(l)})}catch(_){R.logger.warn("Error in worker:",_),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),c&&self.URL.revokeObjectURL(c.objectURL),this.transmuxer=new k.default(this.observer,m,l,s,T),this.worker=null}}else this.transmuxer=new k.default(this.observer,m,l,s,T)}var h=A.prototype;return h.destroy=function(){var T=this.worker;if(T)T.removeEventListener("message",this.onwmsg),T.terminate(),this.worker=null,this.onwmsg=void 0;else{var d=this.transmuxer;d&&(d.destroy(),this.transmuxer=null)}var f=this.observer;f&&f.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},h.push=function(T,d,f,i,l,p,m,s,c,_){var u,o,n=this;c.transmuxing.start=self.performance.now();var g=this.transmuxer,r=this.worker,E=p?p.start:l.start,P=l.decryptdata,y=this.frag,U=!(y&&l.cc===y.cc),B=!(y&&c.level===y.level),w=y?c.sn-y.sn:-1,H=this.part?c.part-this.part.index:-1,G=w===0&&c.id>1&&c.id===(y==null?void 0:y.stats.chunkCount),V=!B&&(w===1||w===0&&(H===1||G&&H<=0)),z=self.performance.now();(B||w||l.stats.parsing.start===0)&&(l.stats.parsing.start=z),p&&(H||!V)&&(p.stats.parsing.start=z);var $=!(y&&((u=l.initSegment)===null||u===void 0?void 0:u.url)===((o=y.initSegment)===null||o===void 0?void 0:o.url)),X=new k.TransmuxState(U,V,s,B,E,$);if(!V||U||$){R.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+`
        discontinuity: `+U+`
        trackSwitch: `+B+`
        contiguous: `+V+`
        accurateTimeOffset: `+s+`
        timeOffset: `+E+`
        initSegmentChange: `+$);var j=new k.TransmuxConfig(f,i,d,m,_);this.configureTransmuxer(j)}if(this.frag=l,this.part=p,r)r.postMessage({cmd:"demux",data:T,decryptdata:P,chunkMeta:c,state:X},T instanceof ArrayBuffer?[T]:[]);else if(g){var Y=g.push(T,P,c,X);(0,k.isPromise)(Y)?(g.async=!0,Y.then(function(Q){n.handleTransmuxComplete(Q)}).catch(function(Q){n.transmuxerError(Q,c,"transmuxer-interface push error")})):(g.async=!1,this.handleTransmuxComplete(Y))}},h.flush=function(T){var d=this;T.transmuxing.start=self.performance.now();var f=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:T});else if(f){var l=f.flush(T),p=(0,k.isPromise)(l);p||f.async?((0,k.isPromise)(l)||(l=Promise.resolve(l)),l.then(function(m){d.handleFlushResult(m,T)}).catch(function(m){d.transmuxerError(m,T,"transmuxer-interface flush error")})):this.handleFlushResult(l,T)}},h.transmuxerError=function(T,d,f){!this.hls||this.hls.trigger(S.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:d,fatal:!1,error:T,err:T,reason:f})},h.handleFlushResult=function(T,d){var f=this;T.forEach(function(i){f.handleTransmuxComplete(i)}),this.onFlush(d)},h.onWorkerMessage=function(T){var d=T.data,f=this.hls;switch(d.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":R.logger[d.data.logType]&&R.logger[d.data.logType](d.data.message);break;default:{d.data=d.data||{},d.data.frag=this.frag,d.data.id=this.id,f.trigger(d.event,d.data);break}}},h.configureTransmuxer=function(T){var d=this.worker,f=this.transmuxer;d?d.postMessage({cmd:"configure",config:T}):f&&f.configure(T)},h.handleTransmuxComplete=function(T){T.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(T)},A}()},"./src/demux/transmuxer-worker.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>b});var M=v("./src/demux/transmuxer.ts"),S=v("./src/events.ts"),k=v("./src/utils/logger.ts"),R=v("./node_modules/eventemitter3/index.js"),K=v("./src/errors.ts");function b(h){var D=new R.EventEmitter,T=function(i,l){h.postMessage({event:i,data:l})};D.on(S.Events.FRAG_DECRYPTED,T),D.on(S.Events.ERROR,T);var d=function(){var i=function(m){var s=function(_){T("workerLog",{logType:m,message:_})};k.logger[m]=s};for(var l in k.logger)i(l)};h.addEventListener("message",function(f){var i=f.data;switch(i.cmd){case"init":{var l=JSON.parse(i.config);h.transmuxer=new M.default(D,i.typeSupported,l,i.vendor,i.id),(0,k.enableLogs)(l.debug,i.id),d(),T("init",null);break}case"configure":{h.transmuxer.configure(i.config);break}case"demux":{var p=h.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);(0,M.isPromise)(p)?(h.transmuxer.async=!0,p.then(function(_){I(h,_)}).catch(function(_){T(S.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:_,err:_,reason:"transmuxer-worker push error"})})):(h.transmuxer.async=!1,I(h,p));break}case"flush":{var m=i.chunkMeta,s=h.transmuxer.flush(m),c=(0,M.isPromise)(s);c||h.transmuxer.async?((0,M.isPromise)(s)||(s=Promise.resolve(s)),s.then(function(_){L(h,_,m)}).catch(function(_){T(S.Events.ERROR,{type:K.ErrorTypes.MEDIA_ERROR,details:K.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:_,err:_,reason:"transmuxer-worker flush error"})})):L(h,s,m);break}}})}function I(h,D){if(A(D.remuxResult))return!1;var T=[],d=D.remuxResult,f=d.audio,i=d.video;return f&&C(T,f),i&&C(T,i),h.postMessage({event:"transmuxComplete",data:D},T),!0}function C(h,D){D.data1&&h.push(D.data1.buffer),D.data2&&h.push(D.data2.buffer)}function L(h,D,T){var d=D.reduce(function(f,i){return I(h,i)||f},!1);d||h.postMessage({event:"transmuxComplete",data:D[0]}),h.postMessage({event:"flush",data:T})}function A(h){return!h.audio&&!h.video&&!h.text&&!h.id3&&!h.initSegment}},"./src/demux/transmuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{TransmuxConfig:()=>l,TransmuxState:()=>p,default:()=>T,isPromise:()=>i});var M=v("./src/events.ts"),S=v("./src/errors.ts"),k=v("./src/crypt/decrypter.ts"),R=v("./src/demux/aacdemuxer.ts"),K=v("./src/demux/mp4demuxer.ts"),b=v("./src/demux/tsdemuxer.ts"),I=v("./src/demux/mp3demuxer.ts"),C=v("./src/remux/mp4-remuxer.ts"),L=v("./src/remux/passthrough-remuxer.ts"),A=v("./src/utils/logger.ts"),h;try{h=self.performance.now.bind(self.performance)}catch{A.logger.debug("Unable to use Performance API on this environment"),h=self.Date.now}var D=[{demux:K.default,remux:L.default},{demux:b.default,remux:C.default},{demux:R.default,remux:C.default},{demux:I.default,remux:C.default}],T=function(){function m(c,_,u,o,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=c,this.typeSupported=_,this.config=u,this.vendor=o,this.id=n}var s=m.prototype;return s.configure=function(_){this.transmuxConfig=_,this.decrypter&&this.decrypter.reset()},s.push=function(_,u,o,n){var g=this,r=o.transmuxing;r.executeStart=h();var E=new Uint8Array(_),P=this.currentTransmuxState,y=this.transmuxConfig;n&&(this.currentTransmuxState=n);var U=n||P,B=U.contiguous,w=U.discontinuity,H=U.trackSwitch,G=U.accurateTimeOffset,V=U.timeOffset,z=U.initSegmentChange,$=y.audioCodec,X=y.videoCodec,j=y.defaultInitPts,Y=y.duration,Q=y.initSegmentData,J=d(E,u);if(J&&J.method==="AES-128"){var Z=this.getDecrypter();if(Z.isSync()){var ee=Z.softwareDecrypt(E,J.key.buffer,J.iv.buffer),ne=o.part>-1;if(ne&&(ee=Z.flush()),!ee)return r.executeEnd=h(),f(o);E=new Uint8Array(ee)}else return this.decryptionPromise=Z.webCryptoDecrypt(E,J.key.buffer,J.iv.buffer).then(function(se){var ie=g.push(se,null,o);return g.decryptionPromise=null,ie}),this.decryptionPromise}var te=this.needsProbing(w,H);te&&this.configureTransmuxer(E),(w||H||z||te)&&this.resetInitSegment(Q,$,X,Y,u),(w||z||te)&&this.resetInitialTimestamp(j),B||this.resetContiguity();var q=this.transmux(E,J,V,G,o),re=this.currentTransmuxState;return re.contiguous=!0,re.discontinuity=!1,re.trackSwitch=!1,r.executeEnd=h(),q},s.flush=function(_){var u=this,o=_.transmuxing;o.executeStart=h();var n=this.decrypter,g=this.currentTransmuxState,r=this.decryptionPromise;if(r)return r.then(function(){return u.flush(_)});var E=[],P=g.timeOffset;if(n){var y=n.flush();y&&E.push(this.push(y,null,_))}var U=this.demuxer,B=this.remuxer;if(!U||!B)return this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),o.executeEnd=h(),[f(_)];var w=U.flush(P);return i(w)?w.then(function(H){return u.flushRemux(E,H,_),E}):(this.flushRemux(E,w,_),E)},s.flushRemux=function(_,u,o){var n=u.audioTrack,g=u.videoTrack,r=u.id3Track,E=u.textTrack,P=this.currentTransmuxState,y=P.accurateTimeOffset,U=P.timeOffset;A.logger.log("[transmuxer.ts]: Flushed fragment "+o.sn+(o.part>-1?" p: "+o.part:"")+" of level "+o.level);var B=this.remuxer.remux(n,g,r,E,U,y,!0,this.id);_.push({remuxResult:B,chunkMeta:o}),o.transmuxing.executeEnd=h()},s.resetInitialTimestamp=function(_){var u=this.demuxer,o=this.remuxer;!u||!o||(u.resetTimeStamp(_),o.resetTimeStamp(_))},s.resetContiguity=function(){var _=this.demuxer,u=this.remuxer;!_||!u||(_.resetContiguity(),u.resetNextTimestamp())},s.resetInitSegment=function(_,u,o,n,g){var r=this.demuxer,E=this.remuxer;!r||!E||(r.resetInitSegment(_,u,o,n),E.resetInitSegment(_,u,o,g))},s.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},s.transmux=function(_,u,o,n,g){var r;return u&&u.method==="SAMPLE-AES"?r=this.transmuxSampleAes(_,u,o,n,g):r=this.transmuxUnencrypted(_,o,n,g),r},s.transmuxUnencrypted=function(_,u,o,n){var g=this.demuxer.demux(_,u,!1,!this.config.progressive),r=g.audioTrack,E=g.videoTrack,P=g.id3Track,y=g.textTrack,U=this.remuxer.remux(r,E,P,y,u,o,!1,this.id);return{remuxResult:U,chunkMeta:n}},s.transmuxSampleAes=function(_,u,o,n,g){var r=this;return this.demuxer.demuxSampleAes(_,u,o).then(function(E){var P=r.remuxer.remux(E.audioTrack,E.videoTrack,E.id3Track,E.textTrack,o,n,!1,r.id);return{remuxResult:P,chunkMeta:g}})},s.configureTransmuxer=function(_){for(var u=this.config,o=this.observer,n=this.typeSupported,g=this.vendor,r,E=0,P=D.length;E<P;E++)if(D[E].demux.probe(_)){r=D[E];break}r||(A.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),r={demux:K.default,remux:L.default});var y=this.demuxer,U=this.remuxer,B=r.remux,w=r.demux;(!U||!(U instanceof B))&&(this.remuxer=new B(o,u,n,g)),(!y||!(y instanceof w))&&(this.demuxer=new w(o,u,n),this.probe=w.probe)},s.needsProbing=function(_,u){return!this.demuxer||!this.remuxer||_||u},s.getDecrypter=function(){var _=this.decrypter;return _||(_=this.decrypter=new k.default(this.config)),_},m}();function d(m,s){var c=null;return m.byteLength>0&&s!=null&&s.key!=null&&s.iv!==null&&s.method!=null&&(c=s),c}var f=function(s){return{remuxResult:{},chunkMeta:s}};function i(m){return"then"in m&&m.then instanceof Function}var l=function(s,c,_,u,o){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=c,this.initSegmentData=_,this.duration=u,this.defaultInitPts=o},p=function(s,c,_,u,o,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=c,this.accurateTimeOffset=_,this.trackSwitch=u,this.timeOffset=o,this.initSegmentChange=n}},"./src/demux/tsdemuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>m});var M=v("./src/demux/adts.ts"),S=v("./src/demux/mpegaudio.ts"),k=v("./src/demux/exp-golomb.ts"),R=v("./src/demux/sample-aes.ts"),K=v("./src/events.ts"),b=v("./src/utils/mp4-tools.ts"),I=v("./src/utils/logger.ts"),C=v("./src/errors.ts"),L=v("./src/types/demuxer.ts");function A(){return A=Object.assign?Object.assign.bind():function(s){for(var c=1;c<arguments.length;c++){var _=arguments[c];for(var u in _)Object.prototype.hasOwnProperty.call(_,u)&&(s[u]=_[u])}return s},A.apply(this,arguments)}var h=188,D=function(){function s(_,u,o){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=_,this.config=u,this.typeSupported=o}s.probe=function(u){var o=s.syncOffset(u);return o>0&&I.logger.warn("MPEG2-TS detected but first sync word found @ offset "+o),o!==-1},s.syncOffset=function(u){for(var o=Math.min(h*5,u.length-h)+1,n=0;n<o;){for(var g=!1,r=0;r<o&&u[r]===71;r+=h)if(!g&&d(u,r)===0&&(g=!0),g&&r+h>o)return n;n++}return-1},s.createTrack=function(u,o){return{container:u==="video"||u==="audio"?"video/mp2t":void 0,type:u,id:b.RemuxerTrackIdConfig[u],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:u==="audio"?o:void 0}};var c=s.prototype;return c.resetInitSegment=function(u,o,n,g){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=s.createTrack("video"),this._audioTrack=s.createTrack("audio",g),this._id3Track=s.createTrack("id3"),this._txtTrack=s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=o,this.videoCodec=n,this._duration=g},c.resetTimeStamp=function(){},c.resetContiguity=function(){var u=this._audioTrack,o=this._avcTrack,n=this._id3Track;u&&(u.pesData=null),o&&(o.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},c.demux=function(u,o,n,g){n===void 0&&(n=!1),g===void 0&&(g=!1),n||(this.sampleAes=null);var r,E=this._avcTrack,P=this._audioTrack,y=this._id3Track,U=this._txtTrack,B=E.pid,w=E.pesData,H=P.pid,G=y.pid,V=P.pesData,z=y.pesData,$=null,X=this.pmtParsed,j=this._pmtId,Y=u.length;if(this.remainderData&&(u=(0,b.appendUint8Array)(this.remainderData,u),Y=u.length,this.remainderData=null),Y<h&&!g)return this.remainderData=u,{audioTrack:P,videoTrack:E,id3Track:y,textTrack:U};var Q=Math.max(0,s.syncOffset(u));Y-=(Y-Q)%h,Y<u.byteLength&&!g&&(this.remainderData=new Uint8Array(u.buffer,Y,u.buffer.byteLength-Y));for(var J=0,Z=Q;Z<Y;Z+=h)if(u[Z]===71){var ee=!!(u[Z+1]&64),ne=d(u,Z),te=(u[Z+3]&48)>>4,q=void 0;if(te>1){if(q=Z+5+u[Z+4],q===Z+h)continue}else q=Z+4;switch(ne){case B:ee&&(w&&(r=l(w))&&this.parseAVCPES(E,U,r,!1),w={data:[],size:0}),w&&(w.data.push(u.subarray(q,Z+h)),w.size+=Z+h-q);break;case H:if(ee){if(V&&(r=l(V)))switch(P.segmentCodec){case"aac":this.parseAACPES(P,r);break;case"mp3":this.parseMPEGPES(P,r);break}V={data:[],size:0}}V&&(V.data.push(u.subarray(q,Z+h)),V.size+=Z+h-q);break;case G:ee&&(z&&(r=l(z))&&this.parseID3PES(y,r),z={data:[],size:0}),z&&(z.data.push(u.subarray(q,Z+h)),z.size+=Z+h-q);break;case 0:ee&&(q+=u[q]+1),j=this._pmtId=f(u,q);break;case j:{ee&&(q+=u[q]+1);var re=i(u,q,this.typeSupported,n);B=re.avc,B>0&&(E.pid=B),H=re.audio,H>0&&(P.pid=H,P.segmentCodec=re.segmentCodec),G=re.id3,G>0&&(y.pid=G),$!==null&&!X&&(I.logger.log("unknown PID '"+$+"' in TS found"),$=null,Z=Q-188),X=this.pmtParsed=!0;break}case 17:case 8191:break;default:$=ne;break}}else J++;J>0&&this.observer.emit(K.Events.ERROR,K.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+J+" TS packet/s that do not start with 0x47"}),E.pesData=w,P.pesData=V,y.pesData=z;var se={audioTrack:P,videoTrack:E,id3Track:y,textTrack:U};return g&&this.extractRemainingSamples(se),se},c.flush=function(){var u=this.remainderData;this.remainderData=null;var o;return u?o=this.demux(u,-1,!1,!0):o={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(o),this.sampleAes?this.decrypt(o,this.sampleAes):o},c.extractRemainingSamples=function(u){var o=u.audioTrack,n=u.videoTrack,g=u.id3Track,r=u.textTrack,E=n.pesData,P=o.pesData,y=g.pesData,U;if(E&&(U=l(E))?(this.parseAVCPES(n,r,U,!0),n.pesData=null):n.pesData=E,P&&(U=l(P))){switch(o.segmentCodec){case"aac":this.parseAACPES(o,U);break;case"mp3":this.parseMPEGPES(o,U);break}o.pesData=null}else P!=null&&P.size&&I.logger.log("last AAC PES packet truncated,might overlap between fragments"),o.pesData=P;y&&(U=l(y))?(this.parseID3PES(g,U),g.pesData=null):g.pesData=y},c.demuxSampleAes=function(u,o,n){var g=this.demux(u,n,!0,!this.config.progressive),r=this.sampleAes=new R.default(this.observer,this.config,o);return this.decrypt(g,r)},c.decrypt=function(u,o){return new Promise(function(n){var g=u.audioTrack,r=u.videoTrack;g.samples&&g.segmentCodec==="aac"?o.decryptAacSamples(g.samples,0,function(){r.samples?o.decryptAvcSamples(r.samples,0,0,function(){n(u)}):n(u)}):r.samples&&o.decryptAvcSamples(r.samples,0,0,function(){n(u)})})},c.destroy=function(){this._duration=0},c.parseAVCPES=function(u,o,n,g){var r=this,E=this.parseAVCNALu(u,n.data),P=this.avcSample,y,U=!1;n.data=null,P&&E.length&&!u.audFound&&(p(P,u),P=this.avcSample=T(!1,n.pts,n.dts,"")),E.forEach(function(B){switch(B.type){case 1:{y=!0,P||(P=r.avcSample=T(!0,n.pts,n.dts,"")),P.frame=!0;var w=B.data;if(U&&w.length>4){var H=new k.default(w).readSliceType();(H===2||H===4||H===7||H===9)&&(P.key=!0)}break}case 5:y=!0,P||(P=r.avcSample=T(!0,n.pts,n.dts,"")),P.key=!0,P.frame=!0;break;case 6:{y=!0,(0,b.parseSEIMessageFromNALu)(B.data,1,n.pts,o.samples);break}case 7:if(y=!0,U=!0,!u.sps){var G=new k.default(B.data),V=G.readSPS();u.width=V.width,u.height=V.height,u.pixelRatio=V.pixelRatio,u.sps=[B.data],u.duration=r._duration;for(var z=B.data.subarray(1,4),$="avc1.",X=0;X<3;X++){var j=z[X].toString(16);j.length<2&&(j="0"+j),$+=j}u.codec=$}break;case 8:y=!0,u.pps||(u.pps=[B.data]);break;case 9:y=!1,u.audFound=!0,P&&p(P,u),P=r.avcSample=T(!1,n.pts,n.dts,"");break;case 12:y=!0;break;default:y=!1,P&&(P.debug+="unknown NAL "+B.type+" ");break}if(P&&y){var Y=P.units;Y.push(B)}}),g&&P&&(p(P,u),this.avcSample=null)},c.getLastNalUnit=function(u){var o,n=this.avcSample,g;if((!n||n.units.length===0)&&(n=u[u.length-1]),(o=n)!==null&&o!==void 0&&o.units){var r=n.units;g=r[r.length-1]}return g},c.parseAVCNALu=function(u,o){var n=o.byteLength,g=u.naluState||0,r=g,E=[],P=0,y,U,B,w=-1,H=0;for(g===-1&&(w=0,H=o[0]&31,g=0,P=1);P<n;){if(y=o[P++],!g){g=y?0:1;continue}if(g===1){g=y?0:2;continue}if(!y)g=3;else if(y===1){if(w>=0){var G={data:o.subarray(w,P-g-1),type:H};E.push(G)}else{var V=this.getLastNalUnit(u.samples);if(V&&(r&&P<=4-r&&V.state&&(V.data=V.data.subarray(0,V.data.byteLength-r)),U=P-g-1,U>0)){var z=new Uint8Array(V.data.byteLength+U);z.set(V.data,0),z.set(o.subarray(0,U),V.data.byteLength),V.data=z,V.state=0}}P<n?(B=o[P]&31,w=P,H=B,g=0):g=-1}else g=0}if(w>=0&&g>=0){var $={data:o.subarray(w,n),type:H,state:g};E.push($)}if(E.length===0){var X=this.getLastNalUnit(u.samples);if(X){var j=new Uint8Array(X.data.byteLength+o.byteLength);j.set(X.data,0),j.set(o,X.data.byteLength),X.data=j}}return u.naluState=g,E},c.parseAACPES=function(u,o){var n=0,g=this.aacOverFlow,r=o.data;if(g){this.aacOverFlow=null;var E=g.missing,P=g.sample.unit.byteLength;if(E===-1){var y=new Uint8Array(P+r.byteLength);y.set(g.sample.unit,0),y.set(r,P),r=y}else{var U=P-E;g.sample.unit.set(r.subarray(0,E),U),u.samples.push(g.sample),n=g.missing}}var B,w;for(B=n,w=r.length;B<w-1&&!M.isHeader(r,B);B++);if(B!==n){var H,G;if(B<w-1?(H="AAC PES did not start with ADTS header,offset:"+B,G=!1):(H="no ADTS header found in AAC PES",G=!0),I.logger.warn("parsing error:"+H),this.observer.emit(K.Events.ERROR,K.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.FRAG_PARSING_ERROR,fatal:G,reason:H}),G)return}M.initTrackConfig(u,this.observer,r,B,this.audioCodec);var V;if(o.pts!==void 0)V=o.pts;else if(g){var z=M.getFrameDuration(u.samplerate);V=g.sample.pts+z}else{I.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var $=0,X;B<w;)if(X=M.appendFrame(u,r,B,V,$),B+=X.length,X.missing){this.aacOverFlow=X;break}else for($++;B<w-1&&!M.isHeader(r,B);B++);},c.parseMPEGPES=function(u,o){var n=o.data,g=n.length,r=0,E=0,P=o.pts;if(P===void 0){I.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;E<g;)if(S.isHeader(n,E)){var y=S.appendFrame(u,n,E,P,r);if(y)E+=y.length,r++;else break}else E++},c.parseID3PES=function(u,o){if(o.pts===void 0){I.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var n=A({},o,{type:this._avcTrack?L.MetadataSchema.emsg:L.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});u.samples.push(n)},s}();function T(s,c,_,u){return{key:s,frame:!1,pts:c,dts:_,units:[],debug:u,length:0}}function d(s,c){return((s[c+1]&31)<<8)+s[c+2]}function f(s,c){return(s[c+10]&31)<<8|s[c+11]}function i(s,c,_,u){var o={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},n=(s[c+1]&15)<<8|s[c+2],g=c+3+n-4,r=(s[c+10]&15)<<8|s[c+11];for(c+=12+r;c<g;){var E=d(s,c);switch(s[c]){case 207:if(!u){I.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:o.audio===-1&&(o.audio=E);break;case 21:o.id3===-1&&(o.id3=E);break;case 219:if(!u){I.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:o.avc===-1&&(o.avc=E);break;case 3:case 4:_.mpeg!==!0&&_.mp3!==!0?I.logger.log("MPEG audio found, not supported in this browser"):o.audio===-1&&(o.audio=E,o.segmentCodec="mp3");break;case 36:I.logger.warn("Unsupported HEVC stream type found");break}c+=((s[c+3]&15)<<8|s[c+4])+5}return o}function l(s){var c=0,_,u,o,n,g,r=s.data;if(!s||s.size===0)return null;for(;r[0].length<19&&r.length>1;){var E=new Uint8Array(r[0].length+r[1].length);E.set(r[0]),E.set(r[1],r[0].length),r[0]=E,r.splice(1,1)}_=r[0];var P=(_[0]<<16)+(_[1]<<8)+_[2];if(P===1){if(u=(_[4]<<8)+_[5],u&&u>s.size-6)return null;var y=_[7];y&192&&(n=(_[9]&14)*536870912+(_[10]&255)*4194304+(_[11]&254)*16384+(_[12]&255)*128+(_[13]&254)/2,y&64?(g=(_[14]&14)*536870912+(_[15]&255)*4194304+(_[16]&254)*16384+(_[17]&255)*128+(_[18]&254)/2,n-g>54e5&&(I.logger.warn(Math.round((n-g)/9e4)+"s delta between PTS and DTS, align them"),n=g)):g=n),o=_[8];var U=o+9;if(s.size<=U)return null;s.size-=U;for(var B=new Uint8Array(s.size),w=0,H=r.length;w<H;w++){_=r[w];var G=_.byteLength;if(U)if(U>G){U-=G;continue}else _=_.subarray(U),G-=U,U=0;B.set(_,c),c+=G}return u&&(u-=o+3),{data:B,pts:n,dts:g,len:u}}return null}function p(s,c){if(s.units.length&&s.frame){if(s.pts===void 0){var _=c.samples,u=_.length;if(u){var o=_[u-1];s.pts=o.pts,s.dts=o.dts}else{c.dropped++;return}}c.samples.push(s)}s.debug.length&&I.logger.log(s.pts+"/"+s.dts+":"+s.debug)}const m=D},"./src/demux/webworkify-webpack.js":(N,O,v)=>{v.r(O),v.d(O,{default:()=>h});var M=function(){var T=ENTRY_MODULE,d={},f=function l(p){var m=d[p];if(m!==void 0)return m.exports;var s=d[p]={exports:{}};return T[p].call(s.exports,s,s.exports,l),s.exports};f.m=T,function(){f.n=function(l){var p=l&&l.__esModule?function(){return l.default}:function(){return l};return f.d(p,{a:p}),p}}(),function(){f.d=function(l,p){for(var m in p)f.o(p,m)&&!f.o(l,m)&&Object.defineProperty(l,m,{enumerable:!0,get:p[m]})}}(),function(){f.o=function(l,p){return Object.prototype.hasOwnProperty.call(l,p)}}(),function(){f.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})}}();var i=f(ENTRY_MODULE);return i.default||i},S=M.toString().split("ENTRY_MODULE"),k="[\\.|\\-|\\+|\\w|/|@]+",R="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+k+").*?\\)";function K(D){return(D+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function b(D){return!isNaN(1*D)}function I(D,T,d){var f={};f[d]=[];var i=T.toString().replace(/^"[^"]+"/,"function"),l=i.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||i.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!l)return f;for(var p=l[1],m=new RegExp("(\\\\n|\\W)"+K(p)+R,"g"),s;s=m.exec(i);)s[3]!=="dll-reference"&&f[d].push(s[3]);for(m=new RegExp("\\("+K(p)+'\\("(dll-reference\\s('+k+'))"\\)\\)'+R,"g");s=m.exec(i);)D[s[2]]||(f[d].push(s[1]),D[s[2]]=v(s[1]).m),f[s[2]]=f[s[2]]||[],f[s[2]].push(s[4]);for(var c=Object.keys(f),_=0;_<c.length;_++)for(var u=0;u<f[c[_]].length;u++)b(f[c[_]][u])&&(f[c[_]][u]=1*f[c[_]][u]);return f}function C(D){var T=Object.keys(D);return T.reduce(function(d,f){return d||D[f].length>0},!1)}function L(D,T){for(var d={main:[T]},f={main:[]},i={main:{}};C(d);)for(var l=Object.keys(d),p=0;p<l.length;p++){var m=l[p],s=d[m],c=s.pop();if(i[m]=i[m]||{},!(i[m][c]||!D[m][c])){i[m][c]=!0,f[m]=f[m]||[],f[m].push(c);for(var _=I(D,D[m][c],m),u=Object.keys(_),o=0;o<u.length;o++)d[u[o]]=d[u[o]]||[],d[u[o]]=d[u[o]].concat(_[u[o]])}}return f}function A(D,T,d,f){var i=D[f].map(function(l){return'"'+l+'": '+T[f][l].toString().replace(/^"[^"]+"/,"function")}).join(",");return S[0]+"{"+i+"}"+S[1]+'"'+d+'"'+S[2]}function h(D,T){T=T||{};var d={main:v.m},f=T.all?{main:Object.keys(d.main)}:L(d,D),i="";Object.keys(f).filter(function(c){return c!=="main"}).forEach(function(c){for(var _=0;f[c][_];)_++;f[c].push(_),d[c][_]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",i=i+("var "+c+" = ("+A(f,d,_,modules)+`)();
`)}),i=i+("new (("+A(f,d,D,"main")+")())(self);");var l=new window.Blob([i],{type:"text/javascript"}),p=window.URL||window.webkitURL||window.mozURL||window.msURL,m=p.createObjectURL(l),s=new window.Worker(m);return s.objectURL=m,s}},"./src/errors.ts":(N,O,v)=>{v.r(O),v.d(O,{ErrorDetails:()=>S,ErrorTypes:()=>M});var M;(function(k){k.NETWORK_ERROR="networkError",k.MEDIA_ERROR="mediaError",k.KEY_SYSTEM_ERROR="keySystemError",k.MUX_ERROR="muxError",k.OTHER_ERROR="otherError"})(M||(M={}));var S;(function(k){k.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",k.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",k.KEY_SYSTEM_NO_SESSION="keySystemNoSession",k.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",k.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",k.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",k.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",k.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",k.MANIFEST_LOAD_ERROR="manifestLoadError",k.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",k.MANIFEST_PARSING_ERROR="manifestParsingError",k.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",k.LEVEL_EMPTY_ERROR="levelEmptyError",k.LEVEL_LOAD_ERROR="levelLoadError",k.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",k.LEVEL_SWITCH_ERROR="levelSwitchError",k.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",k.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",k.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",k.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",k.FRAG_LOAD_ERROR="fragLoadError",k.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",k.FRAG_DECRYPT_ERROR="fragDecryptError",k.FRAG_PARSING_ERROR="fragParsingError",k.REMUX_ALLOC_ERROR="remuxAllocError",k.KEY_LOAD_ERROR="keyLoadError",k.KEY_LOAD_TIMEOUT="keyLoadTimeOut",k.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",k.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",k.BUFFER_APPEND_ERROR="bufferAppendError",k.BUFFER_APPENDING_ERROR="bufferAppendingError",k.BUFFER_STALLED_ERROR="bufferStalledError",k.BUFFER_FULL_ERROR="bufferFullError",k.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",k.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",k.INTERNAL_EXCEPTION="internalException",k.INTERNAL_ABORTED="aborted",k.UNKNOWN="unknown"})(S||(S={}))},"./src/events.ts":(N,O,v)=>{v.r(O),v.d(O,{Events:()=>M});var M;(function(S){S.MEDIA_ATTACHING="hlsMediaAttaching",S.MEDIA_ATTACHED="hlsMediaAttached",S.MEDIA_DETACHING="hlsMediaDetaching",S.MEDIA_DETACHED="hlsMediaDetached",S.BUFFER_RESET="hlsBufferReset",S.BUFFER_CODECS="hlsBufferCodecs",S.BUFFER_CREATED="hlsBufferCreated",S.BUFFER_APPENDING="hlsBufferAppending",S.BUFFER_APPENDED="hlsBufferAppended",S.BUFFER_EOS="hlsBufferEos",S.BUFFER_FLUSHING="hlsBufferFlushing",S.BUFFER_FLUSHED="hlsBufferFlushed",S.MANIFEST_LOADING="hlsManifestLoading",S.MANIFEST_LOADED="hlsManifestLoaded",S.MANIFEST_PARSED="hlsManifestParsed",S.LEVEL_SWITCHING="hlsLevelSwitching",S.LEVEL_SWITCHED="hlsLevelSwitched",S.LEVEL_LOADING="hlsLevelLoading",S.LEVEL_LOADED="hlsLevelLoaded",S.LEVEL_UPDATED="hlsLevelUpdated",S.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",S.LEVELS_UPDATED="hlsLevelsUpdated",S.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",S.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",S.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",S.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",S.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",S.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",S.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",S.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",S.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",S.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",S.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",S.CUES_PARSED="hlsCuesParsed",S.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",S.INIT_PTS_FOUND="hlsInitPtsFound",S.FRAG_LOADING="hlsFragLoading",S.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",S.FRAG_LOADED="hlsFragLoaded",S.FRAG_DECRYPTED="hlsFragDecrypted",S.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",S.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",S.FRAG_PARSING_METADATA="hlsFragParsingMetadata",S.FRAG_PARSED="hlsFragParsed",S.FRAG_BUFFERED="hlsFragBuffered",S.FRAG_CHANGED="hlsFragChanged",S.FPS_DROP="hlsFpsDrop",S.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",S.ERROR="hlsError",S.DESTROYING="hlsDestroying",S.KEY_LOADING="hlsKeyLoading",S.KEY_LOADED="hlsKeyLoaded",S.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",S.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>s});var M=v("./node_modules/url-toolkit/src/url-toolkit.js"),S=v("./src/loader/playlist-loader.ts"),k=v("./src/controller/id3-track-controller.ts"),R=v("./src/controller/latency-controller.ts"),K=v("./src/controller/level-controller.ts"),b=v("./src/controller/fragment-tracker.ts"),I=v("./src/loader/key-loader.ts"),C=v("./src/controller/stream-controller.ts"),L=v("./src/is-supported.ts"),A=v("./src/utils/logger.ts"),h=v("./src/config.ts"),D=v("./node_modules/eventemitter3/index.js"),T=v("./src/events.ts"),d=v("./src/errors.ts"),f=v("./src/types/level.ts");function i(c,_){for(var u=0;u<_.length;u++){var o=_[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(c,p(o.key),o)}}function l(c,_,u){return _&&i(c.prototype,_),u&&i(c,u),Object.defineProperty(c,"prototype",{writable:!1}),c}function p(c){var _=m(c,"string");return typeof _=="symbol"?_:String(_)}function m(c,_){if(typeof c!="object"||c===null)return c;var u=c[Symbol.toPrimitive];if(u!==void 0){var o=u.call(c,_||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(c)}var s=function(){c.isSupported=function(){return(0,L.isSupported)()};function c(u){u===void 0&&(u={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new D.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var o=this.config=(0,h.mergeConfig)(c.DefaultConfig,u);this.userConfig=u,(0,A.enableLogs)(o.debug,"Hls instance"),this._autoLevelCapping=-1,o.progressive&&(0,h.enableStreamingMode)(o);var n=o.abrController,g=o.bufferController,r=o.capLevelController,E=o.fpsController,P=this.abrController=new n(this),y=this.bufferController=new g(this),U=this.capLevelController=new r(this),B=new E(this),w=new S.default(this),H=new k.default(this),G=this.levelController=new K.default(this),V=new b.FragmentTracker(this),z=new I.default(this.config),$=this.streamController=new C.default(this,V,z);U.setStreamController($),B.setStreamController($);var X=[w,G,$];this.networkControllers=X;var j=[P,y,U,B,H,V];this.audioTrackController=this.createController(o.audioTrackController,X);var Y=o.audioStreamController;Y&&X.push(new Y(this,V,z)),this.subtitleTrackController=this.createController(o.subtitleTrackController,X);var Q=o.subtitleStreamController;Q&&X.push(new Q(this,V,z)),this.createController(o.timelineController,j),z.emeController=this.emeController=this.createController(o.emeController,j),this.cmcdController=this.createController(o.cmcdController,j),this.latencyController=this.createController(R.default,j),this.coreComponents=j}var _=c.prototype;return _.createController=function(o,n){if(o){var g=new o(this);return n&&n.push(g),g}return null},_.on=function(o,n,g){g===void 0&&(g=this),this._emitter.on(o,n,g)},_.once=function(o,n,g){g===void 0&&(g=this),this._emitter.once(o,n,g)},_.removeAllListeners=function(o){this._emitter.removeAllListeners(o)},_.off=function(o,n,g,r){g===void 0&&(g=this),this._emitter.off(o,n,g,r)},_.listeners=function(o){return this._emitter.listeners(o)},_.emit=function(o,n,g){return this._emitter.emit(o,n,g)},_.trigger=function(o,n){if(this.config.debug)return this.emit(o,o,n);try{return this.emit(o,o,n)}catch(g){A.logger.error("An internal error happened while handling event "+o+'. Error message: "'+g.message+'". Here is a stacktrace:',g),this.trigger(T.Events.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:o,error:g})}return!1},_.listenerCount=function(o){return this._emitter.listenerCount(o)},_.destroy=function(){A.logger.log("destroy"),this.trigger(T.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(o){return o.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(o){return o.destroy()}),this.coreComponents.length=0},_.attachMedia=function(o){A.logger.log("attachMedia"),this._media=o,this.trigger(T.Events.MEDIA_ATTACHING,{media:o})},_.detachMedia=function(){A.logger.log("detachMedia"),this.trigger(T.Events.MEDIA_DETACHING,void 0),this._media=null},_.loadSource=function(o){this.stopLoad();var n=this.media,g=this.url,r=this.url=M.buildAbsoluteURL(self.location.href,o,{alwaysNormalize:!0});A.logger.log("loadSource:"+r),n&&g&&g!==r&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(n)),this.trigger(T.Events.MANIFEST_LOADING,{url:o})},_.startLoad=function(o){o===void 0&&(o=-1),A.logger.log("startLoad("+o+")"),this.networkControllers.forEach(function(n){n.startLoad(o)})},_.stopLoad=function(){A.logger.log("stopLoad"),this.networkControllers.forEach(function(o){o.stopLoad()})},_.swapAudioCodec=function(){A.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},_.recoverMediaError=function(){A.logger.log("recoverMediaError");var o=this._media;this.detachMedia(),o&&this.attachMedia(o)},_.removeLevel=function(o,n){n===void 0&&(n=0),this.levelController.removeLevel(o,n)},l(c,[{key:"levels",get:function(){var o=this.levelController.levels;return o||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(o){A.logger.log("set currentLevel:"+o),this.loadLevel=o,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(o){A.logger.log("set nextLevel:"+o),this.levelController.manualLevel=o,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(o){A.logger.log("set loadLevel:"+o),this.levelController.manualLevel=o}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(o){this.levelController.nextLoadLevel=o}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(o){A.logger.log("set firstLevel:"+o),this.levelController.firstLevel=o}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(o){A.logger.log("set startLevel:"+o),o!==-1&&(o=Math.max(o,this.minAutoLevel)),this.levelController.startLevel=o}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(o){var n=!!o;n!==this.config.capLevelToPlayerSize&&(n?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=n)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(o){this._autoLevelCapping!==o&&(A.logger.log("set autoLevelCapping:"+o),this._autoLevelCapping=o)}},{key:"bandwidthEstimate",get:function(){var o=this.abrController.bwEstimator;return o?o.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(o){f.HdcpLevels.indexOf(o)>-1&&(this._maxHdcpLevel=o)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var o=this.levels,n=this.config.minAutoBitrate;if(!o)return 0;for(var g=o.length,r=0;r<g;r++)if(o[r].maxBitrate>=n)return r;return 0}},{key:"maxAutoLevel",get:function(){var o=this.levels,n=this.autoLevelCapping,g=this.maxHdcpLevel,r;if(n===-1&&o&&o.length?r=o.length-1:r=n,g)for(var E=r;E--;){var P=o[E].attrs["HDCP-LEVEL"];if(P&&P<=g)return E}return r}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(o){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,o)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var o=this.audioTrackController;return o?o.audioTracks:[]}},{key:"audioTrack",get:function(){var o=this.audioTrackController;return o?o.audioTrack:-1},set:function(o){var n=this.audioTrackController;n&&(n.audioTrack=o)}},{key:"subtitleTracks",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTrack:-1},set:function(o){var n=this.subtitleTrackController;n&&(n.subtitleTrack=o)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var o=this.subtitleTrackController;return o?o.subtitleDisplay:!1},set:function(o){var n=this.subtitleTrackController;n&&(n.subtitleDisplay=o)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(o){this.config.lowLatencyMode=o}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.3"}},{key:"Events",get:function(){return T.Events}},{key:"ErrorTypes",get:function(){return d.ErrorTypes}},{key:"ErrorDetails",get:function(){return d.ErrorDetails}},{key:"DefaultConfig",get:function(){return c.defaultConfig?c.defaultConfig:h.hlsDefaultConfig},set:function(o){c.defaultConfig=o}}]),c}();s.defaultConfig=void 0},"./src/is-supported.ts":(N,O,v)=>{v.r(O),v.d(O,{changeTypeSupported:()=>R,isSupported:()=>k});var M=v("./src/utils/mediasource-helper.ts");function S(){return self.SourceBuffer||self.WebKitSourceBuffer}function k(){var K=(0,M.getMediaSource)();if(!K)return!1;var b=S(),I=K&&typeof K.isTypeSupported=="function"&&K.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),C=!b||b.prototype&&typeof b.prototype.appendBuffer=="function"&&typeof b.prototype.remove=="function";return!!I&&!!C}function R(){var K,b=S();return typeof(b==null||(K=b.prototype)===null||K===void 0?void 0:K.changeType)=="function"}},"./src/loader/date-range.ts":(N,O,v)=>{v.r(O),v.d(O,{DateRange:()=>A,DateRangeAttribute:()=>L});var M=v("./src/polyfills/number.ts"),S=v("./src/utils/attr-list.ts"),k=v("./src/utils/logger.ts");function R(){return R=Object.assign?Object.assign.bind():function(h){for(var D=1;D<arguments.length;D++){var T=arguments[D];for(var d in T)Object.prototype.hasOwnProperty.call(T,d)&&(h[d]=T[d])}return h},R.apply(this,arguments)}function K(h,D){for(var T=0;T<D.length;T++){var d=D[T];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(h,I(d.key),d)}}function b(h,D,T){return D&&K(h.prototype,D),T&&K(h,T),Object.defineProperty(h,"prototype",{writable:!1}),h}function I(h){var D=C(h,"string");return typeof D=="symbol"?D:String(D)}function C(h,D){if(typeof h!="object"||h===null)return h;var T=h[Symbol.toPrimitive];if(T!==void 0){var d=T.call(h,D||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(D==="string"?String:Number)(h)}var L;(function(h){h.ID="ID",h.CLASS="CLASS",h.START_DATE="START-DATE",h.DURATION="DURATION",h.END_DATE="END-DATE",h.END_ON_NEXT="END-ON-NEXT",h.PLANNED_DURATION="PLANNED-DURATION",h.SCTE35_OUT="SCTE35-OUT",h.SCTE35_IN="SCTE35-IN"})(L||(L={}));var A=function(){function h(D,T){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,T){var d=T.attr;for(var f in d)if(Object.prototype.hasOwnProperty.call(D,f)&&D[f]!==d[f]){k.logger.warn('DATERANGE tag attribute: "'+f+'" does not match for tags with ID: "'+D.ID+'"'),this._badValueForSameId=f;break}D=R(new S.AttrList({}),d,D)}if(this.attr=D,this._startDate=new Date(D[L.START_DATE]),L.END_DATE in this.attr){var i=new Date(this.attr[L.END_DATE]);(0,M.isFiniteNumber)(i.getTime())&&(this._endDate=i)}}return b(h,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var T=this.duration;return T!==null?new Date(this._startDate.getTime()+T*1e3):null}},{key:"duration",get:function(){if(L.DURATION in this.attr){var T=this.attr.decimalFloatingPoint(L.DURATION);if((0,M.isFiniteNumber)(T))return T}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return L.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(L.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(L.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,M.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),h}()},"./src/loader/fragment-loader.ts":(N,O,v)=>{v.r(O),v.d(O,{LoadError:()=>T,default:()=>h});var M=v("./src/polyfills/number.ts"),S=v("./src/errors.ts");function k(d,f){d.prototype=Object.create(f.prototype),d.prototype.constructor=d,C(d,f)}function R(d){var f=typeof Map=="function"?new Map:void 0;return R=function(l){if(l===null||!I(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof f!="undefined"){if(f.has(l))return f.get(l);f.set(l,p)}function p(){return K(l,arguments,L(this).constructor)}return p.prototype=Object.create(l.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),C(p,l)},R(d)}function K(d,f,i){return b()?K=Reflect.construct.bind():K=function(p,m,s){var c=[null];c.push.apply(c,m);var _=Function.bind.apply(p,c),u=new _;return s&&C(u,s.prototype),u},K.apply(null,arguments)}function b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function I(d){return Function.toString.call(d).indexOf("[native code]")!==-1}function C(d,f){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,p){return l.__proto__=p,l},C(d,f)}function L(d){return L=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},L(d)}var A=Math.pow(2,17),h=function(){function d(i){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=i}var f=d.prototype;return f.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},f.abort=function(){this.loader&&this.loader.abort()},f.load=function(l,p){var m=this,s=l.url;if(!s)return Promise.reject(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,networkDetails:null},"Fragment does not have a "+(s?"part list":"url")));this.abort();var c=this.config,_=c.fLoader,u=c.loader;return new Promise(function(o,n){m.loader&&m.loader.destroy();var g=m.loader=l.loader=_?new _(c):new u(c),r=D(l),E={timeout:c.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:c.fragLoadingMaxRetryTimeout,highWaterMark:l.sn==="initSegment"?1/0:A};l.stats=g.stats,g.load(r,E,{onSuccess:function(y,U,B,w){m.resetLoader(l,g);var H=y.data;B.resetIV&&l.decryptdata&&(l.decryptdata.iv=new Uint8Array(H.slice(0,16)),H=H.slice(16)),o({frag:l,part:null,payload:H,networkDetails:w})},onError:function(y,U,B){m.resetLoader(l,g),n(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,response:y,networkDetails:B}))},onAbort:function(y,U,B){m.resetLoader(l,g),n(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,networkDetails:B}))},onTimeout:function(y,U,B){m.resetLoader(l,g),n(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,networkDetails:B}))},onProgress:function(y,U,B,w){p&&p({frag:l,part:null,payload:B,networkDetails:w})}})})},f.loadPart=function(l,p,m){var s=this;this.abort();var c=this.config,_=c.fLoader,u=c.loader;return new Promise(function(o,n){s.loader&&s.loader.destroy();var g=s.loader=l.loader=_?new _(c):new u(c),r=D(l,p),E={timeout:c.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:c.fragLoadingMaxRetryTimeout,highWaterMark:A};p.stats=g.stats,g.load(r,E,{onSuccess:function(y,U,B,w){s.resetLoader(l,g),s.updateStatsFromPart(l,p);var H={frag:l,part:p,payload:y.data,networkDetails:w};m(H),o(H)},onError:function(y,U,B){s.resetLoader(l,g),n(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,part:p,response:y,networkDetails:B}))},onAbort:function(y,U,B){l.stats.aborted=p.stats.aborted,s.resetLoader(l,g),n(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,part:p,networkDetails:B}))},onTimeout:function(y,U,B){s.resetLoader(l,g),n(new T({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,part:p,networkDetails:B}))}})})},f.updateStatsFromPart=function(l,p){var m=l.stats,s=p.stats,c=s.total;if(m.loaded+=s.loaded,c){var _=Math.round(l.duration/p.duration),u=Math.min(Math.round(m.loaded/c),_),o=_-u,n=o*Math.round(m.loaded/u);m.total=m.loaded+n}else m.total=Math.max(m.loaded,m.total);var g=m.loading,r=s.loading;g.start?g.first+=r.first-r.start:(g.start=r.start,g.first=r.first),g.end=r.end},f.resetLoader=function(l,p){l.loader=null,this.loader===p&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),p.destroy()},d}();function D(d,f){f===void 0&&(f=null);var i=f||d,l={frag:d,part:f,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},p=i.byteRangeStartOffset,m=i.byteRangeEndOffset;if((0,M.isFiniteNumber)(p)&&(0,M.isFiniteNumber)(m)){var s,c=p,_=m;if(d.sn==="initSegment"&&((s=d.decryptdata)===null||s===void 0?void 0:s.method)==="AES-128"){var u=m-p;u%16&&(_=m+(16-u%16)),p!==0&&(l.resetIV=!0,c=p-16)}l.rangeStart=c,l.rangeEnd=_}return l}var T=function(d){k(f,d);function f(i){for(var l,p=arguments.length,m=new Array(p>1?p-1:0),s=1;s<p;s++)m[s-1]=arguments[s];return l=d.call.apply(d,[this].concat(m))||this,l.data=void 0,l.data=i,l}return f}(R(Error))},"./src/loader/fragment.ts":(N,O,v)=>{v.r(O),v.d(O,{BaseSegment:()=>h,ElementaryStreamTypes:()=>A,Fragment:()=>D,Part:()=>T});var M=v("./src/polyfills/number.ts"),S=v("./node_modules/url-toolkit/src/url-toolkit.js"),k=v("./src/loader/load-stats.ts");function R(d,f){d.prototype=Object.create(f.prototype),d.prototype.constructor=d,K(d,f)}function K(d,f){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,p){return l.__proto__=p,l},K(d,f)}function b(d,f){for(var i=0;i<f.length;i++){var l=f[i];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,C(l.key),l)}}function I(d,f,i){return f&&b(d.prototype,f),i&&b(d,i),Object.defineProperty(d,"prototype",{writable:!1}),d}function C(d){var f=L(d,"string");return typeof f=="symbol"?f:String(f)}function L(d,f){if(typeof d!="object"||d===null)return d;var i=d[Symbol.toPrimitive];if(i!==void 0){var l=i.call(d,f||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(d)}var A;(function(d){d.AUDIO="audio",d.VIDEO="video",d.AUDIOVIDEO="audiovideo"})(A||(A={}));var h=function(){function d(i){var l;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(l={},l[A.AUDIO]=null,l[A.VIDEO]=null,l[A.AUDIOVIDEO]=null,l),this.baseurl=i}var f=d.prototype;return f.setByteRange=function(l,p){var m=l.split("@",2),s=[];m.length===1?s[0]=p?p.byteRangeEndOffset:0:s[0]=parseInt(m[1]),s[1]=parseInt(m[0])+s[0],this._byteRange=s},I(d,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,S.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(l){this._url=l}}]),d}(),D=function(d){R(f,d);function f(l,p){var m;return m=d.call(this,p)||this,m._decryptdata=null,m.rawProgramDateTime=null,m.programDateTime=null,m.tagList=[],m.duration=0,m.sn=0,m.levelkeys=void 0,m.type=void 0,m.loader=null,m.keyLoader=null,m.level=-1,m.cc=0,m.startPTS=void 0,m.endPTS=void 0,m.appendedPTS=void 0,m.startDTS=void 0,m.endDTS=void 0,m.start=0,m.deltaPTS=void 0,m.maxStartPTS=void 0,m.minEndPTS=void 0,m.stats=new k.LoadStats,m.urlId=0,m.data=void 0,m.bitrateTest=!1,m.title=null,m.initSegment=null,m.endList=void 0,m.type=l,m}var i=f.prototype;return i.setKeyFormat=function(p){if(this.levelkeys){var m=this.levelkeys[p];m&&!this._decryptdata&&(this._decryptdata=m.getDecryptData(this.sn))}},i.abortRequests=function(){var p,m;(p=this.loader)===null||p===void 0||p.abort(),(m=this.keyLoader)===null||m===void 0||m.abort()},i.setElementaryStreamInfo=function(p,m,s,c,_,u){u===void 0&&(u=!1);var o=this.elementaryStreams,n=o[p];if(!n){o[p]={startPTS:m,endPTS:s,startDTS:c,endDTS:_,partial:u};return}n.startPTS=Math.min(n.startPTS,m),n.endPTS=Math.max(n.endPTS,s),n.startDTS=Math.min(n.startDTS,c),n.endDTS=Math.max(n.endDTS,_)},i.clearElementaryStreamInfo=function(){var p=this.elementaryStreams;p[A.AUDIO]=null,p[A.VIDEO]=null,p[A.AUDIOVIDEO]=null},I(f,[{key:"decryptdata",get:function(){var p=this.levelkeys;if(!p&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var m=this.levelkeys.identity;if(m)this._decryptdata=m.getDecryptData(this.sn);else{var s=Object.keys(this.levelkeys);if(s.length===1)return this._decryptdata=this.levelkeys[s[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,M.isFiniteNumber)(this.programDateTime))return null;var p=(0,M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+p*1e3}},{key:"encrypted",get:function(){var p;if((p=this._decryptdata)!==null&&p!==void 0&&p.encrypted)return!0;if(this.levelkeys){var m=Object.keys(this.levelkeys),s=m.length;if(s>1||s===1&&this.levelkeys[m[0]].encrypted)return!0}return!1}}]),f}(h),T=function(d){R(f,d);function f(i,l,p,m,s){var c;c=d.call(this,p)||this,c.fragOffset=0,c.duration=0,c.gap=!1,c.independent=!1,c.relurl=void 0,c.fragment=void 0,c.index=void 0,c.stats=new k.LoadStats,c.duration=i.decimalFloatingPoint("DURATION"),c.gap=i.bool("GAP"),c.independent=i.bool("INDEPENDENT"),c.relurl=i.enumeratedString("URI"),c.fragment=l,c.index=m;var _=i.enumeratedString("BYTERANGE");return _&&c.setByteRange(_,s),s&&(c.fragOffset=s.fragOffset+s.duration),c}return I(f,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var l=this.elementaryStreams;return!!(l.audio||l.video||l.audiovideo)}}]),f}(h)},"./src/loader/key-loader.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>k});var M=v("./src/errors.ts"),S=v("./src/loader/fragment-loader.ts"),k=function(){function R(b){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=b}var K=R.prototype;return K.abort=function(){for(var I in this.keyUriToKeyInfo){var C=this.keyUriToKeyInfo[I].loader;C&&C.abort()}},K.detach=function(){for(var I in this.keyUriToKeyInfo){var C=this.keyUriToKeyInfo[I];(C.mediaKeySessionContext||C.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[I]}},K.destroy=function(){this.detach();for(var I in this.keyUriToKeyInfo){var C=this.keyUriToKeyInfo[I].loader;C&&C.destroy()}this.keyUriToKeyInfo={}},K.createKeyLoadError=function(I,C,L,A){return C===void 0&&(C=M.ErrorDetails.KEY_LOAD_ERROR),new S.LoadError({type:M.ErrorTypes.NETWORK_ERROR,details:C,fatal:!1,frag:I,networkDetails:L})},K.loadClear=function(I,C){var L=this;if(this.emeController&&this.config.emeEnabled)for(var A=I.sn,h=I.cc,D=function(i){var l=C[i];if(h<=l.cc&&(A==="initSegment"||A<l.sn))return L.emeController.selectKeySystemFormat(l).then(function(p){l.setKeyFormat(p)}),"break"},T=0;T<C.length;T++){var d=D(T);if(d==="break")break}},K.load=function(I){var C=this;return!I.decryptdata&&I.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(I).then(function(L){return C.loadInternal(I,L)}):this.loadInternal(I)},K.loadInternal=function(I,C){var L,A;C&&I.setKeyFormat(C);var h=I.decryptdata;if(!h){var D=C?"Expected frag.decryptdata to be defined after setting format "+C:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(I,M.ErrorDetails.KEY_LOAD_ERROR,null,D))}var T=h.uri;if(!T)return Promise.reject(this.createKeyLoadError(I,M.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+T+'"'));var d=this.keyUriToKeyInfo[T];if((L=d)!==null&&L!==void 0&&L.decryptdata.key)return h.key=d.decryptdata.key,Promise.resolve({frag:I,keyInfo:d});if((A=d)!==null&&A!==void 0&&A.keyLoadPromise){var f;switch((f=d.mediaKeySessionContext)===null||f===void 0?void 0:f.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return d.keyLoadPromise}}switch(d=this.keyUriToKeyInfo[T]={decryptdata:h,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},h.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return h.keyFormat==="identity"?this.loadKeyHTTP(d,I):this.loadKeyEME(d,I);case"AES-128":return this.loadKeyHTTP(d,I);default:return Promise.reject(this.createKeyLoadError(I,M.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+h.method+'"'))}},K.loadKeyEME=function(I,C){var L={frag:C,keyInfo:I};if(this.emeController&&this.config.emeEnabled){var A=this.emeController.loadKey(L);if(A)return(I.keyLoadPromise=A.then(function(h){return I.mediaKeySessionContext=h,L})).catch(function(h){throw I.keyLoadPromise=null,h})}return Promise.resolve(L)},K.loadKeyHTTP=function(I,C){var L=this,A=this.config,h=A.loader,D=new h(A);return C.keyLoader=I.loader=D,I.keyLoadPromise=new Promise(function(T,d){var f={keyInfo:I,frag:C,responseType:"arraybuffer",url:I.decryptdata.uri},i={timeout:A.fragLoadingTimeOut,maxRetry:0,retryDelay:A.fragLoadingRetryDelay,maxRetryDelay:A.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:function(m,s,c,_){var u=c.frag,o=c.keyInfo,n=c.url;if(!u.decryptdata||o!==L.keyUriToKeyInfo[n])return d(L.createKeyLoadError(u,M.ErrorDetails.KEY_LOAD_ERROR,_,"after key load, decryptdata unset or changed"));o.decryptdata.key=u.decryptdata.key=new Uint8Array(m.data),u.keyLoader=null,o.loader=null,T({frag:u,keyInfo:o})},onError:function(m,s,c){L.resetLoader(s),d(L.createKeyLoadError(C,M.ErrorDetails.KEY_LOAD_ERROR,c))},onTimeout:function(m,s,c){L.resetLoader(s),d(L.createKeyLoadError(C,M.ErrorDetails.KEY_LOAD_TIMEOUT,c))},onAbort:function(m,s,c){L.resetLoader(s),d(L.createKeyLoadError(C,M.ErrorDetails.INTERNAL_ABORTED,c))}};D.load(f,i,l)})},K.resetLoader=function(I){var C=I.frag,L=I.keyInfo,A=I.url,h=L.loader;C.keyLoader===h&&(C.keyLoader=null,L.loader=null),delete this.keyUriToKeyInfo[A],h&&h.destroy()},R}()},"./src/loader/level-details.ts":(N,O,v)=>{v.r(O),v.d(O,{LevelDetails:()=>I});var M=v("./src/polyfills/number.ts");function S(C,L){for(var A=0;A<L.length;A++){var h=L[A];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(C,R(h.key),h)}}function k(C,L,A){return L&&S(C.prototype,L),A&&S(C,A),Object.defineProperty(C,"prototype",{writable:!1}),C}function R(C){var L=K(C,"string");return typeof L=="symbol"?L:String(L)}function K(C,L){if(typeof C!="object"||C===null)return C;var A=C[Symbol.toPrimitive];if(A!==void 0){var h=A.call(C,L||"default");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return(L==="string"?String:Number)(C)}var b=10,I=function(){function C(A){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=A}var L=C.prototype;return L.reloaded=function(h){if(!h){this.advanced=!0,this.updated=!0;return}var D=this.lastPartSn-h.lastPartSn,T=this.lastPartIndex-h.lastPartIndex;this.updated=this.endSN!==h.endSN||!!T||!!D,this.advanced=this.endSN>h.endSN||D>0||D===0&&T>0,this.updated||this.advanced?this.misses=Math.floor(h.misses*.6):this.misses=h.misses+1,this.availabilityDelay=h.availabilityDelay},k(C,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||b}},{key:"drift",get:function(){var h=this.driftEndTime-this.driftStartTime;if(h>0){var D=this.driftEnd-this.driftStart;return D*1e3/h}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var h;return(h=this.partList)!==null&&h!==void 0&&h.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var h;return(h=this.fragments)!==null&&h!==void 0&&h.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var h;return(h=this.partList)!==null&&h!==void 0&&h.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var h;return(h=this.partList)!==null&&h!==void 0&&h.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),C}()},"./src/loader/level-key.ts":(N,O,v)=>{v.r(O),v.d(O,{LevelKey:()=>I});var M=v("./src/utils/keysystem-util.ts"),S=v("./src/utils/mediakeys-helper.ts"),k=v("./src/utils/mp4-tools.ts"),R=v("./src/utils/logger.ts"),K=v("./src/utils/numeric-encoding-utils.ts"),b={},I=function(){L.clearKeyUriToKeyIdMap=function(){b={}};function L(h,D,T,d,f){d===void 0&&(d=[1]),f===void 0&&(f=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=h,this.uri=D,this.keyFormat=T,this.keyFormatVersions=d,this.iv=f,this.encrypted=h?h!=="NONE":!1,this.isCommonEncryption=this.encrypted&&h!=="AES-128"}var A=L.prototype;return A.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case S.KeySystemFormats.FAIRPLAY:case S.KeySystemFormats.WIDEVINE:case S.KeySystemFormats.PLAYREADY:case S.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},A.getDecryptData=function(D){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof D!="number"&&(this.method==="AES-128"&&!this.iv&&R.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),D=0);var T=C(D),d=new L(this.method,this.uri,"identity",this.keyFormatVersions,T);return d}var f=(0,M.convertDataUriToArrayBytes)(this.uri);if(f)switch(this.keyFormat){case S.KeySystemFormats.WIDEVINE:this.pssh=f,f.length>=22&&(this.keyId=f.subarray(f.length-22,f.length-6));break;case S.KeySystemFormats.PLAYREADY:{var i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,k.mp4pssh)(i,null,f);var l=new Uint16Array(f.buffer,f.byteOffset,f.byteLength/2),p=String.fromCharCode.apply(null,Array.from(l)),m=p.substring(p.indexOf("<"),p.length),s=new DOMParser,c=s.parseFromString(m,"text/xml"),_=c.getElementsByTagName("KID")[0];if(_){var u=_.childNodes[0]?_.childNodes[0].nodeValue:_.getAttribute("VALUE");if(u){var o=(0,K.base64Decode)(u).subarray(0,16);(0,M.changeEndianness)(o),this.keyId=o}}break}default:{var n=f.subarray(0,16);if(n.length!==16){var g=new Uint8Array(16);g.set(n,16-n.length),n=g}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){var r=b[this.uri];if(!r){var E=Object.keys(b).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16);var P=new DataView(r.buffer,12,4);P.setUint32(0,E),b[this.uri]=r}this.keyId=r}return this},L}();function C(L){for(var A=new Uint8Array(16),h=12;h<16;h++)A[h]=L>>8*(15-h)&255;return A}},"./src/loader/load-stats.ts":(N,O,v)=>{v.r(O),v.d(O,{LoadStats:()=>M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>f});var M=v("./src/polyfills/number.ts"),S=v("./node_modules/url-toolkit/src/url-toolkit.js"),k=v("./src/loader/date-range.ts"),R=v("./src/loader/fragment.ts"),K=v("./src/loader/level-details.ts"),b=v("./src/loader/level-key.ts"),I=v("./src/utils/attr-list.ts"),C=v("./src/utils/logger.ts"),L=v("./src/utils/codecs.ts");function A(){return A=Object.assign?Object.assign.bind():function(u){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var g in n)Object.prototype.hasOwnProperty.call(n,g)&&(u[g]=n[g])}return u},A.apply(this,arguments)}var h=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,D=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),d=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),f=function(){function u(){}return u.findGroup=function(n,g){for(var r=0;r<n.length;r++){var E=n[r];if(E.id===g)return E}},u.convertAVC1ToAVCOTI=function(n){var g=n.split(".");if(g.length>2){var r=g.shift()+".";return r+=parseInt(g.shift()).toString(16),r+=("000"+parseInt(g.shift()).toString(16)).slice(-4),r}return n},u.resolve=function(n,g){return(0,S.buildAbsoluteURL)(g,n,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(n,g){var r=[],E=[],P={},y=[],U=!1;h.lastIndex=0;for(var B;(B=h.exec(n))!=null;)if(B[1]){var w,H=new I.AttrList(B[1]),G={attrs:H,bitrate:H.decimalInteger("AVERAGE-BANDWIDTH")||H.decimalInteger("BANDWIDTH"),name:H.NAME,url:u.resolve(B[2],g)},V=H.decimalResolution("RESOLUTION");V&&(G.width=V.width,G.height=V.height),l((H.CODECS||"").split(/[ ,]+/).filter(function(Y){return Y}),G),G.videoCodec&&G.videoCodec.indexOf("avc1")!==-1&&(G.videoCodec=u.convertAVC1ToAVCOTI(G.videoCodec)),(w=G.unknownCodecs)!==null&&w!==void 0&&w.length||E.push(G),r.push(G)}else if(B[3]){var z=new I.AttrList(B[3]);z["DATA-ID"]&&(U=!0,P[z["DATA-ID"]]=z)}else if(B[4]){var $=B[4],X=i($,g);X.encrypted&&X.isSupported()?y.push(X):C.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+$+'"')}var j=E.length>0&&E.length<r.length;return{levels:j?E:r,sessionData:U?P:null,sessionKeys:y.length?y:null}},u.parseMasterPlaylistMedia=function(n,g,r,E){E===void 0&&(E=[]);var P,y=[],U=0;for(D.lastIndex=0;(P=D.exec(n))!==null;){var B=new I.AttrList(P[1]);if(B.TYPE===r){var w={attrs:B,bitrate:0,id:U++,groupId:B["GROUP-ID"],instreamId:B["INSTREAM-ID"],name:B.NAME||B.LANGUAGE||"",type:r,default:B.bool("DEFAULT"),autoselect:B.bool("AUTOSELECT"),forced:B.bool("FORCED"),lang:B.LANGUAGE,url:B.URI?u.resolve(B.URI,g):""};if(E.length){var H=u.findGroup(E,w.groupId)||E[0];p(w,H,"audioCodec"),p(w,H,"textCodec")}y.push(w)}}return y},u.parseLevelPlaylist=function(n,g,r,E,P){var y=new K.LevelDetails(g),U=y.fragments,B=null,w=0,H=0,G=0,V=0,z=null,$=new R.Fragment(E,g),X,j,Y,Q=-1,J=!1;for(T.lastIndex=0,y.m3u8=n;(X=T.exec(n))!==null;){J&&(J=!1,$=new R.Fragment(E,g),$.start=G,$.sn=w,$.cc=V,$.level=r,B&&($.initSegment=B,$.rawProgramDateTime=B.rawProgramDateTime,B.rawProgramDateTime=null));var Z=X[1];if(Z){$.duration=parseFloat(Z);var ee=(" "+X[2]).slice(1);$.title=ee||null,$.tagList.push(ee?["INF",Z,ee]:["INF",Z])}else if(X[3])(0,M.isFiniteNumber)($.duration)&&($.start=G,Y&&_($,Y,y),$.sn=w,$.level=r,$.cc=V,$.urlId=P,U.push($),$.relurl=(" "+X[3]).slice(1),s($,z),z=$,G+=$.duration,w++,H=0,J=!0);else if(X[4]){var ne=(" "+X[4]).slice(1);z?$.setByteRange(ne,z):$.setByteRange(ne)}else if(X[5])$.rawProgramDateTime=(" "+X[5]).slice(1),$.tagList.push(["PROGRAM-DATE-TIME",$.rawProgramDateTime]),Q===-1&&(Q=U.length);else{if(X=X[0].match(d),!X){C.logger.warn("No matches on slow regex match for level playlist!");continue}for(j=1;j<X.length&&typeof X[j]=="undefined";j++);var te=(" "+X[j]).slice(1),q=(" "+X[j+1]).slice(1),re=X[j+2]?(" "+X[j+2]).slice(1):"";switch(te){case"PLAYLIST-TYPE":y.type=q.toUpperCase();break;case"MEDIA-SEQUENCE":w=y.startSN=parseInt(q);break;case"SKIP":{var se=new I.AttrList(q),ie=se.decimalInteger("SKIPPED-SEGMENTS");if((0,M.isFiniteNumber)(ie)){y.skippedSegments=ie;for(var ae=ie;ae--;)U.unshift(null);w+=ie}var oe=se.enumeratedString("RECENTLY-REMOVED-DATERANGES");oe&&(y.recentlyRemovedDateranges=oe.split("	"));break}case"TARGETDURATION":y.targetduration=parseFloat(q);break;case"VERSION":y.version=parseInt(q);break;case"EXTM3U":break;case"ENDLIST":y.live=!1;break;case"#":(q||re)&&$.tagList.push(re?[q,re]:[q]);break;case"DISCONTINUITY":V++,$.tagList.push(["DIS"]);break;case"GAP":$.tagList.push([te]);break;case"BITRATE":$.tagList.push([te,q]);break;case"DATERANGE":{var le=new I.AttrList(q),ue=new k.DateRange(le,y.dateRanges[le.ID]);ue.isValid||y.skippedSegments?y.dateRanges[ue.id]=ue:C.logger.warn('Ignoring invalid DATERANGE tag: "'+q+'"'),$.tagList.push(["EXT-X-DATERANGE",q]);break}case"DISCONTINUITY-SEQUENCE":V=parseInt(q);break;case"KEY":{var fe=i(q,g);if(fe.isSupported()){if(fe.method==="NONE"){Y=void 0;break}Y||(Y={}),Y[fe.keyFormat]&&(Y=A({},Y)),Y[fe.keyFormat]=fe}else C.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+q+'"');break}case"START":{var de=new I.AttrList(q),ve=de.decimalFloatingPoint("TIME-OFFSET");(0,M.isFiniteNumber)(ve)&&(y.startTimeOffset=ve);break}case"MAP":{var Le=new I.AttrList(q);if($.duration){var Ae=new R.Fragment(E,g);c(Ae,Le,r,Y),B=Ae,$.initSegment=B,B.rawProgramDateTime&&!$.rawProgramDateTime&&($.rawProgramDateTime=B.rawProgramDateTime)}else c($,Le,r,Y),B=$,J=!0;break}case"SERVER-CONTROL":{var De=new I.AttrList(q);y.canBlockReload=De.bool("CAN-BLOCK-RELOAD"),y.canSkipUntil=De.optionalFloat("CAN-SKIP-UNTIL",0),y.canSkipDateRanges=y.canSkipUntil>0&&De.bool("CAN-SKIP-DATERANGES"),y.partHoldBack=De.optionalFloat("PART-HOLD-BACK",0),y.holdBack=De.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ve=new I.AttrList(q);y.partTarget=Ve.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Ee=y.partList;Ee||(Ee=y.partList=[]);var Ce=H>0?Ee[Ee.length-1]:void 0,We=H++,$e=new R.Part(new I.AttrList(q),$,g,We,Ce);Ee.push($e),$.duration+=$e.duration;break}case"PRELOAD-HINT":{var Xe=new I.AttrList(q);y.preloadHint=Xe;break}case"RENDITION-REPORT":{var Be=new I.AttrList(q);y.renditionReports=y.renditionReports||[],y.renditionReports.push(Be);break}default:C.logger.warn("line parsed but not handled: "+X);break}}}z&&!z.relurl?(U.pop(),G-=z.duration,y.partList&&(y.fragmentHint=z)):y.partList&&(s($,z),$.cc=V,y.fragmentHint=$,Y&&_($,Y,y));var we=U.length,Qe=U[0],tt=U[we-1];if(G+=y.skippedSegments*y.targetduration,G>0&&we&&tt){y.averagetargetduration=G/we;var be=tt.sn;y.endSN=be!=="initSegment"?be:0,y.live||(tt.endList=!0),Qe&&(y.startCC=Qe.cc)}else y.endSN=0,y.startCC=0;return y.fragmentHint&&(G+=y.fragmentHint.duration),y.totalduration=G,y.endCC=V,Q>0&&m(U,Q),y},u}();function i(u,o){var n,g,r=new I.AttrList(u),E=(n=r.enumeratedString("METHOD"))!=null?n:"",P=r.URI,y=r.hexadecimalInteger("IV"),U=r.enumeratedString("KEYFORMATVERSIONS"),B=(g=r.enumeratedString("KEYFORMAT"))!=null?g:"identity";P&&r.IV&&!y&&C.logger.error("Invalid IV: "+r.IV);var w=P?f.resolve(P,o):"",H=(U||"1").split("/").map(Number).filter(Number.isFinite);return new b.LevelKey(E,w,B,H,y)}function l(u,o){["video","audio","text"].forEach(function(n){var g=u.filter(function(E){return(0,L.isCodecType)(E,n)});if(g.length){var r=g.filter(function(E){return E.lastIndexOf("avc1",0)===0||E.lastIndexOf("mp4a",0)===0});o[n+"Codec"]=r.length>0?r[0]:g[0],u=u.filter(function(E){return g.indexOf(E)===-1})}}),o.unknownCodecs=u}function p(u,o,n){var g=o[n];g&&(u[n]=g)}function m(u,o){for(var n=u[o],g=o;g--;){var r=u[g];if(!r)return;r.programDateTime=n.programDateTime-r.duration*1e3,n=r}}function s(u,o){u.rawProgramDateTime?u.programDateTime=Date.parse(u.rawProgramDateTime):o!=null&&o.programDateTime&&(u.programDateTime=o.endProgramDateTime),(0,M.isFiniteNumber)(u.programDateTime)||(u.programDateTime=null,u.rawProgramDateTime=null)}function c(u,o,n,g){u.relurl=o.URI,o.BYTERANGE&&u.setByteRange(o.BYTERANGE),u.level=n,u.sn="initSegment",g&&(u.levelkeys=g),u.initSegment=null}function _(u,o,n){u.levelkeys=o;var g=n.encryptedFragments;(!g.length||g[g.length-1].levelkeys!==o)&&Object.keys(o).some(function(r){return o[r].isCommonEncryption})&&g.push(u)}},"./src/loader/playlist-loader.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>h});var M=v("./src/polyfills/number.ts"),S=v("./src/events.ts"),k=v("./src/errors.ts"),R=v("./src/utils/logger.ts"),K=v("./src/loader/m3u8-parser.ts"),b=v("./src/types/loader.ts"),I=v("./src/utils/attr-list.ts");function C(D){var T=D.type;switch(T){case b.PlaylistContextType.AUDIO_TRACK:return b.PlaylistLevelType.AUDIO;case b.PlaylistContextType.SUBTITLE_TRACK:return b.PlaylistLevelType.SUBTITLE;default:return b.PlaylistLevelType.MAIN}}function L(D,T){var d=D.url;return(d===void 0||d.indexOf("data:")===0)&&(d=T.url),d}var A=function(){function D(d){this.hls=void 0,this.loaders=Object.create(null),this.hls=d,this.registerListeners()}var T=D.prototype;return T.startLoad=function(f){},T.stopLoad=function(){this.destroyInternalLoaders()},T.registerListeners=function(){var f=this.hls;f.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(S.Events.LEVEL_LOADING,this.onLevelLoading,this),f.on(S.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),f.on(S.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.unregisterListeners=function(){var f=this.hls;f.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(S.Events.LEVEL_LOADING,this.onLevelLoading,this),f.off(S.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),f.off(S.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},T.createInternalLoader=function(f){var i=this.hls.config,l=i.pLoader,p=i.loader,m=l||p,s=new m(i);return f.loader=s,this.loaders[f.type]=s,s},T.getInternalLoader=function(f){return this.loaders[f.type]},T.resetInternalLoader=function(f){this.loaders[f]&&delete this.loaders[f]},T.destroyInternalLoaders=function(){for(var f in this.loaders){var i=this.loaders[f];i&&i.destroy(),this.resetInternalLoader(f)}},T.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},T.onManifestLoading=function(f,i){var l=i.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:b.PlaylistContextType.MANIFEST,url:l,deliveryDirectives:null})},T.onLevelLoading=function(f,i){var l=i.id,p=i.level,m=i.url,s=i.deliveryDirectives;this.load({id:l,groupId:null,level:p,responseType:"text",type:b.PlaylistContextType.LEVEL,url:m,deliveryDirectives:s})},T.onAudioTrackLoading=function(f,i){var l=i.id,p=i.groupId,m=i.url,s=i.deliveryDirectives;this.load({id:l,groupId:p,level:null,responseType:"text",type:b.PlaylistContextType.AUDIO_TRACK,url:m,deliveryDirectives:s})},T.onSubtitleTrackLoading=function(f,i){var l=i.id,p=i.groupId,m=i.url,s=i.deliveryDirectives;this.load({id:l,groupId:p,level:null,responseType:"text",type:b.PlaylistContextType.SUBTITLE_TRACK,url:m,deliveryDirectives:s})},T.load=function(f){var i,l=this.hls.config,p=this.getInternalLoader(f);if(p){var m=p.context;if(m&&m.url===f.url){R.logger.trace("[playlist-loader]: playlist request ongoing");return}R.logger.log("[playlist-loader]: aborting previous loader for type: "+f.type),p.abort()}var s,c,_,u;switch(f.type){case b.PlaylistContextType.MANIFEST:s=l.manifestLoadingMaxRetry,c=l.manifestLoadingTimeOut,_=l.manifestLoadingRetryDelay,u=l.manifestLoadingMaxRetryTimeout;break;case b.PlaylistContextType.LEVEL:case b.PlaylistContextType.AUDIO_TRACK:case b.PlaylistContextType.SUBTITLE_TRACK:s=0,c=l.levelLoadingTimeOut;break;default:s=l.levelLoadingMaxRetry,c=l.levelLoadingTimeOut,_=l.levelLoadingRetryDelay,u=l.levelLoadingMaxRetryTimeout;break}if(p=this.createInternalLoader(f),(i=f.deliveryDirectives)!==null&&i!==void 0&&i.part){var o;if(f.type===b.PlaylistContextType.LEVEL&&f.level!==null?o=this.hls.levels[f.level].details:f.type===b.PlaylistContextType.AUDIO_TRACK&&f.id!==null?o=this.hls.audioTracks[f.id].details:f.type===b.PlaylistContextType.SUBTITLE_TRACK&&f.id!==null&&(o=this.hls.subtitleTracks[f.id].details),o){var n=o.partTarget,g=o.targetduration;n&&g&&(c=Math.min(Math.max(n*3,g*.8)*1e3,c))}}var r={timeout:c,maxRetry:s,retryDelay:_,maxRetryDelay:u,highWaterMark:0},E={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};p.load(f,r,E)},T.loadsuccess=function(f,i,l,p){p===void 0&&(p=null),this.resetInternalLoader(l.type);var m=f.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(f,l,"no EXTM3U delimiter",p);return}i.parsing.start=performance.now(),m.indexOf("#EXTINF:")>0||m.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(f,i,l,p):this.handleMasterPlaylist(f,i,l,p)},T.loaderror=function(f,i,l){l===void 0&&(l=null),this.handleNetworkError(i,l,!1,f)},T.loadtimeout=function(f,i,l){l===void 0&&(l=null),this.handleNetworkError(i,l,!0)},T.handleMasterPlaylist=function(f,i,l,p){var m=this.hls,s=f.data,c=L(f,l),_=K.default.parseMasterPlaylist(s,c),u=_.levels,o=_.sessionData,n=_.sessionKeys;if(!u.length){this.handleManifestParsingError(f,l,"no level found in manifest",p);return}var g=u.map(function(B){return{id:B.attrs.AUDIO,audioCodec:B.audioCodec}}),r=u.map(function(B){return{id:B.attrs.SUBTITLES,textCodec:B.textCodec}}),E=K.default.parseMasterPlaylistMedia(s,c,"AUDIO",g),P=K.default.parseMasterPlaylistMedia(s,c,"SUBTITLES",r),y=K.default.parseMasterPlaylistMedia(s,c,"CLOSED-CAPTIONS");if(E.length){var U=E.some(function(B){return!B.url});!U&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(R.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new I.AttrList({}),bitrate:0,url:""}))}m.trigger(S.Events.MANIFEST_LOADED,{levels:u,audioTracks:E,subtitles:P,captions:y,url:c,stats:i,networkDetails:p,sessionData:o,sessionKeys:n})},T.handleTrackOrLevelPlaylist=function(f,i,l,p){var m=this.hls,s=l.id,c=l.level,_=l.type,u=L(f,l),o=(0,M.isFiniteNumber)(s)?s:0,n=(0,M.isFiniteNumber)(c)?c:o,g=C(l),r=K.default.parseLevelPlaylist(f.data,u,n,g,o);if(!r.fragments.length){m.trigger(S.Events.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:u,reason:"no fragments found in level",level:typeof l.level=="number"?l.level:void 0});return}if(_===b.PlaylistContextType.MANIFEST){var E={attrs:new I.AttrList({}),bitrate:0,details:r,name:"",url:u};m.trigger(S.Events.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:u,stats:i,networkDetails:p,sessionData:null,sessionKeys:null})}i.parsing.end=performance.now(),l.levelDetails=r,this.handlePlaylistLoaded(f,i,l,p)},T.handleManifestParsingError=function(f,i,l,p){this.hls.trigger(S.Events.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:i.type===b.PlaylistContextType.MANIFEST,url:f.url,reason:l,response:f,context:i,networkDetails:p})},T.handleNetworkError=function(f,i,l,p){l===void 0&&(l=!1),R.logger.warn("[playlist-loader]: A network "+(l?"timeout":"error")+" occurred while loading "+f.type+" level: "+f.level+" id: "+f.id+' group-id: "'+f.groupId+'"');var m=k.ErrorDetails.UNKNOWN,s=!1,c=this.getInternalLoader(f);switch(f.type){case b.PlaylistContextType.MANIFEST:m=l?k.ErrorDetails.MANIFEST_LOAD_TIMEOUT:k.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case b.PlaylistContextType.LEVEL:m=l?k.ErrorDetails.LEVEL_LOAD_TIMEOUT:k.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case b.PlaylistContextType.AUDIO_TRACK:m=l?k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;case b.PlaylistContextType.SUBTITLE_TRACK:m=l?k.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:k.ErrorDetails.SUBTITLE_LOAD_ERROR,s=!1;break}c&&this.resetInternalLoader(f.type);var _={type:k.ErrorTypes.NETWORK_ERROR,details:m,fatal:s,url:f.url,loader:c,context:f,networkDetails:i};p&&(_.response=p),this.hls.trigger(S.Events.ERROR,_)},T.handlePlaylistLoaded=function(f,i,l,p){var m=l.type,s=l.level,c=l.id,_=l.groupId,u=l.loader,o=l.levelDetails,n=l.deliveryDirectives;if(!(o!=null&&o.targetduration)){this.handleManifestParsingError(f,l,"invalid target duration",p);return}if(!!u)switch(o.live&&(u.getCacheAge&&(o.ageHeader=u.getCacheAge()||0),(!u.getCacheAge||isNaN(o.ageHeader))&&(o.ageHeader=0)),m){case b.PlaylistContextType.MANIFEST:case b.PlaylistContextType.LEVEL:this.hls.trigger(S.Events.LEVEL_LOADED,{details:o,level:s||0,id:c||0,stats:i,networkDetails:p,deliveryDirectives:n});break;case b.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(S.Events.AUDIO_TRACK_LOADED,{details:o,id:c||0,groupId:_||"",stats:i,networkDetails:p,deliveryDirectives:n});break;case b.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(S.Events.SUBTITLE_TRACK_LOADED,{details:o,id:c||0,groupId:_||"",stats:i,networkDetails:p,deliveryDirectives:n});break}},D}();const h=A},"./src/polyfills/number.ts":(N,O,v)=>{v.r(O),v.d(O,{MAX_SAFE_INTEGER:()=>S,isFiniteNumber:()=>M});var M=Number.isFinite||function(k){return typeof k=="number"&&isFinite(k)},S=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>S});var M=function(){function k(){}return k.getSilentFrame=function(K,b){switch(K){case"mp4a.40.2":if(b===1)return new Uint8Array([0,200,0,128,35,128]);if(b===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(b===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(b===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(b===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(b===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(b===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(b===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(b===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},k}();const S=M},"./src/remux/mp4-generator.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>k});var M=Math.pow(2,32)-1,S=function(){function R(){}return R.init=function(){R.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in R.types)R.types.hasOwnProperty(b)&&(R.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),C=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);R.HDLR_TYPES={video:I,audio:C};var L=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),A=new Uint8Array([0,0,0,0,0,0,0,0]);R.STTS=R.STSC=R.STCO=A,R.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),R.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),R.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),R.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var h=new Uint8Array([105,115,111,109]),D=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);R.FTYP=R.box(R.types.ftyp,h,T,h,D),R.DINF=R.box(R.types.dinf,R.box(R.types.dref,L))},R.box=function(b){for(var I=8,C=arguments.length,L=new Array(C>1?C-1:0),A=1;A<C;A++)L[A-1]=arguments[A];for(var h=L.length,D=h;h--;)I+=L[h].byteLength;var T=new Uint8Array(I);for(T[0]=I>>24&255,T[1]=I>>16&255,T[2]=I>>8&255,T[3]=I&255,T.set(b,4),h=0,I=8;h<D;h++)T.set(L[h],I),I+=L[h].byteLength;return T},R.hdlr=function(b){return R.box(R.types.hdlr,R.HDLR_TYPES[b])},R.mdat=function(b){return R.box(R.types.mdat,b)},R.mdhd=function(b,I){I*=b;var C=Math.floor(I/(M+1)),L=Math.floor(I%(M+1));return R.box(R.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,C>>24,C>>16&255,C>>8&255,C&255,L>>24,L>>16&255,L>>8&255,L&255,85,196,0,0]))},R.mdia=function(b){return R.box(R.types.mdia,R.mdhd(b.timescale,b.duration),R.hdlr(b.type),R.minf(b))},R.mfhd=function(b){return R.box(R.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,b&255]))},R.minf=function(b){return b.type==="audio"?R.box(R.types.minf,R.box(R.types.smhd,R.SMHD),R.DINF,R.stbl(b)):R.box(R.types.minf,R.box(R.types.vmhd,R.VMHD),R.DINF,R.stbl(b))},R.moof=function(b,I,C){return R.box(R.types.moof,R.mfhd(b),R.traf(C,I))},R.moov=function(b){for(var I=b.length,C=[];I--;)C[I]=R.trak(b[I]);return R.box.apply(null,[R.types.moov,R.mvhd(b[0].timescale,b[0].duration)].concat(C).concat(R.mvex(b)))},R.mvex=function(b){for(var I=b.length,C=[];I--;)C[I]=R.trex(b[I]);return R.box.apply(null,[R.types.mvex].concat(C))},R.mvhd=function(b,I){I*=b;var C=Math.floor(I/(M+1)),L=Math.floor(I%(M+1)),A=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,b&255,C>>24,C>>16&255,C>>8&255,C&255,L>>24,L>>16&255,L>>8&255,L&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return R.box(R.types.mvhd,A)},R.sdtp=function(b){var I=b.samples||[],C=new Uint8Array(4+I.length),L,A;for(L=0;L<I.length;L++)A=I[L].flags,C[L+4]=A.dependsOn<<4|A.isDependedOn<<2|A.hasRedundancy;return R.box(R.types.sdtp,C)},R.stbl=function(b){return R.box(R.types.stbl,R.stsd(b),R.box(R.types.stts,R.STTS),R.box(R.types.stsc,R.STSC),R.box(R.types.stsz,R.STSZ),R.box(R.types.stco,R.STCO))},R.avc1=function(b){var I=[],C=[],L,A,h;for(L=0;L<b.sps.length;L++)A=b.sps[L],h=A.byteLength,I.push(h>>>8&255),I.push(h&255),I=I.concat(Array.prototype.slice.call(A));for(L=0;L<b.pps.length;L++)A=b.pps[L],h=A.byteLength,C.push(h>>>8&255),C.push(h&255),C=C.concat(Array.prototype.slice.call(A));var D=R.box(R.types.avcC,new Uint8Array([1,I[3],I[4],I[5],255,224|b.sps.length].concat(I).concat([b.pps.length]).concat(C))),T=b.width,d=b.height,f=b.pixelRatio[0],i=b.pixelRatio[1];return R.box(R.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,T&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),D,R.box(R.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),R.box(R.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,i>>24,i>>16&255,i>>8&255,i&255])))},R.esds=function(b){var I=b.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(b.config).concat([6,1,2]))},R.mp4a=function(b){var I=b.samplerate;return R.box(R.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]),R.box(R.types.esds,R.esds(b)))},R.mp3=function(b){var I=b.samplerate;return R.box(R.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]))},R.stsd=function(b){return b.type==="audio"?b.segmentCodec==="mp3"&&b.codec==="mp3"?R.box(R.types.stsd,R.STSD,R.mp3(b)):R.box(R.types.stsd,R.STSD,R.mp4a(b)):R.box(R.types.stsd,R.STSD,R.avc1(b))},R.tkhd=function(b){var I=b.id,C=b.duration*b.timescale,L=b.width,A=b.height,h=Math.floor(C/(M+1)),D=Math.floor(C%(M+1));return R.box(R.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,0,0,0,0,h>>24,h>>16&255,h>>8&255,h&255,D>>24,D>>16&255,D>>8&255,D&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,L>>8&255,L&255,0,0,A>>8&255,A&255,0,0]))},R.traf=function(b,I){var C=R.sdtp(b),L=b.id,A=Math.floor(I/(M+1)),h=Math.floor(I%(M+1));return R.box(R.types.traf,R.box(R.types.tfhd,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255])),R.box(R.types.tfdt,new Uint8Array([1,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,h>>24,h>>16&255,h>>8&255,h&255])),R.trun(b,C.length+16+20+8+16+8+8),C)},R.trak=function(b){return b.duration=b.duration||4294967295,R.box(R.types.trak,R.tkhd(b),R.mdia(b))},R.trex=function(b){var I=b.id;return R.box(R.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},R.trun=function(b,I){var C=b.samples||[],L=C.length,A=12+16*L,h=new Uint8Array(A),D,T,d,f,i,l;for(I+=8+A,h.set([b.type==="video"?1:0,0,15,1,L>>>24&255,L>>>16&255,L>>>8&255,L&255,I>>>24&255,I>>>16&255,I>>>8&255,I&255],0),D=0;D<L;D++)T=C[D],d=T.duration,f=T.size,i=T.flags,l=T.cts,h.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,i.isLeading<<2|i.dependsOn,i.isDependedOn<<6|i.hasRedundancy<<4|i.paddingValue<<1|i.isNonSync,i.degradPrio&240<<8,i.degradPrio&15,l>>>24&255,l>>>16&255,l>>>8&255,l&255],12+16*D);return R.box(R.types.trun,h)},R.initSegment=function(b){R.types||R.init();var I=R.moov(b),C=new Uint8Array(R.FTYP.byteLength+I.byteLength);return C.set(R.FTYP),C.set(I,R.FTYP.byteLength),C},R}();S.types=void 0,S.HDLR_TYPES=void 0,S.STTS=void 0,S.STSC=void 0,S.STCO=void 0,S.STSZ=void 0,S.VMHD=void 0,S.SMHD=void 0,S.STSD=void 0,S.FTYP=void 0,S.DINF=void 0;const k=S},"./src/remux/mp4-remuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>f,flushTextTrackMetadataCueSamples:()=>p,flushTextTrackUserdataCueSamples:()=>m,normalizePts:()=>i});var M=v("./src/polyfills/number.ts"),S=v("./src/remux/aac-helper.ts"),k=v("./src/remux/mp4-generator.ts"),R=v("./src/events.ts"),K=v("./src/errors.ts"),b=v("./src/utils/logger.ts"),I=v("./src/types/loader.ts"),C=v("./src/utils/timescale-conversion.ts");function L(){return L=Object.assign?Object.assign.bind():function(_){for(var u=1;u<arguments.length;u++){var o=arguments[u];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(_[n]=o[n])}return _},L.apply(this,arguments)}var A=10*1e3,h=1024,D=1152,T=null,d=null,f=function(){function _(o,n,g,r){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=o,this.config=n,this.typeSupported=g,this.ISGenerated=!1,T===null){var E=navigator.userAgent||"",P=E.match(/Chrome\/(\d+)/i);T=P?parseInt(P[1]):0}if(d===null){var y=navigator.userAgent.match(/Safari\/(\d+)/i);d=y?parseInt(y[1]):0}}var u=_.prototype;return u.destroy=function(){},u.resetTimeStamp=function(n){b.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=n},u.resetNextTimestamp=function(){b.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){b.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},u.getVideoStartPts=function(n){var g=!1,r=n.reduce(function(E,P){var y=P.pts-E;return y<-4294967296?(g=!0,i(E,P.pts)):y>0?E:P.pts},n[0].pts);return g&&b.logger.debug("PTS rollover detected"),r},u.remux=function(n,g,r,E,P,y,U,B){var w,H,G,V,z,$,X=P,j=P,Y=n.pid>-1,Q=g.pid>-1,J=g.samples.length,Z=n.samples.length>0,ee=U&&J>0||J>1,ne=(!Y||Z)&&(!Q||ee)||this.ISGenerated||U;if(ne){this.ISGenerated||(G=this.generateIS(n,g,P));var te=this.isVideoContiguous,q=-1,re;if(ee&&(q=l(g.samples),!te&&this.config.forceKeyFrameOnDiscontinuity))if($=!0,q>0){b.logger.warn("[mp4-remuxer]: Dropped "+q+" out of "+J+" video samples due to a missing keyframe");var se=this.getVideoStartPts(g.samples);g.samples=g.samples.slice(q),g.dropped+=q,j+=(g.samples[0].pts-se)/g.inputTimeScale,re=j}else q===-1&&(b.logger.warn("[mp4-remuxer]: No keyframe found out of "+J+" video samples"),$=!1);if(this.ISGenerated){if(Z&&ee){var ie=this.getVideoStartPts(g.samples),ae=i(n.samples[0].pts,ie)-ie,oe=ae/g.inputTimeScale;X+=Math.max(0,oe),j+=Math.max(0,-oe)}if(Z){if(n.samplerate||(b.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),G=this.generateIS(n,g,P)),H=this.remuxAudio(n,X,this.isAudioContiguous,y,Q||ee||B===I.PlaylistLevelType.AUDIO?j:void 0),ee){var le=H?H.endPTS-H.startPTS:0;g.inputTimeScale||(b.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),G=this.generateIS(n,g,P)),w=this.remuxVideo(g,j,te,le)}}else ee&&(w=this.remuxVideo(g,j,te,0));w&&(w.firstKeyFrame=q,w.independent=q!==-1,w.firstKeyFramePTS=re)}}return this.ISGenerated&&(r.samples.length&&(z=p(r,P,this._initPTS,this._initDTS)),E.samples.length&&(V=m(E,P,this._initPTS))),{audio:H,video:w,initSegment:G,independent:$,text:V,id3:z}},u.generateIS=function(n,g,r){var E=n.samples,P=g.samples,y=this.typeSupported,U={},B=!(0,M.isFiniteNumber)(this._initPTS),w="audio/mp4",H,G,V;if(B&&(H=G=1/0),n.config&&E.length){switch(n.timescale=n.samplerate,n.segmentCodec){case"mp3":y.mpeg?(w="audio/mpeg",n.codec=""):y.mp3&&(n.codec="mp3");break}U.audio={id:"audio",container:w,codec:n.codec,initSegment:n.segmentCodec==="mp3"&&y.mpeg?new Uint8Array(0):k.default.initSegment([n]),metadata:{channelCount:n.channelCount}},B&&(V=n.inputTimeScale,H=G=E[0].pts-Math.round(V*r))}if(g.sps&&g.pps&&P.length&&(g.timescale=g.inputTimeScale,U.video={id:"main",container:"video/mp4",codec:g.codec,initSegment:k.default.initSegment([g]),metadata:{width:g.width,height:g.height}},B)){V=g.inputTimeScale;var z=this.getVideoStartPts(P),$=Math.round(V*r);G=Math.min(G,i(P[0].dts,z)-$),H=Math.min(H,z-$)}if(Object.keys(U).length)return this.ISGenerated=!0,B&&(this._initPTS=H,this._initDTS=G),{tracks:U,initPTS:H,timescale:V}},u.remuxVideo=function(n,g,r,E){var P=n.inputTimeScale,y=n.samples,U=[],B=y.length,w=this._initPTS,H=this.nextAvcDts,G=8,V=this.videoSampleDuration,z,$,X=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,Y=!1;if(!r||H===null){var Q=g*P,J=y[0].pts-i(y[0].dts,y[0].pts);H=Q-J}for(var Z=0;Z<B;Z++){var ee=y[Z];ee.pts=i(ee.pts-w,H),ee.dts=i(ee.dts-w,H),ee.dts<y[Z>0?Z-1:Z].dts&&(Y=!0)}Y&&y.sort(function(An,Hi){var Ho=An.dts-Hi.dts,Go=An.pts-Hi.pts;return Ho||Go}),z=y[0].dts,$=y[y.length-1].dts;var ne=$-z,te=ne?Math.round(ne/(B-1)):V||n.inputTimeScale/30;if(r){var q=z-H,re=q>te,se=q<-1;if((re||se)&&(re?b.logger.warn("AVC: "+(0,C.toMsFromMpegTsClock)(q,!0)+" ms ("+q+"dts) hole between fragments detected, filling it"):b.logger.warn("AVC: "+(0,C.toMsFromMpegTsClock)(-q,!0)+" ms ("+q+"dts) overlapping between fragments detected"),!se||H>y[0].pts)){z=H;var ie=y[0].pts-q;y[0].dts=z,y[0].pts=ie,b.logger.log("Video: First PTS/DTS adjusted: "+(0,C.toMsFromMpegTsClock)(ie,!0)+"/"+(0,C.toMsFromMpegTsClock)(z,!0)+", delta: "+(0,C.toMsFromMpegTsClock)(q,!0)+" ms")}}z=Math.max(0,z);for(var ae=0,oe=0,le=0;le<B;le++){for(var ue=y[le],fe=ue.units,de=fe.length,ve=0,Le=0;Le<de;Le++)ve+=fe[Le].data.length;oe+=ve,ae+=de,ue.length=ve,ue.dts=Math.max(ue.dts,z),X=Math.min(ue.pts,X),j=Math.max(ue.pts,j)}$=y[B-1].dts;var Ae=oe+4*ae+8,De;try{De=new Uint8Array(Ae)}catch{this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:K.ErrorTypes.MUX_ERROR,details:K.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ae,reason:"fail allocating video mdat "+Ae});return}var Ve=new DataView(De.buffer);Ve.setUint32(0,Ae),De.set(k.default.types.mdat,4);for(var Ee=!1,Ce=Number.POSITIVE_INFINITY,We=Number.POSITIVE_INFINITY,$e=Number.NEGATIVE_INFINITY,Xe=Number.NEGATIVE_INFINITY,Be=0;Be<B;Be++){for(var we=y[Be],Qe=we.units,tt=0,be=0,ft=Qe.length;be<ft;be++){var rt=Qe[be],Br=rt.data,wt=rt.data.byteLength;Ve.setUint32(G,wt),G+=4,De.set(Br,G),G+=wt,tt+=4+wt}var Xt=void 0;if(Be<B-1)V=y[Be+1].dts-we.dts,Xt=y[Be+1].pts-we.pts;else{var Bi=this.config,Nr=Be>0?we.dts-y[Be-1].dts:te;if(Xt=Be>0?we.pts-y[Be-1].pts:te,Bi.stretchShortVideoTrack&&this.nextAudioPts!==null){var Fo=Math.floor(Bi.maxBufferHole*P),xn=(E?X+E*P:this.nextAudioPts)-we.pts;xn>Fo?(V=xn-Nr,V<0?V=Nr:Ee=!0,b.logger.log("[mp4-remuxer]: It is approximately "+xn/90+" ms to the next segment; using duration "+V/90+" ms for the last video frame.")):V=Nr}else V=Nr}var ko=Math.round(we.pts-we.dts);Ce=Math.min(Ce,V),$e=Math.max($e,V),We=Math.min(We,Xt),Xe=Math.max(Xe,Xt),U.push(new s(we.key,V,tt,ko))}if(U.length){if(T){if(T<70){var Ni=U[0].flags;Ni.dependsOn=2,Ni.isNonSync=0}}else if(d&&Xe-We<$e-Ce&&te/$e<.025&&U[0].cts===0){b.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ln=z,nt=0,Ki=U.length;nt<Ki;nt++){var Wi=Ln+U[nt].duration,Uo=Ln+U[nt].cts;if(nt<Ki-1){var Bo=Wi+U[nt+1].cts;U[nt].duration=Bo-Uo}else U[nt].duration=nt?U[nt-1].duration:te;U[nt].cts=0,Ln=Wi}}}console.assert(V!==null,"mp4SampleDuration must be computed"),V=Ee||!V?te:V,this.nextAvcDts=H=$+V,this.videoSampleDuration=V,this.isVideoContiguous=!0;var No=k.default.moof(n.sequenceNumber++,z,L({},n,{samples:U})),Ko="video",Wo={data1:No,data2:De,startPTS:X/P,endPTS:(j+V)/P,startDTS:z/P,endDTS:H/P,type:Ko,hasAudio:!1,hasVideo:!0,nb:U.length,dropped:n.dropped};return n.samples=[],n.dropped=0,console.assert(De.length,"MDAT length must not be zero"),Wo},u.remuxAudio=function(n,g,r,E,P){var y=n.inputTimeScale,U=n.samplerate?n.samplerate:y,B=y/U,w=n.segmentCodec==="aac"?h:D,H=w*B,G=this._initPTS,V=n.segmentCodec==="mp3"&&this.typeSupported.mpeg,z=[],$=P!==void 0,X=n.samples,j=V?0:8,Y=this.nextAudioPts||-1,Q=g*y;if(this.isAudioContiguous=r=r||X.length&&Y>0&&(E&&Math.abs(Q-Y)<9e3||Math.abs(i(X[0].pts-G,Q)-Y)<20*H),X.forEach(function(rt){rt.pts=i(rt.pts-G,Q)}),!r||Y<0){if(X=X.filter(function(rt){return rt.pts>=0}),!X.length)return;P===0?Y=0:E&&!$?Y=Math.max(0,Q):Y=X[0].pts}if(n.segmentCodec==="aac")for(var J=this.config.maxAudioFramesDrift,Z=0,ee=Y;Z<X.length;Z++){var ne=X[Z],te=ne.pts,q=te-ee,re=Math.abs(1e3*q/y);if(q<=-J*H&&$)Z===0&&(b.logger.warn("Audio frame @ "+(te/y).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*q/y)+" ms."),this.nextAudioPts=Y=ee=te);else if(q>=J*H&&re<A&&$){var se=Math.round(q/H);ee=te-se*H,ee<0&&(se--,ee+=H),Z===0&&(this.nextAudioPts=Y=ee),b.logger.warn("[mp4-remuxer]: Injecting "+se+" audio frame @ "+(ee/y).toFixed(3)+"s due to "+Math.round(1e3*q/y)+" ms gap.");for(var ie=0;ie<se;ie++){var ae=Math.max(ee,0),oe=S.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);oe||(b.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),oe=ne.unit.subarray()),X.splice(Z,0,{unit:oe,pts:ae}),ee+=H,Z++}}ne.pts=ee,ee+=H}for(var le=null,ue=null,fe,de=0,ve=X.length;ve--;)de+=X[ve].unit.byteLength;for(var Le=0,Ae=X.length;Le<Ae;Le++){var De=X[Le],Ve=De.unit,Ee=De.pts;if(ue!==null){var Ce=z[Le-1];Ce.duration=Math.round((Ee-ue)/B)}else if(r&&n.segmentCodec==="aac"&&(Ee=Y),le=Ee,de>0){de+=j;try{fe=new Uint8Array(de)}catch{this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:K.ErrorTypes.MUX_ERROR,details:K.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:de,reason:"fail allocating audio mdat "+de});return}if(!V){var We=new DataView(fe.buffer);We.setUint32(0,de),fe.set(k.default.types.mdat,4)}}else return;fe.set(Ve,j);var $e=Ve.byteLength;j+=$e,z.push(new s(!0,w,$e,0)),ue=Ee}var Xe=z.length;if(!!Xe){var Be=z[z.length-1];this.nextAudioPts=Y=ue+B*Be.duration;var we=V?new Uint8Array(0):k.default.moof(n.sequenceNumber++,le/B,L({},n,{samples:z}));n.samples=[];var Qe=le/y,tt=Y/y,be="audio",ft={data1:we,data2:fe,startPTS:Qe,endPTS:tt,startDTS:Qe,endDTS:tt,type:be,hasAudio:!0,hasVideo:!1,nb:Xe};return this.isAudioContiguous=!0,console.assert(fe.length,"MDAT length must not be zero"),ft}},u.remuxEmptyAudio=function(n,g,r,E){var P=n.inputTimeScale,y=n.samplerate?n.samplerate:P,U=P/y,B=this.nextAudioPts,w=(B!==null?B:E.startDTS*P)+this._initDTS,H=E.endDTS*P+this._initDTS,G=U*h,V=Math.ceil((H-w)/G),z=S.default.getSilentFrame(n.manifestCodec||n.codec,n.channelCount);if(b.logger.warn("[mp4-remuxer]: remux empty Audio"),!z){b.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var $=[],X=0;X<V;X++){var j=w+X*G;$.push({unit:z,pts:j,dts:j})}return n.samples=$,this.remuxAudio(n,g,r,!1)},_}();function i(_,u){var o;if(u===null)return _;for(u<_?o=-8589934592:o=8589934592;Math.abs(_-u)>4294967296;)_+=o;return _}function l(_){for(var u=0;u<_.length;u++)if(_[u].key)return u;return-1}function p(_,u,o,n){var g=_.samples.length;if(!!g){for(var r=_.inputTimeScale,E=0;E<g;E++){var P=_.samples[E];P.pts=i(P.pts-o,u*r)/r,P.dts=i(P.dts-n,u*r)/r}var y=_.samples;return _.samples=[],{samples:y}}}function m(_,u,o){var n=_.samples.length;if(!!n){for(var g=_.inputTimeScale,r=0;r<n;r++){var E=_.samples[r];E.pts=i(E.pts-o,u*g)/g}_.samples.sort(function(y,U){return y.pts-U.pts});var P=_.samples;return _.samples=[],{samples:P}}}var s=function(u,o,n,g){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=o,this.size=n,this.cts=g,this.flags=new c(u)},c=function(u){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=u?2:1,this.isNonSync=u?0:1}},"./src/remux/passthrough-remuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>C});var M=v("./src/polyfills/number.ts"),S=v("./src/remux/mp4-remuxer.ts"),k=v("./src/utils/mp4-tools.ts"),R=v("./src/loader/fragment.ts"),K=v("./src/utils/logger.ts"),b=function(){function L(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var A=L.prototype;return A.destroy=function(){},A.resetTimeStamp=function(D){this.initPTS=D,this.lastEndTime=null},A.resetNextTimestamp=function(){this.lastEndTime=null},A.resetInitSegment=function(D,T,d,f){this.audioCodec=T,this.videoCodec=d,this.generateInitSegment((0,k.patchEncyptionData)(D,f)),this.emitInitSegment=!0},A.generateInitSegment=function(D){var T=this.audioCodec,d=this.videoCodec;if(!D||!D.byteLength){this.initTracks=void 0,this.initData=void 0;return}var f=this.initData=(0,k.parseInitSegment)(D);T||(T=I(f.audio,R.ElementaryStreamTypes.AUDIO)),d||(d=I(f.video,R.ElementaryStreamTypes.VIDEO));var i={};f.audio&&f.video?i.audiovideo={container:"video/mp4",codec:T+","+d,initSegment:D,id:"main"}:f.audio?i.audio={container:"audio/mp4",codec:T,initSegment:D,id:"audio"}:f.video?i.video={container:"video/mp4",codec:d,initSegment:D,id:"main"}:K.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=i},A.remux=function(D,T,d,f,i){var l,p=this.initPTS,m=this.lastEndTime,s={audio:void 0,video:void 0,text:f,id3:d,initSegment:void 0};(0,M.isFiniteNumber)(m)||(m=this.lastEndTime=i||0);var c=T.samples;if(!c||!c.length)return s;var _={initPTS:void 0,timescale:1},u=this.initData;if((!u||!u.length)&&(this.generateInitSegment(c),u=this.initData),!u||!u.length)return K.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),s;this.emitInitSegment&&(_.tracks=this.initTracks,this.emitInitSegment=!1);var o=(0,k.getStartDTS)(u,c);(0,M.isFiniteNumber)(p)||(this.initPTS=_.initPTS=p=o-i);var n=(0,k.getDuration)(c,u),g=D?o-p:m,r=g+n;(0,k.offsetStartDTS)(u,c,p),n>0?this.lastEndTime=r:(K.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var E=!!u.audio,P=!!u.video,y="";E&&(y+="audio"),P&&(y+="video");var U={data1:c,startPTS:g,startDTS:g,endPTS:r,endDTS:r,type:y,hasAudio:E,hasVideo:P,nb:1,dropped:0};s.audio=U.type==="audio"?U:void 0,s.video=U.type!=="audio"?U:void 0,s.initSegment=_;var B=(l=this.initPTS)!=null?l:0;return s.id3=(0,S.flushTextTrackMetadataCueSamples)(d,i,B,B),f.samples.length&&(s.text=(0,S.flushTextTrackUserdataCueSamples)(f,i,B)),s},L}();function I(L,A){var h=L==null?void 0:L.codec;return h&&h.length>4?h:h==="hvc1"||h==="hev1"?"hvc1.1.c.L120.90":h==="av01"?"av01.0.04M.08":h==="avc1"||A===R.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const C=b},"./src/task-loop.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>M});var M=function(){function S(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var k=S.prototype;return k.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},k.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},k.onHandlerDestroyed=function(){},k.hasInterval=function(){return!!this._tickInterval},k.hasNextTick=function(){return!!this._tickTimer},k.setInterval=function(K){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,K),!0)},k.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},k.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},k.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},k.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},k.doTick=function(){},S}()},"./src/types/cmcd.ts":(N,O,v)=>{v.r(O),v.d(O,{CMCDObjectType:()=>S,CMCDStreamType:()=>R,CMCDStreamingFormat:()=>k,CMCDVersion:()=>M});var M=1,S;(function(K){K.MANIFEST="m",K.AUDIO="a",K.VIDEO="v",K.MUXED="av",K.INIT="i",K.CAPTION="c",K.TIMED_TEXT="tt",K.KEY="k",K.OTHER="o"})(S||(S={}));var k;(function(K){K.DASH="d",K.HLS="h",K.SMOOTH="s",K.OTHER="o"})(k||(k={}));var R;(function(K){K.VOD="v",K.LIVE="l"})(R||(R={}))},"./src/types/demuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{MetadataSchema:()=>M});var M;(function(S){S.audioId3="org.id3",S.dateRange="com.apple.quicktime.HLS",S.emsg="https://aomedia.org/emsg/ID3"})(M||(M={}))},"./src/types/level.ts":(N,O,v)=>{v.r(O),v.d(O,{HdcpLevels:()=>K,HlsSkip:()=>b,HlsUrlParameters:()=>C,Level:()=>L,getSkipValue:()=>I});function M(A,h){for(var D=0;D<h.length;D++){var T=h[D];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(A,k(T.key),T)}}function S(A,h,D){return h&&M(A.prototype,h),D&&M(A,D),Object.defineProperty(A,"prototype",{writable:!1}),A}function k(A){var h=R(A,"string");return typeof h=="symbol"?h:String(h)}function R(A,h){if(typeof A!="object"||A===null)return A;var D=A[Symbol.toPrimitive];if(D!==void 0){var T=D.call(A,h||"default");if(typeof T!="object")return T;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(A)}var K=["NONE","TYPE-0","TYPE-1","TYPE-2",null],b;(function(A){A.No="",A.Yes="YES",A.v2="v2"})(b||(b={}));function I(A,h){var D=A.canSkipUntil,T=A.canSkipDateRanges,d=A.endSN,f=h!==void 0?h-d:0;return D&&f<D?T?b.v2:b.Yes:b.No}var C=function(){function A(D,T,d){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=D,this.part=T,this.skip=d}var h=A.prototype;return h.addDirectives=function(T){var d=new self.URL(T);return this.msn!==void 0&&d.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&d.searchParams.set("_HLS_part",this.part.toString()),this.skip&&d.searchParams.set("_HLS_skip",this.skip),d.href},A}(),L=function(){function A(h){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[h.url],this.attrs=h.attrs,this.bitrate=h.bitrate,h.details&&(this.details=h.details),this.id=h.id||0,this.name=h.name,this.width=h.width||0,this.height=h.height||0,this.audioCodec=h.audioCodec,this.videoCodec=h.videoCodec,this.unknownCodecs=h.unknownCodecs,this.codecSet=[h.videoCodec,h.audioCodec].filter(function(D){return D}).join(",").replace(/\.[^.,]+/g,"")}return S(A,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(D){var T=D%this.url.length;this._urlId!==T&&(this.details=void 0,this._urlId=T)}}]),A}()},"./src/types/loader.ts":(N,O,v)=>{v.r(O),v.d(O,{PlaylistContextType:()=>M,PlaylistLevelType:()=>S});var M;(function(k){k.MANIFEST="manifest",k.LEVEL="level",k.AUDIO_TRACK="audioTrack",k.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var S;(function(k){k.MAIN="main",k.AUDIO="audio",k.SUBTITLE="subtitle"})(S||(S={}))},"./src/types/transmuxer.ts":(N,O,v)=>{v.r(O),v.d(O,{ChunkMetadata:()=>M});var M=function(R,K,b,I,C,L){I===void 0&&(I=0),C===void 0&&(C=-1),L===void 0&&(L=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=S(),this.buffering={audio:S(),video:S(),audiovideo:S()},this.level=R,this.sn=K,this.id=b,this.size=I,this.part=C,this.partial=L};function S(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(N,O,v)=>{v.r(O),v.d(O,{AttrList:()=>k});var M=/^(\d+)x(\d+)$/,S=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,k=function(){function R(b){typeof b=="string"&&(b=R.parseAttrList(b));for(var I in b)b.hasOwnProperty(I)&&(this[I]=b[I])}var K=R.prototype;return K.decimalInteger=function(I){var C=parseInt(this[I],10);return C>Number.MAX_SAFE_INTEGER?1/0:C},K.hexadecimalInteger=function(I){if(this[I]){var C=(this[I]||"0x").slice(2);C=(C.length&1?"0":"")+C;for(var L=new Uint8Array(C.length/2),A=0;A<C.length/2;A++)L[A]=parseInt(C.slice(A*2,A*2+2),16);return L}else return null},K.hexadecimalIntegerAsNumber=function(I){var C=parseInt(this[I],16);return C>Number.MAX_SAFE_INTEGER?1/0:C},K.decimalFloatingPoint=function(I){return parseFloat(this[I])},K.optionalFloat=function(I,C){var L=this[I];return L?parseFloat(L):C},K.enumeratedString=function(I){return this[I]},K.bool=function(I){return this[I]==="YES"},K.decimalResolution=function(I){var C=M.exec(this[I]);if(C!==null)return{width:parseInt(C[1],10),height:parseInt(C[2],10)}},R.parseAttrList=function(I){var C,L={},A='"';for(S.lastIndex=0;(C=S.exec(I))!==null;){var h=C[2];h.indexOf(A)===0&&h.lastIndexOf(A)===h.length-1&&(h=h.slice(1,-1)),L[C[1]]=h}return L},R}()},"./src/utils/binary-search.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>S});var M={search:function(R,K){for(var b=0,I=R.length-1,C=null,L=null;b<=I;){C=(b+I)/2|0,L=R[C];var A=K(L);if(A>0)b=C+1;else if(A<0)I=C-1;else return L}return null}};const S=M},"./src/utils/buffer-helper.ts":(N,O,v)=>{v.r(O),v.d(O,{BufferHelper:()=>k});var M=v("./src/utils/logger.ts"),S={length:0,start:function(){return 0},end:function(){return 0}},k=function(){function R(){}return R.isBuffered=function(b,I){try{if(b){for(var C=R.getBuffered(b),L=0;L<C.length;L++)if(I>=C.start(L)&&I<=C.end(L))return!0}}catch{}return!1},R.bufferInfo=function(b,I,C){try{if(b){var L=R.getBuffered(b),A=[],h;for(h=0;h<L.length;h++)A.push({start:L.start(h),end:L.end(h)});return this.bufferedInfo(A,I,C)}}catch{}return{len:0,start:I,end:I,nextStart:void 0}},R.bufferedInfo=function(b,I,C){I=Math.max(0,I),b.sort(function(s,c){var _=s.start-c.start;return _||c.end-s.end});var L=[];if(C)for(var A=0;A<b.length;A++){var h=L.length;if(h){var D=L[h-1].end;b[A].start-D<C?b[A].end>D&&(L[h-1].end=b[A].end):L.push(b[A])}else L.push(b[A])}else L=b;for(var T=0,d,f=I,i=I,l=0;l<L.length;l++){var p=L[l].start,m=L[l].end;if(I+C>=p&&I<m)f=p,i=m,T=i-I;else if(I+C<p){d=p;break}}return{len:T,start:f||0,end:i||0,nextStart:d}},R.getBuffered=function(b){try{return b.buffered}catch(I){return M.logger.log("failed to get media.buffered",I),S}},R}()},"./src/utils/cea-608-parser.ts":(N,O,v)=>{v.r(O),v.d(O,{CaptionScreen:()=>l,Row:()=>i,default:()=>u});var M=v("./src/utils/logger.ts"),S={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},k=function(n){var g=n;return S.hasOwnProperty(n)&&(g=S[n]),String.fromCharCode(g)},R=15,K=100,b={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},I={17:2,18:4,21:6,22:8,23:10,19:13,20:15},C={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},L={25:2,26:4,29:6,30:8,31:10,27:13,28:15},A=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],h;(function(o){o[o.ERROR=0]="ERROR",o[o.TEXT=1]="TEXT",o[o.WARNING=2]="WARNING",o[o.INFO=2]="INFO",o[o.DEBUG=3]="DEBUG",o[o.DATA=3]="DATA"})(h||(h={}));var D=function(){function o(){this.time=null,this.verboseLevel=h.ERROR}var n=o.prototype;return n.log=function(r,E){if(this.verboseLevel>=r){var P=typeof E=="function"?E():E;M.logger.log(this.time+" ["+r+"] "+P)}},o}(),T=function(n){for(var g=[],r=0;r<n.length;r++)g.push(n[r].toString(16));return g},d=function(){function o(g,r,E,P,y){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=g||"white",this.underline=r||!1,this.italics=E||!1,this.background=P||"black",this.flash=y||!1}var n=o.prototype;return n.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},n.setStyles=function(r){for(var E=["foreground","underline","italics","background","flash"],P=0;P<E.length;P++){var y=E[P];r.hasOwnProperty(y)&&(this[y]=r[y])}},n.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},n.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},n.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},n.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},o}(),f=function(){function o(g,r,E,P,y,U){this.uchar=void 0,this.penState=void 0,this.uchar=g||" ",this.penState=new d(r,E,P,y,U)}var n=o.prototype;return n.reset=function(){this.uchar=" ",this.penState.reset()},n.setChar=function(r,E){this.uchar=r,this.penState.copy(E)},n.setPenState=function(r){this.penState.copy(r)},n.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},n.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},n.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},o}(),i=function(){function o(g){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var r=0;r<K;r++)this.chars.push(new f);this.logger=g,this.pos=0,this.currPenState=new d}var n=o.prototype;return n.equals=function(r){for(var E=!0,P=0;P<K;P++)if(!this.chars[P].equals(r.chars[P])){E=!1;break}return E},n.copy=function(r){for(var E=0;E<K;E++)this.chars[E].copy(r.chars[E])},n.isEmpty=function(){for(var r=!0,E=0;E<K;E++)if(!this.chars[E].isEmpty()){r=!1;break}return r},n.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(h.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>K&&(this.logger.log(h.DEBUG,"Too large cursor position "+this.pos),this.pos=K)},n.moveCursor=function(r){var E=this.pos+r;if(r>1)for(var P=this.pos+1;P<E+1;P++)this.chars[P].setPenState(this.currPenState);this.setCursor(E)},n.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},n.insertChar=function(r){var E=this;r>=144&&this.backSpace();var P=k(r);if(this.pos>=K){this.logger.log(h.ERROR,function(){return"Cannot insert "+r.toString(16)+" ("+P+") at position "+E.pos+". Skipping it!"});return}this.chars[this.pos].setChar(P,this.currPenState),this.moveCursor(1)},n.clearFromPos=function(r){var E;for(E=r;E<K;E++)this.chars[E].reset()},n.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},n.clearToEndOfRow=function(){this.clearFromPos(this.pos)},n.getTextString=function(){for(var r=[],E=!0,P=0;P<K;P++){var y=this.chars[P].uchar;y!==" "&&(E=!1),r.push(y)}return E?"":r.join("")},n.setPenStyles=function(r){this.currPenState.setStyles(r);var E=this.chars[this.pos];E.setPenState(this.currPenState)},o}(),l=function(){function o(g){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var r=0;r<R;r++)this.rows.push(new i(g));this.logger=g,this.currRow=R-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var n=o.prototype;return n.reset=function(){for(var r=0;r<R;r++)this.rows[r].clear();this.currRow=R-1},n.equals=function(r){for(var E=!0,P=0;P<R;P++)if(!this.rows[P].equals(r.rows[P])){E=!1;break}return E},n.copy=function(r){for(var E=0;E<R;E++)this.rows[E].copy(r.rows[E])},n.isEmpty=function(){for(var r=!0,E=0;E<R;E++)if(!this.rows[E].isEmpty()){r=!1;break}return r},n.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},n.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},n.insertChar=function(r){var E=this.rows[this.currRow];E.insertChar(r)},n.setPen=function(r){var E=this.rows[this.currRow];E.setPenStyles(r)},n.moveCursor=function(r){var E=this.rows[this.currRow];E.moveCursor(r)},n.setCursor=function(r){this.logger.log(h.INFO,"setCursor: "+r);var E=this.rows[this.currRow];E.setCursor(r)},n.setPAC=function(r){this.logger.log(h.INFO,function(){return"pacData = "+JSON.stringify(r)});var E=r.row-1;if(this.nrRollUpRows&&E<this.nrRollUpRows-1&&(E=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==E){for(var P=0;P<R;P++)this.rows[P].clear();var y=this.currRow+1-this.nrRollUpRows,U=this.lastOutputScreen;if(U){var B=U.rows[y].cueStartTime,w=this.logger.time;if(B&&w!==null&&B<w)for(var H=0;H<this.nrRollUpRows;H++)this.rows[E-this.nrRollUpRows+H+1].copy(U.rows[y+H])}}this.currRow=E;var G=this.rows[this.currRow];if(r.indent!==null){var V=r.indent,z=Math.max(V-1,0);G.setCursor(r.indent),r.color=G.chars[z].penState.foreground}var $={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen($)},n.setBkgData=function(r){this.logger.log(h.INFO,function(){return"bkgData = "+JSON.stringify(r)}),this.backSpace(),this.setPen(r),this.insertChar(32)},n.setRollUpRows=function(r){this.nrRollUpRows=r},n.rollUp=function(){var r=this;if(this.nrRollUpRows===null){this.logger.log(h.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(h.TEXT,function(){return r.getDisplayText()});var E=this.currRow+1-this.nrRollUpRows,P=this.rows.splice(E,1)[0];P.clear(),this.rows.splice(this.currRow,0,P),this.logger.log(h.INFO,"Rolling up")},n.getDisplayText=function(r){r=r||!1;for(var E=[],P="",y=-1,U=0;U<R;U++){var B=this.rows[U].getTextString();B&&(y=U+1,r?E.push("Row "+y+": '"+B+"'"):E.push(B.trim()))}return E.length>0&&(r?P="["+E.join(" | ")+"]":P=E.join(`
`)),P},n.getTextAndFormat=function(){return this.rows},o}(),p=function(){function o(g,r,E){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=g,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new l(E),this.nonDisplayedMemory=new l(E),this.lastOutputScreen=new l(E),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=E}var n=o.prototype;return n.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[R-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},n.getHandler=function(){return this.outputFilter},n.setHandler=function(r){this.outputFilter=r},n.setPAC=function(r){this.writeScreen.setPAC(r)},n.setBkgData=function(r){this.writeScreen.setBkgData(r)},n.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(h.INFO,function(){return"MODE="+r}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},n.insertChars=function(r){for(var E=this,P=0;P<r.length;P++)this.writeScreen.insertChar(r[P]);var y=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(h.INFO,function(){return y+": "+E.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(h.TEXT,function(){return"DISPLAYED: "+E.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},n.ccRCL=function(){this.logger.log(h.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},n.ccBS=function(){this.logger.log(h.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},n.ccAOF=function(){},n.ccAON=function(){},n.ccDER=function(){this.logger.log(h.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},n.ccRU=function(r){this.logger.log(h.INFO,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},n.ccFON=function(){this.logger.log(h.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},n.ccRDC=function(){this.logger.log(h.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},n.ccTR=function(){this.logger.log(h.INFO,"TR"),this.setMode("MODE_TEXT")},n.ccRTD=function(){this.logger.log(h.INFO,"RTD"),this.setMode("MODE_TEXT")},n.ccEDM=function(){this.logger.log(h.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},n.ccCR=function(){this.logger.log(h.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},n.ccENM=function(){this.logger.log(h.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},n.ccEOC=function(){var r=this;if(this.logger.log(h.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var E=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=E,this.writeScreen=this.nonDisplayedMemory,this.logger.log(h.TEXT,function(){return"DISP: "+r.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},n.ccTO=function(r){this.logger.log(h.INFO,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},n.ccMIDROW=function(r){var E={flash:!1};if(E.underline=r%2===1,E.italics=r>=46,E.italics)E.foreground="white";else{var P=Math.floor(r/2)-16,y=["white","green","blue","cyan","red","yellow","magenta"];E.foreground=y[P]}this.logger.log(h.INFO,"MIDROW: "+JSON.stringify(E)),this.writeScreen.setPen(E)},n.outputDataUpdate=function(r){r===void 0&&(r=!1);var E=this.logger.time;E!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=E:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,E,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:E),this.lastOutputScreen.copy(this.displayedMemory))},n.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},o}(),m=function(){function o(g,r,E){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var P=new D;this.channels=[null,new p(g,r,P),new p(g+1,E,P)],this.cmdHistory=_(),this.logger=P}var n=o.prototype;return n.getHandler=function(r){return this.channels[r].getHandler()},n.setHandler=function(r,E){this.channels[r].setHandler(E)},n.addData=function(r,E){var P,y,U,B=!1;this.logger.time=r;for(var w=0;w<E.length;w+=2)if(y=E[w]&127,U=E[w+1]&127,!(y===0&&U===0)){if(this.logger.log(h.DATA,"["+T([E[w],E[w+1]])+"] -> ("+T([y,U])+")"),P=this.parseCmd(y,U),P||(P=this.parseMidrow(y,U)),P||(P=this.parsePAC(y,U)),P||(P=this.parseBackgroundAttributes(y,U)),!P&&(B=this.parseChars(y,U),B)){var H=this.currentChannel;if(H&&H>0){var G=this.channels[H];G.insertChars(B)}else this.logger.log(h.WARNING,"No channel found yet. TEXT-MODE?")}!P&&!B&&this.logger.log(h.WARNING,"Couldn't parse cleaned data "+T([y,U])+" orig: "+T([E[w],E[w+1]]))}},n.parseCmd=function(r,E){var P=this.cmdHistory,y=(r===20||r===28||r===21||r===29)&&E>=32&&E<=47,U=(r===23||r===31)&&E>=33&&E<=35;if(!(y||U))return!1;if(c(r,E,P))return s(null,null,P),this.logger.log(h.DEBUG,"Repeated command ("+T([r,E])+") is dropped"),!0;var B=r===20||r===21||r===23?1:2,w=this.channels[B];return r===20||r===21||r===28||r===29?E===32?w.ccRCL():E===33?w.ccBS():E===34?w.ccAOF():E===35?w.ccAON():E===36?w.ccDER():E===37?w.ccRU(2):E===38?w.ccRU(3):E===39?w.ccRU(4):E===40?w.ccFON():E===41?w.ccRDC():E===42?w.ccTR():E===43?w.ccRTD():E===44?w.ccEDM():E===45?w.ccCR():E===46?w.ccENM():E===47&&w.ccEOC():w.ccTO(E-32),s(r,E,P),this.currentChannel=B,!0},n.parseMidrow=function(r,E){var P=0;if((r===17||r===25)&&E>=32&&E<=47){if(r===17?P=1:P=2,P!==this.currentChannel)return this.logger.log(h.ERROR,"Mismatch channel in midrow parsing"),!1;var y=this.channels[P];return y?(y.ccMIDROW(E),this.logger.log(h.DEBUG,"MIDROW ("+T([r,E])+")"),!0):!1}return!1},n.parsePAC=function(r,E){var P,y=this.cmdHistory,U=(r>=17&&r<=23||r>=25&&r<=31)&&E>=64&&E<=127,B=(r===16||r===24)&&E>=64&&E<=95;if(!(U||B))return!1;if(c(r,E,y))return s(null,null,y),!0;var w=r<=23?1:2;E>=64&&E<=95?P=w===1?b[r]:C[r]:P=w===1?I[r]:L[r];var H=this.channels[w];return H?(H.setPAC(this.interpretPAC(P,E)),s(r,E,y),this.currentChannel=w,!0):!1},n.interpretPAC=function(r,E){var P,y={color:null,italics:!1,indent:null,underline:!1,row:r};return E>95?P=E-96:P=E-64,y.underline=(P&1)===1,P<=13?y.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(P/2)]:P<=15?(y.italics=!0,y.color="white"):y.indent=Math.floor((P-16)/2)*4,y},n.parseChars=function(r,E){var P,y=null,U=null;if(r>=25?(P=2,U=r-8):(P=1,U=r),U>=17&&U<=19){var B;U===17?B=E+80:U===18?B=E+112:B=E+144,this.logger.log(h.INFO,"Special char '"+k(B)+"' in channel "+P),y=[B]}else r>=32&&r<=127&&(y=E===0?[r]:[r,E]);if(y){var w=T(y);this.logger.log(h.DEBUG,"Char codes =  "+w.join(",")),s(r,E,this.cmdHistory)}return y},n.parseBackgroundAttributes=function(r,E){var P=(r===16||r===24)&&E>=32&&E<=47,y=(r===23||r===31)&&E>=45&&E<=47;if(!(P||y))return!1;var U,B={};r===16||r===24?(U=Math.floor((E-32)/2),B.background=A[U],E%2===1&&(B.background=B.background+"_semi")):E===45?B.background="transparent":(B.foreground="black",E===47&&(B.underline=!0));var w=r<=23?1:2,H=this.channels[w];return H.setBkgData(B),s(r,E,this.cmdHistory),!0},n.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var E=this.channels[r];E&&E.reset()}this.cmdHistory=_()},n.cueSplitAtTime=function(r){for(var E=0;E<this.channels.length;E++){var P=this.channels[E];P&&P.cueSplitAtTime(r)}},o}();function s(o,n,g){g.a=o,g.b=n}function c(o,n,g){return g.a===o&&g.b===n}function _(){return{a:null,b:null}}const u=m},"./src/utils/codecs.ts":(N,O,v)=>{v.r(O),v.d(O,{isCodecSupportedInMp4:()=>k,isCodecType:()=>S});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function S(R,K){var b=M[K];return!!b&&b[R.slice(0,4)]===!0}function k(R,K){return MediaSource.isTypeSupported((K||"video")+'/mp4;codecs="'+R+'"')}},"./src/utils/cues.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>b});var M=v("./src/utils/vttparser.ts"),S=v("./src/utils/webvtt-parser.ts"),k=v("./src/utils/texttrack-utils.ts"),R=/\s/,K={newCue:function(C,L,A,h){for(var D=[],T,d,f,i,l,p=self.VTTCue||self.TextTrackCue,m=0;m<h.rows.length;m++)if(T=h.rows[m],f=!0,i=0,l="",!T.isEmpty()){for(var s=0;s<T.chars.length;s++)R.test(T.chars[s].uchar)&&f?i++:(l+=T.chars[s].uchar,f=!1);T.cueStartTime=L,L===A&&(A+=1e-4),i>=16?i--:i++;var c=(0,M.fixLineBreaks)(l.trim()),_=(0,S.generateCueId)(L,A,c);(!C||!C.cues||!C.cues.getCueById(_))&&(d=new p(L,A,c),d.id=_,d.line=m+1,d.align="left",d.position=10+Math.min(80,Math.floor(i*8/32)*10),D.push(d))}return C&&D.length&&(D.sort(function(u,o){return u.line==="auto"||o.line==="auto"?0:u.line>8&&o.line>8?o.line-u.line:u.line-o.line}),D.forEach(function(u){return(0,k.addCueToTrack)(C,u)})),D}};const b=K},"./src/utils/discontinuities.ts":(N,O,v)=>{v.r(O),v.d(O,{adjustSlidingStart:()=>C,alignMediaPlaylistByPDT:()=>D,alignPDT:()=>h,alignStream:()=>L,findDiscontinuousReferenceFrag:()=>b,findFirstFragWithCC:()=>R,shouldAlignOnDiscontinuities:()=>K});var M=v("./src/polyfills/number.ts"),S=v("./src/utils/logger.ts"),k=v("./src/controller/level-helper.ts");function R(T,d){for(var f=null,i=0,l=T.length;i<l;i++){var p=T[i];if(p&&p.cc===d){f=p;break}}return f}function K(T,d,f){return!!(d.details&&(f.endCC>f.startCC||T&&T.cc<f.startCC))}function b(T,d,f){var i=T.fragments,l=d.fragments;if(!l.length||!i.length){S.logger.log("No fragments to align");return}var p=R(i,l[0].cc);if(!p||p&&!p.startPTS){S.logger.log("No frag in previous level to align on");return}return p}function I(T,d){if(T){var f=T.start+d;T.start=T.startPTS=f,T.endPTS=f+T.duration}}function C(T,d){for(var f=d.fragments,i=0,l=f.length;i<l;i++)I(f[i],T);d.fragmentHint&&I(d.fragmentHint,T),d.alignedSliding=!0}function L(T,d,f){!d||(A(T,f,d),!f.alignedSliding&&d.details&&h(f,d.details),!f.alignedSliding&&d.details&&!f.skippedSegments&&(0,k.adjustSliding)(d.details,f))}function A(T,d,f){if(K(T,f,d)){var i=b(f.details,d);i&&(0,M.isFiniteNumber)(i.start)&&(S.logger.log("Adjusting PTS using last level due to CC increase within current level "+d.url),C(i.start,d))}}function h(T,d){if(!(!d.fragments.length||!T.hasProgramDateTime||!d.hasProgramDateTime)){var f=d.fragments[0].programDateTime,i=T.fragments[0].programDateTime,l=(i-f)/1e3+d.fragments[0].start;l&&(0,M.isFiniteNumber)(l)&&(S.logger.log("Adjusting PTS using programDateTime delta "+(i-f)+"ms, sliding:"+l.toFixed(3)+" "+T.url+" "),C(l,T))}}function D(T,d){if(!(!T.hasProgramDateTime||!d.hasProgramDateTime)){var f=T.fragments,i=d.fragments;if(!(!f.length||!i.length)){var l=Math.round(i.length/2)-1,p=i[l],m=R(f,p.cc)||f[Math.round(f.length/2)-1],s=p.programDateTime,c=m.programDateTime;if(!(s===null||c===null)){var _=(c-s)/1e3-(m.start-p.start);C(_,T)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>k});var M=v("./src/utils/ewma.ts"),S=function(){function R(b,I,C){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=C,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(b),this.fast_=new M.default(I)}var K=R.prototype;return K.update=function(I,C){var L=this.slow_,A=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new M.default(I,L.getEstimate(),L.getTotalWeight())),this.fast_.halfLife!==C&&(this.fast_=new M.default(C,A.getEstimate(),A.getTotalWeight()))},K.sample=function(I,C){I=Math.max(I,this.minDelayMs_);var L=8*C,A=I/1e3,h=L/A;this.fast_.sample(A,h),this.slow_.sample(A,h)},K.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},K.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},K.destroy=function(){},R}();const k=S},"./src/utils/ewma.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>S});var M=function(){function k(K,b,I){b===void 0&&(b=0),I===void 0&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=K,this.alpha_=K?Math.exp(Math.log(.5)/K):0,this.estimate_=b,this.totalWeight_=I}var R=k.prototype;return R.sample=function(b,I){var C=Math.pow(this.alpha_,b);this.estimate_=I*(1-C)+C*this.estimate_,this.totalWeight_+=b},R.getTotalWeight=function(){return this.totalWeight_},R.getEstimate=function(){if(this.alpha_){var b=1-Math.pow(this.alpha_,this.totalWeight_);if(b)return this.estimate_/b}return this.estimate_},k}();const S=M},"./src/utils/fetch-loader.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>l,fetchSupported:()=>D});var M=v("./src/polyfills/number.ts"),S=v("./src/loader/load-stats.ts"),k=v("./src/demux/chunk-cache.ts");function R(p,m){p.prototype=Object.create(m.prototype),p.prototype.constructor=p,L(p,m)}function K(p){var m=typeof Map=="function"?new Map:void 0;return K=function(c){if(c===null||!C(c))return c;if(typeof c!="function")throw new TypeError("Super expression must either be null or a function");if(typeof m!="undefined"){if(m.has(c))return m.get(c);m.set(c,_)}function _(){return b(c,arguments,A(this).constructor)}return _.prototype=Object.create(c.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),L(_,c)},K(p)}function b(p,m,s){return I()?b=Reflect.construct.bind():b=function(_,u,o){var n=[null];n.push.apply(n,u);var g=Function.bind.apply(_,n),r=new g;return o&&L(r,o.prototype),r},b.apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function C(p){return Function.toString.call(p).indexOf("[native code]")!==-1}function L(p,m){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,_){return c.__proto__=_,c},L(p,m)}function A(p){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},A(p)}function h(){return h=Object.assign?Object.assign.bind():function(p){for(var m=1;m<arguments.length;m++){var s=arguments[m];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(p[c]=s[c])}return p},h.apply(this,arguments)}function D(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var T=function(){function p(s){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=s.fetchSetup||f,this.controller=new self.AbortController,this.stats=new S.LoadStats}var m=p.prototype;return m.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},m.abortInternal=function(){var c=this.response;(!c||!c.ok)&&(this.stats.aborted=!0,this.controller.abort())},m.abort=function(){var c;this.abortInternal(),(c=this.callbacks)!==null&&c!==void 0&&c.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},m.load=function(c,_,u){var o=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var g=d(c,this.controller.signal),r=u.onProgress,E=c.responseType==="arraybuffer",P=E?"byteLength":"length";this.context=c,this.config=_,this.callbacks=u,this.request=this.fetchSetup(c,g),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){o.abortInternal(),u.onTimeout(n,c,o.response)},_.timeout),self.fetch(this.request).then(function(y){if(o.response=o.loader=y,!y.ok){var U=y.status,B=y.statusText;throw new i(B||"fetch, bad network response",U,y)}return n.loading.first=Math.max(self.performance.now(),n.loading.start),n.total=parseInt(y.headers.get("Content-Length")||"0"),r&&(0,M.isFiniteNumber)(_.highWaterMark)?o.loadProgressively(y,n,c,_.highWaterMark,r):E?y.arrayBuffer():y.text()}).then(function(y){var U=o.response;self.clearTimeout(o.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);var B=y[P];B&&(n.loaded=n.total=B);var w={url:U.url,data:y};r&&!(0,M.isFiniteNumber)(_.highWaterMark)&&r(n,c,y,U),u.onSuccess(w,n,c,U)}).catch(function(y){if(self.clearTimeout(o.requestTimeout),!n.aborted){var U=y&&y.code||0,B=y?y.message:null;u.onError({code:U,text:B},c,y?y.details:null)}})},m.getCacheAge=function(){var c=null;if(this.response){var _=this.response.headers.get("age");c=_?parseFloat(_):null}return c},m.loadProgressively=function(c,_,u,o,n){o===void 0&&(o=0);var g=new k.default,r=c.body.getReader(),E=function P(){return r.read().then(function(y){if(y.done)return g.dataLength&&n(_,u,g.flush(),c),Promise.resolve(new ArrayBuffer(0));var U=y.value,B=U.length;return _.loaded+=B,B<o||g.dataLength?(g.push(U),g.dataLength>=o&&n(_,u,g.flush(),c)):n(_,u,U,c),P()}).catch(function(){return Promise.reject()})};return E()},p}();function d(p,m){var s={method:"GET",mode:"cors",credentials:"same-origin",signal:m,headers:new self.Headers(h({},p.headers))};return p.rangeEnd&&s.headers.set("Range","bytes="+p.rangeStart+"-"+String(p.rangeEnd-1)),s}function f(p,m){return new self.Request(p.url,m)}var i=function(p){R(m,p);function m(s,c,_){var u;return u=p.call(this,s)||this,u.code=void 0,u.details=void 0,u.code=c,u.details=_,u}return m}(K(Error));const l=T},"./src/utils/hex.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>S});var M={hexDump:function(R){for(var K="",b=0;b<R.length;b++){var I=R[b].toString(16);I.length<2&&(I="0"+I),K+=I}return K}};const S=M},"./src/utils/imsc1-ttml-parser.ts":(N,O,v)=>{v.r(O),v.d(O,{IMSC1_CODEC:()=>C,parseIMSC1:()=>D});var M=v("./src/utils/mp4-tools.ts"),S=v("./src/utils/vttparser.ts"),k=v("./src/utils/vttcue.ts"),R=v("./src/demux/id3.ts"),K=v("./src/utils/timescale-conversion.ts"),b=v("./src/utils/webvtt-parser.ts");function I(){return I=Object.assign?Object.assign.bind():function(u){for(var o=1;o<arguments.length;o++){var n=arguments[o];for(var g in n)Object.prototype.hasOwnProperty.call(n,g)&&(u[g]=n[g])}return u},I.apply(this,arguments)}var C="stpp.ttml.im1t",L=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,A=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,h={left:"start",center:"center",right:"end",start:"start",end:"end"};function D(u,o,n,g,r){var E=(0,M.findBox)(new Uint8Array(u),["mdat"]);if(E.length===0){r(new Error("Could not parse IMSC1 mdat"));return}var P=E.map(function(U){return(0,R.utf8ArrayToStr)(U)}),y=(0,K.toTimescaleFromScale)(o,1,n);try{P.forEach(function(U){return g(T(U,y))})}catch(U){r(U)}}function T(u,o){var n=new DOMParser,g=n.parseFromString(u,"text/xml"),r=g.getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");var E={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},P=Object.keys(E).reduce(function(H,G){return H[G]=r.getAttribute("ttp:"+G)||E[G],H},{}),y=r.getAttribute("xml:space")!=="preserve",U=f(d(r,"styling","style")),B=f(d(r,"layout","region")),w=d(r,"body","[begin]");return[].map.call(w,function(H){var G=i(H,y);if(!G||!H.hasAttribute("begin"))return null;var V=s(H.getAttribute("begin"),P),z=s(H.getAttribute("dur"),P),$=s(H.getAttribute("end"),P);if(V===null)throw m(H);if($===null){if(z===null)throw m(H);$=V+z}var X=new k.default(V-o,$-o,G);X.id=(0,b.generateCueId)(X.startTime,X.endTime,X.text);var j=B[H.getAttribute("region")],Y=U[H.getAttribute("style")],Q=l(j,Y,U),J=Q.textAlign;if(J){var Z=h[J];Z&&(X.lineAlign=Z),X.align=J}return I(X,Q),X}).filter(function(H){return H!==null})}function d(u,o,n){var g=u.getElementsByTagName(o)[0];return g?[].slice.call(g.querySelectorAll(n)):[]}function f(u){return u.reduce(function(o,n){var g=n.getAttribute("xml:id");return g&&(o[g]=n),o},{})}function i(u,o){return[].slice.call(u.childNodes).reduce(function(n,g,r){var E;return g.nodeName==="br"&&r?n+`
`:(E=g.childNodes)!==null&&E!==void 0&&E.length?i(g,o):o?n+g.textContent.trim().replace(/\s+/g," "):n+g.textContent},"")}function l(u,o,n){var g="http://www.w3.org/ns/ttml#styling",r=null,E=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],P=u!=null&&u.hasAttribute("style")?u.getAttribute("style"):null;return P&&n.hasOwnProperty(P)&&(r=n[P]),E.reduce(function(y,U){var B=p(o,g,U)||p(u,g,U)||p(r,g,U);return B&&(y[U]=B),y},{})}function p(u,o,n){return u&&u.hasAttributeNS(o,n)?u.getAttributeNS(o,n):null}function m(u){return new Error("Could not parse ttml timestamp "+u)}function s(u,o){if(!u)return null;var n=(0,S.parseTimeStamp)(u);return n===null&&(L.test(u)?n=c(u,o):A.test(u)&&(n=_(u,o))),n}function c(u,o){var n=L.exec(u),g=(n[4]|0)+(n[5]|0)/o.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+g/o.frameRate}function _(u,o){var n=A.exec(u),g=Number(n[1]),r=n[2];switch(r){case"h":return g*3600;case"m":return g*60;case"ms":return g*1e3;case"f":return g/o.frameRate;case"t":return g/o.tickRate}return g}},"./src/utils/keysystem-util.ts":(N,O,v)=>{v.r(O),v.d(O,{changeEndianness:()=>k,convertDataUriToArrayBytes:()=>R,strToUtf8array:()=>K});var M=v("./src/utils/numeric-encoding-utils.ts");function S(b){var I=K(b).subarray(0,16),C=new Uint8Array(16);return C.set(I,16-I.length),C}function k(b){var I=function(L,A,h){var D=L[A];L[A]=L[h],L[h]=D};I(b,0,3),I(b,1,2),I(b,4,5),I(b,6,7)}function R(b){var I=b.split(":"),C=null;if(I[0]==="data"&&I.length===2){var L=I[1].split(";"),A=L[L.length-1].split(",");if(A.length===2){var h=A[0]==="base64",D=A[1];h?(L.splice(-1,1),C=(0,M.base64Decode)(D)):C=S(D)}}return C}function K(b){return Uint8Array.from(unescape(encodeURIComponent(b)),function(I){return I.charCodeAt(0)})}},"./src/utils/logger.ts":(N,O,v)=>{v.r(O),v.d(O,{enableLogs:()=>b,logger:()=>I});var M=function(){},S={trace:M,debug:M,log:M,warn:M,info:M,error:M},k=S;function R(C){var L=self.console[C];return L?L.bind(self.console,"["+C+"] >"):M}function K(C){for(var L=arguments.length,A=new Array(L>1?L-1:0),h=1;h<L;h++)A[h-1]=arguments[h];A.forEach(function(D){k[D]=C[D]?C[D].bind(C):R(D)})}function b(C,L){if(self.console&&C===!0||typeof C=="object"){K(C,"debug","log","info","warn","error");try{k.log('Debug logs enabled for "'+L+'"')}catch{k=S}}else k=S}var I=k},"./src/utils/mediakeys-helper.ts":(N,O,v)=>{v.r(O),v.d(O,{KeySystemFormats:()=>S,KeySystemIds:()=>R,KeySystems:()=>M,getKeySystemsForConfig:()=>I,getSupportedMediaKeySystemConfigurations:()=>L,keySystemDomainToKeySystemFormat:()=>b,keySystemFormatToKeySystemDomain:()=>k,keySystemIdToKeySystemDomain:()=>K,requestMediaKeySystemAccess:()=>C});var M;(function(h){h.CLEARKEY="org.w3.clearkey",h.FAIRPLAY="com.apple.fps",h.PLAYREADY="com.microsoft.playready",h.WIDEVINE="com.widevine.alpha"})(M||(M={}));var S;(function(h){h.CLEARKEY="org.w3.clearkey",h.FAIRPLAY="com.apple.streamingkeydelivery",h.PLAYREADY="com.microsoft.playready",h.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(S||(S={}));function k(h){switch(h){case S.FAIRPLAY:return M.FAIRPLAY;case S.PLAYREADY:return M.PLAYREADY;case S.WIDEVINE:return M.WIDEVINE;case S.CLEARKEY:return M.CLEARKEY}}var R;(function(h){h.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(R||(R={}));function K(h){if(h===R.WIDEVINE)return M.WIDEVINE}function b(h){switch(h){case M.FAIRPLAY:return S.FAIRPLAY;case M.PLAYREADY:return S.PLAYREADY;case M.WIDEVINE:return S.WIDEVINE;case M.CLEARKEY:return S.CLEARKEY}}function I(h){var D=h.drmSystems,T=h.widevineLicenseUrl,d=D?[M.FAIRPLAY,M.WIDEVINE,M.PLAYREADY,M.CLEARKEY].filter(function(f){return!!D[f]}):[];return!d[M.WIDEVINE]&&T&&d.push(M.WIDEVINE),d}var C=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function L(h,D,T,d){var f;switch(h){case M.FAIRPLAY:f=["cenc","sinf"];break;case M.WIDEVINE:case M.PLAYREADY:f=["cenc"];break;case M.CLEARKEY:f=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+h)}return A(f,D,T,d)}function A(h,D,T,d){var f={initDataTypes:h,persistentState:d.persistentState||"not-allowed",distinctiveIdentifier:d.distinctiveIdentifier||"not-allowed",sessionTypes:d.sessionTypes||[d.sessionType||"temporary"],audioCapabilities:D.map(function(i){return{contentType:'audio/mp4; codecs="'+i+'"',robustness:d.audioRobustness||"",encryptionScheme:d.audioEncryptionScheme||null}}),videoCapabilities:T.map(function(i){return{contentType:'video/mp4; codecs="'+i+'"',robustness:d.videoRobustness||"",encryptionScheme:d.videoEncryptionScheme||null}})};return[f]}},"./src/utils/mediasource-helper.ts":(N,O,v)=>{v.r(O),v.d(O,{getMediaSource:()=>M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(N,O,v)=>{v.r(O),v.d(O,{RemuxerTrackIdConfig:()=>C,appendUint8Array:()=>o,bin2str:()=>L,computeRawDurationFromSamples:()=>c,discardEPB:()=>P,findBox:()=>d,getDuration:()=>s,getStartDTS:()=>m,mp4Box:()=>U,mp4pssh:()=>B,offsetStartDTS:()=>_,parseEmsg:()=>y,parseInitSegment:()=>i,parsePssh:()=>w,parseSEIMessageFromNALu:()=>E,parseSamples:()=>n,parseSegmentIndex:()=>f,parseSinf:()=>p,patchEncyptionData:()=>l,readSint32:()=>D,readUint16:()=>A,readUint32:()=>h,segmentValidRange:()=>u,writeUint32:()=>T});var M=v("./src/loader/fragment.ts"),S=v("./src/utils/typed-array.ts"),k=v("./src/demux/id3.ts"),R=v("./src/utils/logger.ts"),K=v("./src/utils/hex.ts"),b=Math.pow(2,32)-1,I=[].push,C={video:1,audio:2,id3:3,text:4};function L(H){return String.fromCharCode.apply(null,H)}function A(H,G){var V=H[G]<<8|H[G+1];return V<0?65536+V:V}function h(H,G){var V=D(H,G);return V<0?4294967296+V:V}function D(H,G){return H[G]<<24|H[G+1]<<16|H[G+2]<<8|H[G+3]}function T(H,G,V){H[G]=V>>24,H[G+1]=V>>16&255,H[G+2]=V>>8&255,H[G+3]=V&255}function d(H,G){var V=[];if(!G.length)return V;for(var z=H.byteLength,$=0;$<z;){var X=h(H,$),j=L(H.subarray($+4,$+8)),Y=X>1?$+X:z;if(j===G[0])if(G.length===1)V.push(H.subarray($+8,Y));else{var Q=d(H.subarray($+8,Y),G.slice(1));Q.length&&I.apply(V,Q)}$=Y}return V}function f(H){var G=[],V=H[0],z=8,$=h(H,z);z+=4;var X=0,j=0;V===0?z+=8:z+=16,z+=2;var Y=H.length+j,Q=A(H,z);z+=2;for(var J=0;J<Q;J++){var Z=z,ee=h(H,Z);Z+=4;var ne=ee&2147483647,te=(ee&2147483648)>>>31;if(te===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var q=h(H,Z);Z+=4,G.push({referenceSize:ne,subsegmentDuration:q,info:{duration:q/$,start:Y,end:Y+ne-1}}),Y+=ne,Z+=4,z=Z}return{earliestPresentationTime:X,timescale:$,version:V,referencesCount:Q,references:G}}function i(H){for(var G=[],V=d(H,["moov","trak"]),z=0;z<V.length;z++){var $=V[z],X=d($,["tkhd"])[0];if(X){var j=X[0],Y=j===0?12:20,Q=h(X,Y),J=d($,["mdia","mdhd"])[0];if(J){j=J[0],Y=j===0?12:20;var Z=h(J,Y),ee=d($,["mdia","hdlr"])[0];if(ee){var ne=L(ee.subarray(8,12)),te={soun:M.ElementaryStreamTypes.AUDIO,vide:M.ElementaryStreamTypes.VIDEO}[ne];if(te){var q=d($,["mdia","minf","stbl","stsd"])[0],re=void 0;q&&(re=L(q.subarray(12,16))),G[Q]={timescale:Z,type:te},G[te]={timescale:Z,id:Q,codec:re}}}}}}var se=d(H,["moov","mvex","trex"]);return se.forEach(function(ie){var ae=h(ie,4),oe=G[ae];oe&&(oe.default={duration:h(ie,12),flags:h(ie,20)})}),G}function l(H,G){if(!H||!G)return H;var V=G.keyId;if(V&&G.isCommonEncryption){var z=d(H,["moov","trak"]);z.forEach(function($){var X=d($,["mdia","minf","stbl","stsd"])[0],j=X.subarray(8),Y=d(j,["enca"]),Q=Y.length>0;Q||(Y=d(j,["encv"])),Y.forEach(function(J){var Z=Q?J.subarray(28):J.subarray(78),ee=d(Z,["sinf"]);ee.forEach(function(ne){var te=p(ne);if(te){var q=te.subarray(8,24);q.some(function(re){return re!==0})||(R.logger.log("[eme] Patching keyId in 'enc"+(Q?"a":"v")+">sinf>>tenc' box: "+K.default.hexDump(q)+" -> "+K.default.hexDump(V)),te.set(V,8))}})})})}return H}function p(H){var G=d(H,["schm"])[0];if(G){var V=L(G.subarray(4,8));if(V==="cbcs"||V==="cenc")return d(H,["schi","tenc"])[0]}return R.logger.error("[eme] missing 'schm' box"),null}function m(H,G){return d(G,["moof","traf"]).reduce(function(V,z){var $=d(z,["tfdt"])[0],X=$[0],j=d(z,["tfhd"]).reduce(function(Y,Q){var J=h(Q,4),Z=H[J];if(Z){var ee=h($,4);X===1&&(ee*=Math.pow(2,32),ee+=h($,8));var ne=Z.timescale||9e4,te=ee/ne;if(isFinite(te)&&(Y===null||te<Y))return te}return Y},null);return j!==null&&isFinite(j)&&(V===null||j<V)?j:V},null)||0}function s(H,G){for(var V=0,z=0,$=0,X=d(H,["moof","traf"]),j=0;j<X.length;j++){var Y=X[j],Q=d(Y,["tfhd"])[0],J=h(Q,4),Z=G[J];if(!!Z){var ee=Z.default,ne=h(Q,0)|(ee==null?void 0:ee.flags),te=ee==null?void 0:ee.duration;ne&8&&(ne&2?te=h(Q,12):te=h(Q,8));for(var q=Z.timescale||9e4,re=d(Y,["trun"]),se=0;se<re.length;se++){if(V=c(re[se]),!V&&te){var ie=h(re[se],4);V=te*ie}Z.type===M.ElementaryStreamTypes.VIDEO?z+=V/q:Z.type===M.ElementaryStreamTypes.AUDIO&&($+=V/q)}}}if(z===0&&$===0){for(var ae=0,oe=d(H,["sidx"]),le=0;le<oe.length;le++){var ue=f(oe[le]);ue!=null&&ue.references&&(ae+=ue.references.reduce(function(fe,de){return fe+de.info.duration||0},0))}return ae}return z||$}function c(H){var G=h(H,0),V=8;G&1&&(V+=4),G&4&&(V+=4);for(var z=0,$=h(H,4),X=0;X<$;X++){if(G&256){var j=h(H,V);z+=j,V+=4}G&512&&(V+=4),G&1024&&(V+=4),G&2048&&(V+=4)}return z}function _(H,G,V){d(G,["moof","traf"]).forEach(function(z){d(z,["tfhd"]).forEach(function($){var X=h($,4),j=H[X];if(!!j){var Y=j.timescale||9e4;d(z,["tfdt"]).forEach(function(Q){var J=Q[0],Z=h(Q,4);if(J===0)Z-=V*Y,Z=Math.max(Z,0),T(Q,4,Z);else{Z*=Math.pow(2,32),Z+=h(Q,8),Z-=V*Y,Z=Math.max(Z,0);var ee=Math.floor(Z/(b+1)),ne=Math.floor(Z%(b+1));T(Q,4,ee),T(Q,8,ne)}})}})})}function u(H){var G={valid:null,remainder:null},V=d(H,["moof"]);if(V){if(V.length<2)return G.remainder=H,G}else return G;var z=V[V.length-1];return G.valid=(0,S.sliceUint8)(H,0,z.byteOffset-8),G.remainder=(0,S.sliceUint8)(H,z.byteOffset-8),G}function o(H,G){var V=new Uint8Array(H.length+G.length);return V.set(H),V.set(G,H.length),V}function n(H,G){var V=[],z=G.samples,$=G.timescale,X=G.id,j=!1,Y=d(z,["moof"]);return Y.map(function(Q){var J=Q.byteOffset-8,Z=d(Q,["traf"]);Z.map(function(ee){var ne=d(ee,["tfdt"]).map(function(te){var q=te[0],re=h(te,4);return q===1&&(re*=Math.pow(2,32),re+=h(te,8)),re/$})[0];return ne!==void 0&&(H=ne),d(ee,["tfhd"]).map(function(te){var q=h(te,4),re=h(te,0)&16777215,se=(re&1)!==0,ie=(re&2)!==0,ae=(re&8)!==0,oe=0,le=(re&16)!==0,ue=0,fe=(re&32)!==0,de=8;q===X&&(se&&(de+=8),ie&&(de+=4),ae&&(oe=h(te,de),de+=4),le&&(ue=h(te,de),de+=4),fe&&(de+=4),G.type==="video"&&(j=g(G.codec)),d(ee,["trun"]).map(function(ve){var Le=ve[0],Ae=h(ve,0)&16777215,De=(Ae&1)!==0,Ve=0,Ee=(Ae&4)!==0,Ce=(Ae&256)!==0,We=0,$e=(Ae&512)!==0,Xe=0,Be=(Ae&1024)!==0,we=(Ae&2048)!==0,Qe=0,tt=h(ve,4),be=8;De&&(Ve=h(ve,be),be+=4),Ee&&(be+=4);for(var ft=Ve+J,rt=0;rt<tt;rt++){if(Ce?(We=h(ve,be),be+=4):We=oe,$e?(Xe=h(ve,be),be+=4):Xe=ue,Be&&(be+=4),we&&(Le===0?Qe=h(ve,be):Qe=D(ve,be),be+=4),G.type===M.ElementaryStreamTypes.VIDEO)for(var Br=0;Br<Xe;){var wt=h(z,ft);if(ft+=4,r(j,z[ft])){var Xt=z.subarray(ft,ft+wt);E(Xt,j?2:1,H+Qe/$,V)}ft+=wt,Br+=wt+4}H+=We/$}}))})})}),V}function g(H){if(!H)return!1;var G=H.indexOf("."),V=G<0?H:H.substring(0,G);return V==="hvc1"||V==="hev1"||V==="dvh1"||V==="dvhe"}function r(H,G){if(H){var V=G>>1&63;return V===39||V===40}else{var z=G&31;return z===6}}function E(H,G,V,z){var $=P(H),X=0;X+=G;for(var j=0,Y=0,Q=!1,J=0;X<$.length;){j=0;do{if(X>=$.length)break;J=$[X++],j+=J}while(J===255);Y=0;do{if(X>=$.length)break;J=$[X++],Y+=J}while(J===255);var Z=$.length-X;if(!Q&&j===4&&X<$.length){Q=!0;var ee=$[X++];if(ee===181){var ne=A($,X);if(X+=2,ne===49){var te=h($,X);if(X+=4,te===1195456820){var q=$[X++];if(q===3){var re=$[X++],se=31&re,ie=64&re,ae=ie?2+se*3:0,oe=new Uint8Array(ae);if(ie){oe[0]=re;for(var le=1;le<ae;le++)oe[le]=$[X++]}z.push({type:q,payloadType:j,pts:V,bytes:oe})}}}}}else if(j===5&&Y<Z){if(Q=!0,Y>16){for(var ue=[],fe=0;fe<16;fe++){var de=$[X++].toString(16);ue.push(de.length==1?"0"+de:de),(fe===3||fe===5||fe===7||fe===9)&&ue.push("-")}for(var ve=Y-16,Le=new Uint8Array(ve),Ae=0;Ae<ve;Ae++)Le[Ae]=$[X++];z.push({payloadType:j,pts:V,uuid:ue.join(""),userData:(0,k.utf8ArrayToStr)(Le),userDataBytes:Le})}}else if(Y<Z)X+=Y;else if(Y>Z)break}}function P(H){for(var G=H.byteLength,V=[],z=1;z<G-2;)H[z]===0&&H[z+1]===0&&H[z+2]===3?(V.push(z+2),z+=2):z++;if(V.length===0)return H;var $=G-V.length,X=new Uint8Array($),j=0;for(z=0;z<$;j++,z++)j===V[0]&&(j++,V.shift()),X[z]=H[j];return X}function y(H){var G=H[0],V="",z="",$=0,X=0,j=0,Y=0,Q=0,J=0;if(G===0){for(;L(H.subarray(J,J+1))!=="\0";)V+=L(H.subarray(J,J+1)),J+=1;for(V+=L(H.subarray(J,J+1)),J+=1;L(H.subarray(J,J+1))!=="\0";)z+=L(H.subarray(J,J+1)),J+=1;z+=L(H.subarray(J,J+1)),J+=1,$=h(H,12),X=h(H,16),Y=h(H,20),Q=h(H,24),J=28}else if(G===1){J+=4,$=h(H,J),J+=4;var Z=h(H,J);J+=4;var ee=h(H,J);for(J+=4,j=Math.pow(2,32)*Z+ee,Number.isSafeInteger(j)||(j=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Y=h(H,J),J+=4,Q=h(H,J),J+=4;L(H.subarray(J,J+1))!=="\0";)V+=L(H.subarray(J,J+1)),J+=1;for(V+=L(H.subarray(J,J+1)),J+=1;L(H.subarray(J,J+1))!=="\0";)z+=L(H.subarray(J,J+1)),J+=1;z+=L(H.subarray(J,J+1)),J+=1}var ne=H.subarray(J,H.byteLength);return{schemeIdUri:V,value:z,timeScale:$,presentationTime:j,presentationTimeDelta:X,eventDuration:Y,id:Q,payload:ne}}function U(H){for(var G=arguments.length,V=new Array(G>1?G-1:0),z=1;z<G;z++)V[z-1]=arguments[z];for(var $=V.length,X=8,j=$;j--;)X+=V[j].byteLength;var Y=new Uint8Array(X);for(Y[0]=X>>24&255,Y[1]=X>>16&255,Y[2]=X>>8&255,Y[3]=X&255,Y.set(H,4),j=0,X=8;j<$;j++)Y.set(V[j],X),X+=V[j].byteLength;return Y}function B(H,G,V){if(H.byteLength!==16)throw new RangeError("Invalid system id");var z,$;if(G){z=1,$=new Uint8Array(G.length*16);for(var X=0;X<G.length;X++){var j=G[X];if(j.byteLength!==16)throw new RangeError("Invalid key");$.set(j,X*16)}}else z=0,$=new Uint8Array;var Y;z>0?(Y=new Uint8Array(4),G.length>0&&new DataView(Y.buffer).setUint32(0,G.length,!1)):Y=new Uint8Array;var Q=new Uint8Array(4);return V&&V.byteLength>0&&new DataView(Q.buffer).setUint32(0,V.byteLength,!1),U([112,115,115,104],new Uint8Array([z,0,0,0]),H,Y,$,Q,V||new Uint8Array)}function w(H){if(!(H instanceof ArrayBuffer)||H.byteLength<32)return null;var G={version:0,systemId:"",kids:null,data:null},V=new DataView(H),z=V.getUint32(0);if(H.byteLength!==z&&z>44)return null;var $=V.getUint32(4);if($!==1886614376||(G.version=V.getUint32(8)>>>24,G.version>1))return null;G.systemId=K.default.hexDump(new Uint8Array(H,12,16));var X=V.getUint32(28);if(G.version===0){if(z-32<X)return null;G.data=new Uint8Array(H,32,X)}else if(G.version===1){G.kids=[];for(var j=0;j<X;j++)G.kids.push(new Uint8Array(H,32+j*16,16))}return G}},"./src/utils/numeric-encoding-utils.ts":(N,O,v)=>{v.r(O),v.d(O,{base64Decode:()=>b,base64DecodeToStr:()=>k,base64Encode:()=>R,base64ToBase64Url:()=>M,base64UrlEncode:()=>K,strToBase64Encode:()=>S});function M(I){return I.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function S(I){return btoa(I)}function k(I){return atob(I)}function R(I){return btoa(String.fromCharCode.apply(String,I))}function K(I){return M(R(I))}function b(I){return Uint8Array.from(atob(I),function(C){return C.charCodeAt(0)})}},"./src/utils/output-filter.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>M});var M=function(){function S(R,K){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=R,this.trackName=K}var k=S.prototype;return k.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},k.newCue=function(K,b,I){(this.startTime===null||this.startTime>K)&&(this.startTime=K),this.endTime=b,this.screen=I,this.timelineController.createCaptionsTrack(this.trackName)},k.reset=function(){this.cueRanges=[],this.startTime=null},S}()},"./src/utils/texttrack-utils.ts":(N,O,v)=>{v.r(O),v.d(O,{addCueToTrack:()=>k,clearCurrentCues:()=>R,getCuesInRange:()=>I,removeCuesInRange:()=>K,sendAddTrackEvent:()=>S});var M=v("./src/utils/logger.ts");function S(C,L){var A;try{A=new Event("addtrack")}catch{A=document.createEvent("Event"),A.initEvent("addtrack",!1,!1)}A.track=C,L.dispatchEvent(A)}function k(C,L){var A=C.mode;if(A==="disabled"&&(C.mode="hidden"),C.cues&&!C.cues.getCueById(L.id))try{if(C.addCue(L),!C.cues.getCueById(L.id))throw new Error("addCue is failed for: "+L)}catch(D){M.logger.debug("[texttrack-utils]: "+D);var h=new self.TextTrackCue(L.startTime,L.endTime,L.text);h.id=L.id,C.addCue(h)}A==="disabled"&&(C.mode=A)}function R(C){var L=C.mode;if(L==="disabled"&&(C.mode="hidden"),C.cues)for(var A=C.cues.length;A--;)C.removeCue(C.cues[A]);L==="disabled"&&(C.mode=L)}function K(C,L,A,h){var D=C.mode;if(D==="disabled"&&(C.mode="hidden"),C.cues&&C.cues.length>0)for(var T=I(C.cues,L,A),d=0;d<T.length;d++)(!h||h(T[d]))&&C.removeCue(T[d]);D==="disabled"&&(C.mode=D)}function b(C,L){if(L<C[0].startTime)return 0;var A=C.length-1;if(L>C[A].endTime)return-1;for(var h=0,D=A;h<=D;){var T=Math.floor((D+h)/2);if(L<C[T].startTime)D=T-1;else if(L>C[T].startTime&&h<A)h=T+1;else return T}return C[h].startTime-L<L-C[D].startTime?h:D}function I(C,L,A){var h=[],D=b(C,L);if(D>-1)for(var T=D,d=C.length;T<d;T++){var f=C[T];if(f.startTime>=L&&f.endTime<=A)h.push(f);else if(f.startTime>A)return h}return h}},"./src/utils/time-ranges.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>S});var M={toString:function(R){for(var K="",b=R.length,I=0;I<b;I++)K+="["+R.start(I).toFixed(3)+"-"+R.end(I).toFixed(3)+"]";return K}};const S=M},"./src/utils/timescale-conversion.ts":(N,O,v)=>{v.r(O),v.d(O,{toMpegTsClockFromTimescale:()=>K,toMsFromMpegTsClock:()=>R,toTimescaleFromBase:()=>S,toTimescaleFromScale:()=>k});var M=9e4;function S(b,I,C,L){C===void 0&&(C=1),L===void 0&&(L=!1);var A=b*I*C;return L?Math.round(A):A}function k(b,I,C,L){return C===void 0&&(C=1),L===void 0&&(L=!1),S(b,I,1/C,L)}function R(b,I){return I===void 0&&(I=!1),S(b,1e3,1/M,I)}function K(b,I){return I===void 0&&(I=1),S(b,M,1/I)}},"./src/utils/typed-array.ts":(N,O,v)=>{v.r(O),v.d(O,{sliceUint8:()=>M});function M(S,k,R){return Uint8Array.prototype.slice?S.slice(k,R):new Uint8Array(Array.prototype.slice.call(S,k,R))}},"./src/utils/vttcue.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>M});const M=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var S=["","lr","rl"],k=["start","middle","end","left","right"];function R(L,A){if(typeof A!="string"||!Array.isArray(L))return!1;var h=A.toLowerCase();return~L.indexOf(h)?h:!1}function K(L){return R(S,L)}function b(L){return R(k,L)}function I(L){for(var A=arguments.length,h=new Array(A>1?A-1:0),D=1;D<A;D++)h[D-1]=arguments[D];for(var T=1;T<arguments.length;T++){var d=arguments[T];for(var f in d)L[f]=d[f]}return L}function C(L,A,h){var D=this,T={enumerable:!0};D.hasBeenReset=!1;var d="",f=!1,i=L,l=A,p=h,m=null,s="",c=!0,_="auto",u="start",o=50,n="middle",g=50,r="middle";Object.defineProperty(D,"id",I({},T,{get:function(){return d},set:function(P){d=""+P}})),Object.defineProperty(D,"pauseOnExit",I({},T,{get:function(){return f},set:function(P){f=!!P}})),Object.defineProperty(D,"startTime",I({},T,{get:function(){return i},set:function(P){if(typeof P!="number")throw new TypeError("Start time must be set to a number.");i=P,this.hasBeenReset=!0}})),Object.defineProperty(D,"endTime",I({},T,{get:function(){return l},set:function(P){if(typeof P!="number")throw new TypeError("End time must be set to a number.");l=P,this.hasBeenReset=!0}})),Object.defineProperty(D,"text",I({},T,{get:function(){return p},set:function(P){p=""+P,this.hasBeenReset=!0}})),Object.defineProperty(D,"region",I({},T,{get:function(){return m},set:function(P){m=P,this.hasBeenReset=!0}})),Object.defineProperty(D,"vertical",I({},T,{get:function(){return s},set:function(P){var y=K(P);if(y===!1)throw new SyntaxError("An invalid or illegal string was specified.");s=y,this.hasBeenReset=!0}})),Object.defineProperty(D,"snapToLines",I({},T,{get:function(){return c},set:function(P){c=!!P,this.hasBeenReset=!0}})),Object.defineProperty(D,"line",I({},T,{get:function(){return _},set:function(P){if(typeof P!="number"&&P!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");_=P,this.hasBeenReset=!0}})),Object.defineProperty(D,"lineAlign",I({},T,{get:function(){return u},set:function(P){var y=b(P);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");u=y,this.hasBeenReset=!0}})),Object.defineProperty(D,"position",I({},T,{get:function(){return o},set:function(P){if(P<0||P>100)throw new Error("Position must be between 0 and 100.");o=P,this.hasBeenReset=!0}})),Object.defineProperty(D,"positionAlign",I({},T,{get:function(){return n},set:function(P){var y=b(P);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");n=y,this.hasBeenReset=!0}})),Object.defineProperty(D,"size",I({},T,{get:function(){return g},set:function(P){if(P<0||P>100)throw new Error("Size must be between 0 and 100.");g=P,this.hasBeenReset=!0}})),Object.defineProperty(D,"align",I({},T,{get:function(){return r},set:function(P){var y=b(P);if(!y)throw new SyntaxError("An invalid or illegal string was specified.");r=y,this.hasBeenReset=!0}})),D.displayState=void 0}return C.prototype.getCueAsHTML=function(){var L=self.WebVTT;return L.convertCueToDOMTree(self,this.text)},C}()},"./src/utils/vttparser.ts":(N,O,v)=>{v.r(O),v.d(O,{VTTParser:()=>A,fixLineBreaks:()=>L,parseTimeStamp:()=>k});var M=v("./src/utils/vttcue.ts"),S=function(){function h(){}var D=h.prototype;return D.decode=function(d,f){if(!d)return"";if(typeof d!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(d))},h}();function k(h){function D(d,f,i,l){return(d|0)*3600+(f|0)*60+(i|0)+parseFloat(l||0)}var T=h.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return T?parseFloat(T[2])>59?D(T[2],T[3],0,T[4]):D(T[1],T[2],T[3],T[4]):null}var R=function(){function h(){this.values=Object.create(null)}var D=h.prototype;return D.set=function(d,f){!this.get(d)&&f!==""&&(this.values[d]=f)},D.get=function(d,f,i){return i?this.has(d)?this.values[d]:f[i]:this.has(d)?this.values[d]:f},D.has=function(d){return d in this.values},D.alt=function(d,f,i){for(var l=0;l<i.length;++l)if(f===i[l]){this.set(d,f);break}},D.integer=function(d,f){/^-?\d+$/.test(f)&&this.set(d,parseInt(f,10))},D.percent=function(d,f){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(f)){var i=parseFloat(f);if(i>=0&&i<=100)return this.set(d,i),!0}return!1},h}();function K(h,D,T,d){var f=d?h.split(d):[h];for(var i in f)if(typeof f[i]=="string"){var l=f[i].split(T);if(l.length===2){var p=l[0],m=l[1];D(p,m)}}}var b=new M.default(0,0,""),I=b.align==="middle"?"middle":"center";function C(h,D,T){var d=h;function f(){var p=k(h);if(p===null)throw new Error("Malformed timestamp: "+d);return h=h.replace(/^[^\sa-zA-Z-]+/,""),p}function i(p,m){var s=new R;K(p,function(u,o){var n;switch(u){case"region":for(var g=T.length-1;g>=0;g--)if(T[g].id===o){s.set(u,T[g].region);break}break;case"vertical":s.alt(u,o,["rl","lr"]);break;case"line":n=o.split(","),s.integer(u,n[0]),s.percent(u,n[0])&&s.set("snapToLines",!1),s.alt(u,n[0],["auto"]),n.length===2&&s.alt("lineAlign",n[1],["start",I,"end"]);break;case"position":n=o.split(","),s.percent(u,n[0]),n.length===2&&s.alt("positionAlign",n[1],["start",I,"end","line-left","line-right","auto"]);break;case"size":s.percent(u,o);break;case"align":s.alt(u,o,["start",I,"end","left","right"]);break}},/:/,/\s/),m.region=s.get("region",null),m.vertical=s.get("vertical","");var c=s.get("line","auto");c==="auto"&&b.line===-1&&(c=-1),m.line=c,m.lineAlign=s.get("lineAlign","start"),m.snapToLines=s.get("snapToLines",!0),m.size=s.get("size",100),m.align=s.get("align",I);var _=s.get("position","auto");_==="auto"&&b.position===50&&(_=m.align==="start"||m.align==="left"?0:m.align==="end"||m.align==="right"?100:50),m.position=_}function l(){h=h.replace(/^\s+/,"")}if(l(),D.startTime=f(),l(),h.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+d);h=h.slice(3),l(),D.endTime=f(),l(),i(h,D)}function L(h){return h.replace(/<br(?: \/)?>/gi,`
`)}var A=function(){function h(){this.state="INITIAL",this.buffer="",this.decoder=new S,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var D=h.prototype;return D.parse=function(d){var f=this;d&&(f.buffer+=f.decoder.decode(d,{stream:!0}));function i(){var _=f.buffer,u=0;for(_=L(_);u<_.length&&_[u]!=="\r"&&_[u]!==`
`;)++u;var o=_.slice(0,u);return _[u]==="\r"&&++u,_[u]===`
`&&++u,f.buffer=_.slice(u),o}function l(_){K(_,function(u,o){},/:/)}try{var p="";if(f.state==="INITIAL"){if(!/\r\n|\n/.test(f.buffer))return this;p=i();var m=p.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!m||!m[0])throw new Error("Malformed WebVTT signature.");f.state="HEADER"}for(var s=!1;f.buffer;){if(!/\r\n|\n/.test(f.buffer))return this;switch(s?s=!1:p=i(),f.state){case"HEADER":/:/.test(p)?l(p):p||(f.state="ID");continue;case"NOTE":p||(f.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(p)){f.state="NOTE";break}if(!p)continue;if(f.cue=new M.default(0,0,""),f.state="CUE",p.indexOf("-->")===-1){f.cue.id=p;continue}case"CUE":if(!f.cue){f.state="BADCUE";continue}try{C(p,f.cue,f.regionList)}catch{f.cue=null,f.state="BADCUE";continue}f.state="CUETEXT";continue;case"CUETEXT":{var c=p.indexOf("-->")!==-1;if(!p||c&&(s=!0)){f.oncue&&f.cue&&f.oncue(f.cue),f.cue=null,f.state="ID";continue}if(f.cue===null)continue;f.cue.text&&(f.cue.text+=`
`),f.cue.text+=p}continue;case"BADCUE":p||(f.state="ID")}}}catch{f.state==="CUETEXT"&&f.cue&&f.oncue&&f.oncue(f.cue),f.cue=null,f.state=f.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},D.flush=function(){var d=this;try{if((d.cue||d.state==="HEADER")&&(d.buffer+=`

`,d.parse()),d.state==="INITIAL"||d.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(f){d.onparsingerror&&d.onparsingerror(f)}return d.onflush&&d.onflush(),this},h}()},"./src/utils/webvtt-parser.ts":(N,O,v)=>{v.r(O),v.d(O,{generateCueId:()=>A,parseWebVTT:()=>D});var M=v("./src/polyfills/number.ts"),S=v("./src/utils/vttparser.ts"),k=v("./src/demux/id3.ts"),R=v("./src/utils/timescale-conversion.ts"),K=v("./src/remux/mp4-remuxer.ts"),b=/\r\n|\n\r|\n|\r/g,I=function(d,f,i){return i===void 0&&(i=0),d.slice(i,i+f.length)===f},C=function(d){var f=parseInt(d.slice(-3)),i=parseInt(d.slice(-6,-4)),l=parseInt(d.slice(-9,-7)),p=d.length>9?parseInt(d.substring(0,d.indexOf(":"))):0;if(!(0,M.isFiniteNumber)(f)||!(0,M.isFiniteNumber)(i)||!(0,M.isFiniteNumber)(l)||!(0,M.isFiniteNumber)(p))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+d);return f+=1e3*i,f+=60*1e3*l,f+=60*60*1e3*p,f},L=function(d){for(var f=5381,i=d.length;i;)f=f*33^d.charCodeAt(--i);return(f>>>0).toString()};function A(T,d,f){return L(T.toString())+L(d.toString())+L(f)}var h=function(d,f,i){var l=d[f],p=d[l.prevCC];if(!p||!p.new&&l.new){d.ccOffset=d.presentationOffset=l.start,l.new=!1;return}for(;(m=p)!==null&&m!==void 0&&m.new;){var m;d.ccOffset+=l.start-p.start,l.new=!1,l=p,p=d[l.prevCC]}d.presentationOffset=i};function D(T,d,f,i,l,p,m,s){var c=new S.VTTParser,_=(0,k.utf8ArrayToStr)(new Uint8Array(T)).trim().replace(b,`
`).split(`
`),u=[],o=(0,R.toMpegTsClockFromTimescale)(d,f),n="00:00.000",g=0,r=0,E,P=!0;c.oncue=function(y){var U=i[l],B=i.ccOffset,w=(g-o)/9e4;U!=null&&U.new&&(r!==void 0?B=i.ccOffset=U.start:h(i,l,w)),w&&(B=w-i.presentationOffset);var H=y.endTime-y.startTime,G=(0,K.normalizePts)((y.startTime+B-r)*9e4,p*9e4)/9e4;y.startTime=Math.max(G,0),y.endTime=Math.max(G+H,0);var V=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(V)),y.id||(y.id=A(y.startTime,y.endTime,V)),y.endTime>0&&u.push(y)},c.onparsingerror=function(y){E=y},c.onflush=function(){if(E){s(E);return}m(u)},_.forEach(function(y){if(P)if(I(y,"X-TIMESTAMP-MAP=")){P=!1,y.slice(16).split(",").forEach(function(U){I(U,"LOCAL:")?n=U.slice(6):I(U,"MPEGTS:")&&(g=parseInt(U.slice(7)))});try{r=C(n)/1e3}catch(U){E=U}return}else y===""&&(P=!1);c.parse(y+`
`)}),c.flush()}},"./src/utils/xhr-loader.ts":(N,O,v)=>{v.r(O),v.d(O,{default:()=>K});var M=v("./src/utils/logger.ts"),S=v("./src/loader/load-stats.ts"),k=/^age:\s*[\d.]+\s*$/m,R=function(){function b(C){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=C?C.xhrSetup:null,this.stats=new S.LoadStats,this.retryDelay=0}var I=b.prototype;return I.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},I.abortInternal=function(){var L=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),L&&(L.onreadystatechange=null,L.onprogress=null,L.readyState!==4&&(this.stats.aborted=!0,L.abort()))},I.abort=function(){var L;this.abortInternal(),(L=this.callbacks)!==null&&L!==void 0&&L.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},I.load=function(L,A,h){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=L,this.config=A,this.callbacks=h,this.retryDelay=A.retryDelay,this.loadInternal()},I.loadInternal=function(){var L=this.config,A=this.context;if(!!L){var h=this.loader=new self.XMLHttpRequest,D=this.stats;D.loading.first=0,D.loaded=0;var T=this.xhrSetup;try{if(T)try{T(h,A.url)}catch{h.open("GET",A.url,!0),T(h,A.url)}h.readyState||h.open("GET",A.url,!0);var d=this.context.headers;if(d)for(var f in d)h.setRequestHeader(f,d[f])}catch(i){this.callbacks.onError({code:h.status,text:i.message},A,h);return}A.rangeEnd&&h.setRequestHeader("Range","bytes="+A.rangeStart+"-"+(A.rangeEnd-1)),h.onreadystatechange=this.readystatechange.bind(this),h.onprogress=this.loadprogress.bind(this),h.responseType=A.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),L.timeout),h.send()}},I.readystatechange=function(){var L=this.context,A=this.loader,h=this.stats;if(!(!L||!A)){var D=A.readyState,T=this.config;if(!h.aborted&&D>=2)if(self.clearTimeout(this.requestTimeout),h.loading.first===0&&(h.loading.first=Math.max(self.performance.now(),h.loading.start)),D===4){A.onreadystatechange=null,A.onprogress=null;var d=A.status,f=A.responseType==="arraybuffer";if(d>=200&&d<300&&(f&&A.response||A.responseText!==null)){h.loading.end=Math.max(self.performance.now(),h.loading.first);var i,l;if(f?(i=A.response,l=i.byteLength):(i=A.responseText,l=i.length),h.loaded=h.total=l,!this.callbacks)return;var p=this.callbacks.onProgress;if(p&&p(h,L,i,A),!this.callbacks)return;var m={url:A.responseURL,data:i};this.callbacks.onSuccess(m,h,L,A)}else h.retry>=T.maxRetry||d>=400&&d<499?(M.logger.error(d+" while loading "+L.url),this.callbacks.onError({code:d,text:A.statusText},L,A)):(M.logger.warn(d+" while loading "+L.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),h.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},I.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var L=this.callbacks;L&&(this.abortInternal(),L.onTimeout(this.stats,this.context,this.loader))},I.loadprogress=function(L){var A=this.stats;A.loaded=L.loaded,L.lengthComputable&&(A.total=L.total)},I.getCacheAge=function(){var L=null;if(this.loader&&k.test(this.loader.getAllResponseHeaders())){var A=this.loader.getResponseHeader("age");L=A?parseFloat(A):null}return L},b}();const K=R},"./node_modules/eventemitter3/index.js":N=>{var O=Object.prototype.hasOwnProperty,v="~";function M(){}Object.create&&(M.prototype=Object.create(null),new M().__proto__||(v=!1));function S(b,I,C){this.fn=b,this.context=I,this.once=C||!1}function k(b,I,C,L,A){if(typeof C!="function")throw new TypeError("The listener must be a function");var h=new S(C,L||b,A),D=v?v+I:I;return b._events[D]?b._events[D].fn?b._events[D]=[b._events[D],h]:b._events[D].push(h):(b._events[D]=h,b._eventsCount++),b}function R(b,I){--b._eventsCount===0?b._events=new M:delete b._events[I]}function K(){this._events=new M,this._eventsCount=0}K.prototype.eventNames=function(){var I=[],C,L;if(this._eventsCount===0)return I;for(L in C=this._events)O.call(C,L)&&I.push(v?L.slice(1):L);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(C)):I},K.prototype.listeners=function(I){var C=v?v+I:I,L=this._events[C];if(!L)return[];if(L.fn)return[L.fn];for(var A=0,h=L.length,D=new Array(h);A<h;A++)D[A]=L[A].fn;return D},K.prototype.listenerCount=function(I){var C=v?v+I:I,L=this._events[C];return L?L.fn?1:L.length:0},K.prototype.emit=function(I,C,L,A,h,D){var T=v?v+I:I;if(!this._events[T])return!1;var d=this._events[T],f=arguments.length,i,l;if(d.fn){switch(d.once&&this.removeListener(I,d.fn,void 0,!0),f){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,C),!0;case 3:return d.fn.call(d.context,C,L),!0;case 4:return d.fn.call(d.context,C,L,A),!0;case 5:return d.fn.call(d.context,C,L,A,h),!0;case 6:return d.fn.call(d.context,C,L,A,h,D),!0}for(l=1,i=new Array(f-1);l<f;l++)i[l-1]=arguments[l];d.fn.apply(d.context,i)}else{var p=d.length,m;for(l=0;l<p;l++)switch(d[l].once&&this.removeListener(I,d[l].fn,void 0,!0),f){case 1:d[l].fn.call(d[l].context);break;case 2:d[l].fn.call(d[l].context,C);break;case 3:d[l].fn.call(d[l].context,C,L);break;case 4:d[l].fn.call(d[l].context,C,L,A);break;default:if(!i)for(m=1,i=new Array(f-1);m<f;m++)i[m-1]=arguments[m];d[l].fn.apply(d[l].context,i)}}return!0},K.prototype.on=function(I,C,L){return k(this,I,C,L,!1)},K.prototype.once=function(I,C,L){return k(this,I,C,L,!0)},K.prototype.removeListener=function(I,C,L,A){var h=v?v+I:I;if(!this._events[h])return this;if(!C)return R(this,h),this;var D=this._events[h];if(D.fn)D.fn===C&&(!A||D.once)&&(!L||D.context===L)&&R(this,h);else{for(var T=0,d=[],f=D.length;T<f;T++)(D[T].fn!==C||A&&!D[T].once||L&&D[T].context!==L)&&d.push(D[T]);d.length?this._events[h]=d.length===1?d[0]:d:R(this,h)}return this},K.prototype.removeAllListeners=function(I){var C;return I?(C=v?v+I:I,this._events[C]&&R(this,C)):(this._events=new M,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=v,K.EventEmitter=K,N.exports=K},"./node_modules/url-toolkit/src/url-toolkit.js":function(N){(function(O){var v=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,M=/^(?=([^\/?#]*))\1([^]*)$/,S=/(?:\/|^)\.(?=\/)/g,k=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(K,b,I){if(I=I||{},K=K.trim(),b=b.trim(),!b){if(!I.alwaysNormalize)return K;var C=R.parseURL(K);if(!C)throw new Error("Error trying to parse base URL.");return C.path=R.normalizePath(C.path),R.buildURLFromParts(C)}var L=R.parseURL(b);if(!L)throw new Error("Error trying to parse relative URL.");if(L.scheme)return I.alwaysNormalize?(L.path=R.normalizePath(L.path),R.buildURLFromParts(L)):b;var A=R.parseURL(K);if(!A)throw new Error("Error trying to parse base URL.");if(!A.netLoc&&A.path&&A.path[0]!=="/"){var h=M.exec(A.path);A.netLoc=h[1],A.path=h[2]}A.netLoc&&!A.path&&(A.path="/");var D={scheme:A.scheme,netLoc:L.netLoc,path:null,params:L.params,query:L.query,fragment:L.fragment};if(!L.netLoc&&(D.netLoc=A.netLoc,L.path[0]!=="/"))if(!L.path)D.path=A.path,L.params||(D.params=A.params,L.query||(D.query=A.query));else{var T=A.path,d=T.substring(0,T.lastIndexOf("/")+1)+L.path;D.path=R.normalizePath(d)}return D.path===null&&(D.path=I.alwaysNormalize?R.normalizePath(L.path):L.path),R.buildURLFromParts(D)},parseURL:function(K){var b=v.exec(K);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(K){for(K=K.split("").reverse().join("").replace(S,"");K.length!==(K=K.replace(k,"")).length;);return K.split("").reverse().join("")},buildURLFromParts:function(K){return K.scheme+K.netLoc+K.path+K.params+K.query+K.fragment}};N.exports=R})()}},x={};function F(N){var O=x[N];if(O!==void 0)return O.exports;var v=x[N]={exports:{}};return a[N].call(v.exports,v,v.exports,F),v.exports}F.m=a,F.n=N=>{var O=N&&N.__esModule?()=>N.default:()=>N;return F.d(O,{a:O}),O},F.d=(N,O)=>{for(var v in O)F.o(O,v)&&!F.o(N,v)&&Object.defineProperty(N,v,{enumerable:!0,get:O[v]})},F.o=(N,O)=>Object.prototype.hasOwnProperty.call(N,O),F.r=N=>{typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(N,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(N,"__esModule",{value:!0})};var W=F("./src/hls.ts");return W=W.default,W})())})(wo);var Hn=gh(wo.exports),mh="/img/cat.jpg";const ph={mounted(){let e=new Hn,t="https://live.rouquin.me:8888/hls/live_883158378_G7hEwywoc201aCskN8ZKD2KDHHQ3Yd.m3u8",a=document.getElementById("video");e.on(Hn.Events.MEDIA_ATTACHED,function(){console.log("video and hls.js are now bound together !")}),e.on(Hn.Events.MANIFEST_PARSED,function(x,F){console.log("manifest loaded, found "+F.levels.length+" quality level"),a.play()}),e.loadSource(t),e.attachMedia(a)}},Eh={id:"video",autoplay:"true",controls:"controls",poster:mh};function yh(e,t,a,x,F,W){return Fr(),Ai("video",Eh)}var Th=Fi(ph,[["render",yh],["__file","MyLive.vue"]]),_h=Mt({enhance({app:e,router:t,siteData:a}){e.component("MyLive",Th)},setup(){},rootComponents:[]});const Gn=[Jc,ed,id,md,Td,Ad,hh,_h],Sh=[["v-8daa1a0e","/",{title:""},["/index.html","/index.md"]],["v-3706649a","/404.html",{title:""},["/404"]]];var xh=()=>Sh.reduce((e,[t,a,x,F])=>(e.push({name:t,path:a,component:xs,meta:x},...F.map(W=>({path:W,redirect:a}))),e),[{name:"404",path:"/:catchAll(.*)",component:xs}]),Lh=oc,Ah=()=>{const e=jc({history:Lh(bf(Pt.value.base)),routes:xh(),scrollBehavior:(t,a,x)=>x||(t.hash?{el:t.hash}:{top:0})});return e.beforeResolve(async(t,a)=>{var x;(t.path!==a.path||a===gt)&&([pt.value]=await Promise.all([Nt.resolvePageData(t.name),(x=ro[t.name])==null?void 0:x.__asyncLoader()]))}),e},Dh=e=>{e.component("ClientOnly",Wf),e.component("Content",Hf)},Ph=(e,t)=>{const a=Se(()=>Nt.resolveRouteLocale(Pt.value.locales,t.currentRoute.value.path)),x=Se(()=>Nt.resolveSiteLocaleData(Pt.value,a.value)),F=Se(()=>Nt.resolvePageFrontmatter(pt.value)),W=Se(()=>Nt.resolvePageHeadTitle(pt.value,x.value)),N=Se(()=>Nt.resolvePageHead(W.value,F.value,x.value)),O=Se(()=>Nt.resolvePageLang(pt.value));return e.provide(Ii,a),e.provide(lo,x),e.provide(so,F),e.provide(kf,W),e.provide(ao,N),e.provide(oo,O),Object.defineProperties(e.config.globalProperties,{$frontmatter:{get:()=>F.value},$head:{get:()=>N.value},$headTitle:{get:()=>W.value},$lang:{get:()=>O.value},$page:{get:()=>pt.value},$routeLocale:{get:()=>a.value},$site:{get:()=>Pt.value},$siteLocale:{get:()=>x.value},$withBase:{get:()=>Gf}}),{pageData:pt,pageFrontmatter:F,pageHead:N,pageHeadTitle:W,pageLang:O,routeLocale:a,siteData:Pt,siteLocaleData:x}},Rh=()=>{const e=Mi(),t=Ff(),a=Uf(),x=ke([]),F=()=>{t.value.forEach(N=>{const O=Ih(N);O&&x.value.push(O)})},W=()=>{document.documentElement.lang=a.value,x.value.forEach(N=>{N.parentNode===document.head&&document.head.removeChild(N)}),x.value.splice(0,x.value.length),t.value.forEach(N=>{const O=Ch(N);O!==null&&(document.head.appendChild(O),x.value.push(O))})};Yt(Kf,W),Ot(()=>{F(),W(),Et(()=>e.path,()=>W())})},Ih=([e,t,a=""])=>{const x=Object.entries(t).map(([O,v])=>Te(v)?`[${O}="${v}"]`:v===!0?`[${O}]`:"").join(""),F=`head > ${e}${x}`;return Array.from(document.querySelectorAll(F)).find(O=>O.innerText===a)||null},Ch=([e,t,a])=>{if(!Te(e))return null;const x=document.createElement(e);return eo(t)&&Object.entries(t).forEach(([F,W])=>{Te(W)?x.setAttribute(F,W):W===!0&&x.setAttribute(F,"")}),Te(a)&&x.appendChild(document.createTextNode(a)),x},bh=Af,Oh=async()=>{var a;const e=bh({name:"VuepressApp",setup(){var x;Rh();for(const F of Gn)(x=F.setup)==null||x.call(F);return()=>[Pe(_o),...Gn.flatMap(({rootComponents:F=[]})=>F.map(W=>Pe(W)))]}}),t=Ah();Dh(e),Ph(e,t);for(const x of Gn)await((a=x.enhance)==null?void 0:a.call(x,{app:e,router:t,siteData:Pt}));return e.use(t),{app:e,router:t}};Oh().then(({app:e,router:t})=>{t.isReady().then(()=>{e.mount("#app")})});export{Bh as $,Nf as A,Hh as B,jh as C,Pe as D,Gf as E,Ge as F,Wf as G,br as H,ke as I,Et as J,wh as K,Nh as L,Of as M,bf as N,Oi as O,Te as P,sh as Q,Ot as R,cn as S,Ri as T,kr as U,Vh as V,eo as W,Gh as X,Ti as Y,_i as Z,Fi as _,Ie as a,Si as a0,oh as a1,Xa as b,Ai as c,Oh as createVueApp,Di as d,kh as e,et as f,Mo as g,lt as h,wf as i,Se as j,ce as k,Fh as l,Uh as m,Mi as n,Fr as o,Mh as p,za as q,mu as r,Ku as s,qo as t,Bf as u,ka as v,Zl as w,Cf as x,Kh as y,Wh as z};
